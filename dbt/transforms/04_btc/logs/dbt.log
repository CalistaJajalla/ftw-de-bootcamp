[0m08:12:25.675608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16213f0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f161e051af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f161e0519a0>]}


============================== 08:12:25.685682 | e061b0be-5b36-4441-8234-6cda140ba967 ==============================
[0m08:12:25.685682 [info ] [MainThread]: Running with dbt=1.8.9
[0m08:12:25.686740 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'empty': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'fail_fast': 'False', 'introspect': 'True', 'debug': 'False', 'log_path': '/workdir/transforms/02_chinook/logs', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_experimental_parser': 'False', 'warn_error': 'None', 'use_colors': 'True', 'quiet': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '.', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'version_check': 'True', 'printer_width': '80', 'log_format': 'default'}
[0m08:12:26.225884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e061b0be-5b36-4441-8234-6cda140ba967', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1620997fd0>]}
[0m08:12:26.414257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e061b0be-5b36-4441-8234-6cda140ba967', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f161e01abe0>]}
[0m08:12:26.416010 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m08:12:26.886038 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m08:12:26.887403 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m08:12:26.888099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e061b0be-5b36-4441-8234-6cda140ba967', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f161dcf31c0>]}
[0m08:12:31.808527 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.ex_01_mpg.stg_chinook__album.sql' (models/clean/stg_chinook__album.sql.sql) depends on a source named 'chinook.albums' which was not found
[0m08:12:31.810992 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 6.3323393, "process_in_blocks": "2816", "process_kernel_time": 0.545969, "process_mem_max_rss": "100432", "process_out_blocks": "6616", "process_user_time": 5.998663}
[0m08:12:31.811740 [debug] [MainThread]: Command `dbt build` failed at 08:12:31.811528 after 6.33 seconds
[0m08:12:31.812370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16213f0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f161df36580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f161df369a0>]}
[0m08:12:31.812979 [debug] [MainThread]: Flushing usage events
[0m08:15:44.751396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09ff80310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09cbdea90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09cbde940>]}


============================== 08:15:44.760627 | 9a85211f-b6ad-4538-81e1-ca33b1791f09 ==============================
[0m08:15:44.760627 [info ] [MainThread]: Running with dbt=1.8.9
[0m08:15:44.761801 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'empty': 'False', 'static_parser': 'True', 'warn_error': 'None', 'profiles_dir': '.', 'partial_parse': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'write_json': 'True', 'indirect_selection': 'eager', 'version_check': 'True', 'introspect': 'True', 'no_print': 'None', 'log_format': 'default', 'target_path': 'None', 'debug': 'False', 'log_path': '/workdir/transforms/02_chinook/logs', 'fail_fast': 'False', 'quiet': 'False', 'use_colors': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'send_anonymous_usage_stats': 'True'}
[0m08:15:45.373139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9a85211f-b6ad-4538-81e1-ca33b1791f09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09cae1a30>]}
[0m08:15:45.566646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9a85211f-b6ad-4538-81e1-ca33b1791f09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09d02f250>]}
[0m08:15:45.567889 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m08:15:46.026707 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m08:15:46.028122 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m08:15:46.028830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '9a85211f-b6ad-4538-81e1-ca33b1791f09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09c8807c0>]}
[0m08:15:50.341294 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.ex_02_chinook.dim_album' (models/mart/dim_album.sql) depends on a node named 'stg_chinook__album' which was not found
[0m08:15:50.342913 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 5.7825723, "process_in_blocks": "26968", "process_kernel_time": 0.616956, "process_mem_max_rss": "100444", "process_out_blocks": "6624", "process_user_time": 5.770411}
[0m08:15:50.343652 [debug] [MainThread]: Command `dbt build` failed at 08:15:50.343432 after 5.78 seconds
[0m08:15:50.344297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09ff80310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09bf64220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09c5d3880>]}
[0m08:15:50.344888 [debug] [MainThread]: Flushing usage events
[0m08:16:16.719791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a69ab310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a360ba90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a360b940>]}


============================== 08:16:16.729086 | 44b6ec08-02b4-422e-b9e6-aaeb9fd15429 ==============================
[0m08:16:16.729086 [info ] [MainThread]: Running with dbt=1.8.9
[0m08:16:16.730200 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'indirect_selection': 'eager', 'version_check': 'True', 'log_format': 'default', 'write_json': 'True', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'warn_error': 'None', 'empty': 'False', 'use_colors': 'True', 'log_path': '/workdir/transforms/02_chinook/logs', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'quiet': 'False', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:16:17.317044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '44b6ec08-02b4-422e-b9e6-aaeb9fd15429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a5f53fd0>]}
[0m08:16:17.508771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '44b6ec08-02b4-422e-b9e6-aaeb9fd15429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a40f1430>]}
[0m08:16:17.510035 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m08:16:17.931558 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m08:16:17.933094 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m08:16:17.933798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '44b6ec08-02b4-422e-b9e6-aaeb9fd15429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a32a0ee0>]}
[0m08:16:22.613563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '44b6ec08-02b4-422e-b9e6-aaeb9fd15429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a32a0100>]}
[0m08:16:23.020605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '44b6ec08-02b4-422e-b9e6-aaeb9fd15429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a28df430>]}
[0m08:16:23.021460 [info ] [MainThread]: Found 4 models, 2 sources, 471 macros
[0m08:16:23.024414 [info ] [MainThread]: 
[0m08:16:23.025440 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m08:16:23.038138 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m08:16:23.045093 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m08:16:23.201277 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:16:23.202900 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:16:23.768465 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m08:16:23.796168 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m08:16:23.799628 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m08:16:23.807309 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:16:23.905579 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now create__staging)
[0m08:16:23.907226 [debug] [ThreadPool]: Creating schema "schema: "staging"
"
[0m08:16:23.922357 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create__staging, now list__mart)
[0m08:16:23.923981 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__staging)
[0m08:16:23.940565 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m08:16:24.002063 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__staging: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__staging"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'staging'
      

  ...
[0m08:16:24.013872 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:16:24.016045 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:16:24.024554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '44b6ec08-02b4-422e-b9e6-aaeb9fd15429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a5dc8940>]}
[0m08:16:24.026317 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m08:16:24.027394 [info ] [MainThread]: 
[0m08:16:24.099001 [debug] [Thread-1  ]: Began running node model.ex_02_chinook.stg_chinook__album
[0m08:16:24.100323 [info ] [Thread-1  ]: 1 of 4 START sql view model `staging`.`stg_chinook__album` ..................... [RUN]
[0m08:16:24.101329 [debug] [Thread-2  ]: Began running node model.ex_02_chinook.stg_chinook__artist
[0m08:16:24.102199 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_02_chinook.stg_chinook__album)
[0m08:16:24.103314 [info ] [Thread-2  ]: 2 of 4 START sql view model `staging`.`stg_chinook__artist` .................... [RUN]
[0m08:16:24.104282 [debug] [Thread-1  ]: Began compiling node model.ex_02_chinook.stg_chinook__album
[0m08:16:24.105385 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.stg_chinook__artist'
[0m08:16:24.125324 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_02_chinook.stg_chinook__album"
[0m08:16:24.126224 [debug] [Thread-2  ]: Began compiling node model.ex_02_chinook.stg_chinook__artist
[0m08:16:24.132324 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_02_chinook.stg_chinook__artist"
[0m08:16:24.133370 [debug] [Thread-1  ]: Began executing node model.ex_02_chinook.stg_chinook__album
[0m08:16:24.199793 [debug] [Thread-2  ]: Began executing node model.ex_02_chinook.stg_chinook__artist
[0m08:16:24.308784 [debug] [Thread-1  ]: Creating new relation stg_chinook__album
[0m08:16:24.422360 [debug] [Thread-2  ]: Creating new relation stg_chinook__artist
[0m08:16:24.512026 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_02_chinook.stg_chinook__album"
[0m08:16:24.514001 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m08:16:24.517250 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */


  create view `staging`.`stg_chinook__album` 
  
    
    
  as (
    

-- Keep album grain; standardize names/types.
select
  cast(album_id  as Nullable(Int64))      as album_id,
  cast(title     as Nullable(String))     as album_title,
  cast(artist_id as Nullable(Int64))      as artist_id
from `raw`.`albums`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:16:24.522964 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */


  create view `staging`.`stg_chinook__album` 
  
    
    
  as (
    

-- Keep album grain; standardize names/types.
select
  cast(album_id  as Nullable(Int64))      as album_id,
  cast(title     as Nullable(String))     as album_title,
  cast(artist_id as Nullable(Int64))      as artist_id
from `raw`.`albums`
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m08:16:24.604943 [debug] [Thread-1  ]: Database Error in model stg_chinook__album (models/clean/stg_chinook__album.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 497
   Code: 497. DB::Exception: ftw_user: Not enough privileges. To execute this query, it's necessary to have the grant CREATE VIEW ON staging.stg_chinook__album. (ACCESS_DENIED) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_02_chinook/models/clean/stg_chinook__album.sql
[0m08:16:24.610776 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44b6ec08-02b4-422e-b9e6-aaeb9fd15429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a24903d0>]}
[0m08:16:24.613244 [error] [Thread-1  ]: 1 of 4 ERROR creating sql view model `staging`.`stg_chinook__album` ............ [[31mERROR[0m in 0.50s]
[0m08:16:24.616098 [debug] [Thread-1  ]: Finished running node model.ex_02_chinook.stg_chinook__album
[0m08:16:24.646038 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_02_chinook.stg_chinook__artist"
[0m08:16:24.648376 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */


  create view `staging`.`stg_chinook__artist` 
  
    
    
  as (
    

-- Standardize column names/types per table; no business logic.
select
  cast(artist_id as Nullable(Int64))      as artist_id,
  cast(name      as Nullable(String))     as artist_name
from `raw`.`artists`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:16:24.654667 [debug] [Thread-2  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */


  create view `staging`.`stg_chinook__artist` 
  
    
    
  as (
    

-- Standardize column names/types per table; no business logic.
select
  cast(artist_id as Nullable(Int64))      as artist_id,
  cast(name      as Nullable(String))     as artist_name
from `raw`.`artists`
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m08:16:24.658343 [debug] [Thread-2  ]: Database Error in model stg_chinook__artist (models/clean/stg_chinook__artist.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 497
   Code: 497. DB::Exception: ftw_user: Not enough privileges. To execute this query, it's necessary to have the grant CREATE VIEW ON staging.stg_chinook__artist. (ACCESS_DENIED) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_02_chinook/models/clean/stg_chinook__artist.sql
[0m08:16:24.659818 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44b6ec08-02b4-422e-b9e6-aaeb9fd15429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a263a940>]}
[0m08:16:24.695519 [error] [Thread-2  ]: 2 of 4 ERROR creating sql view model `staging`.`stg_chinook__artist` ........... [[31mERROR[0m in 0.55s]
[0m08:16:24.697804 [debug] [Thread-2  ]: Finished running node model.ex_02_chinook.stg_chinook__artist
[0m08:16:24.699813 [debug] [Thread-4  ]: Began running node model.ex_02_chinook.dim_album
[0m08:16:24.700799 [debug] [Thread-3  ]: Began running node model.ex_02_chinook.dim_artist
[0m08:16:24.701963 [info ] [Thread-4  ]: 3 of 4 SKIP relation mart.dim_album ............................................ [[33mSKIP[0m]
[0m08:16:24.703164 [info ] [Thread-3  ]: 4 of 4 SKIP relation mart.dim_artist ........................................... [[33mSKIP[0m]
[0m08:16:24.704378 [debug] [Thread-4  ]: Finished running node model.ex_02_chinook.dim_album
[0m08:16:24.705496 [debug] [Thread-3  ]: Finished running node model.ex_02_chinook.dim_artist
[0m08:16:24.708055 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:16:24.708740 [debug] [MainThread]: Connection 'model.ex_02_chinook.stg_chinook__album' was left open.
[0m08:16:24.709328 [debug] [MainThread]: On model.ex_02_chinook.stg_chinook__album: Close
[0m08:16:24.709903 [debug] [MainThread]: Connection 'list__staging' was left open.
[0m08:16:24.710452 [debug] [MainThread]: On list__staging: Close
[0m08:16:24.711003 [debug] [MainThread]: Connection 'model.ex_02_chinook.stg_chinook__artist' was left open.
[0m08:16:24.711564 [debug] [MainThread]: On model.ex_02_chinook.stg_chinook__artist: Close
[0m08:16:24.712589 [info ] [MainThread]: 
[0m08:16:24.713298 [info ] [MainThread]: Finished running 2 view models, 2 table models in 0 hours 0 minutes and 1.69 seconds (1.69s).
[0m08:16:24.715524 [debug] [MainThread]: Command end result
[0m08:16:24.819373 [info ] [MainThread]: 
[0m08:16:24.820694 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m08:16:24.821676 [info ] [MainThread]: 
[0m08:16:24.823115 [error] [MainThread]:   Database Error in model stg_chinook__album (models/clean/stg_chinook__album.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 497
   Code: 497. DB::Exception: ftw_user: Not enough privileges. To execute this query, it's necessary to have the grant CREATE VIEW ON staging.stg_chinook__album. (ACCESS_DENIED) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_02_chinook/models/clean/stg_chinook__album.sql
[0m08:16:24.823874 [info ] [MainThread]: 
[0m08:16:24.824828 [error] [MainThread]:   Database Error in model stg_chinook__artist (models/clean/stg_chinook__artist.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 497
   Code: 497. DB::Exception: ftw_user: Not enough privileges. To execute this query, it's necessary to have the grant CREATE VIEW ON staging.stg_chinook__artist. (ACCESS_DENIED) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_02_chinook/models/clean/stg_chinook__artist.sql
[0m08:16:24.825654 [info ] [MainThread]: 
[0m08:16:24.826506 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=2 TOTAL=4
[0m08:16:24.828071 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 8.303202, "process_in_blocks": "6024", "process_kernel_time": 0.663966, "process_mem_max_rss": "114932", "process_out_blocks": "10536", "process_user_time": 6.875945}
[0m08:16:24.829117 [debug] [MainThread]: Command `dbt build` failed at 08:16:24.828903 after 8.30 seconds
[0m08:16:24.829810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a69ab310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a2834100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a5f53fd0>]}
[0m08:16:24.830395 [debug] [MainThread]: Flushing usage events
[0m08:19:17.613903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4f428310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4c087b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4c087a00>]}


============================== 08:19:17.673658 | 8c4bdebb-67b8-46b6-8115-8773f345dd57 ==============================
[0m08:19:17.673658 [info ] [MainThread]: Running with dbt=1.8.9
[0m08:19:17.674815 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True', 'profiles_dir': '.', 'version_check': 'True', 'partial_parse': 'True', 'log_path': '/workdir/transforms/02_chinook/logs', 'log_format': 'default', 'static_parser': 'True', 'fail_fast': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'no_print': 'None', 'warn_error': 'None', 'quiet': 'False', 'introspect': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'use_colors': 'True'}
[0m08:19:18.204478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8c4bdebb-67b8-46b6-8115-8773f345dd57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4f62a160>]}
[0m08:19:18.397593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8c4bdebb-67b8-46b6-8115-8773f345dd57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4c0788e0>]}
[0m08:19:18.398815 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m08:19:18.877796 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m08:19:19.294009 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m08:19:19.294981 [debug] [MainThread]: Partial parsing: updated file: ex_02_chinook://models/clean/stg_chinook__artist.sql
[0m08:19:19.295653 [debug] [MainThread]: Partial parsing: updated file: ex_02_chinook://models/clean/stg_chinook__album.sql
[0m08:19:20.170846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8c4bdebb-67b8-46b6-8115-8773f345dd57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4b458130>]}
[0m08:19:20.526413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8c4bdebb-67b8-46b6-8115-8773f345dd57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4b27d0a0>]}
[0m08:19:20.527278 [info ] [MainThread]: Found 4 models, 2 sources, 471 macros
[0m08:19:20.530252 [info ] [MainThread]: 
[0m08:19:20.531431 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m08:19:20.578367 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m08:19:20.590124 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m08:19:20.682830 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:19:20.681822 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:19:21.357610 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m08:19:21.375724 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m08:19:21.379754 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:19:21.384022 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:19:21.618177 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m08:19:21.624581 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m08:19:21.683940 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m08:19:21.689562 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m08:19:21.698422 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:19:21.703874 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:19:21.709753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c4bdebb-67b8-46b6-8115-8773f345dd57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4e842970>]}
[0m08:19:21.711492 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m08:19:21.712890 [info ] [MainThread]: 
[0m08:19:21.787891 [debug] [Thread-1  ]: Began running node model.ex_02_chinook.stg_chinook__album
[0m08:19:21.788764 [debug] [Thread-2  ]: Began running node model.ex_02_chinook.stg_chinook__artist
[0m08:19:21.789846 [info ] [Thread-1  ]: 1 of 4 START sql view model `clean`.`stg_chinook__album` ....................... [RUN]
[0m08:19:21.790964 [info ] [Thread-2  ]: 2 of 4 START sql view model `clean`.`stg_chinook__artist` ...................... [RUN]
[0m08:19:21.792128 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.stg_chinook__album'
[0m08:19:21.793096 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.stg_chinook__artist'
[0m08:19:21.793885 [debug] [Thread-1  ]: Began compiling node model.ex_02_chinook.stg_chinook__album
[0m08:19:21.794648 [debug] [Thread-2  ]: Began compiling node model.ex_02_chinook.stg_chinook__artist
[0m08:19:21.812780 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_02_chinook.stg_chinook__album"
[0m08:19:21.872382 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_02_chinook.stg_chinook__artist"
[0m08:19:21.874762 [debug] [Thread-1  ]: Began executing node model.ex_02_chinook.stg_chinook__album
[0m08:19:21.876600 [debug] [Thread-2  ]: Began executing node model.ex_02_chinook.stg_chinook__artist
[0m08:19:22.203849 [debug] [Thread-2  ]: Creating new relation stg_chinook__artist
[0m08:19:22.206353 [debug] [Thread-1  ]: Creating new relation stg_chinook__album
[0m08:19:22.374089 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m08:19:22.379606 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m08:19:22.547804 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_02_chinook.stg_chinook__album"
[0m08:19:22.571480 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_02_chinook.stg_chinook__artist"
[0m08:19:22.573197 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */


  create view `clean`.`stg_chinook__album` 
  
    
    
  as (
    

-- Keep album grain; standardize names/types.
select
  cast(album_id  as Nullable(Int64))      as album_id,
  cast(title     as Nullable(String))     as album_title,
  cast(artist_id as Nullable(Int64))      as artist_id
from `raw`.`albums`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:19:22.577101 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */


  create view `clean`.`stg_chinook__artist` 
  
    
    
  as (
    

-- Standardize column names/types per table; no business logic.
select
  cast(artist_id as Nullable(Int64))      as artist_id,
  cast(name      as Nullable(String))     as artist_name
from `raw`.`artists`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:19:22.581635 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */


  create view `clean`.`stg_chinook__album` 
  
    
    
  as (
    

-- Keep album grain; standardize names/types.
select
  cast(album_id  as Nullable(Int64))      as album_id,
  cast(title     as Nullable(String))     as album_title,
  cast(artist_id as Nullable(Int64))      as artist_id
from `raw`.`albums`
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m08:19:22.585706 [debug] [Thread-2  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */


  create view `clean`.`stg_chinook__artist` 
  
    
    
  as (
    

-- Standardize column names/types per table; no business logic.
select
  cast(artist_id as Nullable(Int64))      as artist_id,
  cast(name      as Nullable(String))     as artist_name
from `raw`.`artists`
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m08:19:22.595861 [debug] [Thread-2  ]: Database Error in model stg_chinook__artist (models/clean/stg_chinook__artist.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 60
   Code: 60. DB::Exception: Table raw.artists does not exist. (UNKNOWN_TABLE) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_02_chinook/models/clean/stg_chinook__artist.sql
[0m08:19:22.597171 [debug] [Thread-1  ]: Database Error in model stg_chinook__album (models/clean/stg_chinook__album.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 60
   Code: 60. DB::Exception: Table raw.albums does not exist. (UNKNOWN_TABLE) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_02_chinook/models/clean/stg_chinook__album.sql
[0m08:19:22.600523 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c4bdebb-67b8-46b6-8115-8773f345dd57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4c140550>]}
[0m08:19:22.601424 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c4bdebb-67b8-46b6-8115-8773f345dd57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4b82ae20>]}
[0m08:19:22.602824 [error] [Thread-2  ]: 2 of 4 ERROR creating sql view model `clean`.`stg_chinook__artist` ............. [[31mERROR[0m in 0.81s]
[0m08:19:22.604166 [error] [Thread-1  ]: 1 of 4 ERROR creating sql view model `clean`.`stg_chinook__album` .............. [[31mERROR[0m in 0.81s]
[0m08:19:22.605662 [debug] [Thread-2  ]: Finished running node model.ex_02_chinook.stg_chinook__artist
[0m08:19:22.607050 [debug] [Thread-1  ]: Finished running node model.ex_02_chinook.stg_chinook__album
[0m08:19:22.608443 [debug] [Thread-4  ]: Began running node model.ex_02_chinook.dim_artist
[0m08:19:22.609445 [debug] [Thread-2  ]: Began running node model.ex_02_chinook.dim_album
[0m08:19:22.610411 [info ] [Thread-4  ]: 3 of 4 SKIP relation mart.dim_artist ........................................... [[33mSKIP[0m]
[0m08:19:22.611459 [info ] [Thread-2  ]: 4 of 4 SKIP relation mart.dim_album ............................................ [[33mSKIP[0m]
[0m08:19:22.612578 [debug] [Thread-4  ]: Finished running node model.ex_02_chinook.dim_artist
[0m08:19:22.613736 [debug] [Thread-2  ]: Finished running node model.ex_02_chinook.dim_album
[0m08:19:22.616107 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:19:22.670286 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m08:19:22.671608 [debug] [MainThread]: On list__mart: Close
[0m08:19:22.672673 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m08:19:22.673820 [debug] [MainThread]: On list__clean: Close
[0m08:19:22.674868 [debug] [MainThread]: Connection 'model.ex_02_chinook.stg_chinook__album' was left open.
[0m08:19:22.675944 [debug] [MainThread]: On model.ex_02_chinook.stg_chinook__album: Close
[0m08:19:22.676987 [debug] [MainThread]: Connection 'model.ex_02_chinook.stg_chinook__artist' was left open.
[0m08:19:22.678103 [debug] [MainThread]: On model.ex_02_chinook.stg_chinook__artist: Close
[0m08:19:22.680196 [info ] [MainThread]: 
[0m08:19:22.681584 [info ] [MainThread]: Finished running 2 view models, 2 table models in 0 hours 0 minutes and 2.15 seconds (2.15s).
[0m08:19:22.685633 [debug] [MainThread]: Command end result
[0m08:19:22.890051 [info ] [MainThread]: 
[0m08:19:22.890909 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m08:19:22.891488 [info ] [MainThread]: 
[0m08:19:22.892299 [error] [MainThread]:   Database Error in model stg_chinook__artist (models/clean/stg_chinook__artist.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 60
   Code: 60. DB::Exception: Table raw.artists does not exist. (UNKNOWN_TABLE) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_02_chinook/models/clean/stg_chinook__artist.sql
[0m08:19:22.892913 [info ] [MainThread]: 
[0m08:19:22.893672 [error] [MainThread]:   Database Error in model stg_chinook__album (models/clean/stg_chinook__album.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 60
   Code: 60. DB::Exception: Table raw.albums does not exist. (UNKNOWN_TABLE) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_02_chinook/models/clean/stg_chinook__album.sql
[0m08:19:22.894285 [info ] [MainThread]: 
[0m08:19:22.894915 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=2 TOTAL=4
[0m08:19:22.896186 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 5.477993, "process_in_blocks": "0", "process_kernel_time": 0.673751, "process_mem_max_rss": "113764", "process_out_blocks": "10528", "process_user_time": 5.503464}
[0m08:19:22.896924 [debug] [MainThread]: Command `dbt build` failed at 08:19:22.896735 after 5.48 seconds
[0m08:19:22.897572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4f428310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4a5edb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4a5ed070>]}
[0m08:19:22.898169 [debug] [MainThread]: Flushing usage events
[0m08:20:40.300161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00e2f4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00af54a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00af54940>]}


============================== 08:20:40.309940 | ca3928e3-8b26-4980-8ffd-f2756d224eb2 ==============================
[0m08:20:40.309940 [info ] [MainThread]: Running with dbt=1.8.9
[0m08:20:40.311269 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'warn_error': 'None', 'profiles_dir': '.', 'use_experimental_parser': 'False', 'use_colors': 'True', 'write_json': 'True', 'log_format': 'default', 'version_check': 'True', 'indirect_selection': 'eager', 'empty': 'False', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'quiet': 'False', 'debug': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'partial_parse': 'True', 'target_path': 'None', 'log_path': '/workdir/transforms/02_chinook/logs', 'no_print': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'static_parser': 'True'}
[0m08:20:40.891663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00af311f0>]}
[0m08:20:41.085867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00b052d00>]}
[0m08:20:41.087119 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m08:20:41.502856 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m08:20:41.972868 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m08:20:41.974362 [debug] [MainThread]: Partial parsing: updated file: ex_02_chinook://models/sources.yml
[0m08:20:41.974964 [debug] [MainThread]: Partial parsing: updated file: ex_02_chinook://models/clean/stg_chinook__artist.sql
[0m08:20:41.975523 [debug] [MainThread]: Partial parsing: updated file: ex_02_chinook://models/clean/stg_chinook__album.sql
[0m08:20:43.096278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00a01cee0>]}
[0m08:20:43.491702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c009f18220>]}
[0m08:20:43.492543 [info ] [MainThread]: Found 4 models, 2 sources, 471 macros
[0m08:20:43.495455 [info ] [MainThread]: 
[0m08:20:43.496522 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m08:20:43.509564 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m08:20:43.510757 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m08:20:43.586583 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:20:43.588045 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:20:44.239470 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m08:20:44.244323 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m08:20:44.245862 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:20:44.249381 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m08:20:44.288974 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m08:20:44.290020 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m08:20:44.301653 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m08:20:44.306180 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m08:20:44.312351 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:20:44.315750 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:20:44.320164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c009b1f130>]}
[0m08:20:44.371669 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m08:20:44.373138 [info ] [MainThread]: 
[0m08:20:44.400074 [debug] [Thread-1  ]: Began running node model.ex_02_chinook.stg_chinook__album
[0m08:20:44.400982 [debug] [Thread-2  ]: Began running node model.ex_02_chinook.stg_chinook__artist
[0m08:20:44.402006 [info ] [Thread-1  ]: 1 of 4 START sql view model `clean`.`stg_chinook__album` ....................... [RUN]
[0m08:20:44.403070 [info ] [Thread-2  ]: 2 of 4 START sql view model `clean`.`stg_chinook__artist` ...................... [RUN]
[0m08:20:44.404009 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__clean, now model.ex_02_chinook.stg_chinook__album)
[0m08:20:44.405038 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.stg_chinook__artist'
[0m08:20:44.405809 [debug] [Thread-1  ]: Began compiling node model.ex_02_chinook.stg_chinook__album
[0m08:20:44.406684 [debug] [Thread-2  ]: Began compiling node model.ex_02_chinook.stg_chinook__artist
[0m08:20:44.474089 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_02_chinook.stg_chinook__album"
[0m08:20:44.486579 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_02_chinook.stg_chinook__artist"
[0m08:20:44.488377 [debug] [Thread-1  ]: Began executing node model.ex_02_chinook.stg_chinook__album
[0m08:20:44.510160 [debug] [Thread-2  ]: Began executing node model.ex_02_chinook.stg_chinook__artist
[0m08:20:44.609845 [debug] [Thread-1  ]: Creating new relation stg_chinook__album
[0m08:20:44.619888 [debug] [Thread-2  ]: Creating new relation stg_chinook__artist
[0m08:20:44.776702 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m08:20:44.775373 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_02_chinook.stg_chinook__album"
[0m08:20:44.781578 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */


  create view `clean`.`stg_chinook__album` 
  
    
    
  as (
    

-- Keep album grain; standardize names/types.
select
  cast(album_id  as Nullable(Int64))      as album_id,
  cast(title     as Nullable(String))     as album_title,
  cast(artist_id as Nullable(Int64))      as artist_id
from `raw`.`chinook___albums`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:20:44.806984 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m08:20:44.988754 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00d8a1520>]}
[0m08:20:44.993420 [info ] [Thread-1  ]: 1 of 4 OK created sql view model `clean`.`stg_chinook__album` .................. [[32mOK[0m in 0.58s]
[0m08:20:44.995895 [debug] [Thread-1  ]: Finished running node model.ex_02_chinook.stg_chinook__album
[0m08:20:45.031615 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_02_chinook.stg_chinook__artist"
[0m08:20:45.033472 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */


  create view `clean`.`stg_chinook__artist` 
  
    
    
  as (
    

-- Standardize column names/types per table; no business logic.
select
  cast(artist_id as Nullable(Int64))      as artist_id,
  cast(name      as Nullable(String))     as artist_name
from `raw`.`chinook___artists`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:20:45.044272 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:20:45.048808 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c009ba17c0>]}
[0m08:20:45.050842 [info ] [Thread-2  ]: 2 of 4 OK created sql view model `clean`.`stg_chinook__artist` ................. [[32mOK[0m in 0.64s]
[0m08:20:45.052970 [debug] [Thread-2  ]: Finished running node model.ex_02_chinook.stg_chinook__artist
[0m08:20:45.073006 [debug] [Thread-4  ]: Began running node model.ex_02_chinook.dim_album
[0m08:20:45.075013 [debug] [Thread-3  ]: Began running node model.ex_02_chinook.dim_artist
[0m08:20:45.077652 [info ] [Thread-4  ]: 3 of 4 START sql table model `mart`.`dim_album` ................................ [RUN]
[0m08:20:45.080652 [info ] [Thread-3  ]: 4 of 4 START sql table model `mart`.`dim_artist` ............................... [RUN]
[0m08:20:45.083585 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.dim_album'
[0m08:20:45.086025 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.dim_artist'
[0m08:20:45.087841 [debug] [Thread-4  ]: Began compiling node model.ex_02_chinook.dim_album
[0m08:20:45.089661 [debug] [Thread-3  ]: Began compiling node model.ex_02_chinook.dim_artist
[0m08:20:45.109191 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_02_chinook.dim_album"
[0m08:20:45.116625 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_02_chinook.dim_artist"
[0m08:20:45.119019 [debug] [Thread-3  ]: Began executing node model.ex_02_chinook.dim_artist
[0m08:20:45.171312 [debug] [Thread-4  ]: Began executing node model.ex_02_chinook.dim_album
[0m08:20:45.312238 [debug] [Thread-3  ]: Creating new relation dim_artist
[0m08:20:45.390231 [debug] [Thread-4  ]: Creating new relation dim_album
[0m08:20:45.781614 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m08:20:45.783578 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m08:20:45.971749 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_album"} */

            

    
        create table `mart`.`dim_album`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Album dimension, denormalized with artist_name (common convenience).
with album as (
  select * from `clean`.`stg_chinook__album`
),
artist as (
  select * from `clean`.`stg_chinook__artist`
)
select
  a.album_id,
  a.album_title,
  a.artist_id,
  ar.artist_name
from album a
left join artist ar
  on ar.artist_id = a.artist_id
          )
        
        ...
[0m08:20:45.980550 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_artist"} */

            

    
        create table `mart`.`dim_artist`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Simple conformed dimension for artists.
select
  artist_id,
  artist_name
from `clean`.`stg_chinook__artist`
          )
        
        ...
[0m08:20:46.002438 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m08:20:46.016636 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m08:20:46.026945 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_album"} */

    select name, type from system.columns where table = 'dim_album'
    
      and database = 'mart'
    
    order by position
  ...
[0m08:20:46.030458 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_artist"} */

    select name, type from system.columns where table = 'dim_artist'
    
      and database = 'mart'
    
    order by position
  ...
[0m08:20:46.037405 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:20:46.073191 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m08:20:46.085919 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_02_chinook.dim_album"
[0m08:20:46.091066 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_02_chinook.dim_artist"
[0m08:20:46.094010 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_album"} */

  
    
    
    
        
         


        insert into `mart`.`dim_album`
        ("album_id", "album_title", "artist_id", "artist_name")

-- Album dimension, denormalized with artist_name (common convenience).
with album as (
  select * from `clean`.`stg_chinook__album`
),
artist as (
  select * from `clean`.`stg_chinook__artist`
)
select
  a.album_id,
  a.album_title,
  a.artist_id,
  ar.artist_name
from album a
left join artist ar
  on ar.artist_id = a.artist_id
  ...
[0m08:20:46.096223 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_artist"} */

  
    
    
    
        
         


        insert into `mart`.`dim_artist`
        ("artist_id", "artist_name")

-- Simple conformed dimension for artists.
select
  artist_id,
  artist_name
from `clean`.`stg_chinook__artist`
  ...
[0m08:20:46.107633 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:20:46.115448 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00ac3bd90>]}
[0m08:20:46.117992 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m08:20:46.120417 [info ] [Thread-3  ]: 4 of 4 OK created sql table model `mart`.`dim_artist` .......................... [[32mOK[0m in 1.03s]
[0m08:20:46.174041 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c009ba66a0>]}
[0m08:20:46.176895 [debug] [Thread-3  ]: Finished running node model.ex_02_chinook.dim_artist
[0m08:20:46.179987 [info ] [Thread-4  ]: 3 of 4 OK created sql table model `mart`.`dim_album` ........................... [[32mOK[0m in 1.09s]
[0m08:20:46.183405 [debug] [Thread-4  ]: Finished running node model.ex_02_chinook.dim_album
[0m08:20:46.187441 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:20:46.188674 [debug] [MainThread]: Connection 'model.ex_02_chinook.stg_chinook__album' was left open.
[0m08:20:46.190007 [debug] [MainThread]: On model.ex_02_chinook.stg_chinook__album: Close
[0m08:20:46.191091 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m08:20:46.192166 [debug] [MainThread]: On list__mart: Close
[0m08:20:46.193209 [debug] [MainThread]: Connection 'model.ex_02_chinook.stg_chinook__artist' was left open.
[0m08:20:46.194288 [debug] [MainThread]: On model.ex_02_chinook.stg_chinook__artist: Close
[0m08:20:46.195328 [debug] [MainThread]: Connection 'model.ex_02_chinook.dim_album' was left open.
[0m08:20:46.196486 [debug] [MainThread]: On model.ex_02_chinook.dim_album: Close
[0m08:20:46.197686 [debug] [MainThread]: Connection 'model.ex_02_chinook.dim_artist' was left open.
[0m08:20:46.198776 [debug] [MainThread]: On model.ex_02_chinook.dim_artist: Close
[0m08:20:46.200978 [info ] [MainThread]: 
[0m08:20:46.202340 [info ] [MainThread]: Finished running 2 view models, 2 table models in 0 hours 0 minutes and 2.70 seconds (2.70s).
[0m08:20:46.208280 [debug] [MainThread]: Command end result
[0m08:20:46.420286 [info ] [MainThread]: 
[0m08:20:46.472005 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:20:46.473300 [info ] [MainThread]: 
[0m08:20:46.474755 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m08:20:46.477595 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.3897505, "process_in_blocks": "0", "process_kernel_time": 0.586422, "process_mem_max_rss": "115652", "process_out_blocks": "10568", "process_user_time": 5.894728}
[0m08:20:46.479436 [debug] [MainThread]: Command `dbt build` succeeded at 08:20:46.478977 after 6.39 seconds
[0m08:20:46.480768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00e2f4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c009f18220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00b880670>]}
[0m08:20:46.482013 [debug] [MainThread]: Flushing usage events
[0m08:29:04.884448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a617ef40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a2e21a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a2e21940>]}


============================== 08:29:04.893949 | 4384ba45-b63c-4062-8002-7b173b60ec7c ==============================
[0m08:29:04.893949 [info ] [MainThread]: Running with dbt=1.8.9
[0m08:29:04.895002 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'profiles_dir': '.', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'fail_fast': 'False', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'debug': 'False', 'introspect': 'True', 'quiet': 'False', 'use_colors': 'True', 'cache_selected_only': 'False', 'write_json': 'True', 'log_format': 'default', 'warn_error': 'None', 'no_print': 'None', 'log_path': '/workdir/transforms/02_chinook/logs'}
[0m08:29:05.474738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a56d9fd0>]}
[0m08:29:05.667716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a63db400>]}
[0m08:29:05.669033 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m08:29:06.088998 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m08:29:06.554063 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m08:29:06.554967 [debug] [MainThread]: Partial parsing: added file: ex_02_chinook://models/mart/vw_artist_album_counts.sql
[0m08:29:07.371371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a21cf130>]}
[0m08:29:07.764539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a205d6a0>]}
[0m08:29:07.765382 [info ] [MainThread]: Found 5 models, 2 sources, 471 macros
[0m08:29:07.768386 [info ] [MainThread]: 
[0m08:29:07.769624 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m08:29:07.783911 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m08:29:07.796159 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m08:29:07.870164 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:29:07.882215 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:29:08.511403 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m08:29:08.521000 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:08.552199 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m08:29:08.564515 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:08.766254 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m08:29:08.767306 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m08:29:08.778619 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m08:29:08.782568 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m08:29:08.788466 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:08.791711 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:08.796711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a1e31430>]}
[0m08:29:08.797632 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m08:29:08.798260 [info ] [MainThread]: 
[0m08:29:08.860547 [debug] [Thread-1  ]: Began running node model.ex_02_chinook.stg_chinook__album
[0m08:29:08.861499 [debug] [Thread-2  ]: Began running node model.ex_02_chinook.stg_chinook__artist
[0m08:29:08.862464 [info ] [Thread-1  ]: 1 of 5 START sql view model `clean`.`stg_chinook__album` ....................... [RUN]
[0m08:29:08.863681 [info ] [Thread-2  ]: 2 of 5 START sql view model `clean`.`stg_chinook__artist` ...................... [RUN]
[0m08:29:08.865198 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.stg_chinook__album'
[0m08:29:08.866478 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.stg_chinook__artist'
[0m08:29:08.867530 [debug] [Thread-1  ]: Began compiling node model.ex_02_chinook.stg_chinook__album
[0m08:29:08.868590 [debug] [Thread-2  ]: Began compiling node model.ex_02_chinook.stg_chinook__artist
[0m08:29:08.950326 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_02_chinook.stg_chinook__artist"
[0m08:29:08.897265 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_02_chinook.stg_chinook__album"
[0m08:29:08.953417 [debug] [Thread-2  ]: Began executing node model.ex_02_chinook.stg_chinook__artist
[0m08:29:08.954780 [debug] [Thread-1  ]: Began executing node model.ex_02_chinook.stg_chinook__album
[0m08:29:09.368932 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m08:29:09.375131 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m08:29:09.516324 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_02_chinook.stg_chinook__album"
[0m08:29:09.521274 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */


  create view `clean`.`stg_chinook__album__dbt_tmp` 
  
    
    
  as (
    

-- Keep album grain; standardize names/types.
select
  cast(album_id  as Nullable(Int64))      as album_id,
  cast(title     as Nullable(String))     as album_title,
  cast(artist_id as Nullable(Int64))      as artist_id
from `raw`.`chinook___albums`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:29:09.525436 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_02_chinook.stg_chinook__artist"
[0m08:29:09.528871 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */


  create view `clean`.`stg_chinook__artist__dbt_tmp` 
  
    
    
  as (
    

-- Standardize column names/types per table; no business logic.
select
  cast(artist_id as Nullable(Int64))      as artist_id,
  cast(name      as Nullable(String))     as artist_name
from `raw`.`chinook___artists`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:29:09.549228 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m08:29:09.575867 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m08:29:09.581631 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */

    drop table if exists `clean`.`stg_chinook__album__dbt_backup` 
  
  ...
[0m08:29:09.596067 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */

    drop table if exists `clean`.`stg_chinook__artist__dbt_backup` 
  
  ...
[0m08:29:09.652306 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m08:29:09.656807 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */

    rename table `clean`.`stg_chinook__album` to `clean`.`stg_chinook__album__dbt_backup` 
  
  ...
[0m08:29:09.661130 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:09.665373 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */

    rename table `clean`.`stg_chinook__artist` to `clean`.`stg_chinook__artist__dbt_backup` 
  
  ...
[0m08:29:09.670050 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:09.673004 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:09.687710 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */

    drop table if exists `clean`.`stg_chinook__album` 
  
  ...
[0m08:29:09.753242 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */

    drop table if exists `clean`.`stg_chinook__artist` 
  
  ...
[0m08:29:09.759510 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m08:29:09.763687 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */

    rename table `clean`.`stg_chinook__album__dbt_tmp` to `clean`.`stg_chinook__album` 
  
  ...
[0m08:29:09.768317 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:09.773381 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */

    rename table `clean`.`stg_chinook__artist__dbt_tmp` to `clean`.`stg_chinook__artist` 
  
  ...
[0m08:29:09.776030 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:09.793783 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m08:29:10.191901 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */

    drop table if exists `clean`.`stg_chinook__artist__dbt_backup` 
  ...
[0m08:29:10.194981 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */

    drop table if exists `clean`.`stg_chinook__album__dbt_backup` 
  ...
[0m08:29:10.252372 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m08:29:10.265487 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m08:29:10.269481 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a1d18fa0>]}
[0m08:29:10.274239 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a1d18880>]}
[0m08:29:10.276858 [info ] [Thread-2  ]: 2 of 5 OK created sql view model `clean`.`stg_chinook__artist` ................. [[32mOK[0m in 1.40s]
[0m08:29:10.279697 [info ] [Thread-1  ]: 1 of 5 OK created sql view model `clean`.`stg_chinook__album` .................. [[32mOK[0m in 1.41s]
[0m08:29:10.282717 [debug] [Thread-2  ]: Finished running node model.ex_02_chinook.stg_chinook__artist
[0m08:29:10.286087 [debug] [Thread-1  ]: Finished running node model.ex_02_chinook.stg_chinook__album
[0m08:29:10.289381 [debug] [Thread-4  ]: Began running node model.ex_02_chinook.dim_artist
[0m08:29:10.292889 [debug] [Thread-2  ]: Began running node model.ex_02_chinook.dim_album
[0m08:29:10.291621 [info ] [Thread-4  ]: 3 of 5 START sql table model `mart`.`dim_artist` ............................... [RUN]
[0m08:29:10.294748 [debug] [Thread-1  ]: Began running node model.ex_02_chinook.vw_artist_album_counts
[0m08:29:10.296845 [info ] [Thread-2  ]: 4 of 5 START sql table model `mart`.`dim_album` ................................ [RUN]
[0m08:29:10.349723 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.dim_artist'
[0m08:29:10.352126 [info ] [Thread-1  ]: 5 of 5 START sql view model `mart`.`vw_artist_album_counts` .................... [RUN]
[0m08:29:10.353973 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.ex_02_chinook.stg_chinook__artist, now model.ex_02_chinook.dim_album)
[0m08:29:10.355660 [debug] [Thread-4  ]: Began compiling node model.ex_02_chinook.dim_artist
[0m08:29:10.357363 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_02_chinook.stg_chinook__album, now model.ex_02_chinook.vw_artist_album_counts)
[0m08:29:10.359107 [debug] [Thread-2  ]: Began compiling node model.ex_02_chinook.dim_album
[0m08:29:10.372208 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_02_chinook.dim_artist"
[0m08:29:10.374072 [debug] [Thread-1  ]: Began compiling node model.ex_02_chinook.vw_artist_album_counts
[0m08:29:10.387749 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_02_chinook.dim_album"
[0m08:29:10.454093 [debug] [Thread-4  ]: Began executing node model.ex_02_chinook.dim_artist
[0m08:29:10.458263 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_02_chinook.vw_artist_album_counts"
[0m08:29:10.476086 [debug] [Thread-1  ]: Began executing node model.ex_02_chinook.vw_artist_album_counts
[0m08:29:10.486111 [debug] [Thread-2  ]: Began executing node model.ex_02_chinook.dim_album
[0m08:29:10.551239 [debug] [Thread-1  ]: Creating new relation vw_artist_album_counts
[0m08:29:10.585560 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_02_chinook.vw_artist_album_counts"
[0m08:29:10.748916 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.vw_artist_album_counts: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.vw_artist_album_counts"} */


  create view `mart`.`vw_artist_album_counts` 
  
    
    
  as (
    

with album as (
  select album_id, artist_id
  from `clean`.`stg_chinook__album`
),
artist as (
  select artist_id, artist_name
  from `clean`.`stg_chinook__artist`
)

select
  ar.artist_id,
  ar.artist_name,
  substring(ar.artist_name, 1, 1)             as artist_initial,
  count(a.album_id)                            as album_count,
  case when count(a.album_id) >= 3 then 1 else 0 end as is_prolific -- handy filter in dashboards
from artist ar
left join album a
  on a.artist_id = ar.artist_id
group by
  ar.artist_id,
  ar.artist_name
order by album_count desc, ar.artist_name asc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:29:10.854604 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m08:29:10.879815 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a1c356d0>]}
[0m08:29:10.892821 [info ] [Thread-1  ]: 5 of 5 OK created sql view model `mart`.`vw_artist_album_counts` ............... [[32mOK[0m in 0.52s]
[0m08:29:10.959919 [debug] [Thread-1  ]: Finished running node model.ex_02_chinook.vw_artist_album_counts
[0m08:29:11.161858 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m08:29:11.163053 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_album"} */

            

    
        create table `mart`.`dim_album__dbt_backup`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Album dimension, denormalized with artist_name (common convenience).
with album as (
  select * from `clean`.`stg_chinook__album`
),
artist as (
  select * from `clean`.`stg_chinook__artist`
)
select
  a.album_id,
  a.album_title,
  a.artist_id,
  ar.artist_name
from album a
left join artist ar
  on ar.artist_id = a.artist_id
          )
        
        ...
[0m08:29:11.182232 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m08:29:11.254546 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_album"} */

    select name, type from system.columns where table = 'dim_album__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m08:29:11.266164 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:11.277826 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_02_chinook.dim_album"
[0m08:29:11.279901 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_album"} */

  
    
    
    
        
         


        insert into `mart`.`dim_album__dbt_backup`
        ("album_id", "album_title", "artist_id", "artist_name")

-- Album dimension, denormalized with artist_name (common convenience).
with album as (
  select * from `clean`.`stg_chinook__album`
),
artist as (
  select * from `clean`.`stg_chinook__artist`
)
select
  a.album_id,
  a.album_title,
  a.artist_id,
  ar.artist_name
from album a
left join artist ar
  on ar.artist_id = a.artist_id
  ...
[0m08:29:11.296476 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m08:29:11.353461 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_album"} */
EXCHANGE TABLES `mart`.`dim_album__dbt_backup` AND `mart`.`dim_album` 
  
  ...
[0m08:29:11.359249 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m08:29:11.370403 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_album"} */

    drop table if exists `mart`.`dim_album__dbt_backup` 
  ...
[0m08:29:11.377652 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_artist"} */

            

    
        create table `mart`.`dim_artist__dbt_backup`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Simple conformed dimension for artists.
select
  artist_id,
  artist_name
from `clean`.`stg_chinook__artist`
          )
        
        ...
[0m08:29:11.384022 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:11.388177 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a1d13f10>]}
[0m08:29:11.390091 [info ] [Thread-2  ]: 4 of 5 OK created sql table model `mart`.`dim_album` ........................... [[32mOK[0m in 1.03s]
[0m08:29:11.392394 [debug] [Thread-2  ]: Finished running node model.ex_02_chinook.dim_album
[0m08:29:11.396771 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m08:29:11.456339 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_artist"} */

    select name, type from system.columns where table = 'dim_artist__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m08:29:11.465204 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:11.470372 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_02_chinook.dim_artist"
[0m08:29:11.472610 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_artist"} */

  
    
    
    
        
         


        insert into `mart`.`dim_artist__dbt_backup`
        ("artist_id", "artist_name")

-- Simple conformed dimension for artists.
select
  artist_id,
  artist_name
from `clean`.`stg_chinook__artist`
  ...
[0m08:29:11.481914 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:11.486200 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_artist"} */
EXCHANGE TABLES `mart`.`dim_artist__dbt_backup` AND `mart`.`dim_artist` 
  
  ...
[0m08:29:11.491731 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m08:29:11.505390 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_artist"} */

    drop table if exists `mart`.`dim_artist__dbt_backup` 
  ...
[0m08:29:11.551816 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m08:29:11.556363 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a1d1e3d0>]}
[0m08:29:11.558389 [info ] [Thread-4  ]: 3 of 5 OK created sql table model `mart`.`dim_artist` .......................... [[32mOK[0m in 1.21s]
[0m08:29:11.560828 [debug] [Thread-4  ]: Finished running node model.ex_02_chinook.dim_artist
[0m08:29:11.564671 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:29:11.565761 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m08:29:11.566928 [debug] [MainThread]: On list__mart: Close
[0m08:29:11.567997 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m08:29:11.569092 [debug] [MainThread]: On list__clean: Close
[0m08:29:11.570168 [debug] [MainThread]: Connection 'model.ex_02_chinook.vw_artist_album_counts' was left open.
[0m08:29:11.571280 [debug] [MainThread]: On model.ex_02_chinook.vw_artist_album_counts: Close
[0m08:29:11.572339 [debug] [MainThread]: Connection 'model.ex_02_chinook.dim_album' was left open.
[0m08:29:11.573438 [debug] [MainThread]: On model.ex_02_chinook.dim_album: Close
[0m08:29:11.574477 [debug] [MainThread]: Connection 'model.ex_02_chinook.dim_artist' was left open.
[0m08:29:11.575597 [debug] [MainThread]: On model.ex_02_chinook.dim_artist: Close
[0m08:29:11.577708 [info ] [MainThread]: 
[0m08:29:11.579081 [info ] [MainThread]: Finished running 3 view models, 2 table models in 0 hours 0 minutes and 3.81 seconds (3.81s).
[0m08:29:11.585423 [debug] [MainThread]: Command end result
[0m08:29:11.865823 [info ] [MainThread]: 
[0m08:29:11.867586 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:29:11.869096 [info ] [MainThread]: 
[0m08:29:11.870767 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m08:29:11.873679 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.1826053, "process_in_blocks": "0", "process_kernel_time": 0.659697, "process_mem_max_rss": "114800", "process_out_blocks": "10624", "process_user_time": 6.298559}
[0m08:29:11.875446 [debug] [MainThread]: Command `dbt build` succeeded at 08:29:11.874943 after 7.18 seconds
[0m08:29:11.876819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a617ef40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a1ceb7f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a40e3580>]}
[0m08:29:11.877962 [debug] [MainThread]: Flushing usage events
[0m14:29:11.568730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c870148310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c86cda7a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c86cda7940>]}


============================== 14:29:11.628368 | be521379-d80d-4499-8089-a6aabe140f57 ==============================
[0m14:29:11.628368 [info ] [MainThread]: Running with dbt=1.8.9
[0m14:29:11.629467 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'log_format': 'default', 'target_path': 'None', 'version_check': 'True', 'static_parser': 'True', 'profiles_dir': '.', 'partial_parse': 'True', 'log_path': '/workdir/transforms/03_meteo/logs', 'use_colors': 'True', 'warn_error': 'None', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'introspect': 'True', 'printer_width': '80', 'no_print': 'None', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'debug': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'empty': 'False'}
[0m14:29:12.168304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'be521379-d80d-4499-8089-a6aabe140f57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c86ccc0a30>]}
[0m14:29:12.364386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'be521379-d80d-4499-8089-a6aabe140f57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c86d1e4250>]}
[0m14:29:12.366235 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m14:29:12.833954 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m14:29:13.163994 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m14:29:13.164963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'be521379-d80d-4499-8089-a6aabe140f57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c86e0dc9a0>]}
[0m14:29:17.661911 [error] [MainThread]: Encountered an error:
Compilation Error in model mart_meteo__manila_daily (models/mart/mart_meteo__manila_daily.sql)
  invalid syntax for function call expression
    line 1
      {{ config(
[0m14:29:17.664317 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 6.236668, "process_in_blocks": "43312", "process_kernel_time": 0.631717, "process_mem_max_rss": "99900", "process_out_blocks": "6624", "process_user_time": 6.095277}
[0m14:29:17.665105 [debug] [MainThread]: Command `dbt build` failed at 14:29:17.664895 after 6.24 seconds
[0m14:29:17.665757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c870148310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c86c549dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c86c5fd8e0>]}
[0m14:29:17.666357 [debug] [MainThread]: Flushing usage events
[0m14:38:09.411212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f6bcb9e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f6891eb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f6891ea30>]}


============================== 14:38:09.422767 | 12f6f99d-a3c3-469b-861a-900627540855 ==============================
[0m14:38:09.422767 [info ] [MainThread]: Running with dbt=1.8.9
[0m14:38:09.423913 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt build --profiles-dir . --target local', 'log_cache_events': 'False', 'no_print': 'None', 'log_path': '/workdir/transforms/03_meteo/logs', 'profiles_dir': '.', 'use_experimental_parser': 'False', 'write_json': 'True', 'version_check': 'True', 'static_parser': 'True', 'indirect_selection': 'eager', 'debug': 'False', 'introspect': 'True', 'printer_width': '80', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'warn_error': 'None', 'log_format': 'default', 'fail_fast': 'False', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'quiet': 'False', 'empty': 'False', 'partial_parse': 'True'}
[0m14:38:10.013378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '12f6f99d-a3c3-469b-861a-900627540855', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f6b154910>]}
[0m14:38:10.206951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '12f6f99d-a3c3-469b-861a-900627540855', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f689740d0>]}
[0m14:38:10.208266 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m14:38:10.622188 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m14:38:11.003216 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m14:38:11.004080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '12f6f99d-a3c3-469b-861a-900627540855', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f69bd6700>]}
[0m14:38:15.406939 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m14:38:15.407822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '12f6f99d-a3c3-469b-861a-900627540855', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f67d01850>]}
[0m14:38:16.224974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '12f6f99d-a3c3-469b-861a-900627540855', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f679d7130>]}
[0m14:38:16.738809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '12f6f99d-a3c3-469b-861a-900627540855', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f67a10b20>]}
[0m14:38:16.739698 [info ] [MainThread]: Found 3 models, 4 data tests, 1 source, 471 macros
[0m14:38:16.742899 [info ] [MainThread]: 
[0m14:38:16.743899 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:38:16.782307 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:38:16.756623 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:38:16.818323 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:38:16.822243 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:38:17.418699 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:38:17.425041 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:38:17.484133 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:38:17.491081 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:38:17.529614 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m14:38:17.531513 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m14:38:17.604754 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m14:38:17.614529 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m14:38:17.622596 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:38:17.627279 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:38:17.686453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12f6f99d-a3c3-469b-861a-900627540855', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f6707d9a0>]}
[0m14:38:17.688301 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m14:38:17.689654 [info ] [MainThread]: 
[0m14:38:17.717016 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_meteo__manila
[0m14:38:17.718582 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_meteo__manila` ........................ [RUN]
[0m14:38:17.719988 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_meteo__manila'
[0m14:38:17.720989 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_meteo__manila
[0m14:38:17.791592 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_meteo__manila"
[0m14:38:17.793215 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_meteo__manila
[0m14:38:17.896865 [debug] [Thread-1  ]: Creating new relation stg_meteo__manila
[0m14:38:17.922576 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:38:18.032768 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_meteo__manila"
[0m14:38:18.034230 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */


  create view `clean`.`stg_meteo__manila` 
  
    
    
  as (
    

-- Normalize types & naming; no business logic here.
select
  toDate(date)                         as dte,
  toFloat64(temp_min)                  as temp_min_c,
  toFloat64(temp_max)                  as temp_max_c,
  toFloat64(precipitation)             as precip_mm,
  toInt32(weather_code)                as weather_code
from `raw`.`meteo__manila`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m14:38:18.039065 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */


  create view `clean`.`stg_meteo__manila` 
  
    
    
  as (
    

-- Normalize types & naming; no business logic here.
select
  toDate(date)                         as dte,
  toFloat64(temp_min)                  as temp_min_c,
  toFloat64(temp_max)                  as temp_max_c,
  toFloat64(precipitation)             as precip_mm,
  toInt32(weather_code)                as weather_code
from `raw`.`meteo__manila`
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m14:38:18.047978 [debug] [Thread-1  ]: Database Error in model stg_meteo__manila (models/clean/stg_meteo__manila.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 60
   Code: 60. DB::Exception: Table raw.meteo__manila does not exist. Maybe you meant raw.meteo___manila?. (UNKNOWN_TABLE) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/clean/stg_meteo__manila.sql
[0m14:38:18.050517 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12f6f99d-a3c3-469b-861a-900627540855', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f675e5eb0>]}
[0m14:38:18.051835 [error] [Thread-1  ]: 1 of 7 ERROR creating sql view model `clean`.`stg_meteo__manila` ............... [[31mERROR[0m in 0.33s]
[0m14:38:18.053236 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_meteo__manila
[0m14:38:18.055498 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m14:38:18.056843 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m14:38:18.058582 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m14:38:18.059702 [debug] [Thread-1  ]: Began running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m14:38:18.061064 [info ] [Thread-3  ]: 2 of 7 SKIP test not_null_stg_meteo__manila_dte ................................ [[33mSKIP[0m]
[0m14:38:18.063729 [info ] [Thread-4  ]: 3 of 7 SKIP test not_null_stg_meteo__manila_temp_max_c ......................... [[33mSKIP[0m]
[0m14:38:18.066046 [info ] [Thread-2  ]: 4 of 7 SKIP test not_null_stg_meteo__manila_temp_min_c ......................... [[33mSKIP[0m]
[0m14:38:18.068001 [info ] [Thread-1  ]: 5 of 7 SKIP test unique_stg_meteo__manila_dte .................................. [[33mSKIP[0m]
[0m14:38:18.070213 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m14:38:18.072007 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m14:38:18.073760 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m14:38:18.082477 [debug] [Thread-1  ]: Finished running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m14:38:18.086673 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_meteo__manila_daily
[0m14:38:18.088210 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m14:38:18.089971 [info ] [Thread-3  ]: 6 of 7 SKIP relation mart.mart_meteo__manila_daily ............................. [[33mSKIP[0m]
[0m14:38:18.091908 [info ] [Thread-4  ]: 7 of 7 SKIP relation mart.mart_meteo__manila_monthly ........................... [[33mSKIP[0m]
[0m14:38:18.093943 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_daily
[0m14:38:18.095757 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m14:38:18.100043 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:38:18.101328 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m14:38:18.102721 [debug] [MainThread]: On list__mart: Close
[0m14:38:18.103873 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m14:38:18.105050 [debug] [MainThread]: On list__clean: Close
[0m14:38:18.106175 [debug] [MainThread]: Connection 'model.ex_03_meteo.stg_meteo__manila' was left open.
[0m14:38:18.107445 [debug] [MainThread]: On model.ex_03_meteo.stg_meteo__manila: Close
[0m14:38:18.109331 [info ] [MainThread]: 
[0m14:38:18.110748 [info ] [MainThread]: Finished running 1 view model, 4 data tests, 2 table models in 0 hours 0 minutes and 1.37 seconds (1.37s).
[0m14:38:18.115648 [debug] [MainThread]: Command end result
[0m14:38:18.329127 [info ] [MainThread]: 
[0m14:38:18.330292 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:38:18.331189 [info ] [MainThread]: 
[0m14:38:18.383025 [error] [MainThread]:   Database Error in model stg_meteo__manila (models/clean/stg_meteo__manila.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 60
   Code: 60. DB::Exception: Table raw.meteo__manila does not exist. Maybe you meant raw.meteo___manila?. (UNKNOWN_TABLE) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/clean/stg_meteo__manila.sql
[0m14:38:18.384496 [info ] [MainThread]: 
[0m14:38:18.385917 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=6 TOTAL=7
[0m14:38:18.388873 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 9.179361, "process_in_blocks": "7128", "process_kernel_time": 0.633699, "process_mem_max_rss": "117360", "process_out_blocks": "10544", "process_user_time": 7.380388}
[0m14:38:18.390414 [debug] [MainThread]: Command `dbt build` failed at 14:38:18.390012 after 9.18 seconds
[0m14:38:18.391736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f6bcb9e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f6b154910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f67894ac0>]}
[0m14:38:18.393012 [debug] [MainThread]: Flushing usage events
[0m14:51:33.802297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73252b47a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7325280dab50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7325280daa00>]}


============================== 14:51:33.863448 | 1a0f6246-5ab4-4dec-a443-c98a3a79ad87 ==============================
[0m14:51:33.863448 [info ] [MainThread]: Running with dbt=1.8.9
[0m14:51:33.864697 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'empty': 'False', 'partial_parse': 'True', 'profiles_dir': '.', 'use_colors': 'True', 'target_path': 'None', 'write_json': 'True', 'debug': 'False', 'introspect': 'True', 'quiet': 'False', 'static_parser': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'version_check': 'True', 'log_path': '/workdir/transforms/03_meteo/logs', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'log_format': 'default', 'fail_fast': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_experimental_parser': 'False'}
[0m14:51:34.396121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1a0f6246-5ab4-4dec-a443-c98a3a79ad87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732527ff5520>]}
[0m14:51:34.589278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1a0f6246-5ab4-4dec-a443-c98a3a79ad87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732527f49e20>]}
[0m14:51:34.590583 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m14:51:35.003942 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m14:51:35.575029 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:51:35.576421 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/sources.yml
[0m14:51:36.300152 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m14:51:36.301077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '1a0f6246-5ab4-4dec-a443-c98a3a79ad87', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732527718a90>]}
[0m14:51:36.967203 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.ex_03_meteo.stg_meteo__manila' (models/clean/stg_meteo__manila.sql) depends on a source named 'raw.meteo__manila' which was not found
[0m14:51:36.968816 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 3.3599393, "process_in_blocks": "0", "process_kernel_time": 0.519098, "process_mem_max_rss": "104420", "process_out_blocks": "6616", "process_user_time": 4.472154}
[0m14:51:36.969596 [debug] [MainThread]: Command `dbt build` failed at 14:51:36.969356 after 3.36 seconds
[0m14:51:36.970245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73252b47a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7325278581f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7325278047f0>]}
[0m14:51:36.970949 [debug] [MainThread]: Flushing usage events
[0m14:59:29.413824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee4809b7310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47d618b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47d6189d0>]}


============================== 14:59:29.423069 | 75dad68a-9f02-4bab-81b2-0f5442514c1a ==============================
[0m14:59:29.423069 [info ] [MainThread]: Running with dbt=1.8.9
[0m14:59:29.424198 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'target_path': 'None', 'version_check': 'True', 'warn_error': 'None', 'profiles_dir': '.', 'static_parser': 'True', 'printer_width': '80', 'cache_selected_only': 'False', 'use_colors': 'True', 'debug': 'False', 'introspect': 'True', 'write_json': 'True', 'log_path': '/workdir/transforms/03_meteo/logs', 'invocation_command': 'dbt build --profiles-dir . --target local', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'quiet': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'use_experimental_parser': 'False'}
[0m14:59:29.949296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47d5319d0>]}
[0m14:59:30.146509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47d5cf5b0>]}
[0m14:59:30.147931 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m14:59:30.617222 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m14:59:31.121368 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m14:59:31.122819 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/sources.yml
[0m14:59:31.123412 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/clean/stg_meteo__manila.sql
[0m14:59:31.854865 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m14:59:31.855871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47c867eb0>]}
[0m14:59:32.834831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47c496ee0>]}
[0m14:59:33.273387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47d2ae580>]}
[0m14:59:33.274378 [info ] [MainThread]: Found 3 models, 4 data tests, 1 source, 471 macros
[0m14:59:33.316114 [info ] [MainThread]: 
[0m14:59:33.317629 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:59:33.330511 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:59:33.332088 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:59:33.549140 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:59:33.560945 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:59:34.122160 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:59:34.127053 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:59:34.152914 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:59:34.160030 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:59:34.229873 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m14:59:34.231000 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m14:59:34.243699 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m14:59:34.249049 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m14:59:34.255987 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:59:34.257344 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:59:34.316943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee4809177c0>]}
[0m14:59:34.319026 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m14:59:34.320416 [info ] [MainThread]: 
[0m14:59:34.348173 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_meteo__manila
[0m14:59:34.349422 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_meteo__manila` ........................ [RUN]
[0m14:59:34.350488 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_03_meteo.stg_meteo__manila)
[0m14:59:34.351416 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_meteo__manila
[0m14:59:34.422371 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_meteo__manila"
[0m14:59:34.424241 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_meteo__manila
[0m14:59:34.515604 [debug] [Thread-1  ]: Creating new relation stg_meteo__manila
[0m14:59:34.535141 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_meteo__manila"
[0m14:59:34.536496 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */


  create view `clean`.`stg_meteo__manila` 
  
    
    
  as (
    

-- Normalize types & naming; no business logic here.
select
  toDate(date)                         as dte,
  toFloat64(temp_min)                  as temp_min_c,
  toFloat64(temp_max)                  as temp_max_c,
  toFloat64(precipitation)             as precip_mm,
  toInt32(weather_code)                as weather_code
from `raw`.`meteo___manila`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m14:59:34.547350 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:59:34.626476 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47bab02b0>]}
[0m14:59:34.627664 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_meteo__manila` ................... [[32mOK[0m in 0.27s]
[0m14:59:34.629070 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_meteo__manila
[0m14:59:34.631428 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m14:59:34.632984 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m14:59:34.634191 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_meteo__manila_dte ............................... [RUN]
[0m14:59:34.635903 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m14:59:34.637651 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_meteo__manila_temp_max_c ........................ [RUN]
[0m14:59:34.639351 [debug] [Thread-1  ]: Began running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m14:59:34.641193 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f'
[0m14:59:34.642948 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_meteo__manila_temp_min_c ........................ [RUN]
[0m14:59:34.644651 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339'
[0m14:59:34.645994 [info ] [Thread-1  ]: 5 of 7 START test unique_stg_meteo__manila_dte ................................. [RUN]
[0m14:59:34.647312 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m14:59:34.648866 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9'
[0m14:59:34.650111 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m14:59:34.651442 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_meteo__manila, now test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc)
[0m14:59:34.724260 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m14:59:34.758890 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m14:59:34.813960 [debug] [Thread-1  ]: Began compiling node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m14:59:34.824963 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m14:59:34.841030 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m14:59:34.853341 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m14:59:34.918912 [debug] [Thread-1  ]: Writing injected SQL for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m14:59:34.921044 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m14:59:34.927854 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m14:59:35.048284 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m14:59:35.060381 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m14:59:35.115071 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m14:59:35.116916 [debug] [Thread-1  ]: Began executing node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m14:59:35.119639 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m14:59:35.121247 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m14:59:35.123051 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m14:59:35.134515 [debug] [Thread-1  ]: Writing runtime sql for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m14:59:35.145813 [debug] [Thread-1  ]: dbt_clickhouse adapter: On test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    dte as unique_field,
    count(*) as n_records

from `clean`.`stg_meteo__manila`
where dte is not null
group by dte
having count(*) > 1



    ) dbt_internal_test...
[0m14:59:35.254205 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m14:59:35.326604 [info ] [Thread-1  ]: 5 of 7 PASS unique_stg_meteo__manila_dte ....................................... [[32mPASS[0m in 0.67s]
[0m14:59:35.338480 [debug] [Thread-1  ]: Finished running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m14:59:35.431022 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_max_c
from `clean`.`stg_meteo__manila`
where temp_max_c is null



    ) dbt_internal_test...
[0m14:59:35.442663 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:59:35.448956 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_meteo__manila_temp_max_c .............................. [[32mPASS[0m in 0.80s]
[0m14:59:35.457580 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m14:59:35.515101 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_min_c
from `clean`.`stg_meteo__manila`
where temp_min_c is null



    ) dbt_internal_test...
[0m14:59:35.471139 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select dte
from `clean`.`stg_meteo__manila`
where dte is null



    ) dbt_internal_test...
[0m14:59:35.573091 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m14:59:35.575729 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m14:59:35.582180 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_meteo__manila_dte ..................................... [[32mPASS[0m in 0.94s]
[0m14:59:35.588400 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_meteo__manila_temp_min_c .............................. [[32mPASS[0m in 0.94s]
[0m14:59:35.592009 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m14:59:35.595265 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m14:59:35.598943 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_meteo__manila_daily
[0m14:59:35.600714 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m14:59:35.602974 [info ] [Thread-1  ]: 6 of 7 START sql table model `mart`.`mart_meteo__manila_daily` ................. [RUN]
[0m14:59:35.605338 [info ] [Thread-4  ]: 7 of 7 START sql table model `mart`.`mart_meteo__manila_monthly` ............... [RUN]
[0m14:59:35.607405 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc, now model.ex_03_meteo.mart_meteo__manila_daily)
[0m14:59:35.609274 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339, now model.ex_03_meteo.mart_meteo__manila_monthly)
[0m14:59:35.610878 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_daily
[0m14:59:35.612433 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_monthly
[0m14:59:35.626052 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m14:59:35.639608 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m14:59:35.642200 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_monthly
[0m14:59:35.659330 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_daily
[0m14:59:35.845632 [debug] [Thread-4  ]: Creating new relation mart_meteo__manila_monthly
[0m14:59:35.918861 [debug] [Thread-1  ]: Creating new relation mart_meteo__manila_daily
[0m14:59:36.258041 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

            

    
        create table `mart`.`mart_meteo__manila_daily`
        
  
        
  engine = MergeTree()
        order by (dte)
        
        partition by (toYYYYMM(dte))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Daily meteo mart (persisted)
select
  dte,
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0 as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
          )
        
        ...
[0m14:59:36.260888 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

            

    
        create table `mart`.`mart_meteo__manila_monthly`
        
  
        
  engine = MergeTree()
        order by (month)
        
        partition by (toYYYYMM(month))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    dte,
    temp_min_c,
    temp_max_c,
    (temp_min_c + temp_max_c)/2.0 as temp_avg_c,
    precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte)           as month,
  avg(temp_min_c)               as avg_min_c,
  avg(temp_max_c)               as avg_max_c,
  avg(temp_avg_c)               as avg_temp_c,
  sum(precip_mm)                as total_precip_mm,
  countIf(precip_mm > 0)        as rainy_days
from base
group by month
order by month
          )
        
        ...
[0m14:59:36.326599 [debug] [Thread-4  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

            

    
        create table `mart`.`mart_meteo__manila_monthly`
        
  
        
  engine = MergeTree()
        order by (month)
        
        partition by (toYYYYMM(month))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    dte,
    temp_min_c,
    temp_max_c,
    (temp_min_c + temp_max_c)/2.0 as temp_avg_c,
    precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte)           as month,
  avg(temp_min_c)               as avg_min_c,
  avg(temp_max_c)               as avg_max_c,
  avg(temp_avg_c)               as avg_temp_c,
  sum(precip_mm)                as total_precip_mm,
  countIf(precip_mm > 0)        as rainy_days
from base
group by month
order by month
          )
        
        
[0m14:59:36.329683 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

            

    
        create table `mart`.`mart_meteo__manila_daily`
        
  
        
  engine = MergeTree()
        order by (dte)
        
        partition by (toYYYYMM(dte))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Daily meteo mart (persisted)
select
  dte,
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0 as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
          )
        
        
[0m14:59:36.342921 [debug] [Thread-1  ]: Database Error in model mart_meteo__manila_daily (models/mart/mart_meteo__manila_daily.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 44
   Code: 44. DB::Exception: Partition key contains nullable columns, but merge tree setting `allow_nullable_key` is disabled. (ILLEGAL_COLUMN) (version 23.12.6.19 (official build))
[0m14:59:36.346732 [debug] [Thread-4  ]: Database Error in model mart_meteo__manila_monthly (models/mart/mart_meteo__manila_monthly.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 44
   Code: 44. DB::Exception: Partition key contains nullable columns, but merge tree setting `allow_nullable_key` is disabled. (ILLEGAL_COLUMN) (version 23.12.6.19 (official build))
[0m14:59:36.348260 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47b3755e0>]}
[0m14:59:36.349917 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47b2d6c10>]}
[0m14:59:36.352438 [error] [Thread-1  ]: 6 of 7 ERROR creating sql table model `mart`.`mart_meteo__manila_daily` ........ [[31mERROR[0m in 0.74s]
[0m14:59:36.355149 [error] [Thread-4  ]: 7 of 7 ERROR creating sql table model `mart`.`mart_meteo__manila_monthly` ...... [[31mERROR[0m in 0.74s]
[0m14:59:36.358402 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_daily
[0m14:59:36.361339 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m14:59:36.365897 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:59:36.367125 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_daily' was left open.
[0m14:59:36.368413 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_daily: Close
[0m14:59:36.414384 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m14:59:36.415488 [debug] [MainThread]: On list__clean: Close
[0m14:59:36.416554 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f' was left open.
[0m14:59:36.417642 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f: Close
[0m14:59:36.418685 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_monthly' was left open.
[0m14:59:36.419809 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_monthly: Close
[0m14:59:36.420987 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9' was left open.
[0m14:59:36.422070 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9: Close
[0m14:59:36.424201 [info ] [MainThread]: 
[0m14:59:36.425979 [info ] [MainThread]: Finished running 1 view model, 4 data tests, 2 table models in 0 hours 0 minutes and 3.11 seconds (3.11s).
[0m14:59:36.435201 [debug] [MainThread]: Command end result
[0m14:59:36.650219 [info ] [MainThread]: 
[0m14:59:36.651758 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m14:59:36.652945 [info ] [MainThread]: 
[0m14:59:36.654400 [error] [MainThread]:   Database Error in model mart_meteo__manila_daily (models/mart/mart_meteo__manila_daily.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 44
   Code: 44. DB::Exception: Partition key contains nullable columns, but merge tree setting `allow_nullable_key` is disabled. (ILLEGAL_COLUMN) (version 23.12.6.19 (official build))
[0m14:59:36.655607 [info ] [MainThread]: 
[0m14:59:36.656986 [error] [MainThread]:   Database Error in model mart_meteo__manila_monthly (models/mart/mart_meteo__manila_monthly.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 44
   Code: 44. DB::Exception: Partition key contains nullable columns, but merge tree setting `allow_nullable_key` is disabled. (ILLEGAL_COLUMN) (version 23.12.6.19 (official build))
[0m14:59:36.658045 [info ] [MainThread]: 
[0m14:59:36.659165 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=2 SKIP=0 TOTAL=7
[0m14:59:36.661270 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 7.4437466, "process_in_blocks": "0", "process_kernel_time": 0.646847, "process_mem_max_rss": "118136", "process_out_blocks": "10648", "process_user_time": 6.436773}
[0m14:59:36.662473 [debug] [MainThread]: Command `dbt build` failed at 14:59:36.662166 after 7.45 seconds
[0m14:59:36.714836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee4809b7310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47b305d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47b305b50>]}
[0m14:59:36.716169 [debug] [MainThread]: Flushing usage events
[0m15:04:44.505438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f4634310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f1299ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f1299970>]}


============================== 15:04:44.564881 | 385c2017-b0b4-4ca4-a91f-2950b472bd73 ==============================
[0m15:04:44.564881 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:04:44.566142 [debug] [MainThread]: running dbt with arguments {'log_path': '/workdir/transforms/03_meteo/logs', 'empty': 'False', 'profiles_dir': '.', 'version_check': 'True', 'fail_fast': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'target_path': 'None', 'write_json': 'True', 'printer_width': '80', 'indirect_selection': 'eager', 'introspect': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'use_experimental_parser': 'False', 'debug': 'False', 'warn_error': 'None'}
[0m15:04:45.176846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '385c2017-b0b4-4ca4-a91f-2950b472bd73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f3be1b50>]}
[0m15:04:45.372681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '385c2017-b0b4-4ca4-a91f-2950b472bd73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f4888a30>]}
[0m15:04:45.373934 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m15:04:45.788617 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m15:04:46.292842 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m15:04:46.293943 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/mart/mart_meteo__manila_monthly.sql
[0m15:04:46.294648 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/mart/mart_meteo__manila_daily.sql
[0m15:04:47.201353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '385c2017-b0b4-4ca4-a91f-2950b472bd73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f0576e20>]}
[0m15:04:47.678238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '385c2017-b0b4-4ca4-a91f-2950b472bd73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f05df1f0>]}
[0m15:04:47.679216 [info ] [MainThread]: Found 3 models, 4 data tests, 1 source, 471 macros
[0m15:04:47.683177 [info ] [MainThread]: 
[0m15:04:47.684431 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m15:04:47.697731 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:04:47.699283 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:04:47.778654 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:04:47.783378 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:04:48.367062 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:04:48.371504 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:04:48.375641 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:04:48.379646 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:04:48.607067 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m15:04:48.608342 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m15:04:48.673648 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m15:04:48.681707 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m15:04:48.691211 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:04:48.700522 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m15:04:48.707356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '385c2017-b0b4-4ca4-a91f-2950b472bd73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f0489970>]}
[0m15:04:48.708631 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m15:04:48.709714 [info ] [MainThread]: 
[0m15:04:48.783327 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_meteo__manila
[0m15:04:48.784436 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_meteo__manila` ........................ [RUN]
[0m15:04:48.785591 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_meteo__manila'
[0m15:04:48.786308 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_meteo__manila
[0m15:04:48.804179 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_meteo__manila"
[0m15:04:48.805477 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_meteo__manila
[0m15:04:48.996627 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m15:04:49.106229 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_meteo__manila"
[0m15:04:49.107620 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */


  create view `clean`.`stg_meteo__manila__dbt_tmp` 
  
    
    
  as (
    

-- Normalize types & naming; no business logic here.
select
  toDate(date)                         as dte,
  toFloat64(temp_min)                  as temp_min_c,
  toFloat64(temp_max)                  as temp_max_c,
  toFloat64(precipitation)             as precip_mm,
  toInt32(weather_code)                as weather_code
from `raw`.`meteo___manila`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m15:04:49.121957 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:04:49.136266 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila__dbt_backup` 
  
  ...
[0m15:04:49.139677 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:04:49.141727 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    rename table `clean`.`stg_meteo__manila` to `clean`.`stg_meteo__manila__dbt_backup` 
  
  ...
[0m15:04:49.144740 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:04:49.150880 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila` 
  
  ...
[0m15:04:49.153883 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:04:49.156367 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    rename table `clean`.`stg_meteo__manila__dbt_tmp` to `clean`.`stg_meteo__manila` 
  
  ...
[0m15:04:49.159732 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:04:49.210361 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila__dbt_backup` 
  ...
[0m15:04:49.213787 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:04:49.267252 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385c2017-b0b4-4ca4-a91f-2950b472bd73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f00818e0>]}
[0m15:04:49.268449 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_meteo__manila` ................... [[32mOK[0m in 0.48s]
[0m15:04:49.269815 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_meteo__manila
[0m15:04:49.271970 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:04:49.273067 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:04:49.274407 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_meteo__manila_dte ............................... [RUN]
[0m15:04:49.275477 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:04:49.277152 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_meteo__manila_temp_max_c ........................ [RUN]
[0m15:04:49.278648 [debug] [Thread-1  ]: Began running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:04:49.280261 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f'
[0m15:04:49.282074 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_meteo__manila_temp_min_c ........................ [RUN]
[0m15:04:49.284653 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339'
[0m15:04:49.286118 [info ] [Thread-1  ]: 5 of 7 START test unique_stg_meteo__manila_dte ................................. [RUN]
[0m15:04:49.287453 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:04:49.289710 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9'
[0m15:04:49.291642 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:04:49.293002 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_meteo__manila, now test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc)
[0m15:04:49.365391 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:04:49.401566 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m15:04:49.403125 [debug] [Thread-1  ]: Began compiling node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:04:49.407850 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m15:04:49.474009 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m15:04:49.492021 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:04:49.501256 [debug] [Thread-1  ]: Writing injected SQL for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m15:04:49.503455 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:04:49.582012 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:04:49.593989 [debug] [Thread-1  ]: Began executing node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:04:49.901523 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m15:04:49.903157 [debug] [Thread-1  ]: Writing runtime sql for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m15:04:49.911613 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m15:04:49.969014 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m15:04:49.971668 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m15:04:49.973771 [debug] [Thread-1  ]: dbt_clickhouse adapter: On test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    dte as unique_field,
    count(*) as n_records

from `clean`.`stg_meteo__manila`
where dte is not null
group by dte
having count(*) > 1



    ) dbt_internal_test...
[0m15:04:49.976108 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m15:04:49.979893 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m15:04:50.067686 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m15:04:50.172874 [info ] [Thread-1  ]: 5 of 7 PASS unique_stg_meteo__manila_dte ....................................... [[32mPASS[0m in 0.88s]
[0m15:04:50.178361 [debug] [Thread-1  ]: Finished running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:04:50.279969 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select dte
from `clean`.`stg_meteo__manila`
where dte is null



    ) dbt_internal_test...
[0m15:04:50.294976 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_min_c
from `clean`.`stg_meteo__manila`
where temp_min_c is null



    ) dbt_internal_test...
[0m15:04:50.297825 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m15:04:50.302595 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_max_c
from `clean`.`stg_meteo__manila`
where temp_max_c is null



    ) dbt_internal_test...
[0m15:04:50.308879 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_meteo__manila_dte ..................................... [[32mPASS[0m in 1.03s]
[0m15:04:50.366625 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m15:04:50.370424 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:04:50.377776 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_meteo__manila_temp_min_c .............................. [[32mPASS[0m in 1.09s]
[0m15:04:50.381224 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m15:04:50.384860 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:04:50.390849 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_meteo__manila_temp_max_c .............................. [[32mPASS[0m in 1.11s]
[0m15:04:50.394840 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:04:50.397972 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:04:50.399855 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:04:50.402252 [info ] [Thread-1  ]: 6 of 7 START sql table model `mart`.`mart_meteo__manila_daily` ................. [RUN]
[0m15:04:50.404813 [info ] [Thread-3  ]: 7 of 7 START sql table model `mart`.`mart_meteo__manila_monthly` ............... [RUN]
[0m15:04:50.406664 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc, now model.ex_03_meteo.mart_meteo__manila_daily)
[0m15:04:50.408132 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f, now model.ex_03_meteo.mart_meteo__manila_monthly)
[0m15:04:50.409707 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:04:50.411273 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:04:50.486385 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m15:04:50.490321 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m15:04:50.492891 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:04:50.494460 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:04:50.691775 [debug] [Thread-1  ]: Creating new relation mart_meteo__manila_daily
[0m15:04:50.786092 [debug] [Thread-3  ]: Creating new relation mart_meteo__manila_monthly
[0m15:04:51.164767 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

            

    
        create table `mart`.`mart_meteo__manila_monthly`
        
  
        
  engine = MergeTree()
        order by (month)
        
        partition by (toYYYYMM(month))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(dte)                            as dte_nn,   -- 👈 non-nullable
    toFloat64(temp_min_c)                         as temp_min_c,
    toFloat64(temp_max_c)                         as temp_max_c,
    (toFloat64(temp_min_c) + toFloat64(temp_max_c))/2.0 as temp_avg_c,
    toFloat64(precip_mm)                          as precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte_nn)                as month,             -- 👈 computed from non-null date
  avg(temp_min_c)                       as avg_min_c,
  avg(temp_max_c)                       as avg_max_c,
  avg(temp_avg_c)                       as avg_temp_c,
  sum(precip_mm)                        as total_precip_mm,
  countIf(precip_mm > 0)                as rainy_days
from base
group by month
order by month
          )
        
        ...
[0m15:04:51.166469 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

            

    
        create table `mart`.`mart_meteo__manila_daily`
        
  
        
  engine = MergeTree()
        order by (dte)
        
        partition by (toYYYYMM(dte))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Force non-nullable key for MergeTree
select
  assumeNotNull(dte)                         as dte,          -- 👈 non-nullable
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0              as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
          )
        
        ...
[0m15:04:51.195273 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m15:04:51.211659 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m15:04:51.221341 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

    select name, type from system.columns where table = 'mart_meteo__manila_daily'
    
      and database = 'mart'
    
    order by position
  ...
[0m15:04:51.231621 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

    select name, type from system.columns where table = 'mart_meteo__manila_monthly'
    
      and database = 'mart'
    
    order by position
  ...
[0m15:04:51.267039 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m15:04:51.283066 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m15:04:51.280478 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m15:04:51.288793 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m15:04:51.291608 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

  
    
    
    
        
         


        insert into `mart`.`mart_meteo__manila_daily`
        ("dte", "temp_min_c", "temp_max_c", "temp_avg_c", "precip_mm", "weather_code")

-- Force non-nullable key for MergeTree
select
  assumeNotNull(dte)                         as dte,          -- 👈 non-nullable
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0              as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
  ...
[0m15:04:51.293884 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

  
    
    
    
        
         


        insert into `mart`.`mart_meteo__manila_monthly`
        ("month", "avg_min_c", "avg_max_c", "avg_temp_c", "total_precip_mm", "rainy_days")

with base as (
  select
    assumeNotNull(dte)                            as dte_nn,   -- 👈 non-nullable
    toFloat64(temp_min_c)                         as temp_min_c,
    toFloat64(temp_max_c)                         as temp_max_c,
    (toFloat64(temp_min_c) + toFloat64(temp_max_c))/2.0 as temp_avg_c,
    toFloat64(precip_mm)                          as precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte_nn)                as month,             -- 👈 computed from non-null date
  avg(temp_min_c)                       as avg_min_c,
  avg(temp_max_c)                       as avg_max_c,
  avg(temp_avg_c)                       as avg_temp_c,
  sum(precip_mm)                        as total_precip_mm,
  countIf(precip_mm > 0)                as rainy_days
from base
group by month
order by month
  ...
[0m15:04:51.339656 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m15:04:51.346193 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385c2017-b0b4-4ca4-a91f-2950b472bd73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f006f5e0>]}
[0m15:04:51.348723 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m15:04:51.351375 [info ] [Thread-1  ]: 6 of 7 OK created sql table model `mart`.`mart_meteo__manila_daily` ............ [[32mOK[0m in 0.94s]
[0m15:04:51.371206 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385c2017-b0b4-4ca4-a91f-2950b472bd73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0eff47c10>]}
[0m15:04:51.374167 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:04:51.376869 [info ] [Thread-3  ]: 7 of 7 OK created sql table model `mart`.`mart_meteo__manila_monthly` .......... [[32mOK[0m in 0.96s]
[0m15:04:51.380182 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:04:51.384005 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:04:51.385226 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m15:04:51.386724 [debug] [MainThread]: On list__mart: Close
[0m15:04:51.388000 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m15:04:51.389175 [debug] [MainThread]: On list__clean: Close
[0m15:04:51.390294 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_daily' was left open.
[0m15:04:51.391475 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_daily: Close
[0m15:04:51.392611 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_monthly' was left open.
[0m15:04:51.393813 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_monthly: Close
[0m15:04:51.394998 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339' was left open.
[0m15:04:51.396180 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339: Close
[0m15:04:51.397340 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9' was left open.
[0m15:04:51.398514 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9: Close
[0m15:04:51.400777 [info ] [MainThread]: 
[0m15:04:51.402246 [info ] [MainThread]: Finished running 1 view model, 4 data tests, 2 table models in 0 hours 0 minutes and 3.72 seconds (3.72s).
[0m15:04:51.410813 [debug] [MainThread]: Command end result
[0m15:04:51.675852 [info ] [MainThread]: 
[0m15:04:51.677491 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:04:51.678817 [info ] [MainThread]: 
[0m15:04:51.680157 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:04:51.682789 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.371369, "process_in_blocks": "0", "process_kernel_time": 0.653605, "process_mem_max_rss": "116544", "process_out_blocks": "10696", "process_user_time": 6.386916}
[0m15:04:51.684390 [debug] [MainThread]: Command `dbt build` succeeded at 15:04:51.683984 after 7.37 seconds
[0m15:04:51.685757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f4634310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f1bc2f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f04ce790>]}
[0m15:04:51.687002 [debug] [MainThread]: Flushing usage events
[0m15:36:36.990440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63af6ec310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63ac34a4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63ac34a610>]}


============================== 15:36:37.000651 | 883e48ce-5627-46b3-a880-4911742117d5 ==============================
[0m15:36:37.000651 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:36:37.001876 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'log_path': '/workdir/transforms/03_meteo/logs', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'profiles_dir': '.', 'no_print': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'version_check': 'True', 'target_path': 'None', 'printer_width': '80', 'empty': 'False', 'debug': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'partial_parse': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'write_json': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m15:36:37.578295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63ac449460>]}
[0m15:36:37.773481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63ac422dc0>]}
[0m15:36:37.774737 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m15:36:38.192036 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m15:36:38.704485 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m15:36:38.705453 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/mart/vw_meteo__manila_night_weather.sql
[0m15:36:38.706650 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/sources.yml
[0m15:36:39.492792 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m15:36:39.493771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63abacaeb0>]}
[0m15:36:40.508757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63ab1bde50>]}
[0m15:36:41.007924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63abb08a60>]}
[0m15:36:41.008815 [info ] [MainThread]: Found 4 models, 4 data tests, 2 sources, 471 macros
[0m15:36:41.012155 [info ] [MainThread]: 
[0m15:36:41.013186 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m15:36:41.025644 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:36:41.067232 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:36:41.310982 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:36:41.368962 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:36:42.172584 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:36:42.181213 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:36:42.183599 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:36:42.191776 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:36:42.289628 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m15:36:42.301607 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m15:36:42.306696 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m15:36:42.312501 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m15:36:42.368663 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m15:36:42.385592 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m15:36:42.393808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63ac433190>]}
[0m15:36:42.395643 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m15:36:42.397001 [info ] [MainThread]: 
[0m15:36:42.469729 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_meteo__manila
[0m15:36:42.471133 [info ] [Thread-1  ]: 1 of 8 START sql view model `clean`.`stg_meteo__manila` ........................ [RUN]
[0m15:36:42.472188 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_03_meteo.stg_meteo__manila)
[0m15:36:42.473077 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_meteo__manila
[0m15:36:42.494072 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_meteo__manila"
[0m15:36:42.495427 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_meteo__manila
[0m15:36:42.694318 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_meteo__manila"
[0m15:36:42.696109 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */


  create view `clean`.`stg_meteo__manila__dbt_tmp` 
  
    
    
  as (
    

-- Normalize types & naming; no business logic here.
select
  toDate(date)                         as dte,
  toFloat64(temp_min)                  as temp_min_c,
  toFloat64(temp_max)                  as temp_max_c,
  toFloat64(precipitation)             as precip_mm,
  toInt32(weather_code)                as weather_code
from `raw`.`meteo___manila`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m15:36:42.708187 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:36:42.720803 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila__dbt_backup` 
  
  ...
[0m15:36:42.724203 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:42.767625 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    rename table `clean`.`stg_meteo__manila` to `clean`.`stg_meteo__manila__dbt_backup` 
  
  ...
[0m15:36:42.770834 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:42.777318 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila` 
  
  ...
[0m15:36:42.780241 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:42.782064 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    rename table `clean`.`stg_meteo__manila__dbt_tmp` to `clean`.`stg_meteo__manila` 
  
  ...
[0m15:36:42.784907 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:42.878303 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila__dbt_backup` 
  ...
[0m15:36:42.881659 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:42.888044 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63aad592b0>]}
[0m15:36:42.889231 [info ] [Thread-1  ]: 1 of 8 OK created sql view model `clean`.`stg_meteo__manila` ................... [[32mOK[0m in 0.41s]
[0m15:36:42.890616 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_meteo__manila
[0m15:36:42.893258 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:36:42.894625 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:36:42.895793 [info ] [Thread-3  ]: 2 of 8 START test not_null_stg_meteo__manila_dte ............................... [RUN]
[0m15:36:42.897161 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:36:42.898699 [debug] [Thread-1  ]: Began running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:36:42.899801 [info ] [Thread-4  ]: 3 of 8 START test not_null_stg_meteo__manila_temp_max_c ........................ [RUN]
[0m15:36:42.902138 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f'
[0m15:36:42.903577 [info ] [Thread-2  ]: 4 of 8 START test not_null_stg_meteo__manila_temp_min_c ........................ [RUN]
[0m15:36:42.904578 [info ] [Thread-1  ]: 5 of 8 START test unique_stg_meteo__manila_dte ................................. [RUN]
[0m15:36:42.906092 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339'
[0m15:36:42.907861 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:36:42.909362 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9'
[0m15:36:42.910551 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_meteo__manila, now test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc)
[0m15:36:42.911886 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:36:42.982917 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:36:42.998189 [debug] [Thread-1  ]: Began compiling node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:36:43.011586 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m15:36:43.073458 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m15:36:43.080523 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m15:36:43.093206 [debug] [Thread-1  ]: Writing injected SQL for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m15:36:43.094864 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:36:43.095554 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:36:43.096407 [debug] [Thread-1  ]: Began executing node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:36:43.097127 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:36:43.302800 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m15:36:43.304692 [debug] [Thread-1  ]: Writing runtime sql for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m15:36:43.369340 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m15:36:43.377943 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m15:36:43.379836 [debug] [Thread-1  ]: dbt_clickhouse adapter: On test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    dte as unique_field,
    count(*) as n_records

from `clean`.`stg_meteo__manila`
where dte is not null
group by dte
having count(*) > 1



    ) dbt_internal_test...
[0m15:36:43.380963 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m15:36:43.383885 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m15:36:43.385262 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m15:36:43.394542 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:36:43.479570 [info ] [Thread-1  ]: 5 of 8 PASS unique_stg_meteo__manila_dte ....................................... [[32mPASS[0m in 0.57s]
[0m15:36:43.502870 [debug] [Thread-1  ]: Finished running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:36:43.631487 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select dte
from `clean`.`stg_meteo__manila`
where dte is null



    ) dbt_internal_test...
[0m15:36:43.670960 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m15:36:43.676992 [info ] [Thread-3  ]: 2 of 8 PASS not_null_stg_meteo__manila_dte ..................................... [[32mPASS[0m in 0.78s]
[0m15:36:43.680745 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_min_c
from `clean`.`stg_meteo__manila`
where temp_min_c is null



    ) dbt_internal_test...
[0m15:36:43.683804 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:36:43.695375 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_max_c
from `clean`.`stg_meteo__manila`
where temp_max_c is null



    ) dbt_internal_test...
[0m15:36:43.705893 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m15:36:43.712120 [info ] [Thread-2  ]: 4 of 8 PASS not_null_stg_meteo__manila_temp_min_c .............................. [[32mPASS[0m in 0.80s]
[0m15:36:43.715292 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:36:43.718634 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m15:36:43.769904 [info ] [Thread-4  ]: 3 of 8 PASS not_null_stg_meteo__manila_temp_max_c .............................. [[32mPASS[0m in 0.86s]
[0m15:36:43.772712 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:36:43.775974 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:36:43.777802 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:36:43.779896 [info ] [Thread-1  ]: 6 of 8 START sql table model `mart`.`mart_meteo__manila_daily` ................. [RUN]
[0m15:36:43.781790 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_meteo__manila_night_weather
[0m15:36:43.783944 [info ] [Thread-3  ]: 7 of 8 START sql table model `mart`.`mart_meteo__manila_monthly` ............... [RUN]
[0m15:36:43.785802 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc, now model.ex_03_meteo.mart_meteo__manila_daily)
[0m15:36:43.787947 [info ] [Thread-2  ]: 8 of 8 START sql view model `mart`.`vw_meteo__manila_night_weather` ............ [RUN]
[0m15:36:43.789836 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f, now model.ex_03_meteo.mart_meteo__manila_monthly)
[0m15:36:43.791494 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:36:43.793184 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9, now model.ex_03_meteo.vw_meteo__manila_night_weather)
[0m15:36:43.794903 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:36:43.809033 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m15:36:43.810715 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_meteo__manila_night_weather
[0m15:36:43.877692 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m15:36:43.892388 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_meteo__manila_night_weather"
[0m15:36:43.894476 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:36:43.907067 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:36:43.908828 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_meteo__manila_night_weather
[0m15:36:44.067421 [debug] [Thread-2  ]: Creating new relation vw_meteo__manila_night_weather
[0m15:36:44.076634 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_meteo__manila_night_weather"
[0m15:36:44.172866 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_meteo__manila_night_weather: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_meteo__manila_night_weather"} */


  create view `mart`.`vw_meteo__manila_night_weather` 
  
    
    
  as (
    

with daily as (
  select
    dte,
    temp_min_c,
    temp_max_c,
    (temp_min_c + temp_max_c)/2.0 as temp_avg_c,
    precip_mm,
    weather_code
  from `clean`.`stg_meteo__manila`
),
codes as (
  select
    toInt32(weather_code)                as weather_code,
    cast(night_description as String)    as condition_night,
    cast(night_icon_url as String)       as icon_url_night
  from `raw`.`meteo___wmo_codes`
)

select
  d.dte,
  d.temp_min_c,
  d.temp_max_c,
  d.temp_avg_c,
  d.precip_mm,
  d.weather_code,
  c.condition_night,
  c.icon_url_night
from daily d
left join codes c
  on c.weather_code = d.weather_code
order by d.dte
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m15:36:44.291419 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m15:36:44.379312 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63aaccd220>]}
[0m15:36:44.412002 [info ] [Thread-2  ]: 8 of 8 OK created sql view model `mart`.`vw_meteo__manila_night_weather` ....... [[32mOK[0m in 0.59s]
[0m15:36:44.484388 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

            

    
        create table `mart`.`mart_meteo__manila_daily__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (dte)
        
        partition by (toYYYYMM(dte))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Force non-nullable key for MergeTree
select
  assumeNotNull(dte)                         as dte,          -- 👈 non-nullable
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0              as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
          )
        
        ...
[0m15:36:44.488450 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

            

    
        create table `mart`.`mart_meteo__manila_monthly__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (month)
        
        partition by (toYYYYMM(month))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(dte)                            as dte_nn,   -- 👈 non-nullable
    toFloat64(temp_min_c)                         as temp_min_c,
    toFloat64(temp_max_c)                         as temp_max_c,
    (toFloat64(temp_min_c) + toFloat64(temp_max_c))/2.0 as temp_avg_c,
    toFloat64(precip_mm)                          as precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte_nn)                as month,             -- 👈 computed from non-null date
  avg(temp_min_c)                       as avg_min_c,
  avg(temp_max_c)                       as avg_max_c,
  avg(temp_avg_c)                       as avg_temp_c,
  sum(precip_mm)                        as total_precip_mm,
  countIf(precip_mm > 0)                as rainy_days
from base
group by month
order by month
          )
        
        ...
[0m15:36:44.492151 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_meteo__manila_night_weather
[0m15:36:44.513963 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m15:36:44.528933 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m15:36:44.572365 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

    select name, type from system.columns where table = 'mart_meteo__manila_daily__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m15:36:44.578867 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

    select name, type from system.columns where table = 'mart_meteo__manila_monthly__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m15:36:44.584445 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:44.586065 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:44.593233 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m15:36:44.596079 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m15:36:44.597540 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

  
    
    
    
        
         


        insert into `mart`.`mart_meteo__manila_monthly__dbt_backup`
        ("month", "avg_min_c", "avg_max_c", "avg_temp_c", "total_precip_mm", "rainy_days")

with base as (
  select
    assumeNotNull(dte)                            as dte_nn,   -- 👈 non-nullable
    toFloat64(temp_min_c)                         as temp_min_c,
    toFloat64(temp_max_c)                         as temp_max_c,
    (toFloat64(temp_min_c) + toFloat64(temp_max_c))/2.0 as temp_avg_c,
    toFloat64(precip_mm)                          as precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte_nn)                as month,             -- 👈 computed from non-null date
  avg(temp_min_c)                       as avg_min_c,
  avg(temp_max_c)                       as avg_max_c,
  avg(temp_avg_c)                       as avg_temp_c,
  sum(precip_mm)                        as total_precip_mm,
  countIf(precip_mm > 0)                as rainy_days
from base
group by month
order by month
  ...
[0m15:36:44.598574 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

  
    
    
    
        
         


        insert into `mart`.`mart_meteo__manila_daily__dbt_backup`
        ("dte", "temp_min_c", "temp_max_c", "temp_avg_c", "precip_mm", "weather_code")

-- Force non-nullable key for MergeTree
select
  assumeNotNull(dte)                         as dte,          -- 👈 non-nullable
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0              as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
  ...
[0m15:36:44.627315 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m15:36:44.668058 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m15:36:44.669436 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */
EXCHANGE TABLES `mart`.`mart_meteo__manila_daily__dbt_backup` AND `mart`.`mart_meteo__manila_daily` 
  
  ...
[0m15:36:44.671496 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */
EXCHANGE TABLES `mart`.`mart_meteo__manila_monthly__dbt_backup` AND `mart`.`mart_meteo__manila_monthly` 
  
  ...
[0m15:36:44.674712 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:44.681160 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:36:44.682645 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

    drop table if exists `mart`.`mart_meteo__manila_daily__dbt_backup` 
  ...
[0m15:36:44.690259 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

    drop table if exists `mart`.`mart_meteo__manila_monthly__dbt_backup` 
  ...
[0m15:36:44.694098 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:44.695790 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:44.698658 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63a9eb6f70>]}
[0m15:36:44.702869 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63a9edceb0>]}
[0m15:36:44.704945 [info ] [Thread-1  ]: 6 of 8 OK created sql table model `mart`.`mart_meteo__manila_daily` ............ [[32mOK[0m in 0.91s]
[0m15:36:44.706956 [info ] [Thread-3  ]: 7 of 8 OK created sql table model `mart`.`mart_meteo__manila_monthly` .......... [[32mOK[0m in 0.91s]
[0m15:36:44.709015 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:36:44.710559 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:36:44.713206 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:36:44.714292 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_daily' was left open.
[0m15:36:44.715350 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_daily: Close
[0m15:36:44.716225 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m15:36:44.768035 [debug] [MainThread]: On list__clean: Close
[0m15:36:44.769199 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_monthly' was left open.
[0m15:36:44.770554 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_monthly: Close
[0m15:36:44.771334 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339' was left open.
[0m15:36:44.772484 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339: Close
[0m15:36:44.773552 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_meteo__manila_night_weather' was left open.
[0m15:36:44.775188 [debug] [MainThread]: On model.ex_03_meteo.vw_meteo__manila_night_weather: Close
[0m15:36:44.777508 [info ] [MainThread]: 
[0m15:36:44.779234 [info ] [MainThread]: Finished running 2 view models, 4 data tests, 2 table models in 0 hours 0 minutes and 3.76 seconds (3.76s).
[0m15:36:44.789826 [debug] [MainThread]: Command end result
[0m15:36:44.971153 [info ] [MainThread]: 
[0m15:36:44.972515 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:36:44.973807 [info ] [MainThread]: 
[0m15:36:44.975387 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
[0m15:36:44.977910 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 8.180407, "process_in_blocks": "0", "process_kernel_time": 0.708007, "process_mem_max_rss": "118564", "process_out_blocks": "10760", "process_user_time": 6.789074}
[0m15:36:44.979271 [debug] [MainThread]: Command `dbt build` succeeded at 15:36:44.978939 after 8.18 seconds
[0m15:36:44.980345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63af6ec310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63ad5fda60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63ab506e50>]}
[0m15:36:44.981234 [debug] [MainThread]: Flushing usage events
[0m15:37:28.896480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639d1fd8310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cec2eb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cec2ea00>]}


============================== 15:37:28.906035 | 44d80b62-f5de-47ad-9490-491a483a09f7 ==============================
[0m15:37:28.906035 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:37:28.907109 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'log_cache_events': 'False', 'use_colors': 'True', 'warn_error': 'None', 'version_check': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'introspect': 'True', 'empty': 'False', 'write_json': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'debug': 'False', 'cache_selected_only': 'False', 'printer_width': '80', 'static_parser': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': '/workdir/transforms/03_meteo/logs', 'profiles_dir': '.', 'target_path': 'None', 'no_print': 'None', 'partial_parse': 'True'}
[0m15:37:29.493081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639d1565ca0>]}
[0m15:37:29.688691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639ceb48dc0>]}
[0m15:37:29.689984 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m15:37:30.110461 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m15:37:30.616822 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:37:30.617812 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/mart/vw_meteo__manila_night_weather.sql
[0m15:37:31.509433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cdf07fa0>]}
[0m15:37:31.991337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cddafc10>]}
[0m15:37:31.992201 [info ] [MainThread]: Found 4 models, 4 data tests, 2 sources, 471 macros
[0m15:37:31.995846 [info ] [MainThread]: 
[0m15:37:31.996913 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m15:37:32.009780 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:37:32.011312 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:37:32.104425 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:37:32.111227 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:37:32.778964 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:37:32.787451 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:37:32.791820 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:32.794473 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:33.089731 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m15:37:33.091218 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m15:37:33.106398 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m15:37:33.111922 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m15:37:33.123904 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:33.125898 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:33.186921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639d1f2a7c0>]}
[0m15:37:33.189185 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m15:37:33.190697 [info ] [MainThread]: 
[0m15:37:33.218352 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_meteo__manila
[0m15:37:33.219919 [info ] [Thread-1  ]: 1 of 8 START sql view model `clean`.`stg_meteo__manila` ........................ [RUN]
[0m15:37:33.221164 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_03_meteo.stg_meteo__manila)
[0m15:37:33.272686 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_meteo__manila
[0m15:37:33.298602 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_meteo__manila"
[0m15:37:33.300128 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_meteo__manila
[0m15:37:33.499034 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_meteo__manila"
[0m15:37:33.500835 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */


  create view `clean`.`stg_meteo__manila__dbt_tmp` 
  
    
    
  as (
    

-- Normalize types & naming; no business logic here.
select
  toDate(date)                         as dte,
  toFloat64(temp_min)                  as temp_min_c,
  toFloat64(temp_max)                  as temp_max_c,
  toFloat64(precipitation)             as precip_mm,
  toInt32(weather_code)                as weather_code
from `raw`.`meteo___manila`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m15:37:33.512327 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:33.526744 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila__dbt_backup` 
  
  ...
[0m15:37:33.529798 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:37:33.573227 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    rename table `clean`.`stg_meteo__manila` to `clean`.`stg_meteo__manila__dbt_backup` 
  
  ...
[0m15:37:33.576427 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:37:33.582771 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila` 
  
  ...
[0m15:37:33.586033 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:37:33.588164 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    rename table `clean`.`stg_meteo__manila__dbt_tmp` to `clean`.`stg_meteo__manila` 
  
  ...
[0m15:37:33.590880 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:37:33.690577 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila__dbt_backup` 
  ...
[0m15:37:33.695070 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:37:33.701277 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cebf4d30>]}
[0m15:37:33.702631 [info ] [Thread-1  ]: 1 of 8 OK created sql view model `clean`.`stg_meteo__manila` ................... [[32mOK[0m in 0.48s]
[0m15:37:33.704050 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_meteo__manila
[0m15:37:33.706308 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:37:33.707426 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:37:33.708468 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:37:33.709772 [info ] [Thread-3  ]: 2 of 8 START test not_null_stg_meteo__manila_dte ............................... [RUN]
[0m15:37:33.711197 [debug] [Thread-1  ]: Began running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:37:33.711994 [info ] [Thread-4  ]: 3 of 8 START test not_null_stg_meteo__manila_temp_max_c ........................ [RUN]
[0m15:37:33.713054 [info ] [Thread-2  ]: 4 of 8 START test not_null_stg_meteo__manila_temp_min_c ........................ [RUN]
[0m15:37:33.714858 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f'
[0m15:37:33.716254 [info ] [Thread-1  ]: 5 of 8 START test unique_stg_meteo__manila_dte ................................. [RUN]
[0m15:37:33.717886 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339'
[0m15:37:33.720006 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9'
[0m15:37:33.721742 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:37:33.772606 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_meteo__manila, now test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc)
[0m15:37:33.774234 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:37:33.775906 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:37:33.799311 [debug] [Thread-1  ]: Began compiling node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:37:33.892933 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m15:37:33.897311 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m15:37:33.906741 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m15:37:33.982066 [debug] [Thread-1  ]: Writing injected SQL for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m15:37:33.984210 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:37:34.004766 [debug] [Thread-1  ]: Began executing node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:37:34.006387 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:37:34.093087 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:37:34.200186 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m15:37:34.211464 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m15:37:34.303277 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m15:37:34.306520 [debug] [Thread-1  ]: Writing runtime sql for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m15:37:34.314319 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m15:37:34.379999 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m15:37:34.388199 [debug] [Thread-1  ]: dbt_clickhouse adapter: On test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    dte as unique_field,
    count(*) as n_records

from `clean`.`stg_meteo__manila`
where dte is not null
group by dte
having count(*) > 1



    ) dbt_internal_test...
[0m15:37:34.393297 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m15:37:34.476009 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m15:37:34.499416 [info ] [Thread-1  ]: 5 of 8 PASS unique_stg_meteo__manila_dte ....................................... [[32mPASS[0m in 0.73s]
[0m15:37:34.573640 [debug] [Thread-1  ]: Finished running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:37:34.680742 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_min_c
from `clean`.`stg_meteo__manila`
where temp_min_c is null



    ) dbt_internal_test...
[0m15:37:34.695739 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:34.705083 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_max_c
from `clean`.`stg_meteo__manila`
where temp_max_c is null



    ) dbt_internal_test...
[0m15:37:34.710047 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select dte
from `clean`.`stg_meteo__manila`
where dte is null



    ) dbt_internal_test...
[0m15:37:34.702730 [info ] [Thread-2  ]: 4 of 8 PASS not_null_stg_meteo__manila_temp_min_c .............................. [[32mPASS[0m in 0.98s]
[0m15:37:34.715505 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:37:34.772287 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:34.775779 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m15:37:34.783067 [info ] [Thread-4  ]: 3 of 8 PASS not_null_stg_meteo__manila_temp_max_c .............................. [[32mPASS[0m in 1.07s]
[0m15:37:34.789641 [info ] [Thread-3  ]: 2 of 8 PASS not_null_stg_meteo__manila_dte ..................................... [[32mPASS[0m in 1.07s]
[0m15:37:34.792721 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:37:34.795613 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:37:34.799393 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:37:34.801155 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:37:34.803311 [info ] [Thread-1  ]: 6 of 8 START sql table model `mart`.`mart_meteo__manila_daily` ................. [RUN]
[0m15:37:34.805269 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_meteo__manila_night_weather
[0m15:37:34.807506 [info ] [Thread-2  ]: 7 of 8 START sql table model `mart`.`mart_meteo__manila_monthly` ............... [RUN]
[0m15:37:34.809437 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc, now model.ex_03_meteo.mart_meteo__manila_daily)
[0m15:37:34.811573 [info ] [Thread-4  ]: 8 of 8 START sql view model `mart`.`vw_meteo__manila_night_weather` ............ [RUN]
[0m15:37:34.813611 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9, now model.ex_03_meteo.mart_meteo__manila_monthly)
[0m15:37:34.815324 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:37:34.816967 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339, now model.ex_03_meteo.vw_meteo__manila_night_weather)
[0m15:37:34.818618 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:37:34.886250 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m15:37:34.887647 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_meteo__manila_night_weather
[0m15:37:34.895530 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m15:37:34.903477 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_meteo__manila_night_weather"
[0m15:37:34.904740 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:37:34.905771 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:37:34.916973 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_meteo__manila_night_weather
[0m15:37:35.097158 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_meteo__manila_night_weather"
[0m15:37:35.207865 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_meteo__manila_night_weather: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_meteo__manila_night_weather"} */


  create view `mart`.`vw_meteo__manila_night_weather__dbt_tmp` 
  
    
    
  as (
    

with daily as (
  select
    dte,
    temp_min_c,
    temp_max_c,
    (temp_min_c + temp_max_c)/2.0 as temp_avg_c,
    precip_mm,
    weather_code
  from `clean`.`stg_meteo__manila`
),
codes as (
  select
    toInt32(weather_code)                as weather_code,
    cast(night_description as String)    as condition
  from `raw`.`meteo___wmo_codes`
)

select
  d.dte,
  d.temp_min_c,
  d.temp_max_c,
  d.temp_avg_c,
  d.precip_mm,
  d.weather_code,
  c.condition
from daily d
left join codes c
  on c.weather_code = d.weather_code
order by d.dte
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m15:37:35.373415 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.15 seconds
[0m15:37:35.408166 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

            

    
        create table `mart`.`mart_meteo__manila_daily__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (dte)
        
        partition by (toYYYYMM(dte))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Force non-nullable key for MergeTree
select
  assumeNotNull(dte)                         as dte,          -- 👈 non-nullable
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0              as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
          )
        
        ...
[0m15:37:35.409680 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_meteo__manila_night_weather: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_meteo__manila_night_weather"} */

    drop table if exists `mart`.`vw_meteo__manila_night_weather__dbt_backup` 
  
  ...
[0m15:37:35.415451 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

            

    
        create table `mart`.`mart_meteo__manila_monthly__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (month)
        
        partition by (toYYYYMM(month))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(dte)                            as dte_nn,   -- 👈 non-nullable
    toFloat64(temp_min_c)                         as temp_min_c,
    toFloat64(temp_max_c)                         as temp_max_c,
    (toFloat64(temp_min_c) + toFloat64(temp_max_c))/2.0 as temp_avg_c,
    toFloat64(precip_mm)                          as precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte_nn)                as month,             -- 👈 computed from non-null date
  avg(temp_min_c)                       as avg_min_c,
  avg(temp_max_c)                       as avg_max_c,
  avg(temp_avg_c)                       as avg_temp_c,
  sum(precip_mm)                        as total_precip_mm,
  countIf(precip_mm > 0)                as rainy_days
from base
group by month
order by month
          )
        
        ...
[0m15:37:35.473963 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m15:37:35.492219 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m15:37:35.505118 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m15:37:35.509253 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_meteo__manila_night_weather: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_meteo__manila_night_weather"} */

    rename table `mart`.`vw_meteo__manila_night_weather` to `mart`.`vw_meteo__manila_night_weather__dbt_backup` 
  
  ...
[0m15:37:35.518984 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

    select name, type from system.columns where table = 'mart_meteo__manila_daily__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m15:37:35.581955 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

    select name, type from system.columns where table = 'mart_meteo__manila_monthly__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m15:37:35.588820 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:35.594009 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:35.602399 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:35.609920 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_meteo__manila_night_weather: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_meteo__manila_night_weather"} */

    drop table if exists `mart`.`vw_meteo__manila_night_weather` 
  
  ...
[0m15:37:35.674369 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m15:37:35.679874 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m15:37:35.684874 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

  
    
    
    
        
         


        insert into `mart`.`mart_meteo__manila_daily__dbt_backup`
        ("dte", "temp_min_c", "temp_max_c", "temp_avg_c", "precip_mm", "weather_code")

-- Force non-nullable key for MergeTree
select
  assumeNotNull(dte)                         as dte,          -- 👈 non-nullable
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0              as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
  ...
[0m15:37:35.687508 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:35.693426 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_meteo__manila_night_weather: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_meteo__manila_night_weather"} */

    rename table `mart`.`vw_meteo__manila_night_weather__dbt_tmp` to `mart`.`vw_meteo__manila_night_weather` 
  
  ...
[0m15:37:35.697830 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

  
    
    
    
        
         


        insert into `mart`.`mart_meteo__manila_monthly__dbt_backup`
        ("month", "avg_min_c", "avg_max_c", "avg_temp_c", "total_precip_mm", "rainy_days")

with base as (
  select
    assumeNotNull(dte)                            as dte_nn,   -- 👈 non-nullable
    toFloat64(temp_min_c)                         as temp_min_c,
    toFloat64(temp_max_c)                         as temp_max_c,
    (toFloat64(temp_min_c) + toFloat64(temp_max_c))/2.0 as temp_avg_c,
    toFloat64(precip_mm)                          as precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte_nn)                as month,             -- 👈 computed from non-null date
  avg(temp_min_c)                       as avg_min_c,
  avg(temp_max_c)                       as avg_max_c,
  avg(temp_avg_c)                       as avg_temp_c,
  sum(precip_mm)                        as total_precip_mm,
  countIf(precip_mm > 0)                as rainy_days
from base
group by month
order by month
  ...
[0m15:37:35.705284 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:35.777770 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_meteo__manila_night_weather: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_meteo__manila_night_weather"} */

    drop table if exists `mart`.`vw_meteo__manila_night_weather__dbt_backup` 
  ...
[0m15:37:35.780522 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m15:37:35.773444 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m15:37:35.795759 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:35.804191 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */
EXCHANGE TABLES `mart`.`mart_meteo__manila_daily__dbt_backup` AND `mart`.`mart_meteo__manila_daily` 
  
  ...
[0m15:37:35.808623 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */
EXCHANGE TABLES `mart`.`mart_meteo__manila_monthly__dbt_backup` AND `mart`.`mart_meteo__manila_monthly` 
  
  ...
[0m15:37:35.813670 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cda59c10>]}
[0m15:37:35.872394 [info ] [Thread-4  ]: 8 of 8 OK created sql view model `mart`.`vw_meteo__manila_night_weather` ....... [[32mOK[0m in 1.00s]
[0m15:37:35.875852 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m15:37:35.878931 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_meteo__manila_night_weather
[0m15:37:35.892569 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m15:37:35.896712 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

    drop table if exists `mart`.`mart_meteo__manila_daily__dbt_backup` 
  ...
[0m15:37:35.911408 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

    drop table if exists `mart`.`mart_meteo__manila_monthly__dbt_backup` 
  ...
[0m15:37:35.918512 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:35.973354 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m15:37:35.978651 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cda4e880>]}
[0m15:37:35.984026 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cda57e50>]}
[0m15:37:35.986567 [info ] [Thread-1  ]: 6 of 8 OK created sql table model `mart`.`mart_meteo__manila_daily` ............ [[32mOK[0m in 1.17s]
[0m15:37:35.989289 [info ] [Thread-2  ]: 7 of 8 OK created sql table model `mart`.`mart_meteo__manila_monthly` .......... [[32mOK[0m in 1.17s]
[0m15:37:35.992644 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:37:35.996111 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:37:36.000601 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:37:36.001926 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_daily' was left open.
[0m15:37:36.003177 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_daily: Close
[0m15:37:36.004334 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m15:37:36.005568 [debug] [MainThread]: On list__clean: Close
[0m15:37:36.006822 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f' was left open.
[0m15:37:36.007998 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f: Close
[0m15:37:36.009195 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_meteo__manila_night_weather' was left open.
[0m15:37:36.010370 [debug] [MainThread]: On model.ex_03_meteo.vw_meteo__manila_night_weather: Close
[0m15:37:36.011545 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_monthly' was left open.
[0m15:37:36.012714 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_monthly: Close
[0m15:37:36.014894 [info ] [MainThread]: 
[0m15:37:36.016365 [info ] [MainThread]: Finished running 2 view models, 4 data tests, 2 table models in 0 hours 0 minutes and 4.02 seconds (4.02s).
[0m15:37:36.073959 [debug] [MainThread]: Command end result
[0m15:37:36.280883 [info ] [MainThread]: 
[0m15:37:36.281831 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:37:36.282460 [info ] [MainThread]: 
[0m15:37:36.283151 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
[0m15:37:36.284552 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.578497, "process_in_blocks": "0", "process_kernel_time": 0.682573, "process_mem_max_rss": "115960", "process_out_blocks": "10768", "process_user_time": 6.469437}
[0m15:37:36.285359 [debug] [MainThread]: Command `dbt build` succeeded at 15:37:36.285162 after 7.58 seconds
[0m15:37:36.286050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639d1fd8310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cfef6940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cfe63f70>]}
[0m15:37:36.286674 [debug] [MainThread]: Flushing usage events
[0m15:39:29.299563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70899b86d310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7089984d1ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7089984d1970>]}


============================== 15:39:29.359802 | 01efb72d-0201-4d73-8e52-98a582b86a5e ==============================
[0m15:39:29.359802 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:39:29.360954 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'profiles_dir': '.', 'cache_selected_only': 'False', 'log_path': '/workdir/transforms/03_meteo/logs', 'invocation_command': 'dbt build --profiles-dir . --target local', 'static_parser': 'True', 'no_print': 'None', 'debug': 'False', 'partial_parse': 'True', 'write_json': 'True', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'empty': 'False', 'target_path': 'None', 'quiet': 'False', 'printer_width': '80'}
[0m15:39:29.887807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70899856bd90>]}
[0m15:39:30.080446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708998488250>]}
[0m15:39:30.081732 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m15:39:30.493868 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m15:39:30.996960 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m15:39:30.997856 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/mart/vw_meteo__manila_weather.sql
[0m15:39:30.998436 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/mart/vw_meteo__manila_night_weather.sql
[0m15:39:31.894840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7089977a5f10>]}
[0m15:39:32.371571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708997718af0>]}
[0m15:39:32.372469 [info ] [MainThread]: Found 4 models, 4 data tests, 2 sources, 471 macros
[0m15:39:32.376086 [info ] [MainThread]: 
[0m15:39:32.377315 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m15:39:32.389504 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:39:32.395838 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:39:32.409839 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:39:32.464902 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:39:33.010452 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:39:33.016514 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:39:33.020155 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:39:33.023149 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:39:33.263444 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m15:39:33.275599 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m15:39:33.280503 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m15:39:33.288047 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m15:39:33.297266 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:39:33.307068 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m15:39:33.362790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70899726da60>]}
[0m15:39:33.364742 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m15:39:33.366027 [info ] [MainThread]: 
[0m15:39:33.390815 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_meteo__manila
[0m15:39:33.391951 [info ] [Thread-1  ]: 1 of 8 START sql view model `clean`.`stg_meteo__manila` ........................ [RUN]
[0m15:39:33.392804 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_03_meteo.stg_meteo__manila)
[0m15:39:33.393549 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_meteo__manila
[0m15:39:33.462213 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_meteo__manila"
[0m15:39:33.463359 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_meteo__manila
[0m15:39:33.587734 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_meteo__manila"
[0m15:39:33.589336 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */


  create view `clean`.`stg_meteo__manila__dbt_tmp` 
  
    
    
  as (
    

-- Normalize types & naming; no business logic here.
select
  toDate(date)                         as dte,
  toFloat64(temp_min)                  as temp_min_c,
  toFloat64(temp_max)                  as temp_max_c,
  toFloat64(precipitation)             as precip_mm,
  toInt32(weather_code)                as weather_code
from `raw`.`meteo___manila`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m15:39:33.600957 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:39:33.614339 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila__dbt_backup` 
  
  ...
[0m15:39:33.617355 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:33.660484 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    rename table `clean`.`stg_meteo__manila` to `clean`.`stg_meteo__manila__dbt_backup` 
  
  ...
[0m15:39:33.663409 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:33.668741 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila` 
  
  ...
[0m15:39:33.671389 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:33.673114 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    rename table `clean`.`stg_meteo__manila__dbt_tmp` to `clean`.`stg_meteo__manila` 
  
  ...
[0m15:39:33.675795 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:33.770228 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila__dbt_backup` 
  ...
[0m15:39:33.773961 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:33.779993 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708997304f70>]}
[0m15:39:33.781143 [info ] [Thread-1  ]: 1 of 8 OK created sql view model `clean`.`stg_meteo__manila` ................... [[32mOK[0m in 0.39s]
[0m15:39:33.782555 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_meteo__manila
[0m15:39:33.784797 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:39:33.785674 [info ] [Thread-3  ]: 2 of 8 START test not_null_stg_meteo__manila_dte ............................... [RUN]
[0m15:39:33.786908 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:39:33.788490 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f'
[0m15:39:33.789500 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:39:33.791286 [info ] [Thread-4  ]: 3 of 8 START test not_null_stg_meteo__manila_temp_max_c ........................ [RUN]
[0m15:39:33.792823 [debug] [Thread-1  ]: Began running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:39:33.793957 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:39:33.795350 [info ] [Thread-2  ]: 4 of 8 START test not_null_stg_meteo__manila_temp_min_c ........................ [RUN]
[0m15:39:33.796959 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339'
[0m15:39:33.798419 [info ] [Thread-1  ]: 5 of 8 START test unique_stg_meteo__manila_dte ................................. [RUN]
[0m15:39:33.866121 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9'
[0m15:39:33.896456 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:39:33.902097 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m15:39:33.903799 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_meteo__manila, now test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc)
[0m15:39:33.905312 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:39:33.971364 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m15:39:33.974098 [debug] [Thread-1  ]: Began compiling node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:39:33.976032 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:39:33.991420 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m15:39:34.065033 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:39:34.085363 [debug] [Thread-1  ]: Writing injected SQL for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m15:39:34.108315 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:39:34.271979 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m15:39:34.283930 [debug] [Thread-1  ]: Began executing node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:39:34.295963 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m15:39:34.305489 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m15:39:34.365725 [debug] [Thread-1  ]: Writing runtime sql for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m15:39:34.368207 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m15:39:34.424128 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m15:39:34.425340 [debug] [Thread-1  ]: dbt_clickhouse adapter: On test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    dte as unique_field,
    count(*) as n_records

from `clean`.`stg_meteo__manila`
where dte is not null
group by dte
having count(*) > 1



    ) dbt_internal_test...
[0m15:39:34.426590 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m15:39:34.484397 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select dte
from `clean`.`stg_meteo__manila`
where dte is null



    ) dbt_internal_test...
[0m15:39:34.491802 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m15:39:34.571818 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m15:39:34.581107 [info ] [Thread-1  ]: 5 of 8 PASS unique_stg_meteo__manila_dte ....................................... [[32mPASS[0m in 0.68s]
[0m15:39:34.586973 [info ] [Thread-3  ]: 2 of 8 PASS not_null_stg_meteo__manila_dte ..................................... [[32mPASS[0m in 0.80s]
[0m15:39:34.599292 [debug] [Thread-1  ]: Finished running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:39:34.660160 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:39:34.684662 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_min_c
from `clean`.`stg_meteo__manila`
where temp_min_c is null



    ) dbt_internal_test...
[0m15:39:34.693079 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:39:34.697968 [info ] [Thread-2  ]: 4 of 8 PASS not_null_stg_meteo__manila_temp_min_c .............................. [[32mPASS[0m in 0.83s]
[0m15:39:34.700066 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:39:34.712189 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_max_c
from `clean`.`stg_meteo__manila`
where temp_max_c is null



    ) dbt_internal_test...
[0m15:39:34.718881 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:39:34.722845 [info ] [Thread-4  ]: 3 of 8 PASS not_null_stg_meteo__manila_temp_max_c .............................. [[32mPASS[0m in 0.93s]
[0m15:39:34.724634 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:39:34.726976 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:39:34.727874 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:39:34.728981 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_meteo__manila_weather
[0m15:39:34.730643 [info ] [Thread-1  ]: 6 of 8 START sql table model `mart`.`mart_meteo__manila_daily` ................. [RUN]
[0m15:39:34.732336 [info ] [Thread-3  ]: 7 of 8 START sql table model `mart`.`mart_meteo__manila_monthly` ............... [RUN]
[0m15:39:34.762179 [info ] [Thread-2  ]: 8 of 8 START sql view model `mart`.`vw_meteo__manila_weather` .................. [RUN]
[0m15:39:34.764202 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc, now model.ex_03_meteo.mart_meteo__manila_daily)
[0m15:39:34.765870 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f, now model.ex_03_meteo.mart_meteo__manila_monthly)
[0m15:39:34.767401 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9, now model.ex_03_meteo.vw_meteo__manila_weather)
[0m15:39:34.769267 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:39:34.771640 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:39:34.773338 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_meteo__manila_weather
[0m15:39:34.790099 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m15:39:34.860270 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m15:39:34.877309 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_meteo__manila_weather"
[0m15:39:34.879876 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:39:34.892592 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:39:34.899490 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_meteo__manila_weather
[0m15:39:35.005508 [debug] [Thread-2  ]: Creating new relation vw_meteo__manila_weather
[0m15:39:35.085595 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_meteo__manila_weather"
[0m15:39:35.204452 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_meteo__manila_weather: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_meteo__manila_weather"} */


  create view `mart`.`vw_meteo__manila_weather` 
  
    
    
  as (
    

with daily as (
  select
    dte,
    temp_min_c,
    temp_max_c,
    (temp_min_c + temp_max_c)/2.0 as temp_avg_c,
    precip_mm,
    weather_code
  from `clean`.`stg_meteo__manila`
),
codes as (
  select
    toInt32(weather_code)                as weather_code,
    cast(night_description as String)    as condition
  from `raw`.`meteo___wmo_codes`
)

select
  d.dte,
  d.temp_min_c,
  d.temp_max_c,
  d.temp_avg_c,
  d.precip_mm,
  d.weather_code,
  c.condition
from daily d
left join codes c
  on c.weather_code = d.weather_code
order by d.dte
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m15:39:35.382418 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m15:39:35.468202 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7089972f96d0>]}
[0m15:39:35.475761 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

            

    
        create table `mart`.`mart_meteo__manila_monthly__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (month)
        
        partition by (toYYYYMM(month))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(dte)                            as dte_nn,   -- 👈 non-nullable
    toFloat64(temp_min_c)                         as temp_min_c,
    toFloat64(temp_max_c)                         as temp_max_c,
    (toFloat64(temp_min_c) + toFloat64(temp_max_c))/2.0 as temp_avg_c,
    toFloat64(precip_mm)                          as precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte_nn)                as month,             -- 👈 computed from non-null date
  avg(temp_min_c)                       as avg_min_c,
  avg(temp_max_c)                       as avg_max_c,
  avg(temp_avg_c)                       as avg_temp_c,
  sum(precip_mm)                        as total_precip_mm,
  countIf(precip_mm > 0)                as rainy_days
from base
group by month
order by month
          )
        
        ...
[0m15:39:35.480170 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

            

    
        create table `mart`.`mart_meteo__manila_daily__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (dte)
        
        partition by (toYYYYMM(dte))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Force non-nullable key for MergeTree
select
  assumeNotNull(dte)                         as dte,          -- 👈 non-nullable
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0              as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
          )
        
        ...
[0m15:39:35.481895 [info ] [Thread-2  ]: 8 of 8 OK created sql view model `mart`.`vw_meteo__manila_weather` ............. [[32mOK[0m in 0.70s]
[0m15:39:35.485960 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_meteo__manila_weather
[0m15:39:35.502959 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m15:39:35.519786 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m15:39:35.521120 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

    select name, type from system.columns where table = 'mart_meteo__manila_daily__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m15:39:35.562202 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

    select name, type from system.columns where table = 'mart_meteo__manila_monthly__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m15:39:35.567363 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:35.568793 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:35.575027 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m15:39:35.577663 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m15:39:35.579091 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

  
    
    
    
        
         


        insert into `mart`.`mart_meteo__manila_monthly__dbt_backup`
        ("month", "avg_min_c", "avg_max_c", "avg_temp_c", "total_precip_mm", "rainy_days")

with base as (
  select
    assumeNotNull(dte)                            as dte_nn,   -- 👈 non-nullable
    toFloat64(temp_min_c)                         as temp_min_c,
    toFloat64(temp_max_c)                         as temp_max_c,
    (toFloat64(temp_min_c) + toFloat64(temp_max_c))/2.0 as temp_avg_c,
    toFloat64(precip_mm)                          as precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte_nn)                as month,             -- 👈 computed from non-null date
  avg(temp_min_c)                       as avg_min_c,
  avg(temp_max_c)                       as avg_max_c,
  avg(temp_avg_c)                       as avg_temp_c,
  sum(precip_mm)                        as total_precip_mm,
  countIf(precip_mm > 0)                as rainy_days
from base
group by month
order by month
  ...
[0m15:39:35.580139 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

  
    
    
    
        
         


        insert into `mart`.`mart_meteo__manila_daily__dbt_backup`
        ("dte", "temp_min_c", "temp_max_c", "temp_avg_c", "precip_mm", "weather_code")

-- Force non-nullable key for MergeTree
select
  assumeNotNull(dte)                         as dte,          -- 👈 non-nullable
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0              as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
  ...
[0m15:39:35.595675 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:39:35.604694 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */
EXCHANGE TABLES `mart`.`mart_meteo__manila_daily__dbt_backup` AND `mart`.`mart_meteo__manila_daily` 
  
  ...
[0m15:39:35.608105 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:35.615219 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

    drop table if exists `mart`.`mart_meteo__manila_daily__dbt_backup` 
  ...
[0m15:39:35.618739 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:35.621474 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7089985c7d30>]}
[0m15:39:35.660564 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m15:39:35.661438 [info ] [Thread-1  ]: 6 of 8 OK created sql table model `mart`.`mart_meteo__manila_daily` ............ [[32mOK[0m in 0.86s]
[0m15:39:35.663792 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */
EXCHANGE TABLES `mart`.`mart_meteo__manila_monthly__dbt_backup` AND `mart`.`mart_meteo__manila_monthly` 
  
  ...
[0m15:39:35.665180 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:39:35.668356 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:35.675162 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

    drop table if exists `mart`.`mart_meteo__manila_monthly__dbt_backup` 
  ...
[0m15:39:35.678322 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:35.681187 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7089972e7cd0>]}
[0m15:39:35.682949 [info ] [Thread-3  ]: 7 of 8 OK created sql table model `mart`.`mart_meteo__manila_monthly` .......... [[32mOK[0m in 0.92s]
[0m15:39:35.684565 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:39:35.686614 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:39:35.687168 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_daily' was left open.
[0m15:39:35.687761 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_daily: Close
[0m15:39:35.688240 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m15:39:35.688774 [debug] [MainThread]: On list__clean: Close
[0m15:39:35.689292 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_monthly' was left open.
[0m15:39:35.689808 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_monthly: Close
[0m15:39:35.690328 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339' was left open.
[0m15:39:35.690895 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339: Close
[0m15:39:35.691395 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_meteo__manila_weather' was left open.
[0m15:39:35.691985 [debug] [MainThread]: On model.ex_03_meteo.vw_meteo__manila_weather: Close
[0m15:39:35.693132 [info ] [MainThread]: 
[0m15:39:35.693854 [info ] [MainThread]: Finished running 2 view models, 4 data tests, 2 table models in 0 hours 0 minutes and 3.32 seconds (3.32s).
[0m15:39:35.698175 [debug] [MainThread]: Command end result
[0m15:39:35.804969 [info ] [MainThread]: 
[0m15:39:35.805916 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:39:35.806569 [info ] [MainThread]: 
[0m15:39:35.807288 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
[0m15:39:35.859996 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.754122, "process_in_blocks": "0", "process_kernel_time": 0.677149, "process_mem_max_rss": "115812", "process_out_blocks": "10752", "process_user_time": 5.994761}
[0m15:39:35.860933 [debug] [MainThread]: Command `dbt build` succeeded at 15:39:35.860735 after 6.76 seconds
[0m15:39:35.861599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70899b86d310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708997cb5790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708997655c40>]}
[0m15:39:35.862189 [debug] [MainThread]: Flushing usage events
[0m16:22:12.446886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d7ce9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d494ca90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d494c940>]}


============================== 16:22:12.456134 | bdcd5668-b02c-477e-935e-bcac2aaca4d0 ==============================
[0m16:22:12.456134 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:22:12.457243 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'warn_error': 'None', 'debug': 'False', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'use_colors': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'introspect': 'True', 'indirect_selection': 'eager', 'log_path': '/workdir/transforms/04_btc/logs', 'cache_selected_only': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'static_parser': 'True', 'log_format': 'default', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'fail_fast': 'False', 'target_path': 'None', 'printer_width': '80', 'log_cache_events': 'False'}
[0m16:22:13.047463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bdcd5668-b02c-477e-935e-bcac2aaca4d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d4864a30>]}
[0m16:22:13.244015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bdcd5668-b02c-477e-935e-bcac2aaca4d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d4d86250>]}
[0m16:22:13.245335 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:22:13.667692 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:22:14.185189 [debug] [MainThread]: Partial parsing enabled: 5 files deleted, 5 files added, 1 files changed.
[0m16:22:14.186255 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/clean/stg_btc__market_price.sql
[0m16:22:14.186927 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/mart/mart_btc__market_price_intraday.sql
[0m16:22:14.187493 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/mart/vw_btc__latest_24h.sql
[0m16:22:14.188138 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/clean/btc_schema.yml
[0m16:22:14.239108 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/mart/mart_btc__daily_ohlc.sql
[0m16:22:14.240036 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/sources.yml
[0m16:22:14.240635 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/mart/vw_meteo__manila_weather.sql
[0m16:22:14.241127 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/clean/stg_meteo__manila.sql
[0m16:22:14.241612 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/mart/mart_meteo__manila_monthly.sql
[0m16:22:14.242090 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/mart/mart_meteo__manila_daily.sql
[0m16:22:14.968100 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m16:22:14.969095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'bdcd5668-b02c-477e-935e-bcac2aaca4d0', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d40f8c40>]}
[0m16:22:15.944859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bdcd5668-b02c-477e-935e-bcac2aaca4d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d37ad130>]}
[0m16:22:16.392697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bdcd5668-b02c-477e-935e-bcac2aaca4d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d4140640>]}
[0m16:22:16.393589 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:22:16.396822 [info ] [MainThread]: 
[0m16:22:16.397981 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:22:16.445735 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:22:16.457291 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:22:16.652550 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:22:16.649956 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:22:17.117679 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:22:17.123238 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:22:17.125422 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:22:17.153642 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:22:17.243474 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:22:17.244856 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:22:17.265852 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:22:17.268256 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:22:17.280487 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:22:17.282408 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:22:17.349336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bdcd5668-b02c-477e-935e-bcac2aaca4d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d3bb1340>]}
[0m16:22:17.351216 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:22:17.352489 [info ] [MainThread]: 
[0m16:22:17.371020 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:22:17.372147 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:22:17.373052 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__clean, now model.ex_03_meteo.stg_btc__market_price)
[0m16:22:17.373755 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:22:17.441438 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:22:17.443435 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:22:17.542771 [debug] [Thread-1  ]: Creating new relation stg_btc__market_price
[0m16:22:17.568799 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:22:17.570414 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price` 
  
    
    
  as (
    

select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,
  parseDateTimeBestEffortOrNull(last_updated)                                        as last_updated_utc,
  toTimeZone(parseDateTimeBestEffortOrNull(last_updated), 'Asia/Manila')             as last_updated_manila
from `raw`.`btc__market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:22:17.576103 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price` 
  
    
    
  as (
    

select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,
  parseDateTimeBestEffortOrNull(last_updated)                                        as last_updated_utc,
  toTimeZone(parseDateTimeBestEffortOrNull(last_updated), 'Asia/Manila')             as last_updated_manila
from `raw`.`btc__market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m16:22:17.579214 [debug] [Thread-1  ]: Database Error in model stg_btc__market_price (models/clean/stg_btc__market_price.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 60
   Code: 60. DB::Exception: Table raw.btc__market_price does not exist. Maybe you meant raw.btc___market_price?. (UNKNOWN_TABLE) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/clean/stg_btc__market_price.sql
[0m16:22:17.581635 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bdcd5668-b02c-477e-935e-bcac2aaca4d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d336c4c0>]}
[0m16:22:17.582708 [error] [Thread-1  ]: 1 of 7 ERROR creating sql view model `clean`.`stg_btc__market_price` ........... [[31mERROR[0m in 0.21s]
[0m16:22:17.584064 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:22:17.586047 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:22:17.587084 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:22:17.588442 [info ] [Thread-3  ]: 2 of 7 SKIP test not_null_stg_btc__market_price_coin_id ........................ [[33mSKIP[0m]
[0m16:22:17.589815 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:22:17.640340 [info ] [Thread-4  ]: 3 of 7 SKIP test not_null_stg_btc__market_price_last_updated_utc ............... [[33mSKIP[0m]
[0m16:22:17.642605 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:22:17.644609 [info ] [Thread-2  ]: 4 of 7 SKIP test not_null_stg_btc__market_price_price_usd ...................... [[33mSKIP[0m]
[0m16:22:17.646977 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:22:17.649616 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:22:17.653071 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:22:17.654663 [info ] [Thread-1  ]: 5 of 7 SKIP relation mart.mart_btc__daily_ohlc ................................. [[33mSKIP[0m]
[0m16:22:17.656356 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:22:17.658144 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:22:17.659811 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:22:17.661652 [info ] [Thread-3  ]: 6 of 7 SKIP relation mart.mart_btc__market_price_intraday ...................... [[33mSKIP[0m]
[0m16:22:17.663647 [info ] [Thread-4  ]: 7 of 7 SKIP relation mart.vw_btc__latest_24h ................................... [[33mSKIP[0m]
[0m16:22:17.666109 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:22:17.668135 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:22:17.672377 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:22:17.673570 [debug] [MainThread]: Connection 'model.ex_03_meteo.stg_btc__market_price' was left open.
[0m16:22:17.674747 [debug] [MainThread]: On model.ex_03_meteo.stg_btc__market_price: Close
[0m16:22:17.675844 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m16:22:17.676962 [debug] [MainThread]: On list__mart: Close
[0m16:22:17.678885 [info ] [MainThread]: 
[0m16:22:17.680427 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 table models in 0 hours 0 minutes and 1.28 seconds (1.28s).
[0m16:22:17.684652 [debug] [MainThread]: Command end result
[0m16:22:17.948695 [info ] [MainThread]: 
[0m16:22:17.950408 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:22:17.951682 [info ] [MainThread]: 
[0m16:22:17.953572 [error] [MainThread]:   Database Error in model stg_btc__market_price (models/clean/stg_btc__market_price.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 60
   Code: 60. DB::Exception: Table raw.btc__market_price does not exist. Maybe you meant raw.btc___market_price?. (UNKNOWN_TABLE) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/clean/stg_btc__market_price.sql
[0m16:22:17.955109 [info ] [MainThread]: 
[0m16:22:17.956651 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=6 TOTAL=7
[0m16:22:17.959388 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 5.7099857, "process_in_blocks": "8", "process_kernel_time": 0.60013, "process_mem_max_rss": "116472", "process_out_blocks": "10568", "process_user_time": 5.672333}
[0m16:22:17.961009 [debug] [MainThread]: Command `dbt build` failed at 16:22:17.960581 after 5.71 seconds
[0m16:22:17.962444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d7ce9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d35211c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d3514a30>]}
[0m16:22:17.963781 [debug] [MainThread]: Flushing usage events
[0m16:24:03.281045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a7e58310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a4abdaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a4abd9a0>]}


============================== 16:24:03.290278 | c25140db-cadc-4bc3-a5dc-f65d5ccc1779 ==============================
[0m16:24:03.290278 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:24:03.291423 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'profiles_dir': '.', 'static_parser': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'quiet': 'False', 'warn_error': 'None', 'printer_width': '80', 'use_colors': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'debug': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'write_json': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False', 'version_check': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m16:24:03.817981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c25140db-cadc-4bc3-a5dc-f65d5ccc1779', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a73fefd0>]}
[0m16:24:04.011107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c25140db-cadc-4bc3-a5dc-f65d5ccc1779', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a4a87be0>]}
[0m16:24:04.012403 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:24:04.424172 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:24:04.929371 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:24:04.980528 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/sources.yml
[0m16:24:05.783841 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m16:24:05.784876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'c25140db-cadc-4bc3-a5dc-f65d5ccc1779', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a4258d90>]}
[0m16:24:06.412478 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.ex_03_meteo.stg_btc__market_price' (models/clean/stg_btc__market_price.sql) depends on a source named 'raw.btc__market_price' which was not found
[0m16:24:06.414194 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 3.3313663, "process_in_blocks": "0", "process_kernel_time": 0.570179, "process_mem_max_rss": "104232", "process_out_blocks": "6616", "process_user_time": 4.62776}
[0m16:24:06.414995 [debug] [MainThread]: Command `dbt build` failed at 16:24:06.414787 after 3.33 seconds
[0m16:24:06.415666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a7e58310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a4752b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a3c8a310>]}
[0m16:24:06.416282 [debug] [MainThread]: Flushing usage events
[0m16:24:30.195523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc29a1ac310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc296e11b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc296e11a00>]}


============================== 16:24:30.256621 | acede589-de07-4ae3-a9cb-9a7cba32a6f4 ==============================
[0m16:24:30.256621 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:24:30.257742 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_format': 'default', 'use_colors': 'True', 'static_parser': 'True', 'quiet': 'False', 'profiles_dir': '.', 'partial_parse': 'True', 'debug': 'False', 'empty': 'False', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True', 'fail_fast': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'printer_width': '80', 'introspect': 'True', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'cache_selected_only': 'False'}
[0m16:24:30.847145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'acede589-de07-4ae3-a9cb-9a7cba32a6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc29974aca0>]}
[0m16:24:30.991702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'acede589-de07-4ae3-a9cb-9a7cba32a6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc296d0ddc0>]}
[0m16:24:30.993010 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:24:31.457368 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:24:31.971294 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m16:24:31.973065 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/sources.yml
[0m16:24:31.973716 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/clean/stg_btc__market_price.sql
[0m16:24:32.850674 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m16:24:32.851575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'acede589-de07-4ae3-a9cb-9a7cba32a6f4', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc296593d30>]}
[0m16:24:33.777584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'acede589-de07-4ae3-a9cb-9a7cba32a6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc295c8dee0>]}
[0m16:24:34.261017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'acede589-de07-4ae3-a9cb-9a7cba32a6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc295c76640>]}
[0m16:24:34.261951 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:24:34.265447 [info ] [MainThread]: 
[0m16:24:34.266641 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:24:34.278928 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:24:34.280017 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:24:34.480805 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:24:34.491481 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:24:35.314004 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:24:35.347994 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:24:35.350512 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:24:35.360904 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:24:35.457049 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:24:35.458692 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:24:35.479326 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:24:35.489442 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:24:35.548614 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:24:35.549678 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:24:35.567694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'acede589-de07-4ae3-a9cb-9a7cba32a6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc29725a070>]}
[0m16:24:35.569494 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:24:35.571023 [info ] [MainThread]: 
[0m16:24:35.650426 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:24:35.652046 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:24:35.653585 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m16:24:35.654647 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:24:35.675335 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:24:35.676644 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:24:35.773788 [debug] [Thread-1  ]: Creating new relation stg_btc__market_price
[0m16:24:35.796798 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m16:24:35.909603 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:24:35.910950 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price` 
  
    
    
  as (
    

select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,
  parseDateTimeBestEffortOrNull(last_updated)                                        as last_updated_utc,
  toTimeZone(parseDateTimeBestEffortOrNull(last_updated), 'Asia/Manila')             as last_updated_manila
from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:24:35.917388 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price` 
  
    
    
  as (
    

select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,
  parseDateTimeBestEffortOrNull(last_updated)                                        as last_updated_utc,
  toTimeZone(parseDateTimeBestEffortOrNull(last_updated), 'Asia/Manila')             as last_updated_manila
from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m16:24:35.920785 [debug] [Thread-1  ]: Database Error in model stg_btc__market_price (models/clean/stg_btc__market_price.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 43
   Code: 43. DB::Exception: Illegal type DateTime64(6, 'UTC') of first argument of function parseDateTimeBestEffortOrNull. Conversion functions with postfix 'OrZero' or 'OrNull' should take String argument: While processing CAST(id, 'String') AS coin_id, CAST(symbol, 'String') AS symbol, CAST(name, 'String') AS name, CAST(image, 'String') AS image_url, toFloat64(current_price) AS price_usd, toFloat64(market_cap) AS market_cap_usd, toInt32(market_cap_rank) AS market_cap_rank, toFloat64(total_volume) AS total_volume_usd, toFloat64(high_24h) AS high_24h_usd, toFloat64(low_24h) AS low_24h_usd, toFloat64(price_change_24h) AS price_change_24h_usd, toFloat64(price_change_percentage_24h) AS price_change_pct_24h, parseDateTimeBestEffortOrNull(last_updated) AS last_updated_utc, toTimeZone(parseDateTimeBestEffortOrNull(last_updated), 'Asia/Manila') AS last_updated_manila. (ILLEGAL_TYPE_OF_ARGUMENT) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/clean/stg_btc__market_price.sql
[0m16:24:35.923397 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acede589-de07-4ae3-a9cb-9a7cba32a6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc295f4b700>]}
[0m16:24:35.924802 [error] [Thread-1  ]: 1 of 7 ERROR creating sql view model `clean`.`stg_btc__market_price` ........... [[31mERROR[0m in 0.27s]
[0m16:24:35.926192 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:24:35.928447 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:24:35.929606 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:24:35.930988 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:24:35.932983 [info ] [Thread-3  ]: 2 of 7 SKIP test not_null_stg_btc__market_price_coin_id ........................ [[33mSKIP[0m]
[0m16:24:35.935017 [info ] [Thread-4  ]: 3 of 7 SKIP test not_null_stg_btc__market_price_last_updated_utc ............... [[33mSKIP[0m]
[0m16:24:35.937160 [info ] [Thread-2  ]: 4 of 7 SKIP test not_null_stg_btc__market_price_price_usd ...................... [[33mSKIP[0m]
[0m16:24:35.939355 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:24:35.947180 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:24:35.949163 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:24:35.952736 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:24:35.954224 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:24:35.956024 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:24:35.957694 [info ] [Thread-1  ]: 5 of 7 SKIP relation mart.mart_btc__daily_ohlc ................................. [[33mSKIP[0m]
[0m16:24:35.959478 [info ] [Thread-3  ]: 6 of 7 SKIP relation mart.mart_btc__market_price_intraday ...................... [[33mSKIP[0m]
[0m16:24:35.961602 [info ] [Thread-4  ]: 7 of 7 SKIP relation mart.vw_btc__latest_24h ................................... [[33mSKIP[0m]
[0m16:24:35.963664 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:24:35.965727 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:24:35.967451 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:24:35.970268 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:24:35.971033 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m16:24:35.971742 [debug] [MainThread]: On list__mart: Close
[0m16:24:35.972375 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m16:24:35.973046 [debug] [MainThread]: On list__clean: Close
[0m16:24:35.973729 [debug] [MainThread]: Connection 'model.ex_03_meteo.stg_btc__market_price' was left open.
[0m16:24:35.974374 [debug] [MainThread]: On model.ex_03_meteo.stg_btc__market_price: Close
[0m16:24:35.975597 [info ] [MainThread]: 
[0m16:24:35.976472 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 table models in 0 hours 0 minutes and 1.71 seconds (1.71s).
[0m16:24:35.978921 [debug] [MainThread]: Command end result
[0m16:24:36.148412 [info ] [MainThread]: 
[0m16:24:36.149389 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:24:36.150057 [info ] [MainThread]: 
[0m16:24:36.150998 [error] [MainThread]:   Database Error in model stg_btc__market_price (models/clean/stg_btc__market_price.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 43
   Code: 43. DB::Exception: Illegal type DateTime64(6, 'UTC') of first argument of function parseDateTimeBestEffortOrNull. Conversion functions with postfix 'OrZero' or 'OrNull' should take String argument: While processing CAST(id, 'String') AS coin_id, CAST(symbol, 'String') AS symbol, CAST(name, 'String') AS name, CAST(image, 'String') AS image_url, toFloat64(current_price) AS price_usd, toFloat64(market_cap) AS market_cap_usd, toInt32(market_cap_rank) AS market_cap_rank, toFloat64(total_volume) AS total_volume_usd, toFloat64(high_24h) AS high_24h_usd, toFloat64(low_24h) AS low_24h_usd, toFloat64(price_change_24h) AS price_change_24h_usd, toFloat64(price_change_percentage_24h) AS price_change_pct_24h, parseDateTimeBestEffortOrNull(last_updated) AS last_updated_utc, toTimeZone(parseDateTimeBestEffortOrNull(last_updated), 'Asia/Manila') AS last_updated_manila. (ILLEGAL_TYPE_OF_ARGUMENT) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/clean/stg_btc__market_price.sql
[0m16:24:36.151789 [info ] [MainThread]: 
[0m16:24:36.152491 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=6 TOTAL=7
[0m16:24:36.153896 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 6.164327, "process_in_blocks": "0", "process_kernel_time": 0.660405, "process_mem_max_rss": "116624", "process_out_blocks": "10576", "process_user_time": 5.83358}
[0m16:24:36.154686 [debug] [MainThread]: Command `dbt build` failed at 16:24:36.154464 after 6.17 seconds
[0m16:24:36.155317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc29a1ac310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc295b35040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc29974aca0>]}
[0m16:24:36.155979 [debug] [MainThread]: Flushing usage events
[0m16:26:34.626480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed16394310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed12ff6af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed12ff69a0>]}


============================== 16:26:34.635773 | be8a199c-2502-4e48-92e8-e36124022031 ==============================
[0m16:26:34.635773 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:26:34.636840 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'debug': 'False', 'target_path': 'None', 'version_check': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'write_json': 'True', 'static_parser': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'log_format': 'default', 'use_experimental_parser': 'False', 'empty': 'False', 'no_print': 'None', 'profiles_dir': '.', 'indirect_selection': 'eager', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'printer_width': '80', 'fail_fast': 'False', 'use_colors': 'True'}
[0m16:26:35.220946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed12fb8d90>]}
[0m16:26:35.415707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed130dbbe0>]}
[0m16:26:35.416958 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:26:35.833034 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:26:36.341470 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:26:36.342485 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/clean/stg_btc__market_price.sql
[0m16:26:37.113133 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m16:26:37.114018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed12793370>]}
[0m16:26:37.793359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed11fc5130>]}
[0m16:26:38.237985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed11fd3eb0>]}
[0m16:26:38.238848 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:26:38.242085 [info ] [MainThread]: 
[0m16:26:38.243156 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:26:38.293747 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:26:38.256682 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:26:38.329793 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:26:38.340014 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:26:39.101080 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:26:39.103959 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:26:39.107403 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:26:39.108816 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:26:39.136108 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:26:39.137452 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:26:39.208126 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:26:39.216726 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:26:39.226511 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:26:39.231163 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:26:39.294135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed157b3940>]}
[0m16:26:39.296091 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:26:39.297414 [info ] [MainThread]: 
[0m16:26:39.325663 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:26:39.326778 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:26:39.327669 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__clean, now model.ex_03_meteo.stg_btc__market_price)
[0m16:26:39.328368 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:26:39.398028 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:26:39.399732 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:26:39.497035 [debug] [Thread-1  ]: Creating new relation stg_btc__market_price
[0m16:26:39.526652 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:26:39.528468 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:26:39.566859 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m16:26:39.623177 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed15936820>]}
[0m16:26:39.624542 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.29s]
[0m16:26:39.625934 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:26:39.627845 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:26:39.628637 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:26:39.629503 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:26:39.630710 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m16:26:39.631806 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m16:26:39.632987 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m16:26:39.634744 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m16:26:39.636047 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m16:26:39.637892 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list__mart, now test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6)
[0m16:26:39.639689 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:26:39.641521 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:26:39.693859 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:26:39.822970 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:26:39.827818 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:26:39.830378 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:26:39.831835 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:26:39.837844 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:26:39.893234 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:26:39.913106 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:26:39.918256 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:26:39.923046 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:26:39.924680 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m16:26:39.925410 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m16:26:39.926262 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m16:26:39.993961 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:26:40.004817 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.37s]
[0m16:26:40.009231 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:26:40.062191 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m16:26:40.067836 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m16:26:40.071119 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:26:40.074170 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.44s]
[0m16:26:40.075728 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:26:40.077224 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:26:40.095886 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.46s]
[0m16:26:40.097308 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:26:40.098787 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:26:40.099492 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:26:40.100331 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:26:40.101360 [info ] [Thread-1  ]: 5 of 7 START sql table model `mart`.`mart_btc__daily_ohlc` ..................... [RUN]
[0m16:26:40.102423 [info ] [Thread-2  ]: 6 of 7 START sql table model `mart`.`mart_btc__market_price_intraday` .......... [RUN]
[0m16:26:40.103539 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m16:26:40.104468 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m16:26:40.105273 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_intraday)
[0m16:26:40.105999 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m16:26:40.106725 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:26:40.107476 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:26:40.108236 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m16:26:40.115464 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:26:40.122321 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_intraday"
[0m16:26:40.129229 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:26:40.130702 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:26:40.131385 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:26:40.132137 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m16:26:40.240361 [debug] [Thread-2  ]: Creating new relation mart_btc__market_price_intraday
[0m16:26:40.302796 [debug] [Thread-4  ]: Creating new relation vw_btc__latest_24h
[0m16:26:40.314837 [debug] [Thread-1  ]: Creating new relation mart_btc__daily_ohlc
[0m16:26:40.333845 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:26:40.508434 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_intraday: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_intraday"} */

            

    
        create table `mart`.`mart_btc__market_price_intraday`
        
  
        
  engine = MergeTree()
        order by (last_updated_utc)
        
        partition by (toYYYYMM(last_updated_utc))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

select
  assumeNotNull(last_updated_utc) as last_updated_utc,   -- non-null for CH MergeTree keys
  last_updated_manila,
  coin_id,
  symbol,
  name,
  image_url,
  price_usd,
  market_cap_usd,
  market_cap_rank,
  total_volume_usd,
  high_24h_usd,
  low_24h_usd,
  price_change_24h_usd,
  price_change_pct_24h
from `clean`.`stg_btc__market_price`
          )
        
        ...
[0m16:26:40.512103 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    coin_id,
    assumeNotNull(toDate(toTimeZone(last_updated_utc, 'Asia/Manila'))) as day_local,
    last_updated_utc,
    toFloat64(price_usd) as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null
)
select
  day_local,
  coin_id,
  min(price_usd)                              as low_usd,
  max(price_usd)                              as high_usd,
  argMin(price_usd, last_updated_utc)         as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc)         as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m16:26:40.513049 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h` 
  
    
    
  as (
    

with max_ts as (
  select max(last_updated_utc) as ts_max
  from `clean`.`stg_btc__market_price`
)
select
  s.*
from `clean`.`stg_btc__market_price` s
join max_ts m
  on s.last_updated_utc >= m.ts_max - INTERVAL 24 HOUR
order by s.last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:26:40.518478 [debug] [Thread-4  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h` 
  
    
    
  as (
    

with max_ts as (
  select max(last_updated_utc) as ts_max
  from `clean`.`stg_btc__market_price`
)
select
  s.*
from `clean`.`stg_btc__market_price` s
join max_ts m
  on s.last_updated_utc >= m.ts_max - INTERVAL 24 HOUR
order by s.last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m16:26:40.522281 [debug] [Thread-4  ]: Database Error in model vw_btc__latest_24h (models/mart/vw_btc__latest_24h.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 403
   Code: 403. DB::Exception: Unsupported JOIN ON conditions. Unexpected 'last_updated_utc >= (ts_max - toIntervalHour(24))': While processing last_updated_utc >= (ts_max - toIntervalHour(24)). (INVALID_JOIN_ON_EXPRESSION) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/mart/vw_btc__latest_24h.sql
[0m16:26:40.523176 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed10de4c70>]}
[0m16:26:40.524363 [error] [Thread-4  ]: 7 of 7 ERROR creating sql view model `mart`.`vw_btc__latest_24h` ............... [[31mERROR[0m in 0.42s]
[0m16:26:40.526070 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:26:40.540834 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:26:40.594341 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m16:26:40.595959 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_intraday: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_intraday"} */

    select name, type from system.columns where table = 'mart_btc__market_price_intraday'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:26:40.602546 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:26:40.610585 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:26:40.617926 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:26:40.621725 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_intraday"
[0m16:26:40.626152 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:26:40.628051 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_intraday: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_intraday"} */

  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_intraday`
        ("last_updated_utc", "last_updated_manila", "coin_id", "symbol", "name", "image_url", "price_usd", "market_cap_usd", "market_cap_rank", "total_volume_usd", "high_24h_usd", "low_24h_usd", "price_change_24h_usd", "price_change_pct_24h")

select
  assumeNotNull(last_updated_utc) as last_updated_utc,   -- non-null for CH MergeTree keys
  last_updated_manila,
  coin_id,
  symbol,
  name,
  image_url,
  price_usd,
  market_cap_usd,
  market_cap_rank,
  total_volume_usd,
  high_24h_usd,
  low_24h_usd,
  price_change_24h_usd,
  price_change_pct_24h
from `clean`.`stg_btc__market_price`
  ...
[0m16:26:40.631352 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    coin_id,
    assumeNotNull(toDate(toTimeZone(last_updated_utc, 'Asia/Manila'))) as day_local,
    last_updated_utc,
    toFloat64(price_usd) as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null
)
select
  day_local,
  coin_id,
  min(price_usd)                              as low_usd,
  max(price_usd)                              as high_usd,
  argMin(price_usd, last_updated_utc)         as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc)         as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  ...
[0m16:26:40.643619 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:26:40.648851 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed10dc7c70>]}
[0m16:26:40.694423 [info ] [Thread-2  ]: 6 of 7 OK created sql table model `mart`.`mart_btc__market_price_intraday` ..... [[32mOK[0m in 0.54s]
[0m16:26:40.696363 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:26:40.699576 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:26:40.704773 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed11a71700>]}
[0m16:26:40.706760 [info ] [Thread-1  ]: 5 of 7 OK created sql table model `mart`.`mart_btc__daily_ohlc` ................ [[32mOK[0m in 0.60s]
[0m16:26:40.708543 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:26:40.710900 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:26:40.711517 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m16:26:40.712130 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m16:26:40.712691 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_intraday' was left open.
[0m16:26:40.713287 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_intraday: Close
[0m16:26:40.713820 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m16:26:40.714437 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m16:26:40.714986 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m16:26:40.715493 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m16:26:40.717543 [info ] [MainThread]: 
[0m16:26:40.719060 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 table models in 0 hours 0 minutes and 2.47 seconds (2.47s).
[0m16:26:40.727006 [debug] [MainThread]: Command end result
[0m16:26:40.939378 [info ] [MainThread]: 
[0m16:26:40.940607 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:26:40.941515 [info ] [MainThread]: 
[0m16:26:40.993181 [error] [MainThread]:   Database Error in model vw_btc__latest_24h (models/mart/vw_btc__latest_24h.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 403
   Code: 403. DB::Exception: Unsupported JOIN ON conditions. Unexpected 'last_updated_utc >= (ts_max - toIntervalHour(24))': While processing last_updated_utc >= (ts_max - toIntervalHour(24)). (INVALID_JOIN_ON_EXPRESSION) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/mart/vw_btc__latest_24h.sql
[0m16:26:40.994936 [info ] [MainThread]: 
[0m16:26:40.996453 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m16:26:40.999215 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 6.5647326, "process_in_blocks": "0", "process_kernel_time": 0.679949, "process_mem_max_rss": "116776", "process_out_blocks": "10712", "process_user_time": 5.993113}
[0m16:26:41.000864 [debug] [MainThread]: Command `dbt build` failed at 16:26:41.000408 after 6.57 seconds
[0m16:26:41.002574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed16394310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed142ba760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed12e5be80>]}
[0m16:26:41.004008 [debug] [MainThread]: Flushing usage events
[0m16:27:48.475918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2526b5b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e25237bdac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e25237bd970>]}


============================== 16:27:48.485476 | 7cf0df94-cc1c-41ba-bac0-5e25d368109b ==============================
[0m16:27:48.485476 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:27:48.486750 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'write_json': 'True', 'no_print': 'None', 'empty': 'False', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'warn_error': 'None', 'indirect_selection': 'eager', 'use_colors': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_format': 'default', 'profiles_dir': '.', 'target_path': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'fail_fast': 'False', 'log_cache_events': 'False'}
[0m16:27:49.070508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2523783040>]}
[0m16:27:49.267044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2523783190>]}
[0m16:27:49.268311 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:27:49.692699 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:27:50.259496 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:27:50.260590 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/mart/vw_btc__latest_24h.sql
[0m16:27:51.171678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2522a9ae50>]}
[0m16:27:51.654911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2522b00250>]}
[0m16:27:51.655852 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:27:51.659083 [info ] [MainThread]: 
[0m16:27:51.660081 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:27:51.673373 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:27:51.685025 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:27:51.752774 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:27:51.755665 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:27:52.258572 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:27:52.260641 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:27:52.267406 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:52.269520 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:52.556753 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:27:52.557878 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:27:52.573319 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:27:52.575526 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:27:52.583852 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:52.585869 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:52.650306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2522545670>]}
[0m16:27:52.652351 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:27:52.653701 [info ] [MainThread]: 
[0m16:27:52.681379 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:27:52.682996 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:27:52.684459 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m16:27:52.685518 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:27:52.761781 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:27:52.763500 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:27:52.891926 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m16:27:53.002286 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:27:53.003651 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:27:53.015529 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:53.030347 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:27:53.033559 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:27:53.035517 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:27:53.038338 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:27:53.047125 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m16:27:53.050203 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:27:53.052036 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m16:27:53.054879 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:27:53.149916 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m16:27:53.153448 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:27:53.159365 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2522750c70>]}
[0m16:27:53.160496 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.47s]
[0m16:27:53.161918 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:27:53.164155 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:27:53.165080 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:27:53.166172 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m16:27:53.167611 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:27:53.169634 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m16:27:53.171871 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m16:27:53.173725 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m16:27:53.175357 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m16:27:53.176590 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:27:53.178614 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m16:27:53.179983 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:27:53.191708 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:27:53.372093 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:27:53.377801 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:27:53.385318 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:27:53.387354 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:27:53.389642 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:27:53.460028 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:27:53.785293 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:27:53.779589 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:27:53.784852 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:27:53.789969 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m16:27:53.844525 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m16:27:53.846459 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m16:27:54.092185 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m16:27:54.111160 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m16:27:54.112943 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:27:54.156894 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m16:27:54.160688 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.98s]
[0m16:27:54.162360 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m16:27:54.165134 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:27:54.169413 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.99s]
[0m16:27:54.171613 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:27:54.174262 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:54.180431 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.01s]
[0m16:27:54.183174 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:27:54.185746 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:27:54.186918 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:27:54.188529 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:27:54.190131 [info ] [Thread-1  ]: 5 of 7 START sql table model `mart`.`mart_btc__daily_ohlc` ..................... [RUN]
[0m16:27:54.191835 [info ] [Thread-2  ]: 6 of 7 START sql table model `mart`.`mart_btc__market_price_intraday` .......... [RUN]
[0m16:27:54.245468 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m16:27:54.247404 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m16:27:54.248745 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_intraday)
[0m16:27:54.249845 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m16:27:54.251571 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:27:54.252945 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:27:54.254097 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m16:27:54.268382 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:27:54.278464 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_intraday"
[0m16:27:54.291458 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:27:54.293775 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:27:54.345278 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:27:54.368119 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m16:27:54.478717 [debug] [Thread-4  ]: Creating new relation vw_btc__latest_24h
[0m16:27:54.545962 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:27:54.676313 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h` 
  
    
    
  as (
    

WITH
  (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:27:54.777817 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m16:27:54.855946 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2521563d30>]}
[0m16:27:54.876051 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.61s]
[0m16:27:54.957805 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:27:54.983270 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_intraday: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_intraday"} */

            

    
        create table `mart`.`mart_btc__market_price_intraday__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (last_updated_utc)
        
        partition by (toYYYYMM(last_updated_utc))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

select
  assumeNotNull(last_updated_utc) as last_updated_utc,   -- non-null for CH MergeTree keys
  last_updated_manila,
  coin_id,
  symbol,
  name,
  image_url,
  price_usd,
  market_cap_usd,
  market_cap_rank,
  total_volume_usd,
  high_24h_usd,
  low_24h_usd,
  price_change_24h_usd,
  price_change_pct_24h
from `clean`.`stg_btc__market_price`
          )
        
        ...
[0m16:27:54.986061 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    coin_id,
    assumeNotNull(toDate(toTimeZone(last_updated_utc, 'Asia/Manila'))) as day_local,
    last_updated_utc,
    toFloat64(price_usd) as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null
)
select
  day_local,
  coin_id,
  min(price_usd)                              as low_usd,
  max(price_usd)                              as high_usd,
  argMin(price_usd, last_updated_utc)         as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc)         as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m16:27:55.045290 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:27:55.046557 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:27:55.157682 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_intraday: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_intraday"} */

    select name, type from system.columns where table = 'mart_btc__market_price_intraday__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:27:55.153489 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:27:55.167686 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:55.175622 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:55.185238 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_intraday"
[0m16:27:55.189836 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:27:55.191942 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_intraday: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_intraday"} */

  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_intraday__dbt_backup`
        ("last_updated_utc", "last_updated_manila", "coin_id", "symbol", "name", "image_url", "price_usd", "market_cap_usd", "market_cap_rank", "total_volume_usd", "high_24h_usd", "low_24h_usd", "price_change_24h_usd", "price_change_pct_24h")

select
  assumeNotNull(last_updated_utc) as last_updated_utc,   -- non-null for CH MergeTree keys
  last_updated_manila,
  coin_id,
  symbol,
  name,
  image_url,
  price_usd,
  market_cap_usd,
  market_cap_rank,
  total_volume_usd,
  high_24h_usd,
  low_24h_usd,
  price_change_24h_usd,
  price_change_pct_24h
from `clean`.`stg_btc__market_price`
  ...
[0m16:27:55.193945 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_backup`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    coin_id,
    assumeNotNull(toDate(toTimeZone(last_updated_utc, 'Asia/Manila'))) as day_local,
    last_updated_utc,
    toFloat64(price_usd) as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null
)
select
  day_local,
  coin_id,
  min(price_usd)                              as low_usd,
  max(price_usd)                              as high_usd,
  argMin(price_usd, last_updated_utc)         as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc)         as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  ...
[0m16:27:55.259122 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:55.273347 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:27:55.274821 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_intraday: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_intraday"} */
EXCHANGE TABLES `mart`.`mart_btc__market_price_intraday__dbt_backup` AND `mart`.`mart_btc__market_price_intraday` 
  
  ...
[0m16:27:55.277524 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */
EXCHANGE TABLES `mart`.`mart_btc__daily_ohlc__dbt_backup` AND `mart`.`mart_btc__daily_ohlc` 
  
  ...
[0m16:27:55.281856 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:27:55.283906 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:27:55.293090 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_intraday: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_intraday"} */

    drop table if exists `mart`.`mart_btc__market_price_intraday__dbt_backup` 
  ...
[0m16:27:55.353388 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_backup` 
  ...
[0m16:27:55.361347 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:27:55.363787 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:55.368451 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2522750940>]}
[0m16:27:55.373664 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e25216e2670>]}
[0m16:27:55.376006 [info ] [Thread-2  ]: 6 of 7 OK created sql table model `mart`.`mart_btc__market_price_intraday` ..... [[32mOK[0m in 1.12s]
[0m16:27:55.378855 [info ] [Thread-1  ]: 5 of 7 OK created sql table model `mart`.`mart_btc__daily_ohlc` ................ [[32mOK[0m in 1.12s]
[0m16:27:55.384322 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:27:55.381689 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:27:55.391255 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:27:55.392407 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m16:27:55.393922 [debug] [MainThread]: On list__mart: Close
[0m16:27:55.395030 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m16:27:55.396053 [debug] [MainThread]: On list__clean: Close
[0m16:27:55.397358 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m16:27:55.398732 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m16:27:55.399866 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m16:27:55.444033 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m16:27:55.444722 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m16:27:55.445234 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m16:27:55.445732 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_intraday' was left open.
[0m16:27:55.446232 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_intraday: Close
[0m16:27:55.447394 [info ] [MainThread]: 
[0m16:27:55.448125 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 table models in 0 hours 0 minutes and 3.79 seconds (3.79s).
[0m16:27:55.452183 [debug] [MainThread]: Command end result
[0m16:27:55.568224 [info ] [MainThread]: 
[0m16:27:55.569521 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:27:55.570473 [info ] [MainThread]: 
[0m16:27:55.571438 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m16:27:55.573337 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.2935686, "process_in_blocks": "0", "process_kernel_time": 0.664014, "process_mem_max_rss": "116128", "process_out_blocks": "10712", "process_user_time": 6.363974}
[0m16:27:55.574386 [debug] [MainThread]: Command `dbt build` succeeded at 16:27:55.574112 after 7.29 seconds
[0m16:27:55.575282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2526b5b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e25229938b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e25229c8430>]}
[0m16:27:55.576145 [debug] [MainThread]: Flushing usage events
[0m16:45:20.955322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1fd82a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1fa48baf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1fa48b9a0>]}


============================== 16:45:20.964907 | dd072486-d07e-4dd8-ba05-1b4fabe10928 ==============================
[0m16:45:20.964907 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:45:20.966071 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'static_parser': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'indirect_selection': 'eager', 'introspect': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'printer_width': '80', 'quiet': 'False', 'write_json': 'True', 'warn_error': 'None', 'cache_selected_only': 'False', 'target_path': 'None', 'use_colors': 'True', 'log_cache_events': 'False', 'no_print': 'None', 'use_experimental_parser': 'False', 'debug': 'False', 'partial_parse': 'True', 'log_format': 'default', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '.'}
[0m16:45:21.564247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1fcdd5fd0>]}
[0m16:45:21.772866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1fa58b970>]}
[0m16:45:21.774187 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:45:22.258573 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:45:22.765933 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 2 files changed.
[0m16:45:22.766877 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/mart/mart_btc__market_price_hourly.sql
[0m16:45:22.767434 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/mart/mart_btc__market_price_intraday.sql
[0m16:45:22.768137 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/mart/mart_btc__daily_ohlc.sql
[0m16:45:22.768816 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/mart/vw_btc__latest_24h.sql
[0m16:45:23.742214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1f99e3fa0>]}
[0m16:45:24.181005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1f9c3e220>]}
[0m16:45:24.181874 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:45:24.185180 [info ] [MainThread]: 
[0m16:45:24.186250 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:45:24.235893 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:45:24.237421 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:45:24.328327 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:45:24.337680 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:45:25.061867 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:45:25.067261 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:25.269000 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:45:25.275687 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:25.359656 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:45:25.366458 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:45:25.434216 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:45:25.436897 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:45:25.446120 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:25.451051 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:25.469089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1fa12fee0>]}
[0m16:45:25.470916 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:45:25.472242 [info ] [MainThread]: 
[0m16:45:25.547716 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:45:25.548828 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:45:25.549705 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_03_meteo.stg_btc__market_price)
[0m16:45:25.550384 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:45:25.567509 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:45:25.569009 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:45:25.756668 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:45:25.758573 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:45:25.771864 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:25.784057 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:45:25.787137 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:25.829220 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:45:25.832480 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:25.837900 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m16:45:25.840777 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:25.842574 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m16:45:25.845530 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:25.939604 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m16:45:25.943126 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:25.948951 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1f8a7c2e0>]}
[0m16:45:25.950049 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.40s]
[0m16:45:25.951491 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:45:25.953820 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:45:25.956263 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:45:25.958012 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:45:25.954946 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m16:45:25.960081 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m16:45:25.962030 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m16:45:25.964278 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m16:45:25.966468 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m16:45:25.968453 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m16:45:25.970156 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:45:25.971646 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:45:25.972887 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:45:26.233467 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:45:26.174991 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:45:26.231945 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:45:26.237598 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:45:26.239154 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:45:26.256418 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:45:26.466102 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:45:26.468986 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:45:26.550640 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:45:26.553023 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m16:45:26.555413 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m16:45:26.558005 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m16:45:26.809029 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m16:45:26.837924 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m16:45:26.846021 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:26.849769 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m16:45:26.863636 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:45:26.866057 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.90s]
[0m16:45:26.874347 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m16:45:26.932238 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:45:26.936855 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:45:26.940553 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:45:26.946591 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.98s]
[0m16:45:26.949510 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:45:26.952711 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:45:26.953789 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:45:26.955494 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:45:26.957305 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m16:45:26.959183 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m16:45:26.961405 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m16:45:26.963460 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m16:45:26.965056 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m16:45:26.966723 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m16:45:26.968488 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:45:26.970095 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:45:26.971774 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m16:45:27.065145 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:45:27.072065 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:45:27.132130 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:45:27.133883 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:45:27.156357 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m16:45:27.163375 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:45:27.247530 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:45:27.354368 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:45:27.529313 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m16:45:27.565516 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:45:27.639583 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:45:27.669599 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:45:27.842735 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m16:45:27.851476 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_dd072486_d07e_4dd8_ba05_1b4fabe10928` 
  ...
[0m16:45:27.876239 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:45:27.955099 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:45:27.957841 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:45:28.050418 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:45:28.070645 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:28.165639 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m16:45:28.169591 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m16:45:28.171025 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_dd072486_d07e_4dd8_ba05_1b4fabe10928`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m16:45:28.174272 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:28.228663 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1f83a52e0>]}
[0m16:45:28.231294 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:45:28.232461 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:45:28.230074 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.26s]
[0m16:45:28.253856 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:45:28.254736 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_dd072486_d07e_4dd8_ba05_1b4fabe10928'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:45:28.256141 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:45:28.261019 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:28.267430 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:45:28.269418 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:28.272362 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:45:28.273549 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
    ...
[0m16:45:28.274594 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_dd072486_d07e_4dd8_ba05_1b4fabe10928`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m16:45:28.327698 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:28.338255 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1f8293a30>]}
[0m16:45:28.339500 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.37s]
[0m16:45:28.340993 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:45:28.375091 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m16:45:28.377436 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_dd072486_d07e_4dd8_ba05_1b4fabe10928`)
      
    ...
[0m16:45:28.392809 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:28.397965 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:45:28.402850 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:28.405689 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_dd072486_d07e_4dd8_ba05_1b4fabe10928` 
    ...
[0m16:45:28.411169 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:28.417282 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_dd072486_d07e_4dd8_ba05_1b4fabe10928` 
  ...
[0m16:45:28.420786 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:28.429166 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m16:45:28.432020 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:28.435038 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1f92d71c0>]}
[0m16:45:28.436176 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.47s]
[0m16:45:28.437481 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:45:28.439361 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:45:28.439922 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m16:45:28.440439 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m16:45:28.440949 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m16:45:28.441437 [debug] [MainThread]: On list__clean: Close
[0m16:45:28.441940 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m16:45:28.442460 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m16:45:28.442983 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m16:45:28.443503 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m16:45:28.444042 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m16:45:28.444611 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m16:45:28.445712 [info ] [MainThread]: 
[0m16:45:28.446459 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.26 seconds (4.26s).
[0m16:45:28.450160 [debug] [MainThread]: Command end result
[0m16:45:28.559424 [info ] [MainThread]: 
[0m16:45:28.560347 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:45:28.561019 [info ] [MainThread]: 
[0m16:45:28.561715 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m16:45:28.563174 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.8001084, "process_in_blocks": "0", "process_kernel_time": 0.697758, "process_mem_max_rss": "117816", "process_out_blocks": "10744", "process_user_time": 6.533377}
[0m16:45:28.564031 [debug] [MainThread]: Command `dbt build` succeeded at 16:45:28.563824 after 7.80 seconds
[0m16:45:28.564729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1fd82a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1f9c3e220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1fb6b49d0>]}
[0m16:45:28.565317 [debug] [MainThread]: Flushing usage events
[0m16:57:16.947837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e35770e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e323dcb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e323dca30>]}


============================== 16:57:16.957596 | bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271 ==============================
[0m16:57:16.957596 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:57:16.958688 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'quiet': 'False', 'write_json': 'True', 'use_colors': 'True', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'debug': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'cache_selected_only': 'False', 'partial_parse': 'True', 'fail_fast': 'False', 'indirect_selection': 'eager', 'introspect': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'profiles_dir': '.', 'invocation_command': 'dbt build --profiles-dir . --target local', 'no_print': 'None', 'warn_error': 'None'}
[0m16:57:17.541951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e34251790>]}
[0m16:57:17.736856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e321a2d30>]}
[0m16:57:17.738151 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:57:18.128185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705fae0bf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f7ab1a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f7ab1910>]}


============================== 16:57:18.138196 | 9c68956d-2b7a-4031-89e2-e89c4df76724 ==============================
[0m16:57:18.138196 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:57:18.139412 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'use_colors': 'True', 'target_path': 'None', 'log_format': 'default', 'indirect_selection': 'eager', 'quiet': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'printer_width': '80', 'log_path': '/workdir/transforms/04_btc/logs', 'static_parser': 'True', 'write_json': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'profiles_dir': '.', 'cache_selected_only': 'False', 'debug': 'False', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local'}
[0m16:57:18.155341 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:57:18.666776 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:57:18.667419 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:57:18.735039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705fa35bfd0>]}
[0m16:57:18.871069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e31b42e50>]}
[0m16:57:18.933450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f7efeb50>]}
[0m16:57:18.934756 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:57:19.356783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e31ad07c0>]}
[0m16:57:19.357732 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:57:19.361009 [info ] [MainThread]: 
[0m16:57:19.362059 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:57:19.374283 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:57:19.406425 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:57:19.436442 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:57:19.451203 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:57:19.458575 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:57:19.913049 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:57:19.913752 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:57:19.984075 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:57:19.989930 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:57:19.992176 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:19.997055 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:20.058767 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:57:20.060119 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:57:20.074875 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:57:20.080198 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:57:20.088731 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:20.126709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f721ef70>]}
[0m16:57:20.135993 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:20.146996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e356c8430>]}
[0m16:57:20.148068 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:57:20.149129 [info ] [MainThread]: 
[0m16:57:20.166910 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:57:20.168042 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:57:20.169113 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m16:57:20.169856 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:57:20.237579 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:57:20.238834 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:57:20.363729 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m16:57:20.421670 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:57:20.423014 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:57:20.436399 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:20.572270 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:57:20.575948 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:20.577978 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:57:20.580919 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:20.586705 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m16:57:20.633354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f725c940>]}
[0m16:57:20.634226 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:57:20.636815 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m16:57:20.637404 [info ] [MainThread]: 
[0m16:57:20.638410 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:57:20.638938 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m16:57:20.641911 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:20.650799 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:57:20.698486 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:57:20.722846 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:57:20.724825 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:57:20.738394 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m16:57:20.741464 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:20.747598 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e31725f10>]}
[0m16:57:20.748921 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.58s]
[0m16:57:20.750317 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:57:20.751996 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:57:20.752857 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:57:20.753698 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m16:57:20.754631 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:57:20.755521 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m16:57:20.756659 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m16:57:20.757609 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m16:57:20.759842 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m16:57:20.761360 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:57:20.763195 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m16:57:20.764849 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:57:20.836398 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:57:20.858505 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:57:20.860963 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:57:20.874750 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:57:20.877329 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:57:20.952059 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:57:20.883980 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:57:21.045410 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:57:21.052022 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:57:21.055103 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:57:21.057985 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m16:57:21.060071 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m16:57:21.063565 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m16:57:21.250828 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:57:21.254473 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:57:21.256607 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:21.258611 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:21.299898 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:57:21.302582 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m16:57:21.311868 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m16:57:21.313443 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:21.301493 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:57:21.315703 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:57:21.320159 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:57:21.326971 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:21.314575 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m16:57:21.322481 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.56s]
[0m16:57:21.328617 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:21.324181 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:21.339611 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:57:21.344951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705fa26a040>]}
[0m16:57:21.343212 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.58s]
[0m16:57:21.346714 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:57:21.347439 [info ] [MainThread]: 
[0m16:57:21.345239 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:21.347230 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:57:21.350758 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.59s]
[0m16:57:21.352571 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:57:21.354076 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:57:21.355055 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:57:21.356078 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:57:21.357303 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m16:57:21.358452 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m16:57:21.359883 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m16:57:21.360838 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m16:57:21.361609 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m16:57:21.362625 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m16:57:21.363722 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:57:21.365243 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:57:21.424658 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:57:21.425766 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:57:21.426881 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m16:57:21.427602 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:57:21.444266 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:57:21.445473 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:57:21.366659 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m16:57:21.441933 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:57:21.446933 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:57:21.460818 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:57:21.463001 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:57:21.463815 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:57:21.469810 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m16:57:21.571650 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:57:21.630811 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m16:57:21.668108 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:57:21.723046 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:57:21.724919 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:57:21.737617 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:21.767811 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m16:57:21.910438 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:57:21.915222 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:21.918904 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:57:21.923097 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:21.933975 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m16:57:21.938460 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:21.942154 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:57:21.943901 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m16:57:21.948846 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:21.972557 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:22.052990 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:57:22.050821 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271` 
  ...
[0m16:57:22.066705 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271` 
  ...
[0m16:57:22.070592 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:22.073247 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:22.100366 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m16:57:22.103473 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:22.109415 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f6de4b20>]}
[0m16:57:22.110752 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.68s]
[0m16:57:22.112121 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:57:22.113664 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:57:22.114407 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:57:22.115283 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:57:22.116039 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m16:57:22.117010 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m16:57:22.118192 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m16:57:22.119668 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m16:57:22.120619 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m16:57:22.121846 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m16:57:22.122972 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:57:22.123756 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:57:22.074892 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:22.081207 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:57:22.124781 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:57:22.211486 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:57:22.217679 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:57:22.219391 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:57:22.221177 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:57:22.227229 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:57:22.253250 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:22.233500 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:57:22.338398 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:57:22.372586 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m16:57:22.378091 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m16:57:22.380615 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.401437 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:57:22.407691 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:57:22.417017 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:57:22.418465 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m16:57:22.419336 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m16:57:22.420761 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m16:57:22.439958 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m16:57:22.441328 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:57:22.443007 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:57:22.457693 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.464267 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:57:22.469481 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:57:22.472044 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e3075d2e0>]}
[0m16:57:22.476243 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.11s]
[0m16:57:22.477775 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:57:22.479455 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.481522 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.539991 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:57:22.544888 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:57:22.547179 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m16:57:22.548706 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m16:57:22.567871 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:22.570253 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271`)
      
    ...
[0m16:57:22.571589 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:22.574544 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271`)
      
    ...
[0m16:57:22.582276 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m16:57:22.596258 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:22.598310 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m16:57:22.600207 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:22.604635 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:57:22.606221 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:57:22.604850 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m16:57:22.615181 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.49s]
[0m16:57:22.617448 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.619930 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:57:22.623113 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.50s]
[0m16:57:22.625132 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:57:22.626788 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.629613 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.51s]
[0m16:57:22.630982 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:57:22.632527 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:57:22.633524 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m16:57:22.634447 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m16:57:22.616717 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:57:22.618169 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.635211 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:57:22.636057 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:57:22.637014 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:57:22.641573 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271` 
    ...
[0m16:57:22.643204 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.647066 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271` 
    ...
[0m16:57:22.648655 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:22.655802 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271` 
  ...
[0m16:57:22.657177 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.663727 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271` 
  ...
[0m16:57:22.665213 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.672814 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m16:57:22.674943 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.681028 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m16:57:22.682290 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.638358 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m16:57:22.639779 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m16:57:22.703722 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m16:57:22.710872 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:57:22.711814 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m16:57:22.712911 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:57:22.714246 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m16:57:22.723235 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:57:22.724294 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:57:22.739317 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e3075d7f0>]}
[0m16:57:22.731273 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:57:22.741434 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:57:22.743181 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.38s]
[0m16:57:22.748179 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e3166b640>]}
[0m16:57:22.749503 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:57:22.751261 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.39s]
[0m16:57:22.753841 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:57:22.756311 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:57:22.756862 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m16:57:22.757379 [debug] [MainThread]: On list__clean: Close
[0m16:57:22.757862 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m16:57:22.758332 [debug] [MainThread]: On list__mart: Close
[0m16:57:22.758843 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m16:57:22.759312 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m16:57:22.759790 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m16:57:22.760287 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m16:57:22.760906 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m16:57:22.761389 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m16:57:22.761897 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m16:57:22.762386 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m16:57:22.763579 [info ] [MainThread]: 
[0m16:57:22.764248 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.40 seconds (3.40s).
[0m16:57:22.768007 [debug] [MainThread]: Command end result
[0m16:57:22.798416 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:57:22.898466 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m16:57:22.936382 [info ] [MainThread]: 
[0m16:57:22.937781 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:57:22.938768 [info ] [MainThread]: 
[0m16:57:22.939808 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m16:57:22.941411 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.1873994, "process_in_blocks": "0", "process_kernel_time": 0.65995, "process_mem_max_rss": "114244", "process_out_blocks": "9752", "process_user_time": 5.919675}
[0m16:57:22.942207 [debug] [MainThread]: Command `dbt build` succeeded at 16:57:22.942009 after 6.19 seconds
[0m16:57:22.942891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e35770e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e3369dc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e34251790>]}
[0m16:57:22.943509 [debug] [MainThread]: Flushing usage events
[0m16:57:23.010329 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:57:23.139405 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:57:23.132922 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724` 
  ...
[0m16:57:23.224942 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724` 
  ...
[0m16:57:23.229553 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:23.236236 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:23.298349 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:57:23.409721 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:57:23.509100 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m16:57:23.510515 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m16:57:23.512372 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:57:23.519038 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:57:23.522681 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:23.528878 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:57:23.532040 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:23.534113 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:57:23.536021 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:23.604741 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m16:57:23.613587 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:57:23.620184 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m16:57:23.618896 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:57:23.629496 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m16:57:23.632977 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:23.698497 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:57:23.647224 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:23.700624 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:57:23.703530 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:57:23.706365 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f5d77fd0>]}
[0m16:57:23.707406 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m16:57:23.709064 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.99s]
[0m16:57:23.711895 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:57:23.713072 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m16:57:23.730795 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:23.733057 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724`)
      
    ...
[0m16:57:23.736094 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:23.738427 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724`)
      
    ...
[0m16:57:23.753406 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:23.758716 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:57:23.760204 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:23.798949 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m16:57:23.800110 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:57:23.803372 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724` 
    ...
[0m16:57:23.809623 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:23.816447 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:23.815006 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724` 
    ...
[0m16:57:23.822654 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724` 
  ...
[0m16:57:23.827771 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:23.829466 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:23.838072 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m16:57:23.845564 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724` 
  ...
[0m16:57:23.848736 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:23.899188 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m16:57:23.903021 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f65d5b80>]}
[0m16:57:23.909286 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m16:57:23.910708 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.27s]
[0m16:57:23.913021 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:57:23.914442 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:23.917877 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f65434c0>]}
[0m16:57:23.919079 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.21s]
[0m16:57:23.920385 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:57:23.922424 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:57:23.922990 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m16:57:23.923481 [debug] [MainThread]: On list__mart: Close
[0m16:57:23.924001 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m16:57:23.924481 [debug] [MainThread]: On list__clean: Close
[0m16:57:23.924963 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m16:57:23.925511 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m16:57:23.926103 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m16:57:23.926665 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m16:57:23.927192 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m16:57:23.927713 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m16:57:23.928261 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m16:57:23.928822 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m16:57:23.930037 [info ] [MainThread]: 
[0m16:57:23.930830 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.29 seconds (3.29s).
[0m16:57:23.934721 [debug] [MainThread]: Command end result
[0m16:57:24.043458 [info ] [MainThread]: 
[0m16:57:24.044434 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:57:24.045072 [info ] [MainThread]: 
[0m16:57:24.045746 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m16:57:24.047089 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.1124334, "process_in_blocks": "0", "process_kernel_time": 0.63649, "process_mem_max_rss": "114244", "process_out_blocks": "9736", "process_user_time": 5.848934}
[0m16:57:24.098844 [debug] [MainThread]: Command `dbt build` succeeded at 16:57:24.098464 after 6.16 seconds
[0m16:57:24.099609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705fae0bf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f65b96a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f65b9640>]}
[0m16:57:24.100198 [debug] [MainThread]: Flushing usage events
[0m16:58:16.120727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d675f1310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d6424eb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d6424ea30>]}


============================== 16:58:16.129871 | 99b47ca8-b836-41e7-9646-2256976ace30 ==============================
[0m16:58:16.129871 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:58:16.131018 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'empty': 'False', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'printer_width': '80', 'debug': 'False', 'write_json': 'True', 'fail_fast': 'False', 'quiet': 'False', 'static_parser': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'log_format': 'default', 'partial_parse': 'True', 'use_colors': 'True', 'version_check': 'True', 'no_print': 'None', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True'}
[0m16:58:16.712661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d64219cd0>]}
[0m16:58:16.907751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d64b7dd30>]}
[0m16:58:16.909100 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:58:17.331178 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:58:17.835285 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:58:17.835950 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:58:18.037234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d639bcee0>]}
[0m16:58:18.528054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d639a6e80>]}
[0m16:58:18.528908 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:58:18.532064 [info ] [MainThread]: 
[0m16:58:18.533069 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:58:18.545223 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:58:18.546958 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:58:18.695955 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:58:18.701841 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:58:19.276163 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:58:19.281133 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:19.291810 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:58:19.296468 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:19.319633 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:58:19.320613 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:58:19.332234 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:58:19.336032 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:58:19.394728 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:58:19.400202 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:19.406980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d6374fdf0>]}
[0m16:58:19.407941 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:58:19.408561 [info ] [MainThread]: 
[0m16:58:19.421628 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:58:19.422888 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:58:19.424029 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m16:58:19.424950 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:58:19.493002 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:58:19.494186 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:58:19.612205 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m16:58:19.668241 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:58:19.669644 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:58:19.679239 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:19.817231 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:58:19.820123 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:19.822078 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:58:19.824687 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:19.830513 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m16:58:19.833178 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:19.835058 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m16:58:19.837628 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:19.932180 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m16:58:19.935576 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:19.941415 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d63583dc0>]}
[0m16:58:19.991739 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.52s]
[0m16:58:19.993114 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:58:19.995156 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:58:19.996300 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:58:19.997794 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m16:58:19.999206 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:58:20.001145 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m16:58:20.003207 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m16:58:20.005437 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m16:58:20.007833 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m16:58:20.009271 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:58:20.010802 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m16:58:20.012478 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:58:20.019347 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:58:20.036496 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:58:20.107986 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:58:20.119493 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:58:20.122085 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:58:20.123682 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:58:20.191265 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:58:20.395165 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:58:20.432263 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:58:20.498335 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:58:20.500674 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m16:58:20.502384 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m16:58:20.506934 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m16:58:20.759421 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m16:58:20.772352 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:20.774966 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m16:58:20.800426 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.80s]
[0m16:58:20.805346 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m16:58:20.807570 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:58:20.812077 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:20.815609 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.81s]
[0m16:58:20.818025 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:20.820090 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:58:20.825274 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.81s]
[0m16:58:20.828582 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:58:20.831589 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:58:20.833047 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:58:20.834361 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m16:58:20.835813 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:58:20.837754 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m16:58:20.891740 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m16:58:20.894160 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m16:58:20.895952 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m16:58:20.897655 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:58:20.899320 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m16:58:20.901031 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:58:20.918283 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m16:58:21.012991 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:58:21.014586 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:58:21.016331 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:58:21.017796 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m16:58:21.018519 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:58:21.024773 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:58:21.032828 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:58:21.191282 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:58:21.297290 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m16:58:21.396789 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:58:21.497488 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:58:21.520777 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:58:21.712115 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30` 
  ...
[0m16:58:21.714949 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m16:58:21.812813 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m16:58:21.827242 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:58:21.832501 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30` 
  ...
[0m16:58:21.918824 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:58:21.999310 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:58:22.028077 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:58:22.111301 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m16:58:22.126964 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m16:58:22.131231 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:22.191998 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:58:22.194441 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:58:22.210259 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m16:58:22.298494 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:58:22.296053 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:58:22.307513 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:58:22.312943 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d6414a730>]}
[0m16:58:22.320011 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.41s]
[0m16:58:22.323027 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:58:22.326417 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:22.329106 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:22.393798 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:58:22.399588 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:58:22.402769 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m16:58:22.405100 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m16:58:22.435874 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:58:22.440496 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30`)
      
    ...
[0m16:58:22.471303 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:58:22.480668 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:58:22.483355 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:58:22.491478 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30`)
      
    ...
[0m16:58:22.494052 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:22.500895 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30` 
    ...
[0m16:58:22.510899 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:22.520062 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30` 
  ...
[0m16:58:22.522161 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:58:22.531902 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:58:22.533702 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:22.592180 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:58:22.545489 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m16:58:22.598974 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30` 
    ...
[0m16:58:22.605786 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:22.612437 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d6412d040>]}
[0m16:58:22.614838 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.72s]
[0m16:58:22.617392 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:22.620081 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:58:22.632475 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30` 
  ...
[0m16:58:22.639400 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:22.701228 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m16:58:22.706665 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:22.713132 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d63892910>]}
[0m16:58:22.715448 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.82s]
[0m16:58:22.718305 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:58:22.722569 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:58:22.723731 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m16:58:22.724858 [debug] [MainThread]: On list__clean: Close
[0m16:58:22.725912 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m16:58:22.727020 [debug] [MainThread]: On list__mart: Close
[0m16:58:22.728054 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m16:58:22.729120 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m16:58:22.730148 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m16:58:22.731229 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m16:58:22.732251 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m16:58:22.733307 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m16:58:22.734331 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m16:58:22.735405 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m16:58:22.737597 [info ] [MainThread]: 
[0m16:58:22.738910 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.20 seconds (4.20s).
[0m16:58:22.797087 [debug] [MainThread]: Command end result
[0m16:58:23.010497 [info ] [MainThread]: 
[0m16:58:23.011837 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:58:23.012953 [info ] [MainThread]: 
[0m16:58:23.014371 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m16:58:23.017166 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.0901556, "process_in_blocks": "0", "process_kernel_time": 0.711479, "process_mem_max_rss": "114696", "process_out_blocks": "9744", "process_user_time": 6.289164}
[0m16:58:23.018764 [debug] [MainThread]: Command `dbt build` succeeded at 16:58:23.018333 after 7.09 seconds
[0m16:58:23.020090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d675f1310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d639a6e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d661fb6a0>]}
[0m16:58:23.021481 [debug] [MainThread]: Flushing usage events
[0m16:59:15.836826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f670ee310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f63d54b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f63d549d0>]}


============================== 16:59:15.846583 | bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab ==============================
[0m16:59:15.846583 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:59:15.847666 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'debug': 'False', 'warn_error': 'None', 'log_cache_events': 'False', 'fail_fast': 'False', 'log_format': 'default', 'quiet': 'False', 'cache_selected_only': 'False', 'introspect': 'True', 'no_print': 'None', 'static_parser': 'True', 'empty': 'False', 'target_path': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'profiles_dir': '.', 'indirect_selection': 'eager', 'printer_width': '80', 'use_experimental_parser': 'False', 'use_colors': 'True', 'write_json': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m16:59:16.428269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f63d0c5b0>]}
[0m16:59:16.569306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f63db6070>]}
[0m16:59:16.621141 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:59:17.042348 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:59:17.543755 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:59:17.544380 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:59:17.743832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f634a8eb0>]}
[0m16:59:18.181334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f633688e0>]}
[0m16:59:18.182207 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:59:18.223793 [info ] [MainThread]: 
[0m16:59:18.224837 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:59:18.236784 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:59:18.243126 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:59:18.339716 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:59:18.354930 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:59:19.128144 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:59:19.135783 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:59:19.139569 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:19.141657 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:19.245948 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:59:19.247453 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:59:19.263647 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:59:19.268838 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:59:19.321434 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m16:59:19.333134 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:19.346990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f62fccdc0>]}
[0m16:59:19.348901 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:59:19.350242 [info ] [MainThread]: 
[0m16:59:19.427746 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:59:19.428880 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:59:19.429929 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m16:59:19.430697 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:59:19.446961 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:59:19.448113 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:59:19.566772 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m16:59:19.677346 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:59:19.678760 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:59:19.691722 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:19.767763 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:59:19.771059 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:19.822786 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:59:19.826323 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:19.832110 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m16:59:19.834993 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:19.836822 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m16:59:19.839577 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:19.933385 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m16:59:19.936855 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:19.943061 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f63079fd0>]}
[0m16:59:19.944242 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.51s]
[0m16:59:19.945678 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:59:19.948191 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:59:19.949671 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:59:19.951167 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:59:19.953096 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m16:59:19.955068 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m16:59:19.957076 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m16:59:19.959380 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m16:59:19.961461 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m16:59:19.963615 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m16:59:19.965314 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:59:19.967005 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:59:19.968749 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:59:20.224781 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:59:20.235822 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:59:20.239942 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:59:20.242607 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:59:20.244085 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:59:20.245606 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:59:20.535081 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:59:20.558237 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:59:20.568223 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:59:20.621898 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m16:59:20.623523 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m16:59:20.624619 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m16:59:20.875057 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m16:59:20.883385 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m16:59:20.893264 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:59:20.922812 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m16:59:20.930865 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m16:59:20.937236 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.98s]
[0m16:59:20.942748 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.98s]
[0m16:59:20.948235 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:59:20.951187 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:59:20.955986 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:20.961712 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 1.00s]
[0m16:59:20.964438 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:59:20.967565 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:59:20.968800 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:59:20.970299 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m16:59:20.971508 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:59:21.023593 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m16:59:21.025348 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m16:59:21.027366 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m16:59:21.029512 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m16:59:21.031196 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:59:21.032833 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m16:59:21.034496 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:59:21.051857 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m16:59:21.138087 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:59:21.150249 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:59:21.158998 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:59:21.161874 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:59:21.168762 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:59:21.237929 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m16:59:21.338069 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:59:21.356049 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:59:21.522674 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m16:59:21.566070 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:59:21.747656 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m16:59:21.767044 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:59:21.861336 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:59:21.923658 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab` 
  ...
[0m16:59:21.962304 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:59:22.048031 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab` 
  ...
[0m16:59:22.050374 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m16:59:22.053971 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:22.061776 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:22.127807 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:59:22.229327 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m16:59:22.236420 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m16:59:22.238047 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:59:22.247288 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m16:59:22.250367 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:22.252967 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f63064f70>]}
[0m16:59:22.254111 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.22s]
[0m16:59:22.255472 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:59:22.265258 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:59:22.321979 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m16:59:22.326213 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:59:22.332280 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:59:22.337738 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:22.344290 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:22.345499 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:59:22.348604 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:59:22.350181 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m16:59:22.351969 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m16:59:22.365879 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:22.368079 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab`)
      
    ...
[0m16:59:22.385160 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:59:22.390505 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:59:22.395892 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:22.398984 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab` 
    ...
[0m16:59:22.400264 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m16:59:22.423851 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab`)
      
    ...
[0m16:59:22.426386 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:22.432353 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab` 
  ...
[0m16:59:22.435830 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:22.443745 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m16:59:22.445206 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:59:22.451084 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:59:22.452431 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:22.456759 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f62dc0610>]}
[0m16:59:22.458094 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.43s]
[0m16:59:22.459586 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:22.460945 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:59:22.463959 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab` 
    ...
[0m16:59:22.469530 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:22.524227 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab` 
  ...
[0m16:59:22.527522 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:22.533520 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m16:59:22.536248 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:22.539387 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f62d04820>]}
[0m16:59:22.540503 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.51s]
[0m16:59:22.541814 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:59:22.543862 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:59:22.544389 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m16:59:22.544946 [debug] [MainThread]: On list__clean: Close
[0m16:59:22.545427 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m16:59:22.545970 [debug] [MainThread]: On list__mart: Close
[0m16:59:22.546424 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m16:59:22.546943 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m16:59:22.547407 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m16:59:22.547940 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m16:59:22.548413 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m16:59:22.548978 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m16:59:22.549435 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m16:59:22.549961 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m16:59:22.551093 [info ] [MainThread]: 
[0m16:59:22.551766 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.33 seconds (4.33s).
[0m16:59:22.555611 [debug] [MainThread]: Command end result
[0m16:59:22.657984 [info ] [MainThread]: 
[0m16:59:22.658843 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:59:22.659424 [info ] [MainThread]: 
[0m16:59:22.660081 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m16:59:22.661373 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.0253043, "process_in_blocks": "0", "process_kernel_time": 0.709722, "process_mem_max_rss": "115232", "process_out_blocks": "9744", "process_user_time": 6.173493}
[0m16:59:22.662112 [debug] [MainThread]: Command `dbt build` succeeded at 16:59:22.661919 after 7.03 seconds
[0m16:59:22.662739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f670ee310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f64868460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f61d00430>]}
[0m16:59:22.663322 [debug] [MainThread]: Flushing usage events
[0m17:00:16.792052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7203051db310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720301e43b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720301e43a00>]}


============================== 17:00:16.801489 | d3ff1786-6849-41ab-99ff-7c90cc996a3c ==============================
[0m17:00:16.801489 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:00:16.802573 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'fail_fast': 'False', 'cache_selected_only': 'False', 'profiles_dir': '.', 'no_print': 'None', 'introspect': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'debug': 'False', 'warn_error': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'use_colors': 'True', 'quiet': 'False', 'log_format': 'default', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'empty': 'False', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'version_check': 'True', 'printer_width': '80'}
[0m17:00:17.386489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720301d30b20>]}
[0m17:00:17.529231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7203029267c0>]}
[0m17:00:17.530472 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:00:17.992852 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:00:18.509103 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:00:18.509785 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:00:18.713564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7203015a9e80>]}
[0m17:00:19.198702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7203015bfa90>]}
[0m17:00:19.199617 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:00:19.202954 [info ] [MainThread]: 
[0m17:00:19.204001 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:00:19.215963 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:00:19.222441 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:00:19.391416 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:00:19.392657 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:00:20.068323 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:00:20.087660 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:20.089044 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:00:20.093076 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:20.120019 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:00:20.126275 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:00:20.190362 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:00:20.197994 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:00:20.204575 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:20.208574 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:20.224476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720301b1bb80>]}
[0m17:00:20.225956 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:00:20.226964 [info ] [MainThread]: 
[0m17:00:20.301521 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:00:20.302760 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:00:20.303903 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:00:20.305031 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:00:20.328958 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:00:20.330956 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:00:20.604231 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:00:20.674804 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:00:20.684662 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:00:20.701094 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:20.892001 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:00:20.894827 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:20.896768 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:00:20.899424 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:20.905274 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:00:20.907872 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:20.909720 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:00:20.912117 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:21.007552 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:00:21.010854 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:21.017443 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720300836c10>]}
[0m17:00:21.018806 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.71s]
[0m17:00:21.020110 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:00:21.022453 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:00:21.024266 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:00:21.026023 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:00:21.027588 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:00:21.029521 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:00:21.031330 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:00:21.084628 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:00:21.086736 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:00:21.088847 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:00:21.090881 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:00:21.092582 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:00:21.094244 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:00:21.287091 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:00:21.289500 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:00:21.293937 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:00:21.296315 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:00:21.297862 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:00:21.304820 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:00:21.601161 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:00:21.606517 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:00:21.623697 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:00:21.626827 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:00:21.627946 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:00:21.683724 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:00:21.898998 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:00:21.917148 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:00:21.932977 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.84s]
[0m17:00:21.988376 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:00:21.938490 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:00:21.995027 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:00:22.008334 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:22.011699 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:00:22.019277 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.93s]
[0m17:00:22.026378 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.94s]
[0m17:00:22.030351 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:00:22.033856 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:00:22.037807 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:00:22.082953 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:00:22.039111 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:00:22.084560 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:00:22.086033 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:00:22.087466 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:00:22.089029 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:00:22.090049 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:00:22.090812 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:00:22.091859 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:00:22.092846 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:00:22.093736 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:00:22.115970 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:00:22.197032 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:00:22.198973 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:00:22.200817 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:00:22.201871 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:00:22.293272 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:00:22.305871 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:00:22.493034 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:00:22.583428 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:00:22.613591 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:00:22.713120 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m17:00:22.728673 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c` 
  ...
[0m17:00:22.785872 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:00:22.830153 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c` 
  ...
[0m17:00:22.885023 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:00:22.891023 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:22.904122 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:00:22.993458 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:00:23.089038 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:00:23.098607 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:00:23.184114 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:00:23.285866 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:00:23.311457 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:00:23.330829 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:00:23.386457 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7203001a9ac0>]}
[0m17:00:23.396872 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:00:23.401473 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.30s]
[0m17:00:23.407837 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:00:23.428187 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:00:23.443339 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:00:23.513064 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:00:23.524990 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:00:23.582651 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:23.585438 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:00:23.600630 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:00:23.606903 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:00:23.609913 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:00:23.612225 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:00:23.640909 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:00:23.643523 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:00:23.647784 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c`)
      
    ...
[0m17:00:23.683929 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c`)
      
    ...
[0m17:00:23.705595 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:00:23.711274 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:00:23.713849 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:00:23.721003 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:00:23.722599 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:23.726519 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c` 
    ...
[0m17:00:23.727969 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:23.733430 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c` 
    ...
[0m17:00:23.735706 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:23.744667 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c` 
  ...
[0m17:00:23.746314 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:23.794398 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c` 
  ...
[0m17:00:23.797411 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:00:23.803806 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:23.805229 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:00:23.811042 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:00:23.815299 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:23.818750 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720300e48d30>]}
[0m17:00:23.820030 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.73s]
[0m17:00:23.821421 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:23.822849 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:00:23.826309 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7203001a9940>]}
[0m17:00:23.827799 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.74s]
[0m17:00:23.829029 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:00:23.830884 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:00:23.831387 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:00:23.831965 [debug] [MainThread]: On list__clean: Close
[0m17:00:23.832429 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:00:23.882949 [debug] [MainThread]: On list__mart: Close
[0m17:00:23.883442 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:00:23.884051 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:00:23.886945 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:00:23.888790 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:00:23.890722 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:00:23.892112 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:00:23.893568 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:00:23.894781 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:00:23.896937 [info ] [MainThread]: 
[0m17:00:23.897947 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.69 seconds (4.69s).
[0m17:00:23.902662 [debug] [MainThread]: Command end result
[0m17:00:24.016013 [info ] [MainThread]: 
[0m17:00:24.016915 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:00:24.017576 [info ] [MainThread]: 
[0m17:00:24.018305 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:00:24.020005 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.422599, "process_in_blocks": "0", "process_kernel_time": 0.717289, "process_mem_max_rss": "115064", "process_out_blocks": "9744", "process_user_time": 6.381509}
[0m17:00:24.020923 [debug] [MainThread]: Command `dbt build` succeeded at 17:00:24.020698 after 7.42 seconds
[0m17:00:24.021643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7203051db310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720303101100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720303104220>]}
[0m17:00:24.022324 [debug] [MainThread]: Flushing usage events
[0m17:01:17.965834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31587a0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31553fcb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31553fca00>]}


============================== 17:01:17.975189 | 5d245175-53df-4cbe-9ddd-6b4e300647b2 ==============================
[0m17:01:17.975189 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:01:17.976270 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'quiet': 'False', 'version_check': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'partial_parse': 'True', 'debug': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'use_colors': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'empty': 'False', 'write_json': 'True', 'static_parser': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error': 'None'}
[0m17:01:18.511974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31552f4940>]}
[0m17:01:18.705166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31553c5310>]}
[0m17:01:18.706493 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:01:19.173921 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:01:19.683152 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:01:19.683869 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:01:19.884260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a3154b63eb0>]}
[0m17:01:20.371816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a3154a584c0>]}
[0m17:01:20.372714 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:01:20.376036 [info ] [MainThread]: 
[0m17:01:20.377065 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:01:20.389049 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:01:20.390528 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:01:20.507053 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:01:20.505987 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:01:21.196631 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:01:21.201421 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:21.202825 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:01:21.209817 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:21.265678 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:01:21.266744 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:01:21.278747 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:01:21.282836 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:01:21.292739 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:21.303226 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:01:21.308324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31552daf70>]}
[0m17:01:21.309329 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:01:21.309990 [info ] [MainThread]: 
[0m17:01:21.368032 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:01:21.369208 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:01:21.370313 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:01:21.371092 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:01:21.388762 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:01:21.390017 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:01:21.511711 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:01:21.617081 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:01:21.618466 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:01:21.628640 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:21.769391 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:01:21.772491 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:21.774611 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:01:21.777494 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:21.783773 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:01:21.786647 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:21.788655 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:01:21.791413 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:21.887952 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:01:21.891356 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:21.901649 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a3154731fa0>]}
[0m17:01:21.903798 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m17:01:21.906011 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:01:21.908263 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:01:21.909528 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:01:21.910499 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:01:21.911522 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:01:21.912526 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:01:21.913448 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:01:21.914644 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:01:21.915628 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:01:21.965320 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:01:21.966498 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:01:21.967343 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:01:21.968090 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:01:21.995634 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:01:21.998298 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:01:22.007105 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:01:22.008705 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:01:22.014773 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:01:22.071059 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:01:22.308883 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:01:22.377884 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:01:22.380753 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:01:22.383774 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:01:22.385950 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:01:22.387801 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:01:22.567178 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:01:22.584080 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:01:22.588587 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:01:22.593199 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:01:22.610508 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.70s]
[0m17:01:22.666831 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:01:22.668531 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:01:22.671395 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:01:22.677330 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.76s]
[0m17:01:22.682806 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.77s]
[0m17:01:22.685896 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:01:22.688970 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:01:22.692223 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:01:22.693281 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:01:22.694616 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:01:22.695603 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:01:22.697843 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:01:22.700156 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:01:22.702086 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:01:22.703715 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:01:22.705254 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:01:22.706980 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:01:22.708729 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:01:22.710387 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:01:22.868401 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:01:22.898829 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:01:22.900882 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:01:22.903520 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:01:22.905161 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:01:22.906841 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:01:22.989051 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:01:23.096606 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:01:23.204983 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:01:23.308305 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:01:23.399572 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:01:23.414436 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:01:23.582517 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:01:23.693591 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2` 
  ...
[0m17:01:23.703199 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:01:23.787090 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:01:23.785216 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2` 
  ...
[0m17:01:23.802908 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:23.891505 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:01:23.896041 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:01:24.072070 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:01:24.175077 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:01:24.201011 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:01:24.202891 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:01:24.208562 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:24.266804 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a3153f941f0>]}
[0m17:01:24.269776 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.56s]
[0m17:01:24.272422 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:01:24.275166 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:01:24.294067 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:01:24.380098 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:01:24.388240 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:01:24.398184 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:24.411753 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:01:24.414687 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:01:24.470456 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:01:24.473670 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:01:24.477978 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:01:24.508173 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:01:24.510916 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:01:24.515232 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2`)
      
    ...
[0m17:01:24.520940 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2`)
      
    ...
[0m17:01:24.547752 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:01:24.569039 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:01:24.571711 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:01:24.583939 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:01:24.586619 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:24.594243 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2` 
    ...
[0m17:01:24.597143 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:24.604498 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2` 
    ...
[0m17:01:24.607216 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:24.671945 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:01:24.675687 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2` 
  ...
[0m17:01:24.687617 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2` 
  ...
[0m17:01:24.693401 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:24.696019 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:24.708621 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:01:24.771764 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:01:24.777924 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:24.785923 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:24.787100 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31548ca4c0>]}
[0m17:01:24.793324 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a3153f98970>]}
[0m17:01:24.795744 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.08s]
[0m17:01:24.798233 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.09s]
[0m17:01:24.801371 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:01:24.804274 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:01:24.808662 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:01:24.809813 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:01:24.810934 [debug] [MainThread]: On list__mart: Close
[0m17:01:24.812026 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:01:24.813106 [debug] [MainThread]: On list__clean: Close
[0m17:01:24.814149 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:01:24.815227 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:01:24.866328 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:01:24.867477 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:01:24.868594 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:01:24.869677 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:01:24.870719 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:01:24.871783 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:01:24.874042 [info ] [MainThread]: 
[0m17:01:24.875371 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.50 seconds (4.50s).
[0m17:01:24.883700 [debug] [MainThread]: Command end result
[0m17:01:25.084281 [info ] [MainThread]: 
[0m17:01:25.085159 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:01:25.085764 [info ] [MainThread]: 
[0m17:01:25.086358 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:01:25.087677 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.315574, "process_in_blocks": "0", "process_kernel_time": 0.68319, "process_mem_max_rss": "114868", "process_out_blocks": "9744", "process_user_time": 6.377105}
[0m17:01:25.088385 [debug] [MainThread]: Command `dbt build` succeeded at 17:01:25.088197 after 7.32 seconds
[0m17:01:25.088995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31587a0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31566bf4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31553c5310>]}
[0m17:01:25.089573 [debug] [MainThread]: Flushing usage events
[0m17:02:15.975660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea174e0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea1414bb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea1414b9d0>]}


============================== 17:02:15.985240 | 5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9 ==============================
[0m17:02:15.985240 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:02:15.986315 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'quiet': 'False', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'target_path': 'None', 'debug': 'False', 'log_format': 'default', 'log_path': '/workdir/transforms/04_btc/logs', 'indirect_selection': 'eager', 'invocation_command': 'dbt build --profiles-dir . --target local', 'empty': 'False', 'version_check': 'True', 'warn_error': 'None', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'write_json': 'True', 'use_colors': 'True', 'printer_width': '80', 'static_parser': 'True', 'cache_selected_only': 'False'}
[0m17:02:16.574767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea14019bb0>]}
[0m17:02:16.768412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea14222dc0>]}
[0m17:02:16.769741 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:02:17.182166 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:02:17.746440 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:02:17.747144 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:02:17.960682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea138b1e80>]}
[0m17:02:18.448572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea138c61f0>]}
[0m17:02:18.449418 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:02:18.452712 [info ] [MainThread]: 
[0m17:02:18.453728 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:02:18.465455 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:02:18.467024 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:02:18.573438 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:02:18.574929 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:02:19.246820 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:02:19.254988 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:19.257494 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:02:19.266152 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:19.364474 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:02:19.366004 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:02:19.381485 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:02:19.438721 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:02:19.449082 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:19.461274 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:19.473256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea1380f2b0>]}
[0m17:02:19.475193 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:02:19.476607 [info ] [MainThread]: 
[0m17:02:19.547776 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:02:19.548990 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:02:19.550129 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:02:19.550944 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:02:19.567953 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:02:19.569090 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:02:19.751351 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:02:19.816529 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:02:19.817913 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:02:19.830075 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:19.958592 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:02:19.962289 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:19.964231 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:02:19.967342 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:19.972969 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:02:19.975817 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:19.977689 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:02:19.980455 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:20.072198 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:02:20.075744 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:20.081654 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea12b4a310>]}
[0m17:02:20.082771 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m17:02:20.084132 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:02:20.086377 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:02:20.138469 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:02:20.088026 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:02:20.140820 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:02:20.142876 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:02:20.144929 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:02:20.147202 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:02:20.149401 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:02:20.151504 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:02:20.153338 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:02:20.155162 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:02:20.156454 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:02:20.275513 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:02:20.280641 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:02:20.282365 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:02:20.285134 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:02:20.338647 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:02:20.286683 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:02:20.557425 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:02:20.569673 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:02:20.580356 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:02:20.582197 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:02:20.583379 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:02:20.586822 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:02:20.815478 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:02:20.824148 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:02:20.839236 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:02:20.832068 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:20.842847 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:20.860798 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.71s]
[0m17:02:20.863935 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:20.869673 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.72s]
[0m17:02:20.872770 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:02:20.878625 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.73s]
[0m17:02:20.881496 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:02:20.884854 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:02:20.938828 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:02:20.940526 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:02:20.942375 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:02:20.944300 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:02:20.946464 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:02:20.948820 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:02:20.950729 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:02:20.952266 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:02:20.953862 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:02:20.955462 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:02:20.957104 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:02:20.958857 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:02:21.077181 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:02:21.138699 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:02:21.140382 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:02:21.143011 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:02:21.150266 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:02:21.243351 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:02:21.345262 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:02:21.373426 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:02:21.470464 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:02:21.568270 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:02:21.685860 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m17:02:21.750053 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:02:21.779624 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:21.869478 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:02:21.962136 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9` 
  ...
[0m17:02:21.969216 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9` 
  ...
[0m17:02:21.973414 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:21.981173 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:02:21.984196 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:22.045681 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:02:22.058792 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:02:22.162909 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:02:22.255235 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:02:22.279219 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea13629850>]}
[0m17:02:22.356218 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.31s]
[0m17:02:22.379889 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:02:22.546012 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:02:22.549028 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:02:22.779728 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.23 seconds
[0m17:02:22.794814 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.24 seconds
[0m17:02:22.819415 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:02:22.824305 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:02:22.837796 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:22.839302 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:22.845732 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:02:22.848570 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:02:22.850093 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:02:22.852056 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:02:22.867244 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:22.868512 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:22.871426 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9`)
      
    ...
[0m17:02:22.873799 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9`)
      
    ...
[0m17:02:22.895139 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:22.903461 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:02:22.906854 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:02:22.914327 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:02:22.939733 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:02:22.944003 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9` 
    ...
[0m17:02:22.948261 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:22.951385 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9` 
    ...
[0m17:02:22.953106 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:22.961430 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9` 
  ...
[0m17:02:22.965934 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:22.972918 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:22.976064 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:02:22.983519 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9` 
  ...
[0m17:02:22.987942 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:22.990131 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:23.040893 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea12b4a490>]}
[0m17:02:23.048555 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:02:23.050037 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.09s]
[0m17:02:23.053445 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:02:23.056096 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:23.059855 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea120f2a30>]}
[0m17:02:23.061023 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.11s]
[0m17:02:23.062311 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:02:23.064377 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:02:23.065057 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:02:23.065625 [debug] [MainThread]: On list__mart: Close
[0m17:02:23.066123 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:02:23.066648 [debug] [MainThread]: On list__clean: Close
[0m17:02:23.067142 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:02:23.067684 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:02:23.068168 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m17:02:23.068786 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m17:02:23.069271 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:02:23.069860 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:02:23.070341 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:02:23.070908 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:02:23.072132 [info ] [MainThread]: 
[0m17:02:23.072897 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.62 seconds (4.62s).
[0m17:02:23.076791 [debug] [MainThread]: Command end result
[0m17:02:23.238610 [info ] [MainThread]: 
[0m17:02:23.239584 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:02:23.240209 [info ] [MainThread]: 
[0m17:02:23.240867 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:02:23.242281 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.4588833, "process_in_blocks": "0", "process_kernel_time": 0.7261, "process_mem_max_rss": "115044", "process_out_blocks": "9752", "process_user_time": 6.320871}
[0m17:02:23.243089 [debug] [MainThread]: Command `dbt build` succeeded at 17:02:23.242893 after 7.46 seconds
[0m17:02:23.243753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea174e0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea137603d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea1236a5e0>]}
[0m17:02:23.244365 [debug] [MainThread]: Flushing usage events
