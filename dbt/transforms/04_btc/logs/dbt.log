[0m09:26:21.144511 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:26:21.148997 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:26:21.160255 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:26:21.193732 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:26:21.275930 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:26:21.472786 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:26:21.481829 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_8b3c85f6_0bc3_465e_bcde_98d8f8a441d8` 
  ...
[0m09:26:21.548530 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_8b3c85f6_0bc3_465e_bcde_98d8f8a441d8` 
  ...
[0m09:26:21.552119 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:26:21.553799 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:26:21.566198 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:26:21.673180 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:26:21.768830 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:26:21.785891 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:26:21.863620 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:26:21.971082 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:26:22.054837 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_8b3c85f6_0bc3_465e_bcde_98d8f8a441d8`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:26:22.056920 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_8b3c85f6_0bc3_465e_bcde_98d8f8a441d8`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:26:22.063686 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:26:22.069077 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:26:22.074741 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:26:22.140636 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:26:22.141791 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:26:22.143125 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:26:22.158945 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_8b3c85f6_0bc3_465e_bcde_98d8f8a441d8'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:26:22.163489 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_8b3c85f6_0bc3_465e_bcde_98d8f8a441d8'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:26:22.169017 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:26:22.171191 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:26:22.175442 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b3c85f6-0bc3-465e-bcde-98d8f8a441d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78621d1bf9d0>]}
[0m09:26:22.176952 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:26:22.184166 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:26:22.186169 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.11s]
[0m09:26:22.243768 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:26:22.247271 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:26:22.249828 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_8b3c85f6_0bc3_465e_bcde_98d8f8a441d8`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:26:22.254634 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_8b3c85f6_0bc3_465e_bcde_98d8f8a441d8`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:26:22.278190 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:26:22.279947 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:26:22.282493 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_8b3c85f6_0bc3_465e_bcde_98d8f8a441d8`)
      
    ...
[0m09:26:22.285005 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_8b3c85f6_0bc3_465e_bcde_98d8f8a441d8`)
      
    ...
[0m09:26:22.305328 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:26:22.306687 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:26:22.312625 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:26:22.317444 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:26:22.322285 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:26:22.341368 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:26:22.345965 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_8b3c85f6_0bc3_465e_bcde_98d8f8a441d8` 
    ...
[0m09:26:22.352075 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_8b3c85f6_0bc3_465e_bcde_98d8f8a441d8` 
    ...
[0m09:26:22.362259 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:26:22.369985 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:26:22.382431 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_8b3c85f6_0bc3_465e_bcde_98d8f8a441d8` 
  ...
[0m09:26:22.390496 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_8b3c85f6_0bc3_465e_bcde_98d8f8a441d8` 
  ...
[0m09:26:22.440381 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:26:22.457179 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:26:22.455393 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:26:22.471816 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:26:22.476062 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:26:22.483829 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:26:22.539988 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b3c85f6-0bc3-465e-bcde-98d8f8a441d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78621bf953a0>]}
[0m09:26:22.543893 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b3c85f6-0bc3-465e-bcde-98d8f8a441d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78621d28eb80>]}
[0m09:26:22.546208 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.42s]
[0m09:26:22.548820 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.48s]
[0m09:26:22.551803 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:26:22.554787 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:26:22.559568 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:26:22.560766 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:26:22.561958 [debug] [MainThread]: On list__mart: Close
[0m09:26:22.563039 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:26:22.564203 [debug] [MainThread]: On list__clean: Close
[0m09:26:22.565257 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:26:22.566405 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:26:22.567525 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:26:22.568667 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:26:22.569801 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m09:26:22.570991 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m09:26:22.572080 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:26:22.573169 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:26:22.576351 [info ] [MainThread]: 
[0m09:26:22.578590 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.92 seconds (3.92s).
[0m09:26:22.586705 [debug] [MainThread]: Command end result
[0m09:26:22.778926 [info ] [MainThread]: 
[0m09:26:22.779802 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:26:22.780471 [info ] [MainThread]: 
[0m09:26:22.781213 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:26:22.782549 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.7039747, "process_in_blocks": "576", "process_kernel_time": 0.680759, "process_mem_max_rss": "114868", "process_out_blocks": "9752", "process_user_time": 6.035005}
[0m09:26:22.783286 [debug] [MainThread]: Command `dbt build` succeeded at 09:26:22.783089 after 6.70 seconds
[0m09:26:22.783939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786221127e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78621d3a6b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78621efaf040>]}
[0m09:26:22.784568 [debug] [MainThread]: Flushing usage events
[0m09:27:15.900340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cb7717f4d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cb76e454c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cb76e454ac0>]}


============================== 09:27:15.910306 | 22948ae0-c568-4956-a505-6958a7f593da ==============================
[0m09:27:15.910306 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:27:15.911373 [debug] [MainThread]: running dbt with arguments {'log_path': '/workdir/transforms/04_btc/logs', 'invocation_command': 'dbt build --profiles-dir . --target local', 'empty': 'False', 'printer_width': '80', 'indirect_selection': 'eager', 'no_print': 'None', 'write_json': 'True', 'fail_fast': 'False', 'introspect': 'True', 'static_parser': 'True', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '.', 'version_check': 'True', 'warn_error': 'None', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'quiet': 'False', 'log_format': 'default', 'debug': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'cache_selected_only': 'False'}
[0m09:27:16.491146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '22948ae0-c568-4956-a505-6958a7f593da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cb770cec820>]}
[0m09:27:16.686432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '22948ae0-c568-4956-a505-6958a7f593da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cb76ee6e280>]}
[0m09:27:16.687744 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:27:17.174864 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:27:17.689556 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:27:17.690235 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:27:17.892020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '22948ae0-c568-4956-a505-6958a7f593da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cb76dbb2130>]}
[0m09:27:18.336378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '22948ae0-c568-4956-a505-6958a7f593da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cb76dbdb460>]}
[0m09:27:18.373258 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:27:18.376584 [info ] [MainThread]: 
[0m09:27:18.377614 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:27:18.389008 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:27:18.390522 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:27:18.473162 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:27:18.475242 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:27:19.314718 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:27:19.321700 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:27:19.328684 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:27:19.343666 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:27:19.408874 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:27:19.415111 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:27:19.484384 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:27:19.488323 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:27:19.497405 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:27:19.507391 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:27:19.573505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '22948ae0-c568-4956-a505-6958a7f593da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cb76db19790>]}
[0m09:27:19.575596 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:27:19.576942 [info ] [MainThread]: 
[0m09:27:19.603900 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:27:19.604992 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:27:19.606088 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:27:19.606831 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:27:19.673501 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:27:19.675100 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:27:19.876525 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:27:19.943976 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:27:19.945697 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:27:19.960345 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:27:20.100777 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:27:20.104755 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:27:20.106643 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:27:20.109511 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:27:20.115722 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:27:20.118851 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:27:20.120731 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:27:20.123739 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:27:20.219345 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:27:20.222785 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:27:20.278017 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22948ae0-c568-4956-a505-6958a7f593da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cb76cf45850>]}
[0m09:27:20.279283 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.67s]
[0m09:27:20.280693 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:27:20.282922 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:27:20.284265 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:27:20.285835 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:27:20.287270 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:27:20.289441 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:27:20.291022 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:27:20.292692 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:27:20.294664 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:27:20.296177 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:27:20.297382 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:27:20.299037 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:27:20.300252 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:27:20.495201 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:27:20.499400 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:27:20.500822 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:27:20.503767 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:27:20.510587 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:27:20.512157 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:27:20.875459 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:27:20.878860 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:27:20.885824 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:27:20.887880 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:27:20.889629 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:27:20.891462 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:27:21.088978 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:27:21.108308 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:27:21.125964 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.83s]
[0m09:27:21.129159 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:27:21.174150 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:27:21.180859 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:27:21.189642 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:27:21.196205 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.90s]
[0m09:27:21.199499 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:27:21.202410 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:27:21.208378 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.91s]
[0m09:27:21.211942 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:27:21.214704 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:27:21.215997 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:27:21.217505 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:27:21.218798 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:27:21.221000 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:27:21.222592 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:27:21.224376 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:27:21.274201 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:27:21.275909 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:27:21.277654 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:27:21.279481 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:27:21.301923 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:27:21.376138 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:27:21.391938 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:27:21.409047 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:27:21.412050 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:27:21.418983 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:27:21.501143 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:27:21.605832 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:27:21.683854 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:27:21.784253 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:27:21.884158 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:27:22.015954 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m09:27:22.102689 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:27:22.174227 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:27:22.304043 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:27:22.374966 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_22948ae0_c568_4956_a505_6958a7f593da` 
  ...
[0m09:27:22.387719 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_22948ae0_c568_4956_a505_6958a7f593da` 
  ...
[0m09:27:22.393162 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:27:22.398382 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:27:22.402909 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:27:22.405513 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:27:22.490002 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:27:22.616379 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:27:22.616013 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_22948ae0_c568_4956_a505_6958a7f593da`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:27:22.676985 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_22948ae0_c568_4956_a505_6958a7f593da`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:27:22.683635 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:27:22.690813 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22948ae0-c568-4956-a505-6958a7f593da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cb76c7d6f40>]}
[0m09:27:22.693284 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.41s]
[0m09:27:22.694813 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:27:22.713865 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:27:22.730070 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:27:22.803427 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_22948ae0_c568_4956_a505_6958a7f593da'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:27:22.812215 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_22948ae0_c568_4956_a505_6958a7f593da'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:27:22.821230 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:27:22.874462 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:27:22.887370 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:27:22.893761 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:27:22.896962 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_22948ae0_c568_4956_a505_6958a7f593da`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:27:22.899186 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_22948ae0_c568_4956_a505_6958a7f593da`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:27:22.928237 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:27:22.930853 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:27:22.934858 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_22948ae0_c568_4956_a505_6958a7f593da`)
      
    ...
[0m09:27:22.939045 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_22948ae0_c568_4956_a505_6958a7f593da`)
      
    ...
[0m09:27:23.001140 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:27:23.016262 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:27:23.014688 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:27:23.027373 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:27:23.036762 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:27:23.044684 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:27:23.042644 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_22948ae0_c568_4956_a505_6958a7f593da` 
    ...
[0m09:27:23.076793 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_22948ae0_c568_4956_a505_6958a7f593da` 
    ...
[0m09:27:23.088862 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:27:23.096666 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:27:23.104143 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_22948ae0_c568_4956_a505_6958a7f593da` 
  ...
[0m09:27:23.116676 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_22948ae0_c568_4956_a505_6958a7f593da` 
  ...
[0m09:27:23.122980 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:27:23.177912 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:27:23.191066 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:27:23.201242 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:27:23.206216 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:27:23.208877 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:27:23.215894 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22948ae0-c568-4956-a505-6958a7f593da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cb76cf45b50>]}
[0m09:27:23.273242 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22948ae0-c568-4956-a505-6958a7f593da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cb76c7de610>]}
[0m09:27:23.275841 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.99s]
[0m09:27:23.278581 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.00s]
[0m09:27:23.281697 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:27:23.284664 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:27:23.289041 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:27:23.290254 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:27:23.291481 [debug] [MainThread]: On list__clean: Close
[0m09:27:23.292616 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:27:23.293717 [debug] [MainThread]: On list__mart: Close
[0m09:27:23.294807 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:27:23.296032 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:27:23.297068 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:27:23.298158 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:27:23.299218 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m09:27:23.300411 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m09:27:23.301501 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:27:23.302652 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:27:23.304855 [info ] [MainThread]: 
[0m09:27:23.306214 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.93 seconds (4.93s).
[0m09:27:23.314295 [debug] [MainThread]: Command end result
[0m09:27:23.513885 [info ] [MainThread]: 
[0m09:27:23.515070 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:27:23.515975 [info ] [MainThread]: 
[0m09:27:23.516963 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:27:23.518909 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.8134804, "process_in_blocks": "0", "process_kernel_time": 0.738371, "process_mem_max_rss": "115008", "process_out_blocks": "9744", "process_user_time": 6.590137}
[0m09:27:23.520009 [debug] [MainThread]: Command `dbt build` succeeded at 09:27:23.519726 after 7.81 seconds
[0m09:27:23.520918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cb7717f4d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cb76ee9cb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cb76dac76d0>]}
[0m09:27:23.521779 [debug] [MainThread]: Flushing usage events
[0m09:28:16.379000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf1c5f7f310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf1c2bd4b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf1c2bd4a00>]}


============================== 09:28:16.388051 | 179abcd1-47d5-4840-99b6-4a25c62ee4a3 ==============================
[0m09:28:16.388051 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:28:16.389153 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'write_json': 'True', 'cache_selected_only': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'static_parser': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'debug': 'False', 'printer_width': '80', 'no_print': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'empty': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '.', 'use_colors': 'True', 'quiet': 'False', 'version_check': 'True'}
[0m09:28:16.974656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '179abcd1-47d5-4840-99b6-4a25c62ee4a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf1c5508850>]}
[0m09:28:17.168352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '179abcd1-47d5-4840-99b6-4a25c62ee4a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf1c2b9d850>]}
[0m09:28:17.169694 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:28:17.588162 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:28:18.091514 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:28:18.092171 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:28:18.297424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '179abcd1-47d5-4840-99b6-4a25c62ee4a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf1c233deb0>]}
[0m09:28:18.805234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '179abcd1-47d5-4840-99b6-4a25c62ee4a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf1c2352a00>]}
[0m09:28:18.806140 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:28:18.809383 [info ] [MainThread]: 
[0m09:28:18.810450 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:28:18.822192 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:28:18.823794 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:28:18.982981 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:28:18.987516 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:28:19.797990 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:28:19.804915 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:28:19.810905 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:28:19.820804 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:28:19.862550 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:28:19.874400 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:28:19.875579 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:28:19.879768 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:28:19.886514 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:28:19.887804 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:28:19.901007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '179abcd1-47d5-4840-99b6-4a25c62ee4a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf1c2b0f3a0>]}
[0m09:28:19.902005 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:28:19.902639 [info ] [MainThread]: 
[0m09:28:19.968665 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:28:19.969837 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:28:19.970927 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:28:19.971701 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:28:19.989618 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:28:19.990935 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:28:20.161232 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:28:20.217382 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:28:20.218872 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:28:20.229654 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:28:20.375207 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:28:20.378308 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:28:20.380429 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:28:20.383194 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:28:20.389448 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:28:20.392316 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:28:20.394449 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:28:20.397096 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:28:20.493226 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:28:20.496240 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:28:20.502326 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '179abcd1-47d5-4840-99b6-4a25c62ee4a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf1c15d9190>]}
[0m09:28:20.503562 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m09:28:20.504914 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:28:20.506467 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:28:20.507359 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:28:20.508117 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:28:20.509041 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:28:20.509904 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:28:20.510974 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:28:20.560835 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:28:20.562438 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:28:20.563599 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:28:20.565016 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:28:20.566314 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:28:20.588026 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:28:20.592705 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:28:20.600439 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:28:20.661441 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:28:20.663018 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:28:20.664091 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:28:20.695878 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:28:20.888433 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:28:20.890164 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:28:20.965982 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:28:20.967919 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:28:20.970726 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:28:20.975102 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:28:21.228789 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:28:21.243257 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:28:21.270751 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.76s]
[0m09:28:21.276084 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:28:21.278905 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:28:21.281701 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:28:21.296750 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:28:21.303116 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.74s]
[0m09:28:21.305982 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:28:21.308840 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:28:21.360876 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.75s]
[0m09:28:21.364383 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:28:21.367207 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:28:21.368374 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:28:21.369899 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:28:21.371090 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:28:21.373237 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:28:21.374863 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:28:21.376679 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:28:21.378617 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:28:21.380499 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:28:21.382043 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:28:21.383719 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:28:21.461115 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:28:21.480975 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:28:21.498526 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:28:21.560777 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:28:21.563380 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:28:21.564064 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:28:21.681863 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:28:21.772900 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:28:21.796083 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:28:21.967269 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m09:28:22.081764 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:28:22.162080 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:28:22.186226 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:28:22.266035 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_179abcd1_47d5_4840_99b6_4a25c62ee4a3` 
  ...
[0m09:28:22.274666 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_179abcd1_47d5_4840_99b6_4a25c62ee4a3` 
  ...
[0m09:28:22.277331 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:28:22.279875 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:28:22.285886 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:28:22.305046 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:28:22.374764 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:28:22.384199 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:28:22.469176 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:28:22.577459 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:28:22.676138 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_179abcd1_47d5_4840_99b6_4a25c62ee4a3`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:28:22.674185 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_179abcd1_47d5_4840_99b6_4a25c62ee4a3`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:28:22.682065 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:28:22.689490 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '179abcd1-47d5-4840-99b6-4a25c62ee4a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf1c1ee1bb0>]}
[0m09:28:22.691924 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.31s]
[0m09:28:22.696088 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:28:22.709738 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:28:22.766277 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:28:22.778657 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_179abcd1_47d5_4840_99b6_4a25c62ee4a3'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:28:22.784544 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_179abcd1_47d5_4840_99b6_4a25c62ee4a3'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:28:22.789813 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:28:22.791038 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:28:22.797130 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:28:22.799877 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:28:22.802379 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_179abcd1_47d5_4840_99b6_4a25c62ee4a3`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:28:22.805007 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_179abcd1_47d5_4840_99b6_4a25c62ee4a3`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:28:22.862034 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:28:22.823129 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:28:22.866494 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_179abcd1_47d5_4840_99b6_4a25c62ee4a3`)
      
    ...
[0m09:28:22.870475 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_179abcd1_47d5_4840_99b6_4a25c62ee4a3`)
      
    ...
[0m09:28:22.900970 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:28:22.917036 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:28:22.915162 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:28:22.928024 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:28:22.962279 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:28:22.968874 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_179abcd1_47d5_4840_99b6_4a25c62ee4a3` 
    ...
[0m09:28:22.971772 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:28:22.979152 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_179abcd1_47d5_4840_99b6_4a25c62ee4a3` 
    ...
[0m09:28:22.983790 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:28:22.996881 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:28:22.998981 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_179abcd1_47d5_4840_99b6_4a25c62ee4a3` 
  ...
[0m09:28:23.061765 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_179abcd1_47d5_4840_99b6_4a25c62ee4a3` 
  ...
[0m09:28:23.069237 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:28:23.076858 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:28:23.088931 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:28:23.097888 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:28:23.102656 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:28:23.108923 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '179abcd1-47d5-4840-99b6-4a25c62ee4a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf1c20c4280>]}
[0m09:28:23.162049 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.73s]
[0m09:28:23.111286 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:28:23.165964 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:28:23.173487 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '179abcd1-47d5-4840-99b6-4a25c62ee4a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf1c2bc43d0>]}
[0m09:28:23.177007 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.80s]
[0m09:28:23.180400 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:28:23.184450 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:28:23.185644 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:28:23.186601 [debug] [MainThread]: On list__mart: Close
[0m09:28:23.187439 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:28:23.188342 [debug] [MainThread]: On list__clean: Close
[0m09:28:23.189639 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:28:23.190722 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:28:23.191599 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:28:23.192459 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:28:23.193372 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m09:28:23.194472 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m09:28:23.195565 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:28:23.196919 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:28:23.199229 [info ] [MainThread]: 
[0m09:28:23.200727 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.39 seconds (4.39s).
[0m09:28:23.260822 [debug] [MainThread]: Command end result
[0m09:28:23.478384 [info ] [MainThread]: 
[0m09:28:23.480130 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:28:23.481416 [info ] [MainThread]: 
[0m09:28:23.482793 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:28:23.485411 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.2997575, "process_in_blocks": "0", "process_kernel_time": 0.723908, "process_mem_max_rss": "114568", "process_out_blocks": "9744", "process_user_time": 6.284711}
[0m09:28:23.487133 [debug] [MainThread]: Command `dbt build` succeeded at 09:28:23.486725 after 7.30 seconds
[0m09:28:23.488434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf1c5f7f310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf1c35240a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf1c5508850>]}
[0m09:28:23.489739 [debug] [MainThread]: Flushing usage events
[0m09:29:16.199979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75913f96b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75913c5d8b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75913c5d8a00>]}


============================== 09:29:16.209969 | 7563d7c9-b5ff-4043-b92d-b97c17275fa4 ==============================
[0m09:29:16.209969 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:29:16.211044 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt build --profiles-dir . --target local', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'partial_parse': 'True', 'quiet': 'False', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'debug': 'False', 'version_check': 'True', 'printer_width': '80', 'warn_error': 'None', 'log_cache_events': 'False', 'empty': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'cache_selected_only': 'False', 'log_format': 'default', 'profiles_dir': '.', 'no_print': 'None', 'use_experimental_parser': 'False', 'indirect_selection': 'eager'}
[0m09:29:16.806970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7563d7c9-b5ff-4043-b92d-b97c17275fa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75913c52cfa0>]}
[0m09:29:17.005059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7563d7c9-b5ff-4043-b92d-b97c17275fa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75913c59c3d0>]}
[0m09:29:17.006507 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:29:17.429329 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:29:17.986072 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:29:17.986759 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:29:18.192111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7563d7c9-b5ff-4043-b92d-b97c17275fa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75913bd2ae80>]}
[0m09:29:18.636884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7563d7c9-b5ff-4043-b92d-b97c17275fa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75913bd3f670>]}
[0m09:29:18.637738 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:29:18.640887 [info ] [MainThread]: 
[0m09:29:18.641911 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:29:18.690910 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:29:18.692610 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:29:18.793832 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:29:18.807718 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:29:19.557187 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:29:19.562739 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:29:19.594191 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:29:19.611056 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:29:19.698180 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:29:19.699773 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:29:19.715725 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:29:19.720737 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:29:19.731285 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:29:19.733456 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:29:19.806796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7563d7c9-b5ff-4043-b92d-b97c17275fa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75913bc88880>]}
[0m09:29:19.808730 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:29:19.810101 [info ] [MainThread]: 
[0m09:29:19.835119 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:29:19.885777 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:29:19.887378 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:29:19.888471 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:29:19.913384 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:29:19.914888 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:29:20.107962 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:29:20.166984 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:29:20.169022 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:29:20.194067 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:29:20.324716 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:29:20.328122 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:29:20.330152 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:29:20.333249 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:29:20.387039 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:29:20.390485 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:29:20.392494 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:29:20.395464 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:29:20.489486 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:29:20.493255 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:29:20.499412 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7563d7c9-b5ff-4043-b92d-b97c17275fa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75913afae970>]}
[0m09:29:20.500590 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m09:29:20.501894 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:29:20.504459 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:29:20.506262 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:29:20.508133 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:29:20.510047 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:29:20.511910 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:29:20.514179 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:29:20.516093 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:29:20.517797 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:29:20.518943 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:29:20.521072 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:29:20.522470 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:29:20.590620 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:29:20.704027 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:29:20.693694 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:29:20.717192 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:29:20.719750 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:29:20.790495 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:29:20.797464 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:29:20.984886 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:29:20.986969 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:29:21.011978 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:29:21.014821 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:29:21.018082 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:29:21.021620 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:29:21.319303 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:29:21.333403 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:29:21.336664 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:29:21.386292 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:29:21.387656 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.83s]
[0m09:29:21.392400 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:29:21.395209 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:29:21.401687 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.89s]
[0m09:29:21.405445 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:29:21.410361 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:29:21.417451 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.90s]
[0m09:29:21.420430 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:29:21.422937 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:29:21.424270 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:29:21.426040 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:29:21.428203 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:29:21.430388 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:29:21.432770 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:29:21.434633 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:29:21.436198 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:29:21.486228 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:29:21.488038 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:29:21.489819 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:29:21.491550 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:29:21.607733 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:29:21.690302 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:29:21.697487 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:29:21.703905 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:29:21.714081 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:29:21.716451 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:29:21.718889 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:29:21.731091 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:29:21.823925 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:29:21.918076 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:29:22.009057 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:29:22.018511 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:29:22.096770 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:29:22.191050 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:29:22.316765 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:29:22.392920 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:29:22.496649 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:29:22.608594 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:29:22.702091 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_7563d7c9_b5ff_4043_b92d_b97c17275fa4` 
  ...
[0m09:29:22.703683 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_7563d7c9_b5ff_4043_b92d_b97c17275fa4` 
  ...
[0m09:29:22.706643 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:29:22.715415 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7563d7c9-b5ff-4043-b92d-b97c17275fa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75913a921610>]}
[0m09:29:22.717938 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.23s]
[0m09:29:22.720619 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:29:22.723160 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:29:22.725946 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:29:23.011355 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_7563d7c9_b5ff_4043_b92d_b97c17275fa4`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:29:23.012192 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_7563d7c9_b5ff_4043_b92d_b97c17275fa4`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:29:23.036604 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:29:23.051410 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:29:23.092757 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_7563d7c9_b5ff_4043_b92d_b97c17275fa4'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:29:23.094412 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_7563d7c9_b5ff_4043_b92d_b97c17275fa4'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:29:23.100788 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:29:23.102839 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:29:23.109713 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:29:23.114425 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:29:23.116763 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_7563d7c9_b5ff_4043_b92d_b97c17275fa4`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:29:23.118495 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_7563d7c9_b5ff_4043_b92d_b97c17275fa4`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:29:23.136658 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:29:23.138244 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:29:23.140573 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_7563d7c9_b5ff_4043_b92d_b97c17275fa4`)
      
    ...
[0m09:29:23.143445 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_7563d7c9_b5ff_4043_b92d_b97c17275fa4`)
      
    ...
[0m09:29:23.162962 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:29:23.185834 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:29:23.191445 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:29:23.198506 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:29:23.204346 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:29:23.207268 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_7563d7c9_b5ff_4043_b92d_b97c17275fa4` 
    ...
[0m09:29:23.208280 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:29:23.211800 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_7563d7c9_b5ff_4043_b92d_b97c17275fa4` 
    ...
[0m09:29:23.217028 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:29:23.218652 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:29:23.224781 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_7563d7c9_b5ff_4043_b92d_b97c17275fa4` 
  ...
[0m09:29:23.230853 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_7563d7c9_b5ff_4043_b92d_b97c17275fa4` 
  ...
[0m09:29:23.234241 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:29:23.285492 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:29:23.289978 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:29:23.296256 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:29:23.299477 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:29:23.302717 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7563d7c9-b5ff-4043-b92d-b97c17275fa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75913bab6b20>]}
[0m09:29:23.304001 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.87s]
[0m09:29:23.305649 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:29:23.307254 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:29:23.310423 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7563d7c9-b5ff-4043-b92d-b97c17275fa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75913b8fdca0>]}
[0m09:29:23.312231 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.88s]
[0m09:29:23.314232 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:29:23.316596 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:29:23.317158 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:29:23.317711 [debug] [MainThread]: On list__clean: Close
[0m09:29:23.318188 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:29:23.318710 [debug] [MainThread]: On list__mart: Close
[0m09:29:23.319175 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:29:23.319681 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:29:23.320148 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:29:23.320683 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:29:23.321143 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m09:29:23.321681 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m09:29:23.322130 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:29:23.322681 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:29:23.323801 [info ] [MainThread]: 
[0m09:29:23.324442 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.68 seconds (4.68s).
[0m09:29:23.328171 [debug] [MainThread]: Command end result
[0m09:29:23.486191 [info ] [MainThread]: 
[0m09:29:23.487044 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:29:23.487623 [info ] [MainThread]: 
[0m09:29:23.488236 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:29:23.489544 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.4854293, "process_in_blocks": "0", "process_kernel_time": 0.703415, "process_mem_max_rss": "115300", "process_out_blocks": "9752", "process_user_time": 6.318952}
[0m09:29:23.490276 [debug] [MainThread]: Command `dbt build` succeeded at 09:29:23.490086 after 7.49 seconds
[0m09:29:23.490885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75913f96b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75913d885160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75913a7954c0>]}
[0m09:29:23.491457 [debug] [MainThread]: Flushing usage events
[0m09:30:16.986641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba992460310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba98f0b8b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba98f0b89d0>]}


============================== 09:30:16.995978 | 2f38c319-18e5-4e22-be78-4579145f77d8 ==============================
[0m09:30:16.995978 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:30:16.997034 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'log_format': 'default', 'version_check': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'introspect': 'True', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'static_parser': 'True', 'fail_fast': 'False', 'empty': 'False', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'debug': 'False', 'target_path': 'None', 'no_print': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'quiet': 'False', 'partial_parse': 'True', 'write_json': 'True', 'use_colors': 'True'}
[0m09:30:17.524427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2f38c319-18e5-4e22-be78-4579145f77d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba98f520550>]}
[0m09:30:17.715225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2f38c319-18e5-4e22-be78-4579145f77d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba98efb3f40>]}
[0m09:30:17.716489 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:30:18.186084 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:30:18.687278 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:30:18.688019 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:30:18.894843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2f38c319-18e5-4e22-be78-4579145f77d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba98e81eee0>]}
[0m09:30:19.382500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2f38c319-18e5-4e22-be78-4579145f77d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba98e808280>]}
[0m09:30:19.383435 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:30:19.386770 [info ] [MainThread]: 
[0m09:30:19.388176 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:30:19.399951 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:30:19.400943 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:30:19.428353 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:30:19.487502 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:30:19.920155 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:30:19.928703 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:19.930354 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:30:19.950855 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:30:20.014363 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:30:20.020951 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:30:20.089023 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:30:20.092004 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:30:20.102290 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:20.107321 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:20.132432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2f38c319-18e5-4e22-be78-4579145f77d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba98e5ba700>]}
[0m09:30:20.181781 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:30:20.183117 [info ] [MainThread]: 
[0m09:30:20.209819 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:30:20.211416 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:30:20.212897 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:30:20.213944 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:30:20.287626 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:30:20.289316 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:30:20.429377 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:30:20.543904 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:30:20.545284 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:30:20.556985 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:20.633048 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:30:20.684171 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:30:20.686163 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:30:20.689336 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:30:20.695408 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:30:20.698962 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:30:20.700931 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:30:20.703787 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:30:20.794412 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:30:20.798034 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:30:20.805526 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f38c319-18e5-4e22-be78-4579145f77d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba98daa9c70>]}
[0m09:30:20.806961 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m09:30:20.808415 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:30:20.810407 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:30:20.811428 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:30:20.812786 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:30:20.814437 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:30:20.816198 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:30:20.817671 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:30:20.818779 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:30:20.820057 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:30:20.821711 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:30:20.822972 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:30:20.824352 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:30:20.825481 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:30:21.015411 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:30:21.017531 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:30:21.026041 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:30:21.081689 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:30:21.028833 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:30:21.094737 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:30:21.409841 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:30:21.414610 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:30:21.417110 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:30:21.419704 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:30:21.423655 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:30:21.427723 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:30:21.697599 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:30:21.713753 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:21.728627 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.91s]
[0m09:30:21.735140 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:30:21.737515 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:30:21.789637 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:30:21.791842 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:21.800827 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:21.798210 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.98s]
[0m09:30:21.805253 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.99s]
[0m09:30:21.806759 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:30:21.808139 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:30:21.809889 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:30:21.810724 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:30:21.811666 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:30:21.812515 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:30:21.813468 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:30:21.814380 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:30:21.815500 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:30:21.817427 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:30:21.818697 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:30:21.819839 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:30:21.820840 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:30:21.892133 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:30:21.905545 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:30:21.981730 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:30:21.989920 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:30:21.992662 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:30:22.015420 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:30:22.089131 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:30:22.112694 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:30:22.217847 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:30:22.391992 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m09:30:22.496847 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:30:22.588204 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:30:22.603071 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:30:22.705363 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:30:22.805977 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:30:22.889078 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_2f38c319_18e5_4e22_be78_4579145f77d8` 
  ...
[0m09:30:22.890935 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:30:22.905636 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:22.924869 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:30:22.982471 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_2f38c319_18e5_4e22_be78_4579145f77d8` 
  ...
[0m09:30:23.087757 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:30:23.118107 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:30:23.199136 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:30:23.204413 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_2f38c319_18e5_4e22_be78_4579145f77d8`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:30:23.214029 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_2f38c319_18e5_4e22_be78_4579145f77d8`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:30:23.221699 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:30:23.282770 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:30:23.285890 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f38c319-18e5-4e22-be78-4579145f77d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba98d4455b0>]}
[0m09:30:23.288478 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:30:23.301368 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.47s]
[0m09:30:23.326381 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_2f38c319_18e5_4e22_be78_4579145f77d8'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:30:23.389047 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_2f38c319_18e5_4e22_be78_4579145f77d8'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:30:23.392202 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:30:23.403316 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:23.406948 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:23.416121 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:30:23.419220 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:30:23.420813 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_2f38c319_18e5_4e22_be78_4579145f77d8`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:30:23.423437 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_2f38c319_18e5_4e22_be78_4579145f77d8`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:30:23.437114 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:30:23.438572 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:23.440461 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_2f38c319_18e5_4e22_be78_4579145f77d8`)
      
    ...
[0m09:30:23.442382 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_2f38c319_18e5_4e22_be78_4579145f77d8`)
      
    ...
[0m09:30:23.481493 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:30:23.484144 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:30:23.493863 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:30:23.505836 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:30:23.515738 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:23.518586 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:23.524401 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_2f38c319_18e5_4e22_be78_4579145f77d8` 
    ...
[0m09:30:23.530306 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_2f38c319_18e5_4e22_be78_4579145f77d8` 
    ...
[0m09:30:23.589282 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:30:23.597206 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:23.609371 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_2f38c319_18e5_4e22_be78_4579145f77d8` 
  ...
[0m09:30:23.617855 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_2f38c319_18e5_4e22_be78_4579145f77d8` 
  ...
[0m09:30:23.622266 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:23.630212 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:23.691264 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:30:23.698516 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:30:23.704508 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:30:23.712257 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:30:23.713612 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f38c319-18e5-4e22-be78-4579145f77d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba98d0a7100>]}
[0m09:30:23.719831 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f38c319-18e5-4e22-be78-4579145f77d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba98d4450a0>]}
[0m09:30:23.722432 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.90s]
[0m09:30:23.725168 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.90s]
[0m09:30:23.728402 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:30:23.782008 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:30:23.786732 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:30:23.787484 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:30:23.788245 [debug] [MainThread]: On list__clean: Close
[0m09:30:23.788960 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:30:23.789683 [debug] [MainThread]: On list__mart: Close
[0m09:30:23.790339 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:30:23.791090 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:30:23.791817 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:30:23.792521 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:30:23.793227 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m09:30:23.793990 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m09:30:23.794695 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:30:23.795414 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:30:23.796974 [info ] [MainThread]: 
[0m09:30:23.797854 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.41 seconds (4.41s).
[0m09:30:23.803048 [debug] [MainThread]: Command end result
[0m09:30:23.927691 [info ] [MainThread]: 
[0m09:30:23.928551 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:30:23.929154 [info ] [MainThread]: 
[0m09:30:23.929779 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:30:23.981708 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.1910195, "process_in_blocks": "0", "process_kernel_time": 0.712963, "process_mem_max_rss": "114348", "process_out_blocks": "9744", "process_user_time": 6.273884}
[0m09:30:23.983444 [debug] [MainThread]: Command `dbt build` succeeded at 09:30:23.983021 after 7.19 seconds
[0m09:30:23.984873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba992460310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba98f520550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba98efb3f40>]}
[0m09:30:23.986212 [debug] [MainThread]: Flushing usage events
[0m09:31:16.060888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db3e1d2310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db3ae3db80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db3ae3da30>]}


============================== 09:31:16.070197 | 95cc785d-9205-41bc-8802-e1b418a072f0 ==============================
[0m09:31:16.070197 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:31:16.071298 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error': 'None', 'write_json': 'True', 'introspect': 'True', 'empty': 'False', 'partial_parse': 'True', 'debug': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_cache_events': 'False', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'use_colors': 'True', 'quiet': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'fail_fast': 'False', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'profiles_dir': '.'}
[0m09:31:16.651007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '95cc785d-9205-41bc-8802-e1b418a072f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db3d778b80>]}
[0m09:31:16.846930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '95cc785d-9205-41bc-8802-e1b418a072f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db3ae193d0>]}
[0m09:31:16.848212 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:31:17.271099 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:31:17.773810 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:31:17.774424 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:31:18.030976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '95cc785d-9205-41bc-8802-e1b418a072f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db3a5a9e80>]}
[0m09:31:18.532523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '95cc785d-9205-41bc-8802-e1b418a072f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db3a5be8b0>]}
[0m09:31:18.533451 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:31:18.536895 [info ] [MainThread]: 
[0m09:31:18.538037 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:31:18.551530 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:31:18.552600 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:31:18.629173 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:31:18.631931 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:31:19.089725 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:31:19.097214 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:31:19.098218 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:31:19.103112 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:31:19.154601 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:31:19.155592 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:31:19.168912 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:31:19.173061 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:31:19.181419 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:31:19.238315 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:31:19.246072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '95cc785d-9205-41bc-8802-e1b418a072f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db3a5072b0>]}
[0m09:31:19.247615 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:31:19.248513 [info ] [MainThread]: 
[0m09:31:19.267356 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:31:19.269202 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:31:19.270335 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:31:19.271146 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:31:19.340223 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:31:19.342110 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:31:19.468349 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:31:19.570710 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:31:19.572166 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:31:19.582000 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:31:19.675765 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:31:19.728623 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:31:19.730757 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:31:19.733438 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:31:19.739311 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:31:19.742123 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:31:19.744241 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:31:19.746981 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:31:19.845694 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:31:19.848798 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:31:19.857036 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95cc785d-9205-41bc-8802-e1b418a072f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db3d6f5c40>]}
[0m09:31:19.858322 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m09:31:19.859832 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:31:19.862379 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:31:19.863284 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:31:19.864231 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:31:19.865031 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:31:19.866017 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:31:19.866985 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:31:19.868125 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:31:19.869174 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:31:19.870191 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:31:19.871005 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:31:19.871795 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:31:19.872618 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:31:19.954393 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:31:19.952822 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:31:19.961685 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:31:19.963143 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:31:19.963815 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:31:20.042036 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:31:20.064992 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:31:20.127362 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:31:20.131067 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:31:20.132927 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:31:20.133847 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:31:20.135978 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:31:20.322569 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:31:20.330795 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:31:20.332768 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:31:20.343704 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.48s]
[0m09:31:20.345196 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:31:20.346633 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:31:20.347934 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:31:20.353299 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.48s]
[0m09:31:20.354864 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:31:20.356584 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:31:20.359484 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.49s]
[0m09:31:20.360900 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:31:20.362384 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:31:20.363322 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:31:20.364248 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:31:20.365340 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:31:20.366373 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:31:20.367418 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:31:20.368445 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:31:20.369519 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:31:20.370352 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:31:20.371387 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:31:20.372471 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:31:20.373292 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:31:20.550295 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:31:20.564926 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:31:20.566939 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:31:20.569571 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:31:20.571139 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:31:20.637181 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:31:20.728433 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:31:20.771364 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:31:20.932860 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:31:21.032991 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:31:21.133120 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:31:21.238858 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:31:21.271306 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_95cc785d_9205_41bc_8802_e1b418a072f0` 
  ...
[0m09:31:21.358066 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:31:21.355977 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_95cc785d_9205_41bc_8802_e1b418a072f0` 
  ...
[0m09:31:21.361410 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:31:21.373634 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:31:21.450416 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:31:21.542120 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:31:21.556522 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:31:21.658362 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:31:21.765745 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:31:21.838301 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_95cc785d_9205_41bc_8802_e1b418a072f0`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:31:21.843736 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_95cc785d_9205_41bc_8802_e1b418a072f0`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:31:21.846399 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:31:21.854049 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95cc785d-9205-41bc-8802-e1b418a072f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db39149a90>]}
[0m09:31:21.856512 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.48s]
[0m09:31:21.859379 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:31:21.876016 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:31:21.928007 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:31:21.973339 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_95cc785d_9205_41bc_8802_e1b418a072f0'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:31:22.027497 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_95cc785d_9205_41bc_8802_e1b418a072f0'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:31:22.033439 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:31:22.034490 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:31:22.042075 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:31:22.044761 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:31:22.046210 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_95cc785d_9205_41bc_8802_e1b418a072f0`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:31:22.047211 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_95cc785d_9205_41bc_8802_e1b418a072f0`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:31:22.062087 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:31:22.064823 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_95cc785d_9205_41bc_8802_e1b418a072f0`)
      
    ...
[0m09:31:22.067062 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:31:22.069350 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_95cc785d_9205_41bc_8802_e1b418a072f0`)
      
    ...
[0m09:31:22.084956 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:31:22.091633 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:31:22.093965 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:31:22.127096 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:31:22.128363 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:31:22.131313 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_95cc785d_9205_41bc_8802_e1b418a072f0` 
    ...
[0m09:31:22.136637 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:31:22.139927 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_95cc785d_9205_41bc_8802_e1b418a072f0` 
    ...
[0m09:31:22.141191 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:31:22.148592 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_95cc785d_9205_41bc_8802_e1b418a072f0` 
  ...
[0m09:31:22.150940 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:31:22.157608 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:31:22.158798 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_95cc785d_9205_41bc_8802_e1b418a072f0` 
  ...
[0m09:31:22.165030 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:31:22.168749 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:31:22.169882 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:31:22.173084 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95cc785d-9205-41bc-8802-e1b418a072f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db3d6f5c40>]}
[0m09:31:22.229074 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:31:22.230629 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.80s]
[0m09:31:22.233058 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:31:22.234665 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:31:22.237916 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95cc785d-9205-41bc-8802-e1b418a072f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db3a0fa4c0>]}
[0m09:31:22.239059 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.87s]
[0m09:31:22.240435 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:31:22.242506 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:31:22.243091 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:31:22.243676 [debug] [MainThread]: On list__mart: Close
[0m09:31:22.244183 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:31:22.244776 [debug] [MainThread]: On list__clean: Close
[0m09:31:22.245322 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:31:22.245906 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:31:22.246373 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:31:22.246917 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:31:22.247402 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:31:22.247933 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:31:22.248410 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m09:31:22.248938 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m09:31:22.250123 [info ] [MainThread]: 
[0m09:31:22.250843 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.71 seconds (3.71s).
[0m09:31:22.254714 [debug] [MainThread]: Command end result
[0m09:31:22.364221 [info ] [MainThread]: 
[0m09:31:22.365146 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:31:22.365772 [info ] [MainThread]: 
[0m09:31:22.366407 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:31:22.367945 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.497769, "process_in_blocks": "0", "process_kernel_time": 0.681725, "process_mem_max_rss": "114380", "process_out_blocks": "9744", "process_user_time": 5.934086}
[0m09:31:22.368712 [debug] [MainThread]: Command `dbt build` succeeded at 09:31:22.368504 after 6.50 seconds
[0m09:31:22.369357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db3e1d2310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db3a510700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db3b95f9a0>]}
[0m09:31:22.369985 [debug] [MainThread]: Flushing usage events
[0m09:32:16.040009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7658833db310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765880037b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765880037a00>]}


============================== 09:32:16.049171 | f5055207-186a-49c0-b599-c343054df9fb ==============================
[0m09:32:16.049171 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:32:16.050245 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'use_colors': 'True', 'no_print': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'target_path': 'None', 'version_check': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'fail_fast': 'False', 'introspect': 'True', 'static_parser': 'True', 'empty': 'False', 'profiles_dir': '.', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m09:32:16.581323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f5055207-186a-49c0-b599-c343054df9fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76587ff23610>]}
[0m09:32:16.774838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f5055207-186a-49c0-b599-c343054df9fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7658812718e0>]}
[0m09:32:16.776151 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:32:17.252067 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:32:17.754852 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:32:17.755538 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:32:17.956897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f5055207-186a-49c0-b599-c343054df9fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76587f7a0e80>]}
[0m09:32:18.449984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f5055207-186a-49c0-b599-c343054df9fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76587f78a310>]}
[0m09:32:18.450901 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:32:18.454280 [info ] [MainThread]: 
[0m09:32:18.455392 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:32:18.467348 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:32:18.477916 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:32:18.552630 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:32:18.558920 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:32:19.031961 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:32:19.040946 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:32:19.045355 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:32:19.049605 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:32:19.149827 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:32:19.151358 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:32:19.172834 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:32:19.179424 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:32:19.236640 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:32:19.238046 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:32:19.251929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5055207-186a-49c0-b599-c343054df9fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76588332d790>]}
[0m09:32:19.253048 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:32:19.253732 [info ] [MainThread]: 
[0m09:32:19.268778 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:32:19.269969 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:32:19.271051 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:32:19.271780 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:32:19.337627 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:32:19.339234 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:32:19.474644 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:32:19.585294 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:32:19.586652 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:32:19.598803 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:32:19.676827 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:32:19.680089 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:32:19.681970 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:32:19.734612 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:32:19.740604 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:32:19.743662 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:32:19.745475 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:32:19.748270 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:32:19.841430 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:32:19.845337 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:32:19.852833 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5055207-186a-49c0-b599-c343054df9fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76587ea8ab50>]}
[0m09:32:19.853936 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.58s]
[0m09:32:19.855218 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:32:19.857252 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:32:19.858432 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:32:19.859954 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:32:19.861123 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:32:19.863017 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:32:19.865204 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:32:19.867479 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:32:19.869265 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:32:19.870430 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:32:19.872419 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:32:19.873765 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:32:19.937636 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:32:20.050147 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:32:20.042811 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:32:20.057849 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:32:20.061084 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:32:20.063697 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:32:20.137664 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:32:20.347875 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:32:20.365620 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:32:20.436212 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:32:20.437913 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:32:20.440044 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:32:20.442752 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:32:20.710292 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:32:20.722988 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:32:20.734179 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:32:20.737155 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:32:20.755513 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:32:20.757488 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.88s]
[0m09:32:20.765382 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:32:20.763335 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m09:32:20.769135 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:32:20.774891 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.91s]
[0m09:32:20.777852 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:32:20.832086 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:32:20.835629 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:32:20.836754 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:32:20.838352 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:32:20.839752 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:32:20.841940 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:32:20.844210 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:32:20.846472 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:32:20.848447 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:32:20.850629 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:32:20.853079 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:32:20.854833 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:32:20.872285 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:32:20.956304 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:32:20.973990 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:32:21.033512 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:32:21.036469 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:32:21.038261 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:32:21.060669 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:32:21.171113 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:32:21.269247 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:32:21.376081 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:32:21.468968 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:32:21.580432 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:32:21.740559 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:32:21.765630 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:32:21.860342 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:32:21.938754 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:32:21.950472 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f5055207_186a_49c0_b599_c343054df9fb` 
  ...
[0m09:32:21.969059 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:32:22.033596 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f5055207_186a_49c0_b599_c343054df9fb` 
  ...
[0m09:32:22.039990 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:32:22.044353 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:32:22.047184 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:32:22.140527 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:32:22.177340 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:32:22.261615 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5055207-186a-49c0-b599-c343054df9fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76587fe926d0>]}
[0m09:32:22.345660 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.41s]
[0m09:32:22.364062 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:32:22.534801 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_f5055207_186a_49c0_b599_c343054df9fb`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:32:22.538052 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_f5055207_186a_49c0_b599_c343054df9fb`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:32:22.571491 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:32:22.587291 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:32:22.637871 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_f5055207_186a_49c0_b599_c343054df9fb'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:32:22.643516 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_f5055207_186a_49c0_b599_c343054df9fb'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:32:22.652653 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:32:22.655576 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:32:22.668891 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:32:22.674567 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:32:22.677497 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_f5055207_186a_49c0_b599_c343054df9fb`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:32:22.679845 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_f5055207_186a_49c0_b599_c343054df9fb`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:32:22.762146 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:32:22.766402 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f5055207_186a_49c0_b599_c343054df9fb`)
      
    ...
[0m09:32:22.769087 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:32:22.775583 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f5055207_186a_49c0_b599_c343054df9fb`)
      
    ...
[0m09:32:22.800724 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:32:22.813829 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:32:22.816351 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:32:22.835564 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:32:22.840494 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:32:22.846756 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f5055207_186a_49c0_b599_c343054df9fb` 
    ...
[0m09:32:22.849859 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:32:22.854453 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f5055207_186a_49c0_b599_c343054df9fb` 
    ...
[0m09:32:22.859513 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:32:22.860925 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:32:22.866745 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f5055207_186a_49c0_b599_c343054df9fb` 
  ...
[0m09:32:22.872491 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f5055207_186a_49c0_b599_c343054df9fb` 
  ...
[0m09:32:22.875764 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:32:22.876888 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:32:22.882458 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:32:22.943791 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:32:22.949632 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:32:22.952199 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:32:22.957996 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5055207-186a-49c0-b599-c343054df9fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7658812719a0>]}
[0m09:32:22.964435 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5055207-186a-49c0-b599-c343054df9fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76587e27a9a0>]}
[0m09:32:22.966768 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.11s]
[0m09:32:22.969306 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.12s]
[0m09:32:22.972334 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:32:22.975323 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:32:22.979928 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:32:22.981062 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:32:23.033035 [debug] [MainThread]: On list__clean: Close
[0m09:32:23.034400 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:32:23.035629 [debug] [MainThread]: On list__mart: Close
[0m09:32:23.036665 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:32:23.037726 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:32:23.038751 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m09:32:23.039819 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m09:32:23.040860 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:32:23.041922 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:32:23.042997 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:32:23.044051 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:32:23.046390 [info ] [MainThread]: 
[0m09:32:23.047748 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.59 seconds (4.59s).
[0m09:32:23.056000 [debug] [MainThread]: Command end result
[0m09:32:23.271340 [info ] [MainThread]: 
[0m09:32:23.272662 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:32:23.273654 [info ] [MainThread]: 
[0m09:32:23.274732 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:32:23.276832 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.427698, "process_in_blocks": "0", "process_kernel_time": 0.657299, "process_mem_max_rss": "114796", "process_out_blocks": "9744", "process_user_time": 6.424151}
[0m09:32:23.278008 [debug] [MainThread]: Command `dbt build` succeeded at 09:32:23.277702 after 7.43 seconds
[0m09:32:23.279119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7658833db310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76587f64fb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765880970a60>]}
[0m09:32:23.280087 [debug] [MainThread]: Flushing usage events
[0m09:33:16.136195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b157d9ed310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b157a65caf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b157a65c9a0>]}


============================== 09:33:16.145665 | 88adcc43-8da1-410f-95c7-c687d487cbaa ==============================
[0m09:33:16.145665 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:33:16.146742 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'introspect': 'True', 'static_parser': 'True', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '.', 'indirect_selection': 'eager', 'log_path': '/workdir/transforms/04_btc/logs', 'fail_fast': 'False', 'use_colors': 'True', 'log_format': 'default', 'quiet': 'False', 'use_experimental_parser': 'False', 'debug': 'False', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'partial_parse': 'True', 'warn_error': 'None', 'version_check': 'True', 'target_path': 'None', 'empty': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'write_json': 'True'}
[0m09:33:16.675048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '88adcc43-8da1-410f-95c7-c687d487cbaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b157a586160>]}
[0m09:33:16.870216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '88adcc43-8da1-410f-95c7-c687d487cbaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b157a597f70>]}
[0m09:33:16.871456 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:33:17.344631 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:33:17.847821 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:33:17.848456 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:33:18.047397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '88adcc43-8da1-410f-95c7-c687d487cbaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1579db0ee0>]}
[0m09:33:18.487415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '88adcc43-8da1-410f-95c7-c687d487cbaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1579d9a130>]}
[0m09:33:18.488313 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:33:18.491466 [info ] [MainThread]: 
[0m09:33:18.492521 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:33:18.541711 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:33:18.543258 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:33:18.581263 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:33:18.644732 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:33:19.300078 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:33:19.305174 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:33:19.349243 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:33:19.356978 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:33:19.442423 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:33:19.443872 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:33:19.473061 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:33:19.469741 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:33:19.484261 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:33:19.532795 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:33:19.561701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '88adcc43-8da1-410f-95c7-c687d487cbaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b157ce06970>]}
[0m09:33:19.563674 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:33:19.565294 [info ] [MainThread]: 
[0m09:33:19.643982 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:33:19.645139 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:33:19.646256 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:33:19.646988 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:33:19.663583 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:33:19.664695 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:33:19.845475 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:33:19.903329 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:33:19.904778 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:33:19.914396 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:33:19.937926 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:33:19.941612 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:33:19.943794 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:33:19.946311 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:33:20.068866 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:33:20.072291 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:33:20.074321 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:33:20.077508 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:33:20.172332 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:33:20.175893 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:33:20.181865 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88adcc43-8da1-410f-95c7-c687d487cbaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1579045610>]}
[0m09:33:20.182985 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m09:33:20.184325 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:33:20.235166 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:33:20.236376 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:33:20.237918 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:33:20.239276 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:33:20.240732 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:33:20.241795 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:33:20.243755 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:33:20.245767 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:33:20.268686 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:33:20.270812 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:33:20.272466 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:33:20.274235 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:33:20.276302 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:33:20.282934 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:33:20.341296 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:33:20.356079 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:33:20.444637 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:33:20.451581 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:33:20.536337 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:33:20.539308 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:33:20.548674 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:33:20.551390 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:33:20.553827 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:33:20.556988 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:33:20.818205 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:33:20.849639 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:33:20.852676 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:33:20.857198 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:33:20.870641 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.60s]
[0m09:33:20.875793 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:33:20.878906 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:33:20.936656 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.66s]
[0m09:33:20.939577 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:33:20.942955 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:33:20.948949 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.71s]
[0m09:33:20.952553 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:33:20.955266 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:33:20.956391 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:33:20.957941 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:33:20.959177 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:33:20.961583 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:33:20.963474 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:33:20.965290 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:33:20.966791 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:33:20.968144 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:33:20.969948 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:33:20.971879 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:33:21.033633 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:33:21.077879 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:33:21.080152 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:33:21.140140 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:33:21.141673 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:33:21.142743 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:33:21.159068 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:33:21.240146 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:33:21.348918 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:33:21.466040 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_88adcc43_8da1_410f_95c7_c687d487cbaa` 
  ...
[0m09:33:21.467412 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_88adcc43_8da1_410f_95c7_c687d487cbaa` 
  ...
[0m09:33:21.468833 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:33:21.472353 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:33:21.478837 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:33:21.479847 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:33:21.639089 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:33:21.646699 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:33:21.669939 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_88adcc43_8da1_410f_95c7_c687d487cbaa`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:33:21.674203 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_88adcc43_8da1_410f_95c7_c687d487cbaa`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:33:21.675625 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:33:21.733852 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:33:21.735196 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:33:21.738093 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:33:21.759378 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_88adcc43_8da1_410f_95c7_c687d487cbaa'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:33:21.754515 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_88adcc43_8da1_410f_95c7_c687d487cbaa'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:33:21.763756 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:33:21.768419 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:33:21.770511 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:33:21.771842 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:33:21.833807 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:33:21.835513 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:33:21.838231 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:33:21.845484 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:33:21.847048 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_88adcc43_8da1_410f_95c7_c687d487cbaa`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:33:21.851347 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:33:21.852613 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_88adcc43_8da1_410f_95c7_c687d487cbaa`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:33:21.855664 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88adcc43-8da1-410f-95c7-c687d487cbaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b15789d79d0>]}
[0m09:33:21.858713 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.89s]
[0m09:33:21.860799 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:33:21.866156 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:33:21.869761 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_88adcc43_8da1_410f_95c7_c687d487cbaa`)
      
    ...
[0m09:33:21.873241 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:33:21.875857 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_88adcc43_8da1_410f_95c7_c687d487cbaa`)
      
    ...
[0m09:33:21.890013 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:33:21.933817 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:33:21.895272 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:33:21.939271 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:33:21.945710 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:33:21.950643 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_88adcc43_8da1_410f_95c7_c687d487cbaa` 
    ...
[0m09:33:21.952307 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:33:21.956564 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_88adcc43_8da1_410f_95c7_c687d487cbaa` 
    ...
[0m09:33:21.959451 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:33:21.968548 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_88adcc43_8da1_410f_95c7_c687d487cbaa` 
  ...
[0m09:33:21.969882 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:33:21.977243 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_88adcc43_8da1_410f_95c7_c687d487cbaa` 
  ...
[0m09:33:21.978939 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:33:22.039696 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:33:22.041417 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:33:22.048597 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:33:22.050262 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:33:22.056237 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88adcc43-8da1-410f-95c7-c687d487cbaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b157997ec10>]}
[0m09:33:22.057953 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:33:22.059494 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.09s]
[0m09:33:22.062854 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88adcc43-8da1-410f-95c7-c687d487cbaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b1579981340>]}
[0m09:33:22.064614 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:33:22.066181 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.10s]
[0m09:33:22.067770 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:33:22.069839 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:33:22.070411 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:33:22.070973 [debug] [MainThread]: On list__mart: Close
[0m09:33:22.071478 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:33:22.072039 [debug] [MainThread]: On list__clean: Close
[0m09:33:22.072526 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:33:22.073085 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:33:22.073598 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m09:33:22.074122 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m09:33:22.074643 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:33:22.075173 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:33:22.075718 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:33:22.076242 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:33:22.077411 [info ] [MainThread]: 
[0m09:33:22.078118 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.59 seconds (3.59s).
[0m09:33:22.082040 [debug] [MainThread]: Command end result
[0m09:33:22.345881 [info ] [MainThread]: 
[0m09:33:22.347481 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:33:22.349135 [info ] [MainThread]: 
[0m09:33:22.350849 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:33:22.353851 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.407907, "process_in_blocks": "0", "process_kernel_time": 0.669358, "process_mem_max_rss": "114508", "process_out_blocks": "9744", "process_user_time": 5.932589}
[0m09:33:22.355440 [debug] [MainThread]: Command `dbt build` succeeded at 09:33:22.355031 after 6.41 seconds
[0m09:33:22.356848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b157d9ed310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b157c1951c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b15796fdd90>]}
[0m09:33:22.358168 [debug] [MainThread]: Flushing usage events
[0m09:34:15.855348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044c3c5b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044c08b4af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044c08b49a0>]}


============================== 09:34:15.864600 | b6dd7cc0-7f94-4c44-84c8-4524202e082b ==============================
[0m09:34:15.864600 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:34:15.865651 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'static_parser': 'True', 'log_cache_events': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'version_check': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'empty': 'False', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '.', 'target_path': 'None', 'warn_error': 'None', 'log_format': 'default', 'partial_parse': 'True'}
[0m09:34:16.451341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b6dd7cc0-7f94-4c44-84c8-4524202e082b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044c31f03a0>]}
[0m09:34:16.644910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b6dd7cc0-7f94-4c44-84c8-4524202e082b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044c09773a0>]}
[0m09:34:16.646167 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:34:17.067492 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:34:17.644298 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:34:17.645009 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:34:17.847306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b6dd7cc0-7f94-4c44-84c8-4524202e082b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044c0019ee0>]}
[0m09:34:18.295608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b6dd7cc0-7f94-4c44-84c8-4524202e082b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044c0003c70>]}
[0m09:34:18.296500 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:34:18.299753 [info ] [MainThread]: 
[0m09:34:18.337394 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:34:18.349429 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:34:18.351037 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:34:18.446701 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:34:18.462971 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:34:19.204179 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:34:19.209784 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:34:19.212103 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:34:19.219202 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:34:19.277511 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:34:19.337897 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:34:19.353664 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:34:19.356978 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:34:19.368363 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:34:19.370639 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:34:19.441220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b6dd7cc0-7f94-4c44-84c8-4524202e082b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044bfafb3d0>]}
[0m09:34:19.442266 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:34:19.443329 [info ] [MainThread]: 
[0m09:34:19.467049 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:34:19.468457 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:34:19.469868 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:34:19.470839 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:34:19.540761 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:34:19.542334 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:34:19.737775 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:34:19.805647 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:34:19.807040 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:34:19.819520 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:34:19.958330 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:34:19.961940 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:34:19.964081 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:34:19.967222 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:34:19.973422 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:34:19.978039 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:34:19.980440 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:34:19.983358 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:34:20.084585 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:34:20.088000 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:34:20.142773 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6dd7cc0-7f94-4c44-84c8-4524202e082b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044bf3c63a0>]}
[0m09:34:20.143963 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.67s]
[0m09:34:20.145347 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:34:20.147641 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:34:20.148791 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:34:20.150141 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:34:20.151752 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:34:20.153378 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:34:20.155471 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:34:20.157158 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:34:20.158503 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:34:20.159672 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:34:20.161135 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:34:20.162312 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:34:20.163111 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:34:20.256931 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:34:20.268762 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:34:20.278152 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:34:20.280238 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:34:20.337736 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:34:20.339357 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:34:20.651820 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:34:20.652893 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:34:20.647128 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:34:20.654962 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:34:20.655706 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:34:20.657048 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:34:20.900350 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:34:20.913003 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:34:20.938866 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:34:20.953446 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:34:20.958403 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.80s]
[0m09:34:20.961573 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:34:20.964658 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:34:20.970658 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.81s]
[0m09:34:20.973597 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:34:20.976953 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:34:20.982593 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.83s]
[0m09:34:21.037608 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:34:21.040751 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:34:21.041995 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:34:21.043515 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:34:21.044887 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:34:21.047075 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:34:21.048959 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:34:21.050975 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:34:21.052807 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:34:21.054496 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:34:21.056149 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:34:21.057940 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:34:21.080431 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:34:21.150470 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:34:21.169368 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:34:21.183069 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:34:21.237827 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:34:21.186360 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:34:21.256414 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:34:21.369989 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:34:21.474865 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:34:21.581701 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:34:21.674106 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:34:21.838772 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m09:34:21.867686 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:34:21.963104 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:34:22.085492 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:34:22.153814 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b6dd7cc0_7f94_4c44_84c8_4524202e082b` 
  ...
[0m09:34:22.166590 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b6dd7cc0_7f94_4c44_84c8_4524202e082b` 
  ...
[0m09:34:22.172298 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:34:22.177164 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:34:22.180114 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:34:22.184238 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:34:22.352071 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:34:22.448081 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:34:22.473181 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:34:22.552075 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6dd7cc0-7f94-4c44-84c8-4524202e082b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044bec371f0>]}
[0m09:34:22.571561 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.50s]
[0m09:34:22.579573 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:34:22.663775 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_b6dd7cc0_7f94_4c44_84c8_4524202e082b`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:34:22.667112 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_b6dd7cc0_7f94_4c44_84c8_4524202e082b`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:34:22.701458 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:34:22.740481 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:34:22.775252 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_b6dd7cc0_7f94_4c44_84c8_4524202e082b'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:34:22.776823 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_b6dd7cc0_7f94_4c44_84c8_4524202e082b'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:34:22.786305 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:34:22.838799 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:34:22.857618 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:34:22.865561 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:34:22.868226 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_b6dd7cc0_7f94_4c44_84c8_4524202e082b`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:34:22.870435 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_b6dd7cc0_7f94_4c44_84c8_4524202e082b`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:34:22.903287 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:34:22.905901 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:34:22.910051 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b6dd7cc0_7f94_4c44_84c8_4524202e082b`)
      
    ...
[0m09:34:22.938816 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b6dd7cc0_7f94_4c44_84c8_4524202e082b`)
      
    ...
[0m09:34:22.969158 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:34:22.979501 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:34:22.982711 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:34:22.994718 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:34:22.997669 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:34:23.038928 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:34:23.007293 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b6dd7cc0_7f94_4c44_84c8_4524202e082b` 
    ...
[0m09:34:23.045827 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b6dd7cc0_7f94_4c44_84c8_4524202e082b` 
    ...
[0m09:34:23.058086 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:34:23.072035 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:34:23.070323 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b6dd7cc0_7f94_4c44_84c8_4524202e082b` 
  ...
[0m09:34:23.085144 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b6dd7cc0_7f94_4c44_84c8_4524202e082b` 
  ...
[0m09:34:23.138634 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:34:23.091330 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:34:23.152312 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:34:23.165876 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:34:23.172064 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:34:23.175122 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:34:23.181699 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6dd7cc0-7f94-4c44-84c8-4524202e082b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044bec56100>]}
[0m09:34:23.241362 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6dd7cc0-7f94-4c44-84c8-4524202e082b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044bf3c64f0>]}
[0m09:34:23.243978 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.13s]
[0m09:34:23.246650 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.19s]
[0m09:34:23.249701 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:34:23.252734 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:34:23.257159 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:34:23.258361 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:34:23.259590 [debug] [MainThread]: On list__clean: Close
[0m09:34:23.260668 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:34:23.261796 [debug] [MainThread]: On list__mart: Close
[0m09:34:23.262881 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:34:23.264000 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:34:23.265106 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m09:34:23.266315 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m09:34:23.267360 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:34:23.268441 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:34:23.269484 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:34:23.270657 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:34:23.272931 [info ] [MainThread]: 
[0m09:34:23.274301 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.97 seconds (4.97s).
[0m09:34:23.285196 [debug] [MainThread]: Command end result
[0m09:34:23.464242 [info ] [MainThread]: 
[0m09:34:23.465311 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:34:23.466124 [info ] [MainThread]: 
[0m09:34:23.466980 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:34:23.468605 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.803899, "process_in_blocks": "0", "process_kernel_time": 0.722008, "process_mem_max_rss": "114544", "process_out_blocks": "9744", "process_user_time": 6.552622}
[0m09:34:23.469587 [debug] [MainThread]: Command `dbt build` succeeded at 09:34:23.469316 after 7.81 seconds
[0m09:34:23.470363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044c3c5b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044c1be2850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044c1bdfd00>]}
[0m09:34:23.471115 [debug] [MainThread]: Flushing usage events
[0m09:35:16.378114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776759b36e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77675679db80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77675679da30>]}


============================== 09:35:16.388845 | 070f91c2-627d-4e1c-ae73-4bc1fa1d0746 ==============================
[0m09:35:16.388845 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:35:16.441879 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'warn_error': 'None', 'use_colors': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'profiles_dir': '.', 'target_path': 'None', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'partial_parse': 'True', 'fail_fast': 'False', 'indirect_selection': 'eager', 'empty': 'False', 'write_json': 'True', 'debug': 'False', 'quiet': 'False', 'introspect': 'True', 'printer_width': '80', 'invocation_command': 'dbt build --profiles-dir . --target local', 'no_print': 'None', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'log_format': 'default', 'version_check': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:35:16.973205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '070f91c2-627d-4e1c-ae73-4bc1fa1d0746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7767567f5b80>]}
[0m09:35:17.170580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '070f91c2-627d-4e1c-ae73-4bc1fa1d0746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77675668a6d0>]}
[0m09:35:17.171841 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:35:17.581773 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:35:18.087566 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:35:18.088202 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:35:18.290941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '070f91c2-627d-4e1c-ae73-4bc1fa1d0746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776755ef1e50>]}
[0m09:35:18.786455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '070f91c2-627d-4e1c-ae73-4bc1fa1d0746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776755eb0e80>]}
[0m09:35:18.787376 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:35:18.790541 [info ] [MainThread]: 
[0m09:35:18.791589 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:35:18.803438 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:35:18.842266 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:35:18.964635 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:35:18.975506 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:35:19.817788 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:35:19.843253 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:35:19.847649 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:35:19.850076 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:35:19.950672 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:35:19.952705 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:35:19.973839 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:35:19.981216 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:35:19.989627 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:35:19.991503 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:35:20.066451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '070f91c2-627d-4e1c-ae73-4bc1fa1d0746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776755db1880>]}
[0m09:35:20.068361 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:35:20.069724 [info ] [MainThread]: 
[0m09:35:20.149784 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:35:20.150940 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:35:20.151990 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:35:20.152728 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:35:20.169291 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:35:20.170438 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:35:20.288135 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:35:20.392359 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:35:20.393819 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:35:20.403733 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:35:20.544938 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:35:20.547801 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:35:20.549854 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:35:20.552429 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:35:20.558354 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:35:20.561242 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:35:20.563233 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:35:20.565828 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:35:20.671337 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:35:20.674410 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:35:20.680495 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '070f91c2-627d-4e1c-ae73-4bc1fa1d0746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776755b46340>]}
[0m09:35:20.681736 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m09:35:20.683050 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:35:20.684836 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:35:20.687087 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:35:20.686125 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:35:20.688036 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:35:20.688905 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:35:20.690261 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:35:20.691434 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:35:20.741606 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:35:20.742791 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:35:20.744109 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:35:20.744963 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:35:20.771358 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:35:20.776949 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:35:20.783760 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:35:20.841710 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:35:20.790349 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:35:20.844059 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:35:20.878974 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:35:20.881530 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:35:20.883112 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:35:20.884577 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:35:20.942838 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:35:20.889451 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:35:20.945740 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:35:21.099219 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:35:21.107219 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:35:21.111401 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:35:21.117989 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.43s]
[0m09:35:21.119962 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:35:21.121470 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:35:21.122929 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:35:21.127275 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.38s]
[0m09:35:21.130480 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:35:21.136314 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:35:21.143950 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.45s]
[0m09:35:21.145287 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:35:21.146769 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:35:21.147615 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:35:21.148551 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:35:21.149372 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:35:21.150338 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:35:21.151228 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:35:21.152145 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:35:21.153054 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:35:21.153801 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:35:21.154510 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:35:21.155286 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:35:21.173737 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:35:21.174595 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:35:21.184118 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:35:21.191440 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:35:21.243619 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:35:21.271619 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:35:21.283790 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:35:21.444920 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:35:21.584424 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:35:21.675321 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:35:21.762254 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:35:21.853355 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:35:21.878891 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_070f91c2_627d_4e1c_ae73_4bc1fa1d0746` 
  ...
[0m09:35:21.887528 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:35:21.976175 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_070f91c2_627d_4e1c_ae73_4bc1fa1d0746` 
  ...
[0m09:35:21.979524 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:35:22.053240 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:35:22.055868 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:35:22.167070 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:35:22.284148 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:35:22.357819 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:35:22.466270 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_070f91c2_627d_4e1c_ae73_4bc1fa1d0746`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:35:22.469307 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_070f91c2_627d_4e1c_ae73_4bc1fa1d0746`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:35:22.476943 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:35:22.543043 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:35:22.560255 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:35:22.568021 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:35:22.648600 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:35:22.650846 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_070f91c2_627d_4e1c_ae73_4bc1fa1d0746'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:35:22.660998 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '070f91c2-627d-4e1c-ae73-4bc1fa1d0746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776755aa2a00>]}
[0m09:35:22.656592 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_070f91c2_627d_4e1c_ae73_4bc1fa1d0746'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:35:22.666324 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.51s]
[0m09:35:22.671715 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:35:22.674663 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:35:22.682919 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:35:22.743101 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:35:22.749916 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:35:22.752876 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_070f91c2_627d_4e1c_ae73_4bc1fa1d0746`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:35:22.755139 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_070f91c2_627d_4e1c_ae73_4bc1fa1d0746`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:35:22.788711 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:35:22.793719 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_070f91c2_627d_4e1c_ae73_4bc1fa1d0746`)
      
    ...
[0m09:35:22.797848 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:35:22.802282 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_070f91c2_627d_4e1c_ae73_4bc1fa1d0746`)
      
    ...
[0m09:35:22.822743 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:35:22.843126 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:35:22.844988 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:35:22.855099 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:35:22.865464 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:35:22.868248 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:35:22.874159 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_070f91c2_627d_4e1c_ae73_4bc1fa1d0746` 
    ...
[0m09:35:22.879970 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_070f91c2_627d_4e1c_ae73_4bc1fa1d0746` 
    ...
[0m09:35:22.891206 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:35:22.944842 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:35:22.952876 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_070f91c2_627d_4e1c_ae73_4bc1fa1d0746` 
  ...
[0m09:35:22.965039 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_070f91c2_627d_4e1c_ae73_4bc1fa1d0746` 
  ...
[0m09:35:22.971234 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:35:22.973870 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:35:23.042869 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:35:23.052117 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:35:23.056873 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:35:23.059271 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:35:23.065586 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '070f91c2-627d-4e1c-ae73-4bc1fa1d0746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776757087d00>]}
[0m09:35:23.071672 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '070f91c2-627d-4e1c-ae73-4bc1fa1d0746', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776755b460d0>]}
[0m09:35:23.074196 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.91s]
[0m09:35:23.076826 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.92s]
[0m09:35:23.079877 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:35:23.083081 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:35:23.087690 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:35:23.088900 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:35:23.090170 [debug] [MainThread]: On list__mart: Close
[0m09:35:23.142353 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:35:23.143625 [debug] [MainThread]: On list__clean: Close
[0m09:35:23.144766 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:35:23.145934 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:35:23.147044 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:35:23.148199 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:35:23.149319 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m09:35:23.150480 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m09:35:23.151602 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:35:23.152749 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:35:23.155109 [info ] [MainThread]: 
[0m09:35:23.156580 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.36 seconds (4.36s).
[0m09:35:23.164698 [debug] [MainThread]: Command end result
[0m09:35:23.383730 [info ] [MainThread]: 
[0m09:35:23.385019 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:35:23.386013 [info ] [MainThread]: 
[0m09:35:23.387069 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:35:23.389086 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.207257, "process_in_blocks": "0", "process_kernel_time": 0.689378, "process_mem_max_rss": "114572", "process_out_blocks": "9744", "process_user_time": 6.244962}
[0m09:35:23.390199 [debug] [MainThread]: Command `dbt build` succeeded at 09:35:23.389911 after 7.21 seconds
[0m09:35:23.391135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776759b36e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776754a19fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7767547ee310>]}
[0m09:35:23.442198 [debug] [MainThread]: Flushing usage events
[0m09:36:16.317602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56aebace20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56ab80ab80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56ab80aa30>]}


============================== 09:36:16.378953 | ad90527b-1bcc-40e9-97c2-29fdb185dc66 ==============================
[0m09:36:16.378953 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:36:16.380105 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'static_parser': 'True', 'target_path': 'None', 'version_check': 'True', 'profiles_dir': '.', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_format': 'default', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt build --profiles-dir . --target local', 'write_json': 'True', 'introspect': 'True', 'quiet': 'False', 'printer_width': '80', 'use_colors': 'True', 'empty': 'False', 'warn_error': 'None', 'debug': 'False'}
[0m09:36:16.920758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ad90527b-1bcc-40e9-97c2-29fdb185dc66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56ab861b80>]}
[0m09:36:17.122723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ad90527b-1bcc-40e9-97c2-29fdb185dc66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56ab7046d0>]}
[0m09:36:17.174974 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:36:17.591652 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:36:18.096568 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:36:18.097223 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:36:18.297869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ad90527b-1bcc-40e9-97c2-29fdb185dc66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56aaf6fe50>]}
[0m09:36:18.777081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ad90527b-1bcc-40e9-97c2-29fdb185dc66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56aaf2ee80>]}
[0m09:36:18.777997 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:36:18.781348 [info ] [MainThread]: 
[0m09:36:18.782371 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:36:18.794372 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:36:18.796235 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:36:18.899111 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:36:18.911682 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:36:19.782191 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:36:19.786567 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:36:19.790824 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:36:19.793226 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:36:19.895407 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:36:19.897304 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:36:19.913094 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:36:19.918617 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:36:19.929153 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:36:19.979267 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:36:20.001408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad90527b-1bcc-40e9-97c2-29fdb185dc66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56aae2f880>]}
[0m09:36:20.003385 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:36:20.004734 [info ] [MainThread]: 
[0m09:36:20.084405 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:36:20.085647 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:36:20.086733 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:36:20.087451 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:36:20.104355 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:36:20.105543 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:36:20.290625 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:36:20.351265 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:36:20.352657 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:36:20.364884 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:36:20.498707 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:36:20.502321 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:36:20.504228 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:36:20.507058 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:36:20.512515 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:36:20.515400 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:36:20.517186 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:36:20.520019 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:36:20.614967 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:36:20.618392 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:36:20.624397 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad90527b-1bcc-40e9-97c2-29fdb185dc66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56aae7d760>]}
[0m09:36:20.674326 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.54s]
[0m09:36:20.676105 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:36:20.678236 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:36:20.679657 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:36:20.681322 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:36:20.682841 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:36:20.684775 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:36:20.686706 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:36:20.689083 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:36:20.691140 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:36:20.693301 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:36:20.695037 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:36:20.697052 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:36:20.699009 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:36:20.894723 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:36:20.898671 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:36:20.907180 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:36:20.908937 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:36:20.910770 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:36:20.917406 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:36:21.106437 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:36:21.119027 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:36:21.117841 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:36:21.120525 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:36:21.121366 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:36:21.123004 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:36:21.360665 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:36:21.388225 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:36:21.403569 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.71s]
[0m09:36:21.406346 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:36:21.408889 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:36:21.411888 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:36:21.425688 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:36:21.477450 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.79s]
[0m09:36:21.480474 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:36:21.483358 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:36:21.488988 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.80s]
[0m09:36:21.492348 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:36:21.495104 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:36:21.496271 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:36:21.497890 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:36:21.499181 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:36:21.501343 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:36:21.503052 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:36:21.505043 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:36:21.506865 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:36:21.508565 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:36:21.510135 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:36:21.512035 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:36:21.585381 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:36:21.608004 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:36:21.686772 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:36:21.691006 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:36:21.693524 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:36:21.705525 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:36:21.717566 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:36:21.889165 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:36:22.017510 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:36:22.176380 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:36:22.280070 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:36:22.310429 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:36:22.386132 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:36:22.482615 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:36:22.520890 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_ad90527b_1bcc_40e9_97c2_29fdb185dc66` 
  ...
[0m09:36:22.522773 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:36:22.588637 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:36:22.616240 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:36:22.701407 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_ad90527b_1bcc_40e9_97c2_29fdb185dc66` 
  ...
[0m09:36:22.713321 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:36:22.803698 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:36:22.894136 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:36:22.910221 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_ad90527b_1bcc_40e9_97c2_29fdb185dc66`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:36:22.918135 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_ad90527b_1bcc_40e9_97c2_29fdb185dc66`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:36:22.982664 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:36:22.992199 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:36:22.997398 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad90527b-1bcc-40e9-97c2-29fdb185dc66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56a9b47490>]}
[0m09:36:22.999831 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.49s]
[0m09:36:23.002713 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:36:23.016462 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:36:23.031965 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:36:23.117527 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_ad90527b_1bcc_40e9_97c2_29fdb185dc66'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:36:23.115774 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_ad90527b_1bcc_40e9_97c2_29fdb185dc66'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:36:23.177321 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:36:23.186225 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:36:23.196299 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:36:23.202142 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:36:23.205407 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_ad90527b_1bcc_40e9_97c2_29fdb185dc66`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:36:23.207715 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_ad90527b_1bcc_40e9_97c2_29fdb185dc66`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:36:23.240695 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:36:23.243325 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:36:23.247394 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_ad90527b_1bcc_40e9_97c2_29fdb185dc66`)
      
    ...
[0m09:36:23.279688 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_ad90527b_1bcc_40e9_97c2_29fdb185dc66`)
      
    ...
[0m09:36:23.306259 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:36:23.313757 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:36:23.315539 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:36:23.325139 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:36:23.327452 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:36:23.332953 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_ad90527b_1bcc_40e9_97c2_29fdb185dc66` 
    ...
[0m09:36:23.335469 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:36:23.338441 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_ad90527b_1bcc_40e9_97c2_29fdb185dc66` 
    ...
[0m09:36:23.343790 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:36:23.345037 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:36:23.378824 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_ad90527b_1bcc_40e9_97c2_29fdb185dc66` 
  ...
[0m09:36:23.384739 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_ad90527b_1bcc_40e9_97c2_29fdb185dc66` 
  ...
[0m09:36:23.388845 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:36:23.390069 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:36:23.396137 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:36:23.402085 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:36:23.405785 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:36:23.407327 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:36:23.410734 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad90527b-1bcc-40e9-97c2-29fdb185dc66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56a9b47220>]}
[0m09:36:23.415192 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad90527b-1bcc-40e9-97c2-29fdb185dc66', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56aab24370>]}
[0m09:36:23.416656 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.90s]
[0m09:36:23.417944 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.91s]
[0m09:36:23.419303 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:36:23.420827 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:36:23.423207 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:36:23.474907 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:36:23.475482 [debug] [MainThread]: On list__mart: Close
[0m09:36:23.475981 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:36:23.476466 [debug] [MainThread]: On list__clean: Close
[0m09:36:23.476956 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:36:23.477439 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:36:23.477920 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:36:23.478483 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:36:23.479027 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m09:36:23.479662 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m09:36:23.480179 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:36:23.480707 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:36:23.481893 [info ] [MainThread]: 
[0m09:36:23.482633 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.70 seconds (4.70s).
[0m09:36:23.486338 [debug] [MainThread]: Command end result
[0m09:36:23.590451 [info ] [MainThread]: 
[0m09:36:23.591329 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:36:23.591955 [info ] [MainThread]: 
[0m09:36:23.592599 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:36:23.593974 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.4796968, "process_in_blocks": "0", "process_kernel_time": 0.664811, "process_mem_max_rss": "115024", "process_out_blocks": "9744", "process_user_time": 6.395603}
[0m09:36:23.594711 [debug] [MainThread]: Command `dbt build` succeeded at 09:36:23.594506 after 7.48 seconds
[0m09:36:23.595313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56aebace20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56acb3a0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f56ab7046d0>]}
[0m09:36:23.595911 [debug] [MainThread]: Flushing usage events
[0m09:37:16.169946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c047151e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c043dafbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c043dafa60>]}


============================== 09:37:16.179830 | c93fe0d5-f3ec-4889-9e7f-02805d273fb6 ==============================
[0m09:37:16.179830 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:37:16.180983 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'partial_parse': 'True', 'target_path': 'None', 'cache_selected_only': 'False', 'log_format': 'default', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': '.', 'write_json': 'True', 'version_check': 'True', 'indirect_selection': 'eager', 'printer_width': '80', 'use_experimental_parser': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_path': '/workdir/transforms/04_btc/logs', 'no_print': 'None', 'use_colors': 'True', 'debug': 'False'}
[0m09:37:16.766491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c93fe0d5-f3ec-4889-9e7f-02805d273fb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c0465dc910>]}
[0m09:37:16.911735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c93fe0d5-f3ec-4889-9e7f-02805d273fb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c043ca93d0>]}
[0m09:37:16.962785 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:37:17.385701 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:37:17.892920 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:37:17.893717 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:37:18.093499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c93fe0d5-f3ec-4889-9e7f-02805d273fb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c043514e50>]}
[0m09:37:18.575531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c93fe0d5-f3ec-4889-9e7f-02805d273fb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c043529610>]}
[0m09:37:18.576409 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:37:18.579694 [info ] [MainThread]: 
[0m09:37:18.580752 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:37:18.592420 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:37:18.604509 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:37:18.701911 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:37:18.703254 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:37:19.418954 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:37:19.424691 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:37:19.429365 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:37:19.437106 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:37:19.464898 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:37:19.465967 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:37:19.482724 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:37:19.486401 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:37:19.493143 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:37:19.496978 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:37:19.508099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c93fe0d5-f3ec-4889-9e7f-02805d273fb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c043a8adc0>]}
[0m09:37:19.509003 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:37:19.509570 [info ] [MainThread]: 
[0m09:37:19.572481 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:37:19.573657 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:37:19.574791 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:37:19.575563 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:37:19.592397 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:37:19.593733 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:37:19.711415 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:37:19.822799 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:37:19.824190 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:37:19.834867 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:37:19.970895 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:37:19.973807 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:37:19.975847 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:37:19.978584 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:37:19.984419 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:37:19.987126 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:37:19.989108 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:37:19.991697 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:37:20.096339 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:37:20.099471 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:37:20.105732 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c93fe0d5-f3ec-4889-9e7f-02805d273fb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c046662c10>]}
[0m09:37:20.106948 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m09:37:20.108272 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:37:20.109833 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:37:20.110856 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:37:20.111645 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:37:20.112510 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:37:20.113451 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:37:20.114354 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:37:20.163374 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:37:20.164513 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:37:20.165496 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:37:20.166283 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:37:20.167143 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:37:20.167966 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:37:20.195625 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:37:20.198091 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:37:20.206584 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:37:20.208170 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:37:20.208997 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:37:20.272848 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:37:20.374280 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:37:20.375955 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:37:20.389921 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:37:20.393092 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:37:20.394853 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:37:20.397203 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:37:20.639472 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:37:20.680062 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:37:20.684258 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:37:20.691662 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.53s]
[0m09:37:20.695683 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:37:20.698107 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:37:20.699986 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:37:20.703862 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.54s]
[0m09:37:20.707519 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:37:20.714092 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:37:20.765310 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.60s]
[0m09:37:20.767269 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:37:20.768900 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:37:20.770040 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:37:20.771306 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:37:20.772622 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:37:20.774278 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:37:20.775667 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:37:20.776739 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:37:20.778091 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:37:20.779747 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:37:20.781328 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:37:20.783064 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:37:20.784746 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:37:20.873264 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:37:20.894264 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:37:20.898314 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:37:20.901171 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:37:20.902882 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:37:20.904503 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:37:21.071394 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:37:21.104872 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:37:21.211240 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:37:21.371592 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:37:21.402196 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:37:21.470655 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:37:21.597865 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:37:21.768738 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:37:21.882492 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:37:21.880367 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c93fe0d5_f3ec_4889_9e7f_02805d273fb6` 
  ...
[0m09:37:21.884760 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c93fe0d5_f3ec_4889_9e7f_02805d273fb6` 
  ...
[0m09:37:21.888999 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:37:21.897292 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:37:21.904971 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:37:21.964890 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:37:22.080939 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:37:22.179286 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:37:22.266357 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c93fe0d5-f3ec-4889-9e7f-02805d273fb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c04304b730>]}
[0m09:37:22.302460 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.49s]
[0m09:37:22.374733 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:37:22.403419 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_c93fe0d5_f3ec_4889_9e7f_02805d273fb6`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:37:22.406814 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_c93fe0d5_f3ec_4889_9e7f_02805d273fb6`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:37:22.462679 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:37:22.465410 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:37:22.575112 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_c93fe0d5_f3ec_4889_9e7f_02805d273fb6'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:37:22.576269 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_c93fe0d5_f3ec_4889_9e7f_02805d273fb6'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:37:22.585162 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:37:22.587750 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:37:22.600806 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:37:22.606277 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:37:22.609229 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_c93fe0d5_f3ec_4889_9e7f_02805d273fb6`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:37:22.663112 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_c93fe0d5_f3ec_4889_9e7f_02805d273fb6`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:37:22.692941 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:37:22.695414 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:37:22.699651 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c93fe0d5_f3ec_4889_9e7f_02805d273fb6`)
      
    ...
[0m09:37:22.703860 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c93fe0d5_f3ec_4889_9e7f_02805d273fb6`)
      
    ...
[0m09:37:22.734286 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:37:22.742499 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:37:22.744108 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:37:22.751241 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:37:22.755526 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:37:22.762968 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:37:22.763685 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c93fe0d5_f3ec_4889_9e7f_02805d273fb6` 
    ...
[0m09:37:22.766547 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c93fe0d5_f3ec_4889_9e7f_02805d273fb6` 
    ...
[0m09:37:22.772945 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:37:22.779017 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c93fe0d5_f3ec_4889_9e7f_02805d273fb6` 
  ...
[0m09:37:22.780281 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:37:22.788958 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c93fe0d5_f3ec_4889_9e7f_02805d273fb6` 
  ...
[0m09:37:22.790356 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:37:22.798434 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:37:22.799761 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:37:22.807588 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:37:22.809497 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:37:22.863759 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:37:22.866299 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c93fe0d5-f3ec-4889-9e7f-02805d273fb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c04312cfa0>]}
[0m09:37:22.872514 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c93fe0d5-f3ec-4889-9e7f-02805d273fb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c0428c9280>]}
[0m09:37:22.874937 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.09s]
[0m09:37:22.877452 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.10s]
[0m09:37:22.880269 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:37:22.883142 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:37:22.887642 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:37:22.888884 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:37:22.890166 [debug] [MainThread]: On list__clean: Close
[0m09:37:22.891312 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:37:22.892490 [debug] [MainThread]: On list__mart: Close
[0m09:37:22.893744 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:37:22.894904 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:37:22.896056 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m09:37:22.897249 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m09:37:22.898397 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:37:22.899642 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:37:22.900802 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:37:22.901954 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:37:22.904370 [info ] [MainThread]: 
[0m09:37:22.905908 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.32 seconds (4.32s).
[0m09:37:22.965775 [debug] [MainThread]: Command end result
[0m09:37:23.181366 [info ] [MainThread]: 
[0m09:37:23.183043 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:37:23.184523 [info ] [MainThread]: 
[0m09:37:23.186016 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:37:23.189013 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.2122893, "process_in_blocks": "0", "process_kernel_time": 0.659934, "process_mem_max_rss": "114896", "process_out_blocks": "9744", "process_user_time": 6.357201}
[0m09:37:23.190946 [debug] [MainThread]: Command `dbt build` succeeded at 09:37:23.190289 after 7.21 seconds
[0m09:37:23.192883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c047151e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c0433c3b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c04208b0a0>]}
[0m09:37:23.194188 [debug] [MainThread]: Flushing usage events
[0m09:38:16.103405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73477944e310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7347760b0b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7347760b0a30>]}


============================== 09:38:16.117996 | b931e7ec-16cd-4066-8212-f52290d41ba2 ==============================
[0m09:38:16.117996 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:38:16.119933 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'partial_parse': 'True', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'introspect': 'True', 'warn_error': 'None', 'empty': 'False', 'profiles_dir': '.', 'printer_width': '80', 'write_json': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'version_check': 'True', 'target_path': 'None', 'debug': 'False'}
[0m09:38:16.711347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b931e7ec-16cd-4066-8212-f52290d41ba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7347789dbb80>]}
[0m09:38:16.905243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b931e7ec-16cd-4066-8212-f52290d41ba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73477608d3d0>]}
[0m09:38:16.906517 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:38:17.326618 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:38:17.829334 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:38:17.829963 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:38:18.031254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b931e7ec-16cd-4066-8212-f52290d41ba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734775811e80>]}
[0m09:38:18.533611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b931e7ec-16cd-4066-8212-f52290d41ba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7347758268b0>]}
[0m09:38:18.534506 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:38:18.537759 [info ] [MainThread]: 
[0m09:38:18.538786 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:38:18.550406 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:38:18.551918 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:38:18.625132 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:38:18.685715 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:38:19.359920 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:38:19.386398 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:38:19.400904 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:38:19.409566 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:38:19.501770 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:38:19.513360 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:38:19.523692 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:38:19.532308 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:38:19.539197 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:38:19.600389 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:38:19.616426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b931e7ec-16cd-4066-8212-f52290d41ba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734774e87940>]}
[0m09:38:19.618319 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:38:19.619589 [info ] [MainThread]: 
[0m09:38:19.692781 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:38:19.693916 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:38:19.694976 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:38:19.695727 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:38:19.712008 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:38:19.713162 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:38:19.896220 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:38:19.963279 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:38:19.965077 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:38:19.979185 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:38:20.117683 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:38:20.121220 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:38:20.123113 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:38:20.126114 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:38:20.131793 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:38:20.134762 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:38:20.136620 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:38:20.187649 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:38:20.233234 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:38:20.236850 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:38:20.290670 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b931e7ec-16cd-4066-8212-f52290d41ba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73477557e670>]}
[0m09:38:20.291911 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m09:38:20.293375 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:38:20.295467 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:38:20.296708 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:38:20.298122 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:38:20.299741 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:38:20.301448 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:38:20.303492 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:38:20.305461 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:38:20.307342 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:38:20.309482 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:38:20.311556 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:38:20.334013 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:38:20.391944 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:38:20.420913 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:38:20.430334 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:38:20.498716 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:38:20.501345 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:38:20.503279 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:38:20.515435 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:38:20.808260 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:38:20.810996 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:38:20.813877 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:38:20.816704 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:38:20.818740 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:38:20.821508 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:38:21.096008 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:38:21.107239 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:38:21.109423 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:38:21.122253 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.82s]
[0m09:38:21.124859 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:38:21.126829 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:38:21.128942 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:38:21.134995 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.82s]
[0m09:38:21.188075 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:38:21.198996 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:38:21.204796 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.90s]
[0m09:38:21.207679 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:38:21.211098 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:38:21.213715 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:38:21.212457 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:38:21.215477 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:38:21.217669 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:38:21.219670 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:38:21.221635 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:38:21.223425 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:38:21.225149 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:38:21.226713 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:38:21.228322 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:38:21.296088 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:38:21.323217 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:38:21.392976 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:38:21.401908 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:38:21.404686 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:38:21.406635 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:38:21.413547 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:38:21.586898 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:38:21.707119 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:38:21.786947 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:38:21.830899 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:38:21.991867 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m09:38:22.088390 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:38:22.113716 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:38:22.208415 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:38:22.293955 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:38:22.322531 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:38:22.310412 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b931e7ec_16cd_4066_8212_f52290d41ba2` 
  ...
[0m09:38:22.387923 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b931e7ec_16cd_4066_8212_f52290d41ba2` 
  ...
[0m09:38:22.392670 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:38:22.397299 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:38:22.410097 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:38:22.414229 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:38:22.591005 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:38:22.605312 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_b931e7ec_16cd_4066_8212_f52290d41ba2`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:38:22.605984 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_b931e7ec_16cd_4066_8212_f52290d41ba2`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:38:22.608660 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b931e7ec-16cd-4066-8212-f52290d41ba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73477559cf10>]}
[0m09:38:22.611879 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.38s]
[0m09:38:22.613478 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:38:22.635028 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:38:22.650522 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:38:22.689316 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_b931e7ec_16cd_4066_8212_f52290d41ba2'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:38:22.653499 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_b931e7ec_16cd_4066_8212_f52290d41ba2'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:38:22.696872 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:38:22.703368 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:38:22.704825 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:38:22.707697 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:38:22.708967 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_b931e7ec_16cd_4066_8212_f52290d41ba2`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:38:22.710048 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_b931e7ec_16cd_4066_8212_f52290d41ba2`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:38:22.727048 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:38:22.729213 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b931e7ec_16cd_4066_8212_f52290d41ba2`)
      
    ...
[0m09:38:22.731970 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:38:22.734467 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b931e7ec_16cd_4066_8212_f52290d41ba2`)
      
    ...
[0m09:38:22.747299 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:38:22.753655 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:38:22.755206 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:38:22.791053 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:38:22.792669 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:38:22.795725 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b931e7ec_16cd_4066_8212_f52290d41ba2` 
    ...
[0m09:38:22.802204 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:38:22.807087 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b931e7ec_16cd_4066_8212_f52290d41ba2` 
    ...
[0m09:38:22.808656 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:38:22.815841 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b931e7ec_16cd_4066_8212_f52290d41ba2` 
  ...
[0m09:38:22.819292 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:38:22.820887 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:38:22.827159 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:38:22.885133 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b931e7ec_16cd_4066_8212_f52290d41ba2` 
  ...
[0m09:38:22.889881 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:38:22.891585 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:38:22.895094 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b931e7ec-16cd-4066-8212-f52290d41ba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7347761ab2b0>]}
[0m09:38:22.904906 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:38:22.906571 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.67s]
[0m09:38:22.909410 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:38:22.911418 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:38:22.916861 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b931e7ec-16cd-4066-8212-f52290d41ba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73477557e5b0>]}
[0m09:38:22.918770 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.70s]
[0m09:38:22.920829 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:38:22.923071 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:38:22.923672 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:38:22.924223 [debug] [MainThread]: On list__clean: Close
[0m09:38:22.924764 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:38:22.925280 [debug] [MainThread]: On list__mart: Close
[0m09:38:22.925807 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:38:22.926340 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:38:22.926884 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:38:22.927426 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:38:22.927931 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m09:38:22.928446 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m09:38:22.928958 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:38:22.929470 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:38:22.930647 [info ] [MainThread]: 
[0m09:38:22.931341 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.39 seconds (4.39s).
[0m09:38:22.985827 [debug] [MainThread]: Command end result
[0m09:38:23.093505 [info ] [MainThread]: 
[0m09:38:23.094400 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:38:23.095014 [info ] [MainThread]: 
[0m09:38:23.095639 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:38:23.096955 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.196977, "process_in_blocks": "0", "process_kernel_time": 0.706992, "process_mem_max_rss": "115040", "process_out_blocks": "9744", "process_user_time": 6.250882}
[0m09:38:23.097681 [debug] [MainThread]: Command `dbt build` succeeded at 09:38:23.097478 after 7.20 seconds
[0m09:38:23.098283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73477944e310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73477580bfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734776bd09a0>]}
[0m09:38:23.098897 [debug] [MainThread]: Flushing usage events
[0m09:39:17.408736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7116a0348310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71169cfa9ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71169cfa9970>]}


============================== 09:39:17.417988 | a2dff908-9a73-41d0-b6d5-fe2e55c0d482 ==============================
[0m09:39:17.417988 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:39:17.418998 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'printer_width': '80', 'log_path': '/workdir/transforms/04_btc/logs', 'version_check': 'True', 'empty': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'write_json': 'True', 'warn_error': 'None', 'target_path': 'None', 'partial_parse': 'True', 'introspect': 'True', 'profiles_dir': '.', 'debug': 'False', 'log_format': 'default', 'use_colors': 'True', 'no_print': 'None', 'indirect_selection': 'eager', 'quiet': 'False', 'fail_fast': 'False'}
[0m09:39:17.944701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a2dff908-9a73-41d0-b6d5-fe2e55c0d482', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71169cf7f190>]}
[0m09:39:18.138010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a2dff908-9a73-41d0-b6d5-fe2e55c0d482', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7116a057da00>]}
[0m09:39:18.139294 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:39:18.549916 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:39:19.109973 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:39:19.110709 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:39:19.315626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a2dff908-9a73-41d0-b6d5-fe2e55c0d482', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71169c70ef40>]}
[0m09:39:19.769447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a2dff908-9a73-41d0-b6d5-fe2e55c0d482', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71169c74c400>]}
[0m09:39:19.770405 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:39:19.773823 [info ] [MainThread]: 
[0m09:39:19.808692 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:39:19.821885 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:39:19.832699 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:39:19.850940 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:39:19.909461 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:39:20.586353 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:39:20.616193 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:39:20.622614 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:39:20.632200 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:39:20.729166 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:39:20.731029 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:39:20.746728 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:39:20.752162 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:39:20.810195 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:39:20.811777 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:39:20.838331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a2dff908-9a73-41d0-b6d5-fe2e55c0d482', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71169cef1ac0>]}
[0m09:39:20.840232 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:39:20.841619 [info ] [MainThread]: 
[0m09:39:20.917233 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:39:20.918641 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:39:20.920008 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:39:20.920986 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:39:20.941468 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:39:20.942644 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:39:21.131735 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:39:21.199099 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:39:21.200489 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:39:21.212363 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:39:21.339375 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:39:21.343022 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:39:21.344909 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:39:21.347764 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:39:21.353326 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:39:21.356963 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:39:21.358842 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:39:21.361883 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:39:21.453192 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:39:21.456654 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:39:21.512396 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a2dff908-9a73-41d0-b6d5-fe2e55c0d482', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71169f8ea520>]}
[0m09:39:21.513956 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m09:39:21.515387 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:39:21.517513 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:39:21.519062 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:39:21.520481 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:39:21.521990 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:39:21.523743 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:39:21.525658 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:39:21.527639 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:39:21.529681 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:39:21.531760 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:39:21.533446 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:39:21.535163 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:39:21.536890 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:39:21.717241 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:39:21.719132 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:39:21.713273 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:39:21.721689 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:39:21.723874 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:39:21.735838 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:39:22.014370 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:39:22.020075 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:39:22.042045 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:39:22.044642 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:39:22.046869 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:39:22.048477 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:39:22.344065 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:39:22.355884 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:39:22.363967 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:39:22.413518 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:39:22.416431 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.88s]
[0m09:39:22.419509 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:39:22.424390 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:39:22.431638 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.90s]
[0m09:39:22.435067 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:39:22.438086 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:39:22.444194 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.91s]
[0m09:39:22.447661 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:39:22.450316 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:39:22.451277 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:39:22.452481 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:39:22.453782 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:39:22.455877 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:39:22.457694 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:39:22.459489 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:39:22.510312 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:39:22.511983 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:39:22.513654 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:39:22.515335 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:39:22.537741 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:39:22.622302 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:39:22.641850 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:39:22.638257 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:39:22.644199 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:39:22.646301 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:39:22.724429 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:39:22.737958 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:39:22.819688 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:39:22.909891 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:39:23.014222 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:39:23.040056 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:39:23.054892 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:39:23.137096 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:39:23.246419 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:39:23.353422 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:39:23.416517 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:39:23.531387 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:39:23.641719 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_a2dff908_9a73_41d0_b6d5_fe2e55c0d482` 
  ...
[0m09:39:23.711211 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:39:23.713692 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_a2dff908_9a73_41d0_b6d5_fe2e55c0d482` 
  ...
[0m09:39:23.716635 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:39:23.722655 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:39:23.730796 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:39:23.743491 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a2dff908-9a73-41d0-b6d5-fe2e55c0d482', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71169ba78cd0>]}
[0m09:39:23.830483 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.23s]
[0m09:39:23.854951 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:39:24.135187 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_a2dff908_9a73_41d0_b6d5_fe2e55c0d482`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:39:24.137667 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_a2dff908_9a73_41d0_b6d5_fe2e55c0d482`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:39:24.174056 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:39:24.210714 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:39:24.255422 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_a2dff908_9a73_41d0_b6d5_fe2e55c0d482'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:39:24.308953 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_a2dff908_9a73_41d0_b6d5_fe2e55c0d482'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:39:24.320337 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:39:24.322919 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:39:24.336189 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:39:24.341904 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:39:24.345290 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_a2dff908_9a73_41d0_b6d5_fe2e55c0d482`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:39:24.347869 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_a2dff908_9a73_41d0_b6d5_fe2e55c0d482`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:39:24.381569 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:39:24.383971 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:39:24.409774 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_a2dff908_9a73_41d0_b6d5_fe2e55c0d482`)
      
    ...
[0m09:39:24.414029 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_a2dff908_9a73_41d0_b6d5_fe2e55c0d482`)
      
    ...
[0m09:39:24.444183 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:39:24.456790 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:39:24.459279 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:39:24.474185 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:39:24.477282 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:39:24.514011 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_a2dff908_9a73_41d0_b6d5_fe2e55c0d482` 
    ...
[0m09:39:24.519794 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:39:24.525711 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_a2dff908_9a73_41d0_b6d5_fe2e55c0d482` 
    ...
[0m09:39:24.529974 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:39:24.543227 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:39:24.545500 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_a2dff908_9a73_41d0_b6d5_fe2e55c0d482` 
  ...
[0m09:39:24.609363 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_a2dff908_9a73_41d0_b6d5_fe2e55c0d482` 
  ...
[0m09:39:24.614820 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:39:24.617513 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:39:24.631544 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:39:24.644220 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:39:24.650863 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:39:24.653288 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:39:24.710949 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a2dff908-9a73-41d0-b6d5-fe2e55c0d482', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71169e1d6ee0>]}
[0m09:39:24.714678 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a2dff908-9a73-41d0-b6d5-fe2e55c0d482', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71169d0a6d30>]}
[0m09:39:24.716650 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.25s]
[0m09:39:24.718482 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.20s]
[0m09:39:24.721436 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:39:24.724299 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:39:24.728803 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:39:24.729941 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:39:24.731064 [debug] [MainThread]: On list__mart: Close
[0m09:39:24.732114 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:39:24.733184 [debug] [MainThread]: On list__clean: Close
[0m09:39:24.734346 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:39:24.735823 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:39:24.736994 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:39:24.738181 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:39:24.739415 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m09:39:24.740636 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m09:39:24.741758 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:39:24.742910 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:39:24.745435 [info ] [MainThread]: 
[0m09:39:24.746885 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.94 seconds (4.94s).
[0m09:39:24.755232 [debug] [MainThread]: Command end result
[0m09:39:25.012419 [info ] [MainThread]: 
[0m09:39:25.014093 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:39:25.015387 [info ] [MainThread]: 
[0m09:39:25.016776 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:39:25.019432 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.803969, "process_in_blocks": "0", "process_kernel_time": 0.729493, "process_mem_max_rss": "114492", "process_out_blocks": "9744", "process_user_time": 6.488344}
[0m09:39:25.020987 [debug] [MainThread]: Command `dbt build` succeeded at 09:39:25.020602 after 7.81 seconds
[0m09:39:25.022212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7116a0348310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71169c676520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71169b199c10>]}
[0m09:39:25.023391 [debug] [MainThread]: Flushing usage events
[0m09:40:16.861651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a096dd3ddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a096a99bc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a096a99bac0>]}


============================== 09:40:16.871009 | 59e2d7b4-2a2c-48a6-9743-ff4c13e3fba5 ==============================
[0m09:40:16.871009 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:40:16.872072 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'indirect_selection': 'eager', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'log_format': 'default', 'log_path': '/workdir/transforms/04_btc/logs', 'target_path': 'None', 'no_print': 'None', 'write_json': 'True', 'printer_width': '80', 'partial_parse': 'True', 'quiet': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'static_parser': 'True', 'profiles_dir': '.', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m09:40:17.456588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '59e2d7b4-2a2c-48a6-9743-ff4c13e3fba5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a096a95fe20>]}
[0m09:40:17.653865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '59e2d7b4-2a2c-48a6-9743-ff4c13e3fba5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a096aaa4610>]}
[0m09:40:17.655246 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:40:18.067908 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:40:18.571446 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:40:18.572080 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:40:18.771624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '59e2d7b4-2a2c-48a6-9743-ff4c13e3fba5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a096a107e20>]}
[0m09:40:19.248005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '59e2d7b4-2a2c-48a6-9743-ff4c13e3fba5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a096a1453a0>]}
[0m09:40:19.248888 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:40:19.252103 [info ] [MainThread]: 
[0m09:40:19.253133 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:40:19.264985 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:40:19.272261 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:40:19.361406 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:40:19.364293 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:40:19.995818 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:40:20.002453 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:20.004599 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:40:20.011725 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:20.059290 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:40:20.066199 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:40:20.076928 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:40:20.082957 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:40:20.092446 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:20.158741 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:40:20.172722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '59e2d7b4-2a2c-48a6-9743-ff4c13e3fba5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a096a064490>]}
[0m09:40:20.175106 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:40:20.177371 [info ] [MainThread]: 
[0m09:40:20.256400 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:40:20.257567 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:40:20.258671 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:40:20.259379 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:40:20.275766 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:40:20.276902 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:40:20.464393 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:40:20.530505 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:40:20.538326 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:40:20.551769 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:20.674479 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:40:20.677683 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:40:20.680071 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:40:20.683078 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:40:20.738141 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:40:20.741466 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:40:20.743432 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:40:20.746281 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:40:20.844318 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:40:20.847764 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:40:20.853753 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '59e2d7b4-2a2c-48a6-9743-ff4c13e3fba5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a09694acd30>]}
[0m09:40:20.854898 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m09:40:20.856210 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:40:20.858562 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:40:20.859980 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:40:20.861179 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:40:20.863054 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:40:20.864967 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:40:20.867163 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:40:20.868924 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:40:20.871401 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:40:20.873130 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:40:20.875200 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:40:20.876821 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:40:20.943696 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:40:21.072359 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:40:21.081651 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:40:21.083488 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:40:21.086282 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:40:21.139757 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:40:21.146676 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:40:21.372888 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:40:21.450170 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:40:21.460880 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:40:21.463693 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:40:21.466098 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:40:21.470195 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:40:22.579033 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:40:22.587171 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:40:22.588577 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:22.597170 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 1.72s]
[0m09:40:22.598768 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:22.599970 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:40:22.601277 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:40:22.604237 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.73s]
[0m09:40:22.606965 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:40:22.611174 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:22.614055 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.75s]
[0m09:40:22.615491 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:40:22.617017 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:40:22.617764 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:40:22.618548 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:40:22.619523 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:40:22.620913 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:40:22.622250 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:40:22.623154 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:40:22.623993 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:40:22.637857 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:40:22.638681 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:40:22.639623 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:40:22.640653 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:40:22.659497 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:40:22.673103 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:40:22.680259 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:40:22.681834 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:40:22.682758 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:40:22.738029 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:40:22.769732 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:40:22.943008 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:40:23.083143 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:40:23.174303 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:40:23.255887 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:40:23.265209 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:40:23.277004 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_59e2d7b4_2a2c_48a6_9743_ff4c13e3fba5` 
  ...
[0m09:40:23.351381 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_59e2d7b4_2a2c_48a6_9743_ff4c13e3fba5` 
  ...
[0m09:40:23.355931 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:23.360441 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:23.373700 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:40:23.378154 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:40:23.560235 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m09:40:23.585422 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:40:23.680594 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:40:23.851675 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:40:23.870236 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_59e2d7b4_2a2c_48a6_9743_ff4c13e3fba5`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:40:23.867446 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_59e2d7b4_2a2c_48a6_9743_ff4c13e3fba5`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:40:23.878283 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:23.938119 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '59e2d7b4-2a2c-48a6-9743-ff4c13e3fba5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0968cfa190>]}
[0m09:40:23.940698 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:40:23.943084 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:40:23.945711 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.30s]
[0m09:40:24.040274 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_59e2d7b4_2a2c_48a6_9743_ff4c13e3fba5'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:40:24.043606 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_59e2d7b4_2a2c_48a6_9743_ff4c13e3fba5'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:40:24.045624 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:40:24.052894 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:40:24.064753 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:40:24.063438 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:40:24.067778 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:40:24.069487 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_59e2d7b4_2a2c_48a6_9743_ff4c13e3fba5`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:40:24.070787 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_59e2d7b4_2a2c_48a6_9743_ff4c13e3fba5`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:40:24.093904 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:40:24.096442 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:40:24.100265 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_59e2d7b4_2a2c_48a6_9743_ff4c13e3fba5`)
      
    ...
[0m09:40:24.104986 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_59e2d7b4_2a2c_48a6_9743_ff4c13e3fba5`)
      
    ...
[0m09:40:24.167187 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:40:24.169687 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:40:24.179982 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:40:24.187381 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:40:24.195618 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:24.198365 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:24.204964 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_59e2d7b4_2a2c_48a6_9743_ff4c13e3fba5` 
    ...
[0m09:40:24.210657 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_59e2d7b4_2a2c_48a6_9743_ff4c13e3fba5` 
    ...
[0m09:40:24.246158 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:40:24.248903 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:24.261341 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_59e2d7b4_2a2c_48a6_9743_ff4c13e3fba5` 
  ...
[0m09:40:24.273390 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_59e2d7b4_2a2c_48a6_9743_ff4c13e3fba5` 
  ...
[0m09:40:24.281361 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:24.288337 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:24.349888 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:40:24.365527 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:40:24.372850 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:24.375278 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:40:24.382238 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '59e2d7b4-2a2c-48a6-9743-ff4c13e3fba5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0968c99fa0>]}
[0m09:40:24.440994 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '59e2d7b4-2a2c-48a6-9743-ff4c13e3fba5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0968d342b0>]}
[0m09:40:24.443326 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.76s]
[0m09:40:24.445926 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.82s]
[0m09:40:24.448892 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:40:24.451767 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:40:24.459834 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:40:24.461158 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:40:24.462371 [debug] [MainThread]: On list__mart: Close
[0m09:40:24.463511 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:40:24.464689 [debug] [MainThread]: On list__clean: Close
[0m09:40:24.465796 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:40:24.466987 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:40:24.468113 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m09:40:24.469278 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m09:40:24.470479 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:40:24.471645 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:40:24.472742 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:40:24.474010 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:40:24.476342 [info ] [MainThread]: 
[0m09:40:24.477812 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.22 seconds (5.22s).
[0m09:40:24.485977 [debug] [MainThread]: Command end result
[0m09:40:24.678764 [info ] [MainThread]: 
[0m09:40:24.679782 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:40:24.680498 [info ] [MainThread]: 
[0m09:40:24.681180 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:40:24.682661 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 8.013398, "process_in_blocks": "0", "process_kernel_time": 0.741848, "process_mem_max_rss": "114948", "process_out_blocks": "9744", "process_user_time": 6.287955}
[0m09:40:24.683635 [debug] [MainThread]: Command `dbt build` succeeded at 09:40:24.683352 after 8.01 seconds
[0m09:40:24.684465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a096dd3ddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a096bcc6310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a096bc53100>]}
[0m09:40:24.685194 [debug] [MainThread]: Flushing usage events
[0m09:41:17.538676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6e9136310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6e5d91af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6e5d919a0>]}


============================== 09:41:17.548373 | 211be4f2-6897-445d-b094-675296ce56b0 ==============================
[0m09:41:17.548373 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:41:17.599968 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'version_check': 'True', 'indirect_selection': 'eager', 'warn_error': 'None', 'introspect': 'True', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'debug': 'False', 'empty': 'False', 'log_cache_events': 'False', 'fail_fast': 'False', 'log_format': 'default', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'profiles_dir': '.', 'no_print': 'None', 'target_path': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'use_colors': 'True', 'printer_width': '80', 'quiet': 'False'}
[0m09:41:18.134597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '211be4f2-6897-445d-b094-675296ce56b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6e5cc8160>]}
[0m09:41:18.332112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '211be4f2-6897-445d-b094-675296ce56b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6e5cd9f70>]}
[0m09:41:18.333523 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:41:18.802024 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:41:19.308567 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:41:19.309320 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:41:19.509188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '211be4f2-6897-445d-b094-675296ce56b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6e54f6ee0>]}
[0m09:41:19.954913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '211be4f2-6897-445d-b094-675296ce56b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6e54e0130>]}
[0m09:41:19.955832 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:41:19.959151 [info ] [MainThread]: 
[0m09:41:19.960210 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:41:20.004881 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:41:20.006813 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:41:20.046431 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:41:20.109858 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:41:20.909689 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:41:20.920654 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:41:20.923384 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:41:20.933612 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:41:21.025240 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:41:21.036937 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:41:21.041416 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:41:21.046829 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:41:21.108841 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:41:21.120900 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:41:21.139464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '211be4f2-6897-445d-b094-675296ce56b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6e503fd30>]}
[0m09:41:21.141496 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:41:21.142899 [info ] [MainThread]: 
[0m09:41:21.218337 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:41:21.219596 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:41:21.220669 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:41:21.221432 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:41:21.237481 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:41:21.238744 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:41:21.427726 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:41:21.499076 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:41:21.500568 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:41:21.512756 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:41:21.640981 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:41:21.644637 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:41:21.646492 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:41:21.649646 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:41:21.703982 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:41:21.707196 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:41:21.709228 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:41:21.712117 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:41:21.807293 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:41:21.810829 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:41:21.816862 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '211be4f2-6897-445d-b094-675296ce56b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6e488ddc0>]}
[0m09:41:21.818034 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m09:41:21.819381 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:41:21.821752 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:41:21.822785 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:41:21.824014 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:41:21.825976 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:41:21.827680 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:41:21.829995 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:41:21.831934 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:41:21.834234 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:41:21.836086 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:41:21.838224 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:41:21.839943 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:41:21.904709 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:41:22.021246 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:41:22.023428 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:41:22.034578 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:41:22.037233 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:41:22.039373 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:41:22.105044 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:41:22.409695 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:41:22.422923 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:41:22.424230 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:41:22.427120 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:41:22.428918 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:41:22.434076 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:41:22.716151 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:41:22.721231 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:41:22.726056 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:41:22.737674 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:41:22.741330 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:41:22.744191 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:41:22.811884 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.97s]
[0m09:41:22.817844 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.98s]
[0m09:41:22.823786 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.99s]
[0m09:41:22.826915 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:41:22.829961 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:41:22.832949 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:41:22.836615 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:41:22.837951 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:41:22.839604 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:41:22.841011 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:41:22.843097 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:41:22.844935 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:41:22.847176 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:41:22.848649 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:41:22.849710 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:41:22.899334 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:41:22.901239 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:41:22.923750 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:41:23.003082 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:41:23.010985 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:41:23.017777 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:41:23.019338 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:41:23.020084 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:41:23.020987 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:41:23.205816 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:41:23.304974 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:41:23.400576 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:41:23.440475 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:41:23.600445 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:41:23.630584 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:41:23.730168 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:41:23.817917 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:41:23.809108 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_211be4f2_6897_445d_b094_675296ce56b0` 
  ...
[0m09:41:23.917018 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:41:23.928802 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_211be4f2_6897_445d_b094_675296ce56b0` 
  ...
[0m09:41:23.932807 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m09:41:24.002209 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:41:24.020789 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:41:24.041859 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:41:24.207613 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:41:24.244685 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:41:24.319797 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '211be4f2-6897-445d-b094-675296ce56b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6e40af130>]}
[0m09:41:24.332908 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.47s]
[0m09:41:24.414844 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_211be4f2_6897_445d_b094_675296ce56b0`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:41:24.418193 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_211be4f2_6897_445d_b094_675296ce56b0`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:41:24.421239 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:41:24.460787 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:41:24.477081 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:41:24.537820 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_211be4f2_6897_445d_b094_675296ce56b0'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:41:24.539290 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_211be4f2_6897_445d_b094_675296ce56b0'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:41:24.600624 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:41:24.602222 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:41:24.615757 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:41:24.621264 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:41:24.624682 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_211be4f2_6897_445d_b094_675296ce56b0`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:41:24.627163 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_211be4f2_6897_445d_b094_675296ce56b0`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:41:24.659614 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:41:24.662096 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:41:24.666506 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_211be4f2_6897_445d_b094_675296ce56b0`)
      
    ...
[0m09:41:24.670796 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_211be4f2_6897_445d_b094_675296ce56b0`)
      
    ...
[0m09:41:24.725890 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:41:24.731625 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:41:24.734359 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:41:24.748058 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:41:24.750298 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:41:24.755836 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_211be4f2_6897_445d_b094_675296ce56b0` 
    ...
[0m09:41:24.759262 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:41:24.765337 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_211be4f2_6897_445d_b094_675296ce56b0` 
    ...
[0m09:41:24.767088 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:41:24.812205 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_211be4f2_6897_445d_b094_675296ce56b0` 
  ...
[0m09:41:24.814899 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:41:24.830292 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_211be4f2_6897_445d_b094_675296ce56b0` 
  ...
[0m09:41:24.833024 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:41:24.900432 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:41:24.847188 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:41:24.915238 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:41:24.920655 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:41:24.928449 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:41:24.929917 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '211be4f2-6897-445d-b094-675296ce56b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6e502c370>]}
[0m09:41:24.936713 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '211be4f2-6897-445d-b094-675296ce56b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6e5be7f40>]}
[0m09:41:24.939101 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.08s]
[0m09:41:24.941570 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.09s]
[0m09:41:24.944395 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:41:24.999697 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:41:25.004511 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:41:25.005706 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:41:25.006830 [debug] [MainThread]: On list__clean: Close
[0m09:41:25.007881 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:41:25.009013 [debug] [MainThread]: On list__mart: Close
[0m09:41:25.010050 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:41:25.011169 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:41:25.012335 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m09:41:25.013428 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m09:41:25.014469 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:41:25.015544 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:41:25.016617 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:41:25.018258 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:41:25.021788 [info ] [MainThread]: 
[0m09:41:25.023839 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.06 seconds (5.06s).
[0m09:41:25.034918 [debug] [MainThread]: Command end result
[0m09:41:25.202161 [info ] [MainThread]: 
[0m09:41:25.203096 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:41:25.203723 [info ] [MainThread]: 
[0m09:41:25.204366 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:41:25.205725 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.860926, "process_in_blocks": "0", "process_kernel_time": 0.730478, "process_mem_max_rss": "114848", "process_out_blocks": "9744", "process_user_time": 6.570317}
[0m09:41:25.206473 [debug] [MainThread]: Command `dbt build` succeeded at 09:41:25.206270 after 7.86 seconds
[0m09:41:25.207154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6e9136310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6e5cd9f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e6e83ffcd0>]}
[0m09:41:25.207781 [debug] [MainThread]: Flushing usage events
[0m09:42:16.931255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779a45b74310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779a427d8b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779a427d89d0>]}


============================== 09:42:16.992569 | 79da9acd-f1ad-4886-b9a4-bf2a71fac541 ==============================
[0m09:42:16.992569 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:42:16.993719 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt build --profiles-dir . --target local', 'log_path': '/workdir/transforms/04_btc/logs', 'use_experimental_parser': 'False', 'no_print': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'use_colors': 'True', 'introspect': 'True', 'indirect_selection': 'eager', 'static_parser': 'True', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'empty': 'False', 'target_path': 'None', 'partial_parse': 'True', 'printer_width': '80', 'log_format': 'default', 'fail_fast': 'False', 'profiles_dir': '.'}
[0m09:42:17.528201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '79da9acd-f1ad-4886-b9a4-bf2a71fac541', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779a451113a0>]}
[0m09:42:17.722038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '79da9acd-f1ad-4886-b9a4-bf2a71fac541', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779a4271e280>]}
[0m09:42:17.723292 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:42:18.187673 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:42:18.693981 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:42:18.694711 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:42:18.896035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '79da9acd-f1ad-4886-b9a4-bf2a71fac541', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779a41f3eee0>]}
[0m09:42:19.343382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '79da9acd-f1ad-4886-b9a4-bf2a71fac541', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779a44e53c40>]}
[0m09:42:19.344260 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:42:19.347464 [info ] [MainThread]: 
[0m09:42:19.348538 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:42:19.392959 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:42:19.399746 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:42:19.495488 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:42:19.506854 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:42:20.197265 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:42:20.202598 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:42:20.217798 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:42:20.225172 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:42:20.301775 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:42:20.303762 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:42:20.325320 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:42:20.332176 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:42:20.342527 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:42:20.399565 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:42:20.415716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '79da9acd-f1ad-4886-b9a4-bf2a71fac541', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779a424afe50>]}
[0m09:42:20.417512 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:42:20.418869 [info ] [MainThread]: 
[0m09:42:20.498004 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:42:20.499124 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:42:20.500193 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:42:20.500940 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:42:20.517090 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:42:20.518258 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:42:20.699349 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:42:20.765424 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:42:20.766772 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:42:20.778860 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:42:20.904863 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:42:20.908857 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:42:20.910843 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:42:20.913737 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:42:20.919724 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:42:20.922873 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:42:20.924803 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:42:20.927623 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:42:21.024123 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:42:21.027622 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:42:21.033659 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79da9acd-f1ad-4886-b9a4-bf2a71fac541', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779a41b3a6a0>]}
[0m09:42:21.034818 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m09:42:21.036119 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:42:21.038208 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:42:21.039460 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:42:21.087585 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:42:21.089548 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:42:21.091824 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:42:21.093512 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:42:21.096105 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:42:21.098375 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:42:21.100305 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:42:21.102067 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:42:21.103983 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:42:21.105470 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:42:21.224214 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:42:21.230299 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:42:21.229734 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:42:21.232373 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:42:21.233285 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:42:21.292401 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:42:21.399333 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:42:21.400435 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:42:21.402972 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:42:21.404422 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:42:21.405214 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:42:21.406745 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:42:21.551247 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:42:21.558526 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:42:21.565370 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.47s]
[0m09:42:21.569222 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:42:21.575888 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:42:21.577194 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:42:21.594796 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:42:21.596297 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:42:21.599962 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.50s]
[0m09:42:21.603006 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.51s]
[0m09:42:21.604424 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:42:21.605796 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:42:21.607640 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:42:21.608364 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:42:21.609357 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:42:21.610245 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:42:21.611178 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:42:21.611983 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:42:21.612930 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:42:21.613801 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:42:21.614601 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:42:21.615508 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:42:21.616498 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:42:21.634911 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:42:21.635892 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:42:21.690796 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:42:21.702751 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:42:21.704225 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:42:21.710559 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:42:21.721842 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:42:21.817298 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:42:21.910460 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:42:22.028528 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:42:22.100665 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_79da9acd_f1ad_4886_b9a4_bf2a71fac541` 
  ...
[0m09:42:22.106684 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:42:22.119609 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_79da9acd_f1ad_4886_b9a4_bf2a71fac541` 
  ...
[0m09:42:22.122925 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:42:22.124383 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:42:22.126023 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:42:22.128059 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:42:22.304233 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:42:22.416443 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:42:22.500416 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:42:22.517484 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:42:22.605602 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:42:22.608344 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_79da9acd_f1ad_4886_b9a4_bf2a71fac541`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:42:22.610720 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_79da9acd_f1ad_4886_b9a4_bf2a71fac541`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:42:22.625648 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:42:22.635134 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:42:22.693641 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:42:22.696792 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:42:22.691173 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79da9acd-f1ad-4886-b9a4-bf2a71fac541', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779a41abf7f0>]}
[0m09:42:22.799016 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.08s]
[0m09:42:22.809341 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_79da9acd_f1ad_4886_b9a4_bf2a71fac541'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:42:22.811307 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_79da9acd_f1ad_4886_b9a4_bf2a71fac541'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:42:22.814143 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:42:22.824238 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:42:22.826961 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:42:22.889801 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:42:22.894105 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:42:22.896019 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_79da9acd_f1ad_4886_b9a4_bf2a71fac541`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:42:22.897414 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_79da9acd_f1ad_4886_b9a4_bf2a71fac541`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:42:22.919433 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:42:22.920790 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:42:22.922908 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_79da9acd_f1ad_4886_b9a4_bf2a71fac541`)
      
    ...
[0m09:42:22.924858 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_79da9acd_f1ad_4886_b9a4_bf2a71fac541`)
      
    ...
[0m09:42:22.950427 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:42:22.952048 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:42:22.957526 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:42:22.962392 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:42:22.968443 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:42:22.969819 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:42:22.972797 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_79da9acd_f1ad_4886_b9a4_bf2a71fac541` 
    ...
[0m09:42:22.975475 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_79da9acd_f1ad_4886_b9a4_bf2a71fac541` 
    ...
[0m09:42:22.988703 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:42:23.001390 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_79da9acd_f1ad_4886_b9a4_bf2a71fac541` 
  ...
[0m09:42:23.007988 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:42:23.010491 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:42:23.024984 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:42:23.088526 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:42:23.096350 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_79da9acd_f1ad_4886_b9a4_bf2a71fac541` 
  ...
[0m09:42:23.094662 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79da9acd-f1ad-4886-b9a4-bf2a71fac541', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779a411c49d0>]}
[0m09:42:23.102641 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.48s]
[0m09:42:23.105409 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:42:23.108192 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:42:23.121510 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:42:23.127295 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:42:23.133587 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79da9acd-f1ad-4886-b9a4-bf2a71fac541', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779a41ac32e0>]}
[0m09:42:23.135869 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.52s]
[0m09:42:23.189395 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:42:23.193631 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:42:23.194864 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:42:23.196083 [debug] [MainThread]: On list__clean: Close
[0m09:42:23.197485 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:42:23.198716 [debug] [MainThread]: On list__mart: Close
[0m09:42:23.199809 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:42:23.200938 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:42:23.202058 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:42:23.203247 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:42:23.204438 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m09:42:23.205616 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m09:42:23.206695 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:42:23.207816 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:42:23.210102 [info ] [MainThread]: 
[0m09:42:23.211544 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.86 seconds (3.86s).
[0m09:42:23.219752 [debug] [MainThread]: Command end result
[0m09:42:23.428734 [info ] [MainThread]: 
[0m09:42:23.429545 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:42:23.430181 [info ] [MainThread]: 
[0m09:42:23.430865 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:42:23.432199 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.64331, "process_in_blocks": "0", "process_kernel_time": 0.636258, "process_mem_max_rss": "115080", "process_out_blocks": "9744", "process_user_time": 6.141887}
[0m09:42:23.432947 [debug] [MainThread]: Command `dbt build` succeeded at 09:42:23.432756 after 6.64 seconds
[0m09:42:23.433579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779a45b74310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779a43a99160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779a41abf370>]}
[0m09:42:23.434185 [debug] [MainThread]: Flushing usage events
[0m09:43:16.640215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf7e812310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf7b476af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf7b4769a0>]}


============================== 09:43:16.649620 | 8110a2f2-aa4a-4c58-b376-391f6b5b2368 ==============================
[0m09:43:16.649620 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:43:16.650726 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'cache_selected_only': 'False', 'version_check': 'True', 'printer_width': '80', 'warn_error': 'None', 'log_format': 'default', 'log_cache_events': 'False', 'fail_fast': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'target_path': 'None', 'write_json': 'True', 'introspect': 'True', 'profiles_dir': '.', 'partial_parse': 'True'}
[0m09:43:17.232226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8110a2f2-aa4a-4c58-b376-391f6b5b2368', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf7b3ad160>]}
[0m09:43:17.428958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8110a2f2-aa4a-4c58-b376-391f6b5b2368', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf7b3bef70>]}
[0m09:43:17.430332 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:43:17.849192 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:43:18.362948 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:43:18.363689 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:43:18.565814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8110a2f2-aa4a-4c58-b376-391f6b5b2368', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf7abdbee0>]}
[0m09:43:19.045792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8110a2f2-aa4a-4c58-b376-391f6b5b2368', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf7abc5130>]}
[0m09:43:19.046701 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:43:19.049947 [info ] [MainThread]: 
[0m09:43:19.050964 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:43:19.062799 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:43:19.064258 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:43:19.155270 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:43:19.172360 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:43:19.732451 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:43:19.740620 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:43:19.742923 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:43:19.752056 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:43:19.849917 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:43:19.861832 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:43:19.867138 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:43:19.873819 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:43:19.933945 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:43:19.940607 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:43:19.963512 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8110a2f2-aa4a-4c58-b376-391f6b5b2368', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf7a493d30>]}
[0m09:43:19.965361 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:43:19.966710 [info ] [MainThread]: 
[0m09:43:20.044679 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:43:20.045822 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:43:20.046900 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:43:20.047699 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:43:20.064663 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:43:20.065826 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:43:20.252301 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:43:20.318288 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:43:20.319773 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:43:20.336463 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:43:20.350927 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:43:20.354603 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:43:20.356891 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:43:20.360200 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:43:20.473803 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:43:20.527637 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:43:20.529640 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:43:20.532821 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:43:20.625710 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:43:20.629184 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:43:20.635180 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8110a2f2-aa4a-4c58-b376-391f6b5b2368', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf79f73a00>]}
[0m09:43:20.636337 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m09:43:20.637757 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:43:20.639821 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:43:20.641021 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:43:20.642386 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:43:20.643742 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:43:20.645618 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:43:20.647336 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:43:20.648716 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:43:20.651009 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:43:20.652411 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:43:20.654072 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:43:20.655812 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:43:20.673520 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:43:20.745920 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:43:20.747113 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:43:20.761019 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:43:20.763789 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:43:20.827692 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:43:20.860600 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:43:21.071349 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:43:21.133942 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:43:21.152791 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:43:21.155332 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:43:21.157210 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:43:21.160759 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:43:21.461204 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:43:21.468162 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:43:21.473254 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:43:21.478504 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:43:21.526460 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:43:21.530821 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.88s]
[0m09:43:21.534021 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:43:21.539895 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.89s]
[0m09:43:21.543437 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:43:21.550130 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.90s]
[0m09:43:21.553374 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:43:21.557059 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:43:21.560725 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:43:21.562155 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:43:21.563584 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:43:21.565410 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:43:21.566619 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:43:21.568660 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:43:21.570294 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:43:21.571588 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:43:21.572994 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:43:21.625952 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:43:21.627827 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:43:21.629402 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:43:21.742967 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:43:21.757759 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:43:21.760158 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:43:21.761941 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:43:21.768817 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:43:21.828513 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:43:21.840819 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:43:21.866668 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:43:22.031794 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:43:22.067971 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:43:22.136800 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:43:22.151584 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:43:22.253267 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:43:22.355672 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:43:22.442966 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:43:22.452696 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:43:22.536775 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:43:22.655102 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:43:22.670163 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_8110a2f2_aa4a_4c58_b376_391f6b5b2368` 
  ...
[0m09:43:22.764791 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:43:22.769073 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_8110a2f2_aa4a_4c58_b376_391f6b5b2368` 
  ...
[0m09:43:22.826331 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:43:22.828509 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8110a2f2-aa4a-4c58-b376-391f6b5b2368', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf7b2d09a0>]}
[0m09:43:22.843425 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:43:22.864747 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.26s]
[0m09:43:22.968747 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:43:23.168911 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_8110a2f2_aa4a_4c58_b376_391f6b5b2368`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:43:23.170731 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_8110a2f2_aa4a_4c58_b376_391f6b5b2368`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:43:23.381040 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.21 seconds
[0m09:43:23.396057 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.22 seconds
[0m09:43:23.448053 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_8110a2f2_aa4a_4c58_b376_391f6b5b2368'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:43:23.443924 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_8110a2f2_aa4a_4c58_b376_391f6b5b2368'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:43:23.460491 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:43:23.463222 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:43:23.476757 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:43:23.529518 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:43:23.532917 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_8110a2f2_aa4a_4c58_b376_391f6b5b2368`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:43:23.535118 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_8110a2f2_aa4a_4c58_b376_391f6b5b2368`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:43:23.567238 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:43:23.569858 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:43:23.574624 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_8110a2f2_aa4a_4c58_b376_391f6b5b2368`)
      
    ...
[0m09:43:23.578801 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_8110a2f2_aa4a_4c58_b376_391f6b5b2368`)
      
    ...
[0m09:43:23.606888 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:43:23.626148 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:43:23.618645 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:43:23.636963 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:43:23.645321 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:43:23.647556 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:43:23.653131 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_8110a2f2_aa4a_4c58_b376_391f6b5b2368` 
    ...
[0m09:43:23.657002 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_8110a2f2_aa4a_4c58_b376_391f6b5b2368` 
    ...
[0m09:43:23.664256 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:43:23.672183 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_8110a2f2_aa4a_4c58_b376_391f6b5b2368` 
  ...
[0m09:43:23.673398 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:43:23.726411 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:43:23.732860 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_8110a2f2_aa4a_4c58_b376_391f6b5b2368` 
  ...
[0m09:43:23.742725 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:43:23.747582 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:43:23.754417 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:43:23.757206 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:43:23.761208 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8110a2f2-aa4a-4c58-b376-391f6b5b2368', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf7a70a430>]}
[0m09:43:23.764091 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.19s]
[0m09:43:23.765845 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:43:23.767621 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:43:23.771438 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8110a2f2-aa4a-4c58-b376-391f6b5b2368', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf7b2c3670>]}
[0m09:43:23.772704 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.20s]
[0m09:43:23.825374 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:43:23.827596 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:43:23.828216 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:43:23.828820 [debug] [MainThread]: On list__clean: Close
[0m09:43:23.829323 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:43:23.829871 [debug] [MainThread]: On list__mart: Close
[0m09:43:23.830360 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:43:23.830906 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:43:23.831401 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:43:23.831955 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:43:23.832458 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:43:23.833012 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:43:23.833506 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m09:43:23.834054 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m09:43:23.835203 [info ] [MainThread]: 
[0m09:43:23.835989 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.78 seconds (4.78s).
[0m09:43:23.839728 [debug] [MainThread]: Command end result
[0m09:43:23.972896 [info ] [MainThread]: 
[0m09:43:23.974005 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:43:24.025280 [info ] [MainThread]: 
[0m09:43:24.026945 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:43:24.029813 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.581754, "process_in_blocks": "0", "process_kernel_time": 0.675336, "process_mem_max_rss": "114380", "process_out_blocks": "9752", "process_user_time": 6.397184}
[0m09:43:24.031415 [debug] [MainThread]: Command `dbt build` succeeded at 09:43:24.031002 after 7.58 seconds
[0m09:43:24.032781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf7e812310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf7c6a0640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf79e48520>]}
[0m09:43:24.034093 [debug] [MainThread]: Flushing usage events
[0m09:44:16.397921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725f1ee40310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725f1baa7af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725f1baa79a0>]}


============================== 09:44:16.407305 | eb6e4fa2-097f-4146-8a3c-f080d8ca7b44 ==============================
[0m09:44:16.407305 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:44:16.408397 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'profiles_dir': '.', 'static_parser': 'True', 'partial_parse': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'cache_selected_only': 'False', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'introspect': 'True', 'write_json': 'True', 'printer_width': '80', 'log_format': 'default', 'warn_error': 'None', 'fail_fast': 'False', 'target_path': 'None', 'no_print': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local'}
[0m09:44:16.992087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eb6e4fa2-097f-4146-8a3c-f080d8ca7b44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725f1e3d53a0>]}
[0m09:44:17.190982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eb6e4fa2-097f-4146-8a3c-f080d8ca7b44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725f1bb073a0>]}
[0m09:44:17.192266 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:44:17.607082 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:44:18.109448 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:44:18.110241 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:44:18.365311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eb6e4fa2-097f-4146-8a3c-f080d8ca7b44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725f1b1fcee0>]}
[0m09:44:18.817717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eb6e4fa2-097f-4146-8a3c-f080d8ca7b44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725f1b1e6c70>]}
[0m09:44:18.818615 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:44:18.821793 [info ] [MainThread]: 
[0m09:44:18.822828 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:44:18.866691 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:44:18.873959 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:44:18.971122 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:44:18.980647 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:44:19.669467 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:44:19.676315 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:19.678716 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:44:19.690738 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:19.774671 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:44:19.775865 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:44:19.788614 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:44:19.793293 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:44:19.800594 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:19.801985 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:19.866952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb6e4fa2-097f-4146-8a3c-f080d8ca7b44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725f1acf4910>]}
[0m09:44:19.868258 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:44:19.869781 [info ] [MainThread]: 
[0m09:44:19.893803 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:44:19.894970 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:44:19.896142 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:44:19.896929 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:44:19.966059 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:44:19.967828 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:44:20.110595 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:44:20.225993 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:44:20.227426 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:44:20.240068 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:20.369184 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:44:20.372093 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:44:20.374232 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:44:20.377420 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:44:20.383596 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:44:20.386425 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:44:20.388472 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:44:20.391504 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:44:20.489139 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:44:20.492338 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:44:20.498701 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb6e4fa2-097f-4146-8a3c-f080d8ca7b44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725f1adb0340>]}
[0m09:44:20.500009 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m09:44:20.501370 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:44:20.503027 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:44:20.503886 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:44:20.504726 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:44:20.505502 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:44:20.506437 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:44:20.507418 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:44:20.508501 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:44:20.509494 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:44:20.510433 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:44:20.511240 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:44:20.512027 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:44:20.562683 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:44:20.590576 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:44:20.592330 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:44:20.600762 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:44:20.602358 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:44:20.603186 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:44:20.609105 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:44:20.772479 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:44:20.774396 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:44:20.778091 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:44:20.779735 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:44:20.780705 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:44:20.782663 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:44:20.928740 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:44:20.936915 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:44:20.939190 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:20.968083 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.46s]
[0m09:44:20.970117 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:44:20.971339 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:44:20.973089 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:44:20.976335 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.47s]
[0m09:44:20.979860 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:44:20.984098 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:20.987058 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.48s]
[0m09:44:20.988487 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:44:20.990033 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:44:20.990981 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:44:20.992071 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:44:20.993029 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:44:20.994114 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:44:20.995136 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:44:20.995972 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:44:20.996858 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:44:20.997769 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:44:20.998490 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:44:20.999423 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:44:21.000464 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:44:21.097237 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:44:21.098654 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:44:21.105660 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:44:21.106964 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:44:21.107956 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:44:21.108725 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:44:21.183285 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:44:21.384077 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:44:21.409755 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:44:21.592375 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:44:21.785807 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.18 seconds
[0m09:44:21.805516 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:44:21.807435 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_eb6e4fa2_097f_4146_8a3c_f080d8ca7b44` 
  ...
[0m09:44:21.869264 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:44:21.962741 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_eb6e4fa2_097f_4146_8a3c_f080d8ca7b44` 
  ...
[0m09:44:21.910029 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:44:21.976611 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:44:21.993035 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:22.091204 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:44:22.173245 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:44:22.266305 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:44:22.373317 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:44:22.384385 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_eb6e4fa2_097f_4146_8a3c_f080d8ca7b44`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:44:22.389138 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_eb6e4fa2_097f_4146_8a3c_f080d8ca7b44`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:44:22.399753 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:22.408217 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb6e4fa2-097f-4146-8a3c-f080d8ca7b44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725f1ad302e0>]}
[0m09:44:22.463932 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:44:22.466355 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:44:22.410597 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.41s]
[0m09:44:22.505861 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_eb6e4fa2_097f_4146_8a3c_f080d8ca7b44'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:44:22.565658 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_eb6e4fa2_097f_4146_8a3c_f080d8ca7b44'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:44:22.568347 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:44:22.577391 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:22.580009 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:22.592857 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:44:22.598597 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:44:22.601609 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_eb6e4fa2_097f_4146_8a3c_f080d8ca7b44`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:44:22.603703 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_eb6e4fa2_097f_4146_8a3c_f080d8ca7b44`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:44:22.663186 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:44:22.664884 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:44:22.668869 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_eb6e4fa2_097f_4146_8a3c_f080d8ca7b44`)
      
    ...
[0m09:44:22.673090 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_eb6e4fa2_097f_4146_8a3c_f080d8ca7b44`)
      
    ...
[0m09:44:22.700529 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:44:22.712167 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:44:22.714960 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:44:22.728287 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:44:22.763195 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:44:22.772009 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_eb6e4fa2_097f_4146_8a3c_f080d8ca7b44` 
    ...
[0m09:44:22.775186 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:22.782999 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_eb6e4fa2_097f_4146_8a3c_f080d8ca7b44` 
    ...
[0m09:44:22.787460 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:22.800220 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_eb6e4fa2_097f_4146_8a3c_f080d8ca7b44` 
  ...
[0m09:44:22.806083 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:44:22.808792 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:22.871853 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_eb6e4fa2_097f_4146_8a3c_f080d8ca7b44` 
  ...
[0m09:44:22.885774 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:44:22.888598 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:22.903335 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:22.905457 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:44:22.963705 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb6e4fa2-097f-4146-8a3c-f080d8ca7b44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725f19d8ec10>]}
[0m09:44:22.968009 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.97s]
[0m09:44:22.970997 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:44:22.973893 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:44:22.980671 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb6e4fa2-097f-4146-8a3c-f080d8ca7b44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725f1adb0820>]}
[0m09:44:22.983444 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.98s]
[0m09:44:22.986328 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:44:22.990401 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:44:22.991629 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:44:22.992838 [debug] [MainThread]: On list__clean: Close
[0m09:44:22.993983 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:44:22.995157 [debug] [MainThread]: On list__mart: Close
[0m09:44:22.996292 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:44:22.997454 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:44:22.998586 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:44:22.999763 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:44:23.001034 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:44:23.002230 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:44:23.003350 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m09:44:23.004516 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m09:44:23.006908 [info ] [MainThread]: 
[0m09:44:23.008404 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.18 seconds (4.18s).
[0m09:44:23.067352 [debug] [MainThread]: Command end result
[0m09:44:23.289636 [info ] [MainThread]: 
[0m09:44:23.291417 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:44:23.292749 [info ] [MainThread]: 
[0m09:44:23.294200 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:44:23.296849 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.091299, "process_in_blocks": "0", "process_kernel_time": 0.707187, "process_mem_max_rss": "115004", "process_out_blocks": "9744", "process_user_time": 6.26493}
[0m09:44:23.298345 [debug] [MainThread]: Command `dbt build` succeeded at 09:44:23.297959 after 7.09 seconds
[0m09:44:23.299604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725f1ee40310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725f1cdc5850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x725f1cdc2d00>]}
[0m09:44:23.300814 [debug] [MainThread]: Flushing usage events
[0m09:45:16.325113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566ecf8c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566e9bf6b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566e9bf6a00>]}


============================== 09:45:16.334819 | a0e2a1e9-bf9e-4e5d-bf9d-d62d927e2cd5 ==============================
[0m09:45:16.334819 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:45:16.335921 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'version_check': 'True', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'write_json': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_experimental_parser': 'False', 'printer_width': '80', 'log_format': 'default', 'warn_error': 'None', 'debug': 'False', 'quiet': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'use_colors': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'partial_parse': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'static_parser': 'True', 'fail_fast': 'False'}
[0m09:45:16.926095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a0e2a1e9-bf9e-4e5d-bf9d-d62d927e2cd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566e9ad4b20>]}
[0m09:45:17.189244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a0e2a1e9-bf9e-4e5d-bf9d-d62d927e2cd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566eaea1a00>]}
[0m09:45:17.190641 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:45:17.606446 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:45:18.108170 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:45:18.108825 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:45:18.311676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a0e2a1e9-bf9e-4e5d-bf9d-d62d927e2cd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566e9349e50>]}
[0m09:45:18.790278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a0e2a1e9-bf9e-4e5d-bf9d-d62d927e2cd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566e935e670>]}
[0m09:45:18.791167 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:45:18.794388 [info ] [MainThread]: 
[0m09:45:18.795422 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:45:18.807298 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:45:18.808939 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:45:18.891337 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:45:18.906964 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:45:19.661808 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:45:19.690670 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:45:19.703088 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:45:19.713259 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:45:19.803798 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:45:19.805395 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:45:19.820664 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:45:19.826137 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:45:19.835441 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:45:19.888824 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:45:19.912343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a0e2a1e9-bf9e-4e5d-bf9d-d62d927e2cd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566e8e8c820>]}
[0m09:45:19.914371 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:45:19.915741 [info ] [MainThread]: 
[0m09:45:19.994742 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:45:19.995913 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:45:19.997061 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:45:19.997839 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:45:20.014723 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:45:20.015944 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:45:20.197930 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:45:20.263390 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:45:20.264760 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:45:20.276827 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:45:20.411240 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:45:20.415639 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:45:20.417912 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:45:20.421199 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:45:20.426885 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:45:20.429765 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:45:20.431636 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:45:20.434437 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:45:20.524726 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:45:20.528237 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:45:20.534600 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a0e2a1e9-bf9e-4e5d-bf9d-d62d927e2cd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566e871c7c0>]}
[0m09:45:20.535787 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.54s]
[0m09:45:20.537081 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:45:20.588243 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:45:20.589476 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:45:20.590864 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:45:20.592865 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:45:20.594469 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:45:20.596294 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:45:20.598239 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:45:20.600086 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:45:20.602272 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:45:20.609678 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:45:20.687856 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:45:20.709476 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:45:20.711142 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:45:20.725582 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:45:20.787280 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:45:20.791763 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:45:20.798800 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:45:20.826466 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:45:21.032483 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:45:21.108874 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:45:21.111740 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:45:21.114395 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:45:21.116291 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:45:21.119755 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:45:21.395845 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:45:21.407026 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:45:21.413192 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:45:21.416321 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:45:21.488987 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:45:21.432172 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.83s]
[0m09:45:21.496952 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m09:45:21.499955 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:45:21.502581 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:45:21.505407 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:45:21.511411 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.92s]
[0m09:45:21.515346 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:45:21.518281 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:45:21.519673 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:45:21.521245 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:45:21.522638 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:45:21.524665 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:45:21.526464 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:45:21.528402 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:45:21.530049 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:45:21.531684 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:45:21.533271 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:45:21.534868 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:45:21.614098 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:45:21.628258 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:45:21.695933 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:45:21.709758 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:45:21.712284 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:45:21.714206 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:45:21.731828 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:45:21.906940 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:45:21.998496 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:45:22.093828 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:45:22.187489 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:45:22.235421 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:45:22.322987 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:45:22.413190 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:45:22.524227 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:45:22.612062 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:45:22.619322 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_a0e2a1e9_bf9e_4e5d_bf9d_d62d927e2cd5` 
  ...
[0m09:45:22.623410 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:45:22.701099 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:45:22.698049 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_a0e2a1e9_bf9e_4e5d_bf9d_d62d927e2cd5` 
  ...
[0m09:45:22.728122 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:45:22.814774 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:45:22.897216 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:45:22.932411 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:45:23.003078 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a0e2a1e9-bf9e-4e5d-bf9d-d62d927e2cd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566e8672b20>]}
[0m09:45:23.026120 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.47s]
[0m09:45:23.094038 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:45:23.108151 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_a0e2a1e9_bf9e_4e5d_bf9d_d62d927e2cd5`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:45:23.110407 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_a0e2a1e9_bf9e_4e5d_bf9d_d62d927e2cd5`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:45:23.474913 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.36 seconds
[0m09:45:23.489652 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.38 seconds
[0m09:45:23.505375 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_a0e2a1e9_bf9e_4e5d_bf9d_d62d927e2cd5'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:45:23.510097 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_a0e2a1e9_bf9e_4e5d_bf9d_d62d927e2cd5'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:45:23.516888 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:45:23.518511 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:45:23.525074 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:45:23.527782 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:45:23.529324 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_a0e2a1e9_bf9e_4e5d_bf9d_d62d927e2cd5`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:45:23.530355 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_a0e2a1e9_bf9e_4e5d_bf9d_d62d927e2cd5`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:45:23.547926 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:45:23.550189 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_a0e2a1e9_bf9e_4e5d_bf9d_d62d927e2cd5`)
      
    ...
[0m09:45:23.552378 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:45:23.554301 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_a0e2a1e9_bf9e_4e5d_bf9d_d62d927e2cd5`)
      
    ...
[0m09:45:23.605443 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:45:23.611026 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:45:23.612467 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:45:23.619856 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:45:23.622288 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:45:23.625278 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_a0e2a1e9_bf9e_4e5d_bf9d_d62d927e2cd5` 
    ...
[0m09:45:23.627704 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:45:23.630732 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_a0e2a1e9_bf9e_4e5d_bf9d_d62d927e2cd5` 
    ...
[0m09:45:23.632068 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:45:23.638844 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_a0e2a1e9_bf9e_4e5d_bf9d_d62d927e2cd5` 
  ...
[0m09:45:23.641425 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:45:23.647253 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_a0e2a1e9_bf9e_4e5d_bf9d_d62d927e2cd5` 
  ...
[0m09:45:23.649388 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:45:23.688064 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:45:23.693767 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:45:23.699575 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:45:23.702601 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:45:23.706035 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a0e2a1e9-bf9e-4e5d-bf9d-d62d927e2cd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566e7e59a60>]}
[0m09:45:23.707306 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:45:23.708510 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.18s]
[0m09:45:23.711739 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a0e2a1e9-bf9e-4e5d-bf9d-d62d927e2cd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566e871c4f0>]}
[0m09:45:23.713059 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:45:23.714324 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.19s]
[0m09:45:23.716020 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:45:23.717846 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:45:23.718385 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:45:23.718944 [debug] [MainThread]: On list__mart: Close
[0m09:45:23.719440 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:45:23.719973 [debug] [MainThread]: On list__clean: Close
[0m09:45:23.720425 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:45:23.720962 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:45:23.721414 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m09:45:23.721953 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m09:45:23.722403 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:45:23.722936 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:45:23.723385 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:45:23.723914 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:45:23.725047 [info ] [MainThread]: 
[0m09:45:23.725753 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.93 seconds (4.93s).
[0m09:45:23.729480 [debug] [MainThread]: Command end result
[0m09:45:23.836222 [info ] [MainThread]: 
[0m09:45:23.837094 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:45:23.887423 [info ] [MainThread]: 
[0m09:45:23.888306 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:45:23.889814 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.758545, "process_in_blocks": "0", "process_kernel_time": 0.738459, "process_mem_max_rss": "114752", "process_out_blocks": "9744", "process_user_time": 6.393689}
[0m09:45:23.890622 [debug] [MainThread]: Command `dbt build` succeeded at 09:45:23.890390 after 7.76 seconds
[0m09:45:23.891252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566ecf8c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566e9ab5130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566e91f80a0>]}
[0m09:45:23.891862 [debug] [MainThread]: Flushing usage events
[0m09:46:16.597705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b5424f310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b50eafb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b50eaf9d0>]}


============================== 09:46:16.608820 | 6b7c31a3-a748-4df6-a4f1-49e506ae0ee1 ==============================
[0m09:46:16.608820 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:46:16.610064 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_colors': 'True', 'static_parser': 'True', 'introspect': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'cache_selected_only': 'False', 'no_print': 'None', 'debug': 'False', 'log_cache_events': 'False', 'write_json': 'True', 'version_check': 'True', 'indirect_selection': 'eager', 'quiet': 'False', 'fail_fast': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'empty': 'False', 'warn_error': 'None', 'printer_width': '80', 'log_format': 'default'}
[0m09:46:17.194007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6b7c31a3-a748-4df6-a4f1-49e506ae0ee1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b537e7fd0>]}
[0m09:46:17.390083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6b7c31a3-a748-4df6-a4f1-49e506ae0ee1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b50d8a2b0>]}
[0m09:46:17.391336 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:46:17.806258 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:46:18.313650 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:46:18.314280 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:46:18.515290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6b7c31a3-a748-4df6-a4f1-49e506ae0ee1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b50615f10>]}
[0m09:46:19.000943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6b7c31a3-a748-4df6-a4f1-49e506ae0ee1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b5346f7c0>]}
[0m09:46:19.001944 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:46:19.005254 [info ] [MainThread]: 
[0m09:46:19.006321 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:46:19.018254 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:46:19.025015 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:46:19.177801 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:46:19.188780 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:46:19.937376 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:46:19.944157 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:46:19.950523 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:46:19.982303 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:46:20.081748 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:46:20.083169 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:46:20.103571 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:46:20.112227 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:46:20.122025 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:46:20.173504 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:46:20.199982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b7c31a3-a748-4df6-a4f1-49e506ae0ee1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b4fedfc10>]}
[0m09:46:20.201931 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:46:20.203409 [info ] [MainThread]: 
[0m09:46:20.281114 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:46:20.282245 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:46:20.283305 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:46:20.284061 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:46:20.301046 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:46:20.302314 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:46:20.488098 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:46:20.552810 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:46:20.554291 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:46:20.565803 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:46:20.696612 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:46:20.700470 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:46:20.702657 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:46:20.705839 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:46:20.711729 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:46:20.714692 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:46:20.716590 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:46:20.719453 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:46:20.811704 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:46:20.815164 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:46:20.821539 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b7c31a3-a748-4df6-a4f1-49e506ae0ee1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b503a4580>]}
[0m09:46:20.872108 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.54s]
[0m09:46:20.873854 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:46:20.875547 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:46:20.876388 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:46:20.877299 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:46:20.878356 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:46:20.879198 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:46:20.880122 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:46:20.881220 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:46:20.882179 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:46:20.883468 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:46:20.905073 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:46:20.908030 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:46:20.908896 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:46:20.909632 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:46:20.918513 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:46:20.972708 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:46:20.982887 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:46:21.000384 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:46:21.088274 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:46:21.213814 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:46:21.215364 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:46:21.276170 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:46:21.279277 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:46:21.281241 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:46:21.284455 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:46:21.538966 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:46:21.557187 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:46:21.574797 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:46:21.590744 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:46:21.595012 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.71s]
[0m09:46:21.601086 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.70s]
[0m09:46:21.603986 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:46:21.606881 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:46:21.609834 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:46:21.623698 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:46:21.674932 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.80s]
[0m09:46:21.677997 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:46:21.681452 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:46:21.682906 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:46:21.684446 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:46:21.685743 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:46:21.687962 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:46:21.689798 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:46:21.691945 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:46:21.693802 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:46:21.695450 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:46:21.697122 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:46:21.698930 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:46:21.711022 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:46:21.872968 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:46:21.885386 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:46:21.884159 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:46:21.888952 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:46:21.901324 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:46:21.913676 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:46:22.079408 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:46:22.193592 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:46:22.376610 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.16 seconds
[0m09:46:22.493175 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:46:22.595935 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:46:22.675291 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:46:22.778791 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:46:22.799651 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_6b7c31a3_a748_4df6_a4f1_49e506ae0ee1` 
  ...
[0m09:46:22.803490 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_6b7c31a3_a748_4df6_a4f1_49e506ae0ee1` 
  ...
[0m09:46:22.813687 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:46:22.819132 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:46:22.878863 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:46:22.821078 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:46:22.889304 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:46:22.996676 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:46:23.091935 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:46:23.117258 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:46:23.181208 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b7c31a3-a748-4df6-a4f1-49e506ae0ee1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b50395910>]}
[0m09:46:23.213077 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.48s]
[0m09:46:23.289179 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:46:23.308135 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_6b7c31a3_a748_4df6_a4f1_49e506ae0ee1`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:46:23.310634 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_6b7c31a3_a748_4df6_a4f1_49e506ae0ee1`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:46:23.345588 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:46:23.373331 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:46:23.481148 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_6b7c31a3_a748_4df6_a4f1_49e506ae0ee1'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:46:23.486876 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_6b7c31a3_a748_4df6_a4f1_49e506ae0ee1'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:46:23.492379 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:46:23.494237 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:46:23.503872 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:46:23.506652 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:46:23.508222 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_6b7c31a3_a748_4df6_a4f1_49e506ae0ee1`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:46:23.509277 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_6b7c31a3_a748_4df6_a4f1_49e506ae0ee1`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:46:23.532005 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:46:23.535394 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_6b7c31a3_a748_4df6_a4f1_49e506ae0ee1`)
      
    ...
[0m09:46:23.537650 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:46:23.575838 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_6b7c31a3_a748_4df6_a4f1_49e506ae0ee1`)
      
    ...
[0m09:46:23.596486 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:46:23.603889 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:46:23.605293 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:46:23.616726 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:46:23.619148 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:46:23.624630 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_6b7c31a3_a748_4df6_a4f1_49e506ae0ee1` 
    ...
[0m09:46:23.629177 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:46:23.634269 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_6b7c31a3_a748_4df6_a4f1_49e506ae0ee1` 
    ...
[0m09:46:23.673298 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:46:23.686082 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_6b7c31a3_a748_4df6_a4f1_49e506ae0ee1` 
  ...
[0m09:46:23.691979 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:46:23.705769 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:46:23.707935 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:46:23.718159 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_6b7c31a3_a748_4df6_a4f1_49e506ae0ee1` 
  ...
[0m09:46:23.773476 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:46:23.779852 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:46:23.791437 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b7c31a3-a748-4df6-a4f1-49e506ae0ee1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b50f960a0>]}
[0m09:46:23.793994 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.09s]
[0m09:46:23.796441 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:46:23.799457 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:46:23.805039 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:46:23.811866 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b7c31a3-a748-4df6-a4f1-49e506ae0ee1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b50d7d220>]}
[0m09:46:23.814774 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.12s]
[0m09:46:23.817581 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:46:23.821432 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:46:23.873104 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:46:23.874311 [debug] [MainThread]: On list__clean: Close
[0m09:46:23.875385 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:46:23.876599 [debug] [MainThread]: On list__mart: Close
[0m09:46:23.877973 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:46:23.879207 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:46:23.880796 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m09:46:23.882573 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m09:46:23.884278 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:46:23.885626 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:46:23.886835 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:46:23.887916 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:46:23.890294 [info ] [MainThread]: 
[0m09:46:23.891785 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.88 seconds (4.88s).
[0m09:46:23.900090 [debug] [MainThread]: Command end result
[0m09:46:24.117488 [info ] [MainThread]: 
[0m09:46:24.118776 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:46:24.119749 [info ] [MainThread]: 
[0m09:46:24.120741 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:46:24.173761 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.7840657, "process_in_blocks": "0", "process_kernel_time": 0.675924, "process_mem_max_rss": "114564", "process_out_blocks": "9744", "process_user_time": 6.545896}
[0m09:46:24.175509 [debug] [MainThread]: Command `dbt build` succeeded at 09:46:24.175079 after 7.79 seconds
[0m09:46:24.176842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b5424f310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b5346f7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b537e7fd0>]}
[0m09:46:24.178123 [debug] [MainThread]: Flushing usage events
[0m09:47:17.368244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7643a1955310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76439e5b9b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76439e5b99d0>]}


============================== 09:47:17.384287 | 8ca74940-a101-4dd8-a2ea-6aa2c8ac9ec4 ==============================
[0m09:47:17.384287 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:47:17.386124 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'target_path': 'None', 'quiet': 'False', 'introspect': 'True', 'printer_width': '80', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'write_json': 'True', 'no_print': 'None', 'profiles_dir': '.', 'static_parser': 'True', 'empty': 'False', 'log_format': 'default', 'indirect_selection': 'eager', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m09:47:17.980682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8ca74940-a101-4dd8-a2ea-6aa2c8ac9ec4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76439e56d910>]}
[0m09:47:18.174137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8ca74940-a101-4dd8-a2ea-6aa2c8ac9ec4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76439e599a60>]}
[0m09:47:18.175403 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:47:18.587852 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:47:19.091020 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:47:19.091715 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:47:19.292920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8ca74940-a101-4dd8-a2ea-6aa2c8ac9ec4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76439dd0ce80>]}
[0m09:47:19.780754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8ca74940-a101-4dd8-a2ea-6aa2c8ac9ec4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76439dd229a0>]}
[0m09:47:19.781615 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:47:19.784742 [info ] [MainThread]: 
[0m09:47:19.785758 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:47:19.797606 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:47:19.799520 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:47:19.893841 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:47:19.960002 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:47:20.686936 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:47:20.691373 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:47:20.710056 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:47:20.721631 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:47:20.765687 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:47:20.767515 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:47:20.782811 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:47:20.789129 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:47:20.799260 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:47:20.801303 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:47:20.874813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ca74940-a101-4dd8-a2ea-6aa2c8ac9ec4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76439dc6a2b0>]}
[0m09:47:20.876613 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:47:20.877763 [info ] [MainThread]: 
[0m09:47:20.903608 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:47:20.955322 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:47:20.957683 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:47:20.958475 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:47:20.976008 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:47:20.977220 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:47:21.156437 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:47:21.226280 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:47:21.227675 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:47:21.238059 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:47:21.367440 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:47:21.371140 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:47:21.373030 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:47:21.375878 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:47:21.381395 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:47:21.384284 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:47:21.386111 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:47:21.389082 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:47:21.496346 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:47:21.499569 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:47:21.555332 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ca74940-a101-4dd8-a2ea-6aa2c8ac9ec4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76439cf55070>]}
[0m09:47:21.556838 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.55s]
[0m09:47:21.558218 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:47:21.560403 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:47:21.561614 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:47:21.563152 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:47:21.564748 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:47:21.566302 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:47:21.568226 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:47:21.569824 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:47:21.571654 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:47:21.573635 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:47:21.575521 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:47:21.592779 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:47:21.665639 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:47:21.678719 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:47:21.693152 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:47:21.759386 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:47:21.761642 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:47:21.763789 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:47:21.796869 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:47:22.074196 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:47:22.066500 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:47:22.089077 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:47:22.092122 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:47:22.093851 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:47:22.096844 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:47:22.372986 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:47:22.386414 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:47:22.406133 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.83s]
[0m09:47:22.409263 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:47:22.456788 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:47:22.468008 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:47:22.475869 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:47:22.481948 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.91s]
[0m09:47:22.484969 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:47:22.487655 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:47:22.493523 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.93s]
[0m09:47:22.496925 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:47:22.499765 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:47:22.500953 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:47:22.502530 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:47:22.504063 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:47:22.505740 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:47:22.556018 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:47:22.557836 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:47:22.559190 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:47:22.560915 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:47:22.562647 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:47:22.564323 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:47:22.565974 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:47:22.668601 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:47:22.678926 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:47:22.687381 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:47:22.689906 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:47:22.691973 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:47:22.755557 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:47:22.897355 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:47:22.992145 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:47:23.161473 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m09:47:23.266481 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:47:23.388818 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m09:47:23.468281 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:47:23.493444 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:47:23.592033 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:47:23.687120 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_8ca74940_a101_4dd8_a2ea_6aa2c8ac9ec4` 
  ...
[0m09:47:23.686257 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_8ca74940_a101_4dd8_a2ea_6aa2c8ac9ec4` 
  ...
[0m09:47:23.690164 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:47:23.697083 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:47:23.701876 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:47:23.754981 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:47:23.796655 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:47:23.888915 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:47:24.061781 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:47:24.090099 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ca74940-a101-4dd8-a2ea-6aa2c8ac9ec4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76439d05e5e0>]}
[0m09:47:24.174906 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_8ca74940_a101_4dd8_a2ea_6aa2c8ac9ec4`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:47:24.178742 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_8ca74940_a101_4dd8_a2ea_6aa2c8ac9ec4`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:47:24.181826 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.53s]
[0m09:47:24.188364 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:47:24.912725 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.73 seconds
[0m09:47:24.928120 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.74 seconds
[0m09:47:24.971591 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_8ca74940_a101_4dd8_a2ea_6aa2c8ac9ec4'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:47:24.974022 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_8ca74940_a101_4dd8_a2ea_6aa2c8ac9ec4'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:47:24.984250 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:47:24.992281 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:47:25.000970 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:47:25.006918 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:47:25.055620 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_8ca74940_a101_4dd8_a2ea_6aa2c8ac9ec4`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:47:25.059060 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_8ca74940_a101_4dd8_a2ea_6aa2c8ac9ec4`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:47:25.089130 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:47:25.091830 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:47:25.096064 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_8ca74940_a101_4dd8_a2ea_6aa2c8ac9ec4`)
      
    ...
[0m09:47:25.100484 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_8ca74940_a101_4dd8_a2ea_6aa2c8ac9ec4`)
      
    ...
[0m09:47:25.129423 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:47:25.143206 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:47:25.145990 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:47:25.162412 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:47:25.165184 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:47:25.175016 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_8ca74940_a101_4dd8_a2ea_6aa2c8ac9ec4` 
    ...
[0m09:47:25.177771 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:47:25.181685 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_8ca74940_a101_4dd8_a2ea_6aa2c8ac9ec4` 
    ...
[0m09:47:25.183378 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:47:25.192981 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_8ca74940_a101_4dd8_a2ea_6aa2c8ac9ec4` 
  ...
[0m09:47:25.194558 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:47:25.256267 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:47:25.259286 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_8ca74940_a101_4dd8_a2ea_6aa2c8ac9ec4` 
  ...
[0m09:47:25.271756 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:47:25.278792 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:47:25.286412 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:47:25.287697 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ca74940-a101-4dd8-a2ea-6aa2c8ac9ec4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76439c6d69d0>]}
[0m09:47:25.300264 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:47:25.302660 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.73s]
[0m09:47:25.356337 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:47:25.359383 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:47:25.368429 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ca74940-a101-4dd8-a2ea-6aa2c8ac9ec4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76439cfaccd0>]}
[0m09:47:25.372016 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.81s]
[0m09:47:25.375290 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:47:25.379352 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:47:25.380385 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:47:25.381798 [debug] [MainThread]: On list__clean: Close
[0m09:47:25.382978 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:47:25.384131 [debug] [MainThread]: On list__mart: Close
[0m09:47:25.385212 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:47:25.386586 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:47:25.387854 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m09:47:25.388931 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m09:47:25.389919 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:47:25.390925 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:47:25.391860 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:47:25.392836 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:47:25.394988 [info ] [MainThread]: 
[0m09:47:25.396273 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.61 seconds (5.61s).
[0m09:47:25.455950 [debug] [MainThread]: Command end result
[0m09:47:25.591297 [info ] [MainThread]: 
[0m09:47:25.592565 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:47:25.593519 [info ] [MainThread]: 
[0m09:47:25.594486 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:47:25.596311 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 8.499823, "process_in_blocks": "0", "process_kernel_time": 0.715039, "process_mem_max_rss": "114628", "process_out_blocks": "9744", "process_user_time": 6.594911}
[0m09:47:25.597426 [debug] [MainThread]: Command `dbt build` succeeded at 09:47:25.597142 after 8.50 seconds
[0m09:47:25.598340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7643a1955310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76439dc73640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76439dd06f40>]}
[0m09:47:25.599284 [debug] [MainThread]: Flushing usage events
[0m09:48:15.275086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x767667bfe310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x767664866a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x767664866940>]}


============================== 09:48:15.284319 | f090864a-e870-4f0b-a744-001e4f42afaa ==============================
[0m09:48:15.284319 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:48:15.285482 [debug] [MainThread]: running dbt with arguments {'log_path': '/workdir/transforms/04_btc/logs', 'debug': 'False', 'version_check': 'True', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'introspect': 'True', 'empty': 'False', 'no_print': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'target_path': 'None', 'partial_parse': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '.', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_format': 'default', 'cache_selected_only': 'False', 'static_parser': 'True', 'write_json': 'True', 'quiet': 'False', 'log_cache_events': 'False', 'printer_width': '80'}
[0m09:48:15.859014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f090864a-e870-4f0b-a744-001e4f42afaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x767667192fd0>]}
[0m09:48:16.055231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f090864a-e870-4f0b-a744-001e4f42afaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x767665332430>]}
[0m09:48:16.056643 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:48:16.471869 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:48:16.973619 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:48:16.974267 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:48:17.176216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f090864a-e870-4f0b-a744-001e4f42afaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x767663fbaf10>]}
[0m09:48:17.662864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f090864a-e870-4f0b-a744-001e4f42afaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x767666e2ac70>]}
[0m09:48:17.663734 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:48:17.666951 [info ] [MainThread]: 
[0m09:48:17.667982 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:48:17.679902 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:48:17.687230 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:48:17.776957 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:48:17.789875 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:48:18.540651 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:48:18.554256 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:18.556178 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:48:18.571015 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:18.657509 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:48:18.659553 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:48:18.680561 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:48:18.688133 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:48:18.698582 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:18.701102 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:18.775126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f090864a-e870-4f0b-a744-001e4f42afaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x767667014940>]}
[0m09:48:18.777019 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:48:18.778435 [info ] [MainThread]: 
[0m09:48:18.856606 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:48:18.857729 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:48:18.858793 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:48:18.859580 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:48:18.876329 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:48:18.877447 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:48:19.059994 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:48:19.127006 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:48:19.128389 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:48:19.140259 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:19.271997 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:48:19.275971 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:48:19.277971 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:48:19.281021 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:48:19.286746 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:48:19.289769 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:48:19.291638 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:48:19.294612 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:48:19.385825 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:48:19.389240 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:48:19.395251 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f090864a-e870-4f0b-a744-001e4f42afaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7676633d1b20>]}
[0m09:48:19.396412 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.54s]
[0m09:48:19.397826 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:48:19.399751 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:48:19.451398 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:48:19.453736 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:48:19.455838 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:48:19.400878 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:48:19.458457 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:48:19.460634 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:48:19.462519 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:48:19.464433 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:48:19.466163 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:48:19.468304 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:48:19.577466 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:48:19.586748 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:48:19.596414 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:48:19.653725 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:48:19.655222 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:48:19.656253 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:48:19.691143 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:48:19.754199 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:48:19.776842 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:48:19.791126 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:48:19.793897 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:48:19.796950 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:48:19.798651 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:48:20.086133 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:48:20.094970 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:48:20.100045 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:20.101754 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:48:20.108852 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.65s]
[0m09:48:20.111789 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:20.116062 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:48:20.154190 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:48:20.151354 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.66s]
[0m09:48:20.160997 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.69s]
[0m09:48:20.164043 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:48:20.167013 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:48:20.170463 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:48:20.171776 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:48:20.173377 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:48:20.174737 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:48:20.176914 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:48:20.178881 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:48:20.181000 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:48:20.182882 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:48:20.184637 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:48:20.186367 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:48:20.188085 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:48:20.251293 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:48:20.364608 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:48:20.369311 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:48:20.371388 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:48:20.374215 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:48:20.380989 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:48:20.388336 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:48:20.492670 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:48:20.666976 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:48:20.855119 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.17 seconds
[0m09:48:20.898884 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:48:20.990489 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:48:21.061135 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:48:21.097538 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f090864a_e870_4f0b_a744_001e4f42afaa` 
  ...
[0m09:48:21.098963 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f090864a_e870_4f0b_a744_001e4f42afaa` 
  ...
[0m09:48:21.151047 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:21.158640 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:21.171796 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:48:21.175434 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:48:21.290263 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:48:21.353925 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:48:21.368514 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:21.465005 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:48:21.562576 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:48:21.661999 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f090864a-e870-4f0b-a744-001e4f42afaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x767664737700>]}
[0m09:48:21.670457 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.48s]
[0m09:48:21.683687 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_f090864a_e870_4f0b_a744_001e4f42afaa`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:48:21.686689 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:48:21.695084 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_f090864a_e870_4f0b_a744_001e4f42afaa`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:48:21.752022 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:48:21.754708 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:48:21.850974 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_f090864a_e870_4f0b_a744_001e4f42afaa'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:48:21.860784 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_f090864a_e870_4f0b_a744_001e4f42afaa'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:48:21.869468 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:21.877662 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:21.896931 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:48:21.899831 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:48:21.950822 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_f090864a_e870_4f0b_a744_001e4f42afaa`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:48:21.956047 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_f090864a_e870_4f0b_a744_001e4f42afaa`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:48:21.983803 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:48:21.989139 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f090864a_e870_4f0b_a744_001e4f42afaa`)
      
    ...
[0m09:48:21.991252 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:48:21.995941 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f090864a_e870_4f0b_a744_001e4f42afaa`)
      
    ...
[0m09:48:22.010723 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:48:22.019410 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:48:22.021723 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:48:22.031306 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:48:22.033232 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:22.055457 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f090864a_e870_4f0b_a744_001e4f42afaa` 
    ...
[0m09:48:22.057275 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:22.062782 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f090864a_e870_4f0b_a744_001e4f42afaa` 
    ...
[0m09:48:22.065711 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:22.073348 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f090864a_e870_4f0b_a744_001e4f42afaa` 
  ...
[0m09:48:22.074982 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:22.084020 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f090864a_e870_4f0b_a744_001e4f42afaa` 
  ...
[0m09:48:22.085752 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:22.095606 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:48:22.097418 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:48:22.151816 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:48:22.161814 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:48:22.167372 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f090864a-e870-4f0b-a744-001e4f42afaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76766336f0a0>]}
[0m09:48:22.170855 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.99s]
[0m09:48:22.172990 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:48:22.175291 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:48:22.180972 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f090864a-e870-4f0b-a744-001e4f42afaa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x767663a97100>]}
[0m09:48:22.183381 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.00s]
[0m09:48:22.185576 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:48:22.189108 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:48:22.190257 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:48:22.191431 [debug] [MainThread]: On list__mart: Close
[0m09:48:22.192530 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:48:22.193631 [debug] [MainThread]: On list__clean: Close
[0m09:48:22.194710 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:48:22.195840 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:48:22.197027 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:48:22.198233 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:48:22.199372 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:48:22.200497 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:48:22.251912 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m09:48:22.253089 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m09:48:22.255413 [info ] [MainThread]: 
[0m09:48:22.256856 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.59 seconds (4.59s).
[0m09:48:22.265085 [debug] [MainThread]: Command end result
[0m09:48:22.481979 [info ] [MainThread]: 
[0m09:48:22.483643 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:48:22.484883 [info ] [MainThread]: 
[0m09:48:22.486105 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:48:22.488453 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.405963, "process_in_blocks": "0", "process_kernel_time": 0.673578, "process_mem_max_rss": "114916", "process_out_blocks": "9744", "process_user_time": 6.343438}
[0m09:48:22.489899 [debug] [MainThread]: Command `dbt build` succeeded at 09:48:22.489524 after 7.41 seconds
[0m09:48:22.491042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x767667bfe310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x767665b12f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7676653890a0>]}
[0m09:48:22.492096 [debug] [MainThread]: Flushing usage events
[0m09:49:16.102204 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d64ae085310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d64aacf9b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d64aacf9a00>]}


============================== 09:49:16.111307 | 07641ce5-28c5-40e1-ac0c-a633b87411c6 ==============================
[0m09:49:16.111307 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:49:16.112429 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'partial_parse': 'True', 'debug': 'False', 'profiles_dir': '.', 'use_colors': 'True', 'log_format': 'default', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'version_check': 'True', 'write_json': 'True', 'log_cache_events': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'cache_selected_only': 'False', 'introspect': 'True', 'warn_error': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'no_print': 'None', 'target_path': 'None', 'quiet': 'False', 'use_experimental_parser': 'False', 'fail_fast': 'False'}
[0m09:49:16.702983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '07641ce5-28c5-40e1-ac0c-a633b87411c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d64ac7ce5b0>]}
[0m09:49:16.897932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '07641ce5-28c5-40e1-ac0c-a633b87411c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d64ab153ca0>]}
[0m09:49:16.899218 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:49:17.317423 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:49:17.822332 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:49:17.822971 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:49:18.023619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '07641ce5-28c5-40e1-ac0c-a633b87411c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d64aa44ceb0>]}
[0m09:49:18.505167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '07641ce5-28c5-40e1-ac0c-a633b87411c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d64aa3414c0>]}
[0m09:49:18.506088 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:49:18.509735 [info ] [MainThread]: 
[0m09:49:18.510913 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:49:18.523327 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:49:18.525050 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:49:18.624709 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:49:18.630727 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:49:19.353547 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:49:19.359345 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:49:19.362146 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:49:19.363987 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:49:19.411277 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:49:19.418154 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:49:19.438143 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:49:19.442455 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:49:19.504970 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:49:19.516961 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:49:19.535123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07641ce5-28c5-40e1-ac0c-a633b87411c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d64adfdc7c0>]}
[0m09:49:19.536971 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:49:19.538233 [info ] [MainThread]: 
[0m09:49:19.611439 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:49:19.613013 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:49:19.614465 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:49:19.615522 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:49:19.636048 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:49:19.637209 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:49:19.830785 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:49:19.937249 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:49:19.938750 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:49:19.953889 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:49:20.038451 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:49:20.041718 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:49:20.092916 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:49:20.096384 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:49:20.102078 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:49:20.104981 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:49:20.106830 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:49:20.109720 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:49:20.202341 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:49:20.205859 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:49:20.212027 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07641ce5-28c5-40e1-ac0c-a633b87411c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d64aa04e310>]}
[0m09:49:20.213180 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m09:49:20.214704 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:49:20.216899 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:49:20.218128 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:49:20.219324 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:49:20.220623 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:49:20.222301 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:49:20.224304 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:49:20.226396 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:49:20.228174 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:49:20.230254 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:49:20.232493 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:49:20.239734 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:49:20.304855 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:49:20.432274 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:49:20.433714 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:49:20.434846 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:49:20.436565 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:49:20.437706 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:49:20.514286 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:49:20.808749 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:49:20.810763 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:49:20.820256 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:49:20.822478 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:49:20.824213 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:49:20.827311 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:49:21.101530 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:49:21.111822 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:49:21.119980 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:49:21.123015 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:49:21.137716 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m09:49:21.194451 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:49:21.195693 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:49:21.198510 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:49:21.204573 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.98s]
[0m09:49:21.210309 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.98s]
[0m09:49:21.214090 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:49:21.217203 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:49:21.220569 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:49:21.221834 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:49:21.223407 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:49:21.224343 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:49:21.225465 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:49:21.226924 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:49:21.228550 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:49:21.230322 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:49:21.231989 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:49:21.233590 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:49:21.235247 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:49:21.303817 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:49:21.327959 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:49:21.396567 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:49:21.410641 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:49:21.413299 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:49:21.415156 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:49:21.498518 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:49:21.537784 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:49:21.635353 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:49:21.732286 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:49:21.840070 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:49:22.010157 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:49:22.040323 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:49:22.226156 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_07641ce5_28c5_40e1_ac0c_a633b87411c6` 
  ...
[0m09:49:22.239557 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:49:22.320103 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_07641ce5_28c5_40e1_ac0c_a633b87411c6` 
  ...
[0m09:49:22.333519 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:49:22.336595 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:49:22.394461 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:49:22.402199 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:49:22.505275 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:49:22.535706 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:49:22.621879 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:49:22.639859 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:49:22.700963 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_07641ce5_28c5_40e1_ac0c_a633b87411c6`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:49:22.707632 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_07641ce5_28c5_40e1_ac0c_a633b87411c6`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:49:22.706156 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07641ce5-28c5-40e1-ac0c-a633b87411c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d64a8fb3ac0>]}
[0m09:49:22.715023 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.47s]
[0m09:49:22.719966 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:49:22.747948 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:49:22.765462 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:49:22.793959 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_07641ce5_28c5_40e1_ac0c_a633b87411c6'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:49:22.806573 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_07641ce5_28c5_40e1_ac0c_a633b87411c6'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:49:22.817136 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:49:22.820277 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:49:22.833167 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:49:22.838515 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:49:22.841668 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_07641ce5_28c5_40e1_ac0c_a633b87411c6`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:49:22.893269 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_07641ce5_28c5_40e1_ac0c_a633b87411c6`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:49:22.927771 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:49:22.930368 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:49:22.934386 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_07641ce5_28c5_40e1_ac0c_a633b87411c6`)
      
    ...
[0m09:49:22.938433 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_07641ce5_28c5_40e1_ac0c_a633b87411c6`)
      
    ...
[0m09:49:22.973328 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:49:22.975698 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:49:22.981162 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:49:22.990783 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:49:22.998829 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:49:23.007033 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:49:23.004768 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_07641ce5_28c5_40e1_ac0c_a633b87411c6` 
    ...
[0m09:49:23.013667 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_07641ce5_28c5_40e1_ac0c_a633b87411c6` 
    ...
[0m09:49:23.025143 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:49:23.027877 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:49:23.040966 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_07641ce5_28c5_40e1_ac0c_a633b87411c6` 
  ...
[0m09:49:23.100242 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_07641ce5_28c5_40e1_ac0c_a633b87411c6` 
  ...
[0m09:49:23.106924 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:49:23.114692 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:49:23.132937 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:49:23.135443 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:49:23.142279 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:49:23.201008 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:49:23.202577 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07641ce5-28c5-40e1-ac0c-a633b87411c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d64a9f7c910>]}
[0m09:49:23.209172 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07641ce5-28c5-40e1-ac0c-a633b87411c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d64a8fb3a30>]}
[0m09:49:23.211440 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.98s]
[0m09:49:23.213912 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.98s]
[0m09:49:23.216901 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:49:23.219972 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:49:23.227730 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:49:23.228880 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:49:23.230106 [debug] [MainThread]: On list__clean: Close
[0m09:49:23.231296 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:49:23.232381 [debug] [MainThread]: On list__mart: Close
[0m09:49:23.233421 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:49:23.234522 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:49:23.235655 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:49:23.236743 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:49:23.237777 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m09:49:23.238892 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m09:49:23.239930 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:49:23.241045 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:49:23.293713 [info ] [MainThread]: 
[0m09:49:23.295248 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.78 seconds (4.78s).
[0m09:49:23.303293 [debug] [MainThread]: Command end result
[0m09:49:23.525298 [info ] [MainThread]: 
[0m09:49:23.527375 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:49:23.529129 [info ] [MainThread]: 
[0m09:49:23.530324 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:49:23.532692 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.6218204, "process_in_blocks": "0", "process_kernel_time": 0.685051, "process_mem_max_rss": "115396", "process_out_blocks": "9744", "process_user_time": 6.507486}
[0m09:49:23.533983 [debug] [MainThread]: Command `dbt build` succeeded at 09:49:23.533655 after 7.62 seconds
[0m09:49:23.534870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d64ae085310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d64ac7ce5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d64ab153ca0>]}
[0m09:49:23.535564 [debug] [MainThread]: Flushing usage events
[0m09:50:15.972749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7919195be310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x791916217b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x791916217a00>]}


============================== 09:50:15.981935 | 535db7a3-b0e9-4fb2-b78c-834123f423a9 ==============================
[0m09:50:15.981935 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:50:15.983050 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'introspect': 'True', 'quiet': 'False', 'printer_width': '80', 'log_path': '/workdir/transforms/04_btc/logs', 'version_check': 'True', 'empty': 'False', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'static_parser': 'True', 'cache_selected_only': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local'}
[0m09:50:16.511917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '535db7a3-b0e9-4fb2-b78c-834123f423a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x791917d005b0>]}
[0m09:50:16.702940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '535db7a3-b0e9-4fb2-b78c-834123f423a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x791916685ca0>]}
[0m09:50:16.704219 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:50:17.168177 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:50:17.685306 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:50:17.685981 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:50:17.887897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '535db7a3-b0e9-4fb2-b78c-834123f423a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x791915980eb0>]}
[0m09:50:18.365592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '535db7a3-b0e9-4fb2-b78c-834123f423a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7919158754c0>]}
[0m09:50:18.366471 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:50:18.369723 [info ] [MainThread]: 
[0m09:50:18.370739 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:50:18.382267 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:50:18.389128 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:50:18.487677 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:50:18.494564 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:50:19.278823 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:50:19.281308 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:50:19.288277 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:50:19.290496 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:50:19.394167 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:50:19.405950 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:50:19.410441 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:50:19.467027 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:50:19.477831 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:50:19.479553 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:50:19.508511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '535db7a3-b0e9-4fb2-b78c-834123f423a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7919195167c0>]}
[0m09:50:19.510508 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:50:19.511876 [info ] [MainThread]: 
[0m09:50:19.587123 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:50:19.588408 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:50:19.589501 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:50:19.590292 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:50:19.607175 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:50:19.608354 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:50:19.800487 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:50:19.920852 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:50:19.923042 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:50:19.937281 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:50:20.073645 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:50:20.076868 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:50:20.078888 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:50:20.081527 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:50:20.087287 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:50:20.090149 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:50:20.092150 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:50:20.094852 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:50:20.197175 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:50:20.202111 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:50:20.211609 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '535db7a3-b0e9-4fb2-b78c-834123f423a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x791914ceaac0>]}
[0m09:50:20.213021 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.62s]
[0m09:50:20.264086 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:50:20.266401 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:50:20.267761 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:50:20.269261 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:50:20.270804 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:50:20.272918 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:50:20.274863 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:50:20.277281 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:50:20.279513 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:50:20.281882 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:50:20.283151 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:50:20.284884 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:50:20.286709 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:50:20.382424 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:50:20.383696 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:50:20.401012 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:50:20.403699 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:50:20.405528 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:50:20.474234 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:50:20.705208 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:50:20.773103 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:50:20.788086 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:50:20.790683 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:50:20.794061 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:50:20.795673 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:50:21.047008 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:50:21.071511 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:50:21.080599 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:50:21.083250 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:50:21.096565 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:50:21.098956 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.82s]
[0m09:50:21.107342 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.83s]
[0m09:50:21.110846 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:50:21.164133 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:50:21.166059 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:50:21.172572 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.89s]
[0m09:50:21.176009 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:50:21.178527 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:50:21.179745 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:50:21.180962 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:50:21.182681 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:50:21.184423 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:50:21.187114 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:50:21.189718 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:50:21.191649 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:50:21.193676 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:50:21.195191 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:50:21.264412 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:50:21.290642 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:50:21.292652 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:50:21.310375 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:50:21.378936 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:50:21.381581 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:50:21.383776 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:50:21.468736 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:50:21.564834 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:50:21.593328 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:50:21.700862 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m09:50:21.779016 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:50:21.885415 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:50:21.966288 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:50:22.064579 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:50:22.109301 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:50:22.264629 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:50:22.294615 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:50:22.285952 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_535db7a3_b0e9_4fb2_b78c_834123f423a9` 
  ...
[0m09:50:22.377652 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_535db7a3_b0e9_4fb2_b78c_834123f423a9` 
  ...
[0m09:50:22.380722 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:50:22.387270 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:50:22.390180 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:50:22.404284 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:50:22.505668 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:50:22.567400 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '535db7a3-b0e9-4fb2-b78c-834123f423a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x791914579c10>]}
[0m09:50:22.664450 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.37s]
[0m09:50:22.677832 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:50:22.792823 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_535db7a3_b0e9_4fb2_b78c_834123f423a9`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:50:22.801751 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_535db7a3_b0e9_4fb2_b78c_834123f423a9`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:50:22.833767 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:50:22.875381 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:50:22.967120 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_535db7a3_b0e9_4fb2_b78c_834123f423a9'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:50:22.969628 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_535db7a3_b0e9_4fb2_b78c_834123f423a9'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:50:22.979890 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:50:22.992901 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:50:22.995812 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:50:23.001316 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:50:23.004674 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_535db7a3_b0e9_4fb2_b78c_834123f423a9`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:50:23.007867 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_535db7a3_b0e9_4fb2_b78c_834123f423a9`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:50:23.065157 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:50:23.069621 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_535db7a3_b0e9_4fb2_b78c_834123f423a9`)
      
    ...
[0m09:50:23.098527 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:50:23.101123 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:50:23.105330 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_535db7a3_b0e9_4fb2_b78c_834123f423a9`)
      
    ...
[0m09:50:23.116251 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:50:23.129785 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:50:23.137852 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_535db7a3_b0e9_4fb2_b78c_834123f423a9` 
    ...
[0m09:50:23.163397 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:50:23.164832 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:50:23.169790 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:50:23.175250 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_535db7a3_b0e9_4fb2_b78c_834123f423a9` 
  ...
[0m09:50:23.180239 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:50:23.187406 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:50:23.189725 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:50:23.193060 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_535db7a3_b0e9_4fb2_b78c_834123f423a9` 
    ...
[0m09:50:23.196614 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:50:23.200433 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '535db7a3-b0e9-4fb2-b78c-834123f423a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x791916088550>]}
[0m09:50:23.203271 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:50:23.201904 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.02s]
[0m09:50:23.210113 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_535db7a3_b0e9_4fb2_b78c_834123f423a9` 
  ...
[0m09:50:23.211731 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:50:23.263194 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:50:23.275462 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:50:23.280588 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:50:23.285465 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '535db7a3-b0e9-4fb2-b78c-834123f423a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x791914579490>]}
[0m09:50:23.287260 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.09s]
[0m09:50:23.289413 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:50:23.293973 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:50:23.295302 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:50:23.296529 [debug] [MainThread]: On list__mart: Close
[0m09:50:23.297653 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:50:23.298867 [debug] [MainThread]: On list__clean: Close
[0m09:50:23.299995 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:50:23.301148 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:50:23.302277 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:50:23.303452 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:50:23.304621 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m09:50:23.305846 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m09:50:23.307028 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:50:23.308372 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:50:23.310721 [info ] [MainThread]: 
[0m09:50:23.312152 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.94 seconds (4.94s).
[0m09:50:23.370768 [debug] [MainThread]: Command end result
[0m09:50:23.593184 [info ] [MainThread]: 
[0m09:50:23.594820 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:50:23.596092 [info ] [MainThread]: 
[0m09:50:23.597369 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:50:23.599670 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.818271, "process_in_blocks": "0", "process_kernel_time": 0.718255, "process_mem_max_rss": "114784", "process_out_blocks": "9744", "process_user_time": 6.541006}
[0m09:50:23.601010 [debug] [MainThread]: Command `dbt build` succeeded at 09:50:23.600666 after 7.82 seconds
[0m09:50:23.602159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7919195be310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79191607f670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7919174db130>]}
[0m09:50:23.603215 [debug] [MainThread]: Flushing usage events
[0m09:51:16.343080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bd6cc916310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bd6c9586b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bd6c9586a00>]}


============================== 09:51:16.353417 | fdc3650c-6ebc-4789-a9b6-b1237e8fe2a6 ==============================
[0m09:51:16.353417 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:51:16.354516 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'indirect_selection': 'eager', 'warn_error': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_format': 'default', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '.', 'fail_fast': 'False', 'target_path': 'None', 'log_cache_events': 'False', 'no_print': 'None', 'cache_selected_only': 'False', 'use_colors': 'True', 'static_parser': 'True', 'partial_parse': 'True', 'write_json': 'True', 'debug': 'False', 'empty': 'False', 'quiet': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'use_experimental_parser': 'False', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m09:51:16.959952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fdc3650c-6ebc-4789-a9b6-b1237e8fe2a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bd6cbeab3a0>]}
[0m09:51:17.170808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fdc3650c-6ebc-4789-a9b6-b1237e8fe2a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bd6c964ee50>]}
[0m09:51:17.222116 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:51:17.651522 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:51:18.158112 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:51:18.158782 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:51:18.361568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fdc3650c-6ebc-4789-a9b6-b1237e8fe2a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bd6c8cddee0>]}
[0m09:51:18.840686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fdc3650c-6ebc-4789-a9b6-b1237e8fe2a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bd6c8cf24f0>]}
[0m09:51:18.841518 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:51:18.844816 [info ] [MainThread]: 
[0m09:51:18.845869 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:51:18.861963 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:51:18.922218 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:51:19.022094 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:51:19.029700 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:51:19.732671 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:51:19.737446 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:51:19.755557 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:51:19.761804 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:51:19.837686 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:51:19.839607 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:51:19.860953 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:51:19.868193 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:51:19.922138 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:51:19.924742 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:51:19.950586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fdc3650c-6ebc-4789-a9b6-b1237e8fe2a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bd6c88190a0>]}
[0m09:51:19.952484 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:51:19.953819 [info ] [MainThread]: 
[0m09:51:20.031763 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:51:20.032917 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:51:20.033985 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:51:20.034747 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:51:20.051134 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:51:20.052609 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:51:20.238899 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:51:20.305858 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:51:20.307295 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:51:20.320658 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:51:20.457684 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:51:20.461314 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:51:20.463252 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:51:20.466107 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:51:20.471603 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:51:20.522231 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:51:20.524733 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:51:20.527973 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:51:20.623132 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:51:20.626662 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:51:20.633848 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdc3650c-6ebc-4789-a9b6-b1237e8fe2a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bd6c8071e20>]}
[0m09:51:20.635145 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m09:51:20.636527 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:51:20.638128 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:51:20.639174 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:51:20.640460 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:51:20.641353 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:51:20.642358 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:51:20.643274 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:51:20.644474 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:51:20.645576 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:51:20.646519 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:51:20.647369 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:51:20.648214 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:51:20.649029 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:51:20.749896 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:51:20.746916 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:51:20.827444 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:51:20.830062 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:51:20.842561 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:51:20.843967 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:51:21.144009 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:51:21.136715 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:51:21.164991 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:51:21.168627 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:51:21.171200 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:51:21.224060 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:51:21.437365 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:51:21.452570 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:51:21.462903 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.82s]
[0m09:51:21.465804 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:51:21.471038 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:51:21.525627 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:51:21.536431 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:51:21.542251 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.90s]
[0m09:51:21.545221 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:51:21.547942 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:51:21.553629 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.91s]
[0m09:51:21.557366 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:51:21.559896 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:51:21.561296 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:51:21.562971 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:51:21.564290 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:51:21.566491 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:51:21.568397 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:51:21.621306 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:51:21.623394 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:51:21.625154 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:51:21.626741 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:51:21.628952 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:51:21.651384 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:51:21.726438 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:51:21.749456 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:51:21.758518 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:51:21.761073 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:51:21.763266 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:51:21.827233 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:51:21.944150 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:51:22.027863 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:51:22.148504 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:51:22.249143 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:51:22.363626 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:51:22.443166 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:51:22.540213 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:51:22.648693 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:51:22.730649 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:51:22.757726 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:51:22.754016 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_fdc3650c_6ebc_4789_a9b6_b1237e8fe2a6` 
  ...
[0m09:51:22.822296 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_fdc3650c_6ebc_4789_a9b6_b1237e8fe2a6` 
  ...
[0m09:51:22.828740 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:51:22.843187 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:51:22.845815 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:51:22.849046 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:51:22.863901 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:51:22.961483 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdc3650c-6ebc-4789-a9b6-b1237e8fe2a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bd6c8a5f160>]}
[0m09:51:22.963912 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.33s]
[0m09:51:23.023384 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:51:23.249609 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_fdc3650c_6ebc_4789_a9b6_b1237e8fe2a6`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:51:23.252223 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_fdc3650c_6ebc_4789_a9b6_b1237e8fe2a6`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:51:23.283480 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:51:23.323120 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:51:23.366111 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_fdc3650c_6ebc_4789_a9b6_b1237e8fe2a6'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:51:23.425189 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_fdc3650c_6ebc_4789_a9b6_b1237e8fe2a6'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:51:23.431347 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:51:23.434117 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:51:23.447458 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:51:23.453037 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:51:23.456201 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_fdc3650c_6ebc_4789_a9b6_b1237e8fe2a6`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:51:23.461071 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_fdc3650c_6ebc_4789_a9b6_b1237e8fe2a6`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:51:23.487515 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:51:23.523113 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:51:23.526996 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_fdc3650c_6ebc_4789_a9b6_b1237e8fe2a6`)
      
    ...
[0m09:51:23.531085 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_fdc3650c_6ebc_4789_a9b6_b1237e8fe2a6`)
      
    ...
[0m09:51:23.557669 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:51:23.569821 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:51:23.574647 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:51:23.623101 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:51:23.589088 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:51:23.629690 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_fdc3650c_6ebc_4789_a9b6_b1237e8fe2a6` 
    ...
[0m09:51:23.641065 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:51:23.647193 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_fdc3650c_6ebc_4789_a9b6_b1237e8fe2a6` 
    ...
[0m09:51:23.649861 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:51:23.664173 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_fdc3650c_6ebc_4789_a9b6_b1237e8fe2a6` 
  ...
[0m09:51:23.666842 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:51:23.727650 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:51:23.732585 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_fdc3650c_6ebc_4789_a9b6_b1237e8fe2a6` 
  ...
[0m09:51:23.739443 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:51:23.743091 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:51:23.749575 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:51:23.751821 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:51:23.755252 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdc3650c-6ebc-4789-a9b6-b1237e8fe2a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bd6c8071c40>]}
[0m09:51:23.757497 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.19s]
[0m09:51:23.759034 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:51:23.760282 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:51:23.763650 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdc3650c-6ebc-4789-a9b6-b1237e8fe2a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bd6c945c250>]}
[0m09:51:23.765111 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.14s]
[0m09:51:23.766516 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:51:23.769001 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:51:23.822109 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:51:23.823310 [debug] [MainThread]: On list__mart: Close
[0m09:51:23.824388 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:51:23.825478 [debug] [MainThread]: On list__clean: Close
[0m09:51:23.826523 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:51:23.827661 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:51:23.828711 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m09:51:23.829834 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m09:51:23.830879 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:51:23.831952 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:51:23.832988 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:51:23.834054 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:51:23.836350 [info ] [MainThread]: 
[0m09:51:23.837791 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.99 seconds (4.99s).
[0m09:51:23.845882 [debug] [MainThread]: Command end result
[0m09:51:24.057422 [info ] [MainThread]: 
[0m09:51:24.058282 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:51:24.058944 [info ] [MainThread]: 
[0m09:51:24.059579 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:51:24.060894 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.918281, "process_in_blocks": "0", "process_kernel_time": 0.748785, "process_mem_max_rss": "115024", "process_out_blocks": "9744", "process_user_time": 6.724288}
[0m09:51:24.061615 [debug] [MainThread]: Command `dbt build` succeeded at 09:51:24.061407 after 7.92 seconds
[0m09:51:24.062222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bd6cc916310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bd6c94413a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bd6ca8a54c0>]}
[0m09:51:24.062819 [debug] [MainThread]: Flushing usage events
[0m09:52:15.657886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1028178e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1024de0c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1024de0ac0>]}


============================== 09:52:15.667147 | 70950091-b5eb-4293-bf12-2f9f0b90df49 ==============================
[0m09:52:15.667147 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:52:15.668256 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'no_print': 'None', 'use_experimental_parser': 'False', 'printer_width': '80', 'cache_selected_only': 'False', 'use_colors': 'True', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'partial_parse': 'True', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'write_json': 'True', 'version_check': 'True', 'quiet': 'False', 'debug': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'invocation_command': 'dbt build --profiles-dir . --target local', 'fail_fast': 'False', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'profiles_dir': '.', 'log_format': 'default'}
[0m09:52:16.193742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '70950091-b5eb-4293-bf12-2f9f0b90df49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1027602910>]}
[0m09:52:16.388347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '70950091-b5eb-4293-bf12-2f9f0b90df49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1024eb7070>]}
[0m09:52:16.389933 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:52:16.864889 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:52:17.378246 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:52:17.378915 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:52:17.659281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '70950091-b5eb-4293-bf12-2f9f0b90df49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1024536e20>]}
[0m09:52:18.097799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '70950091-b5eb-4293-bf12-2f9f0b90df49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d102454b700>]}
[0m09:52:18.098685 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:52:18.101926 [info ] [MainThread]: 
[0m09:52:18.103056 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:52:18.114713 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:52:18.116520 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:52:18.252514 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:52:18.254275 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:52:19.033395 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:52:19.052454 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:52:19.054424 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:52:19.071129 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:52:19.165530 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:52:19.167413 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:52:19.188526 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:52:19.195788 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:52:19.251981 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:52:19.268620 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:52:19.281574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '70950091-b5eb-4293-bf12-2f9f0b90df49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1024494490>]}
[0m09:52:19.283396 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:52:19.284692 [info ] [MainThread]: 
[0m09:52:19.364436 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:52:19.365635 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:52:19.366674 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:52:19.367389 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:52:19.383309 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:52:19.384454 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:52:19.566872 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:52:19.635471 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:52:19.636870 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:52:19.651994 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:52:19.779067 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:52:19.782772 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:52:19.784823 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:52:19.787734 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:52:19.793443 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:52:19.796447 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:52:19.798806 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:52:19.801878 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:52:19.893394 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:52:19.897001 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:52:19.952684 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70950091-b5eb-4293-bf12-2f9f0b90df49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d10238debe0>]}
[0m09:52:19.953991 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.54s]
[0m09:52:19.955302 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:52:19.957704 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:52:19.958751 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:52:19.959736 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:52:19.961086 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:52:19.962875 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:52:19.965136 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:52:19.966974 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:52:19.969282 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:52:19.971083 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:52:19.973219 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:52:19.974960 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:52:19.992187 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:52:20.092010 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:52:20.156054 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:52:20.159424 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:52:20.161550 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:52:20.180046 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:52:20.186887 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:52:20.451347 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:52:20.487721 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:52:20.490642 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:52:20.492865 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:52:20.495071 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:52:20.552788 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:52:20.804502 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:52:20.814372 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:52:20.824005 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:52:20.852726 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:52:20.865713 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:52:20.869500 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.90s]
[0m09:52:20.874874 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.90s]
[0m09:52:20.879939 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:52:20.883099 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:52:20.891163 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:52:20.896838 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.93s]
[0m09:52:20.899707 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:52:20.902396 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:52:20.952084 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:52:20.903713 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:52:20.954048 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:52:20.955821 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:52:20.957958 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:52:20.960186 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:52:20.962030 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:52:20.964066 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:52:20.966321 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:52:20.989035 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:52:20.993816 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:52:20.994795 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:52:21.058861 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:52:21.071760 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:52:21.081332 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:52:21.082989 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:52:21.161477 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:52:21.263241 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:52:21.372832 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:52:21.488892 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:52:21.678052 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:52:21.786281 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:52:21.861920 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:52:21.961937 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_70950091_b5eb_4293_bf12_2f9f0b90df49` 
  ...
[0m09:52:21.964849 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:52:21.989639 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_70950091_b5eb_4293_bf12_2f9f0b90df49` 
  ...
[0m09:52:22.052365 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:52:22.054072 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:52:22.057833 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:52:22.064516 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:52:22.092326 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:52:22.187523 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:52:22.368223 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_70950091_b5eb_4293_bf12_2f9f0b90df49`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:52:22.372864 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:52:22.374426 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_70950091_b5eb_4293_bf12_2f9f0b90df49`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:52:22.382781 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:52:22.388391 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70950091-b5eb-4293-bf12-2f9f0b90df49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d10240c34f0>]}
[0m09:52:22.391314 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.42s]
[0m09:52:22.394439 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:52:22.408947 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:52:22.452691 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:52:22.572197 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_70950091_b5eb_4293_bf12_2f9f0b90df49'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:52:22.574567 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_70950091_b5eb_4293_bf12_2f9f0b90df49'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:52:22.583959 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:52:22.586828 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:52:22.600072 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:52:22.656171 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:52:22.659137 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_70950091_b5eb_4293_bf12_2f9f0b90df49`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:52:22.661402 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_70950091_b5eb_4293_bf12_2f9f0b90df49`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:52:22.695454 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:52:22.698860 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:52:22.703528 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_70950091_b5eb_4293_bf12_2f9f0b90df49`)
      
    ...
[0m09:52:22.707756 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_70950091_b5eb_4293_bf12_2f9f0b90df49`)
      
    ...
[0m09:52:22.737506 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:52:22.743965 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:52:22.746155 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:52:22.760503 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:52:22.758415 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:52:22.767397 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_70950091_b5eb_4293_bf12_2f9f0b90df49` 
    ...
[0m09:52:22.776364 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:52:22.782553 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_70950091_b5eb_4293_bf12_2f9f0b90df49` 
    ...
[0m09:52:22.786744 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:52:22.799444 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_70950091_b5eb_4293_bf12_2f9f0b90df49` 
  ...
[0m09:52:22.853436 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:52:22.866754 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:52:22.868909 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_70950091_b5eb_4293_bf12_2f9f0b90df49` 
  ...
[0m09:52:22.882189 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:52:22.888934 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:52:22.891407 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:52:22.955456 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:52:22.962649 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70950091-b5eb-4293-bf12-2f9f0b90df49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d10240ba790>]}
[0m09:52:22.966935 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.00s]
[0m09:52:22.969765 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:52:22.972624 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:52:22.982691 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70950091-b5eb-4293-bf12-2f9f0b90df49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1024c56820>]}
[0m09:52:22.985472 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.03s]
[0m09:52:22.988342 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:52:22.992284 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:52:22.993475 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:52:22.994718 [debug] [MainThread]: On list__mart: Close
[0m09:52:22.995901 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:52:22.997134 [debug] [MainThread]: On list__clean: Close
[0m09:52:22.998260 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:52:22.999496 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:52:23.052409 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m09:52:23.053632 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m09:52:23.054779 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:52:23.055934 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:52:23.057041 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:52:23.058229 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:52:23.060547 [info ] [MainThread]: 
[0m09:52:23.062011 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.96 seconds (4.96s).
[0m09:52:23.070184 [debug] [MainThread]: Command end result
[0m09:52:23.286697 [info ] [MainThread]: 
[0m09:52:23.288199 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:52:23.289308 [info ] [MainThread]: 
[0m09:52:23.290448 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:52:23.292701 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.8258963, "process_in_blocks": "0", "process_kernel_time": 0.702451, "process_mem_max_rss": "115032", "process_out_blocks": "9744", "process_user_time": 6.570164}
[0m09:52:23.293979 [debug] [MainThread]: Command `dbt build` succeeded at 09:52:23.293617 after 7.83 seconds
[0m09:52:23.295034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1028178e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1024eb7070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d102442a520>]}
[0m09:52:23.295996 [debug] [MainThread]: Flushing usage events
[0m09:53:15.741645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723516dc0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723513a354f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723513a35640>]}


============================== 09:53:15.751240 | 2aed3fdd-b0a5-4516-86f9-3c50e308242c ==============================
[0m09:53:15.751240 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:53:15.752371 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'target_path': 'None', 'partial_parse': 'True', 'debug': 'False', 'quiet': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'version_check': 'True', 'log_cache_events': 'False', 'empty': 'False', 'profiles_dir': '.', 'introspect': 'True', 'no_print': 'None', 'static_parser': 'True', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'log_format': 'default', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False'}
[0m09:53:16.279126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2aed3fdd-b0a5-4516-86f9-3c50e308242c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7235139f00a0>]}
[0m09:53:16.471873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2aed3fdd-b0a5-4516-86f9-3c50e308242c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723513a1ba60>]}
[0m09:53:16.473190 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:53:16.938113 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:53:17.459615 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:53:17.460259 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:53:17.665075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2aed3fdd-b0a5-4516-86f9-3c50e308242c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723513192e80>]}
[0m09:53:18.140704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2aed3fdd-b0a5-4516-86f9-3c50e308242c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7235131a89a0>]}
[0m09:53:18.141605 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:53:18.144766 [info ] [MainThread]: 
[0m09:53:18.145786 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:53:18.157744 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:53:18.159209 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:53:18.269926 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:53:18.271480 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:53:19.099634 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:53:19.108592 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:53:19.140243 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:53:19.154525 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:53:19.240019 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:53:19.247087 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:53:19.262525 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:53:19.266106 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:53:19.273600 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:53:19.331709 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:53:19.351476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2aed3fdd-b0a5-4516-86f9-3c50e308242c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72351398cd00>]}
[0m09:53:19.353342 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:53:19.354718 [info ] [MainThread]: 
[0m09:53:19.432193 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:53:19.433570 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:53:19.434804 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:53:19.435685 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:53:19.453060 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:53:19.454181 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:53:19.630961 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:53:19.703072 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:53:19.704522 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:53:19.716968 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:53:19.843803 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:53:19.847943 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:53:19.849878 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:53:19.852707 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:53:19.858257 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:53:19.861385 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:53:19.863245 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:53:19.866109 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:53:19.959569 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:53:19.962959 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:53:19.969014 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2aed3fdd-b0a5-4516-86f9-3c50e308242c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723512426ac0>]}
[0m09:53:19.970218 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m09:53:19.971617 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:53:19.973300 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:53:19.974231 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:53:19.975256 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:53:19.976253 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:53:19.977411 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:53:19.978626 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:53:19.979986 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:53:19.981237 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:53:20.032240 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:53:20.034096 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:53:20.035921 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:53:20.037721 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:53:20.254559 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:53:20.259075 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:53:20.260419 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:53:20.262927 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:53:20.264676 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:53:20.351577 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:53:20.634918 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:53:20.636990 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:53:20.651561 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:53:20.654449 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:53:20.656258 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:53:20.659443 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:53:20.930711 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:53:20.946757 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:53:20.954486 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:53:20.962404 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:53:20.970352 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:53:20.972623 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.99s]
[0m09:53:21.037322 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:53:21.040395 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:53:21.034340 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.05s]
[0m09:53:21.046738 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 1.01s]
[0m09:53:21.049762 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:53:21.052725 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:53:21.056377 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:53:21.057620 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:53:21.059328 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:53:21.060976 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:53:21.062759 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:53:21.065046 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:53:21.067002 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:53:21.068596 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:53:21.070166 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:53:21.071818 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:53:21.073478 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:53:21.075265 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:53:21.248778 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:53:21.265874 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:53:21.267967 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:53:21.270627 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:53:21.272312 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:53:21.279076 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:53:21.344913 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:53:21.457495 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:53:21.631865 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:53:21.736389 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:53:21.877491 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:53:21.944829 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:53:21.959181 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:53:22.039917 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:53:22.140608 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:53:22.150057 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:53:22.158624 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_2aed3fdd_b0a5_4516_86f9_3c50e308242c` 
  ...
[0m09:53:22.171870 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_2aed3fdd_b0a5_4516_86f9_3c50e308242c` 
  ...
[0m09:53:22.177121 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:53:22.232413 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:53:22.245481 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:53:22.249951 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:53:22.359878 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:53:22.445520 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2aed3fdd-b0a5-4516-86f9-3c50e308242c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723511d74310>]}
[0m09:53:22.463670 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.38s]
[0m09:53:22.537265 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:53:22.730622 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_2aed3fdd_b0a5_4516_86f9_3c50e308242c`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:53:22.732027 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_2aed3fdd_b0a5_4516_86f9_3c50e308242c`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:53:22.766070 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:53:22.782004 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:53:22.852122 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_2aed3fdd_b0a5_4516_86f9_3c50e308242c'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:53:22.854579 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_2aed3fdd_b0a5_4516_86f9_3c50e308242c'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:53:22.864891 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:53:22.872874 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:53:22.932147 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:53:22.942648 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:53:22.945843 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_2aed3fdd_b0a5_4516_86f9_3c50e308242c`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:53:22.948273 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_2aed3fdd_b0a5_4516_86f9_3c50e308242c`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:53:22.979739 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:53:22.981522 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:53:22.986418 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_2aed3fdd_b0a5_4516_86f9_3c50e308242c`)
      
    ...
[0m09:53:22.991367 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_2aed3fdd_b0a5_4516_86f9_3c50e308242c`)
      
    ...
[0m09:53:23.021708 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:53:23.035322 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:53:23.038546 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:53:23.047904 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:53:23.049782 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:53:23.055977 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_2aed3fdd_b0a5_4516_86f9_3c50e308242c` 
    ...
[0m09:53:23.058650 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:53:23.062103 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_2aed3fdd_b0a5_4516_86f9_3c50e308242c` 
    ...
[0m09:53:23.063886 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:53:23.071629 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_2aed3fdd_b0a5_4516_86f9_3c50e308242c` 
  ...
[0m09:53:23.073982 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:53:23.132059 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:53:23.143833 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_2aed3fdd_b0a5_4516_86f9_3c50e308242c` 
  ...
[0m09:53:23.164003 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:53:23.170219 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:53:23.177446 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:53:23.231568 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:53:23.237192 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2aed3fdd-b0a5-4516-86f9-3c50e308242c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723511ba5c40>]}
[0m09:53:23.241687 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.17s]
[0m09:53:23.245829 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:53:23.248829 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:53:23.254374 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2aed3fdd-b0a5-4516-86f9-3c50e308242c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723513704730>]}
[0m09:53:23.256265 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.19s]
[0m09:53:23.258409 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:53:23.262263 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:53:23.263312 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:53:23.264369 [debug] [MainThread]: On list__clean: Close
[0m09:53:23.265471 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:53:23.266901 [debug] [MainThread]: On list__mart: Close
[0m09:53:23.268109 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:53:23.269563 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:53:23.270713 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:53:23.271911 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:53:23.273028 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:53:23.274212 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:53:23.275417 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m09:53:23.276599 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m09:53:23.279059 [info ] [MainThread]: 
[0m09:53:23.331445 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.13 seconds (5.13s).
[0m09:53:23.340087 [debug] [MainThread]: Command end result
[0m09:53:23.541788 [info ] [MainThread]: 
[0m09:53:23.543445 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:53:23.544778 [info ] [MainThread]: 
[0m09:53:23.546191 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:53:23.548890 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.998669, "process_in_blocks": "0", "process_kernel_time": 0.745452, "process_mem_max_rss": "115092", "process_out_blocks": "9744", "process_user_time": 6.611923}
[0m09:53:23.550468 [debug] [MainThread]: Command `dbt build` succeeded at 09:53:23.550059 after 8.00 seconds
[0m09:53:23.551853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723516dc0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7235130f9640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72351318b370>]}
[0m09:53:23.553288 [debug] [MainThread]: Flushing usage events
[0m09:54:16.365100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a53b33e7310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a53b0040a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a53b0040940>]}


============================== 09:54:16.374817 | bb8af609-56fe-4901-80ce-053e00c88006 ==============================
[0m09:54:16.374817 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:54:16.375898 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'empty': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'debug': 'False', 'introspect': 'True', 'printer_width': '80', 'partial_parse': 'True', 'write_json': 'True', 'indirect_selection': 'eager', 'profiles_dir': '.', 'quiet': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'use_colors': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_format': 'default', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True'}
[0m09:54:16.948367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bb8af609-56fe-4901-80ce-053e00c88006', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a53b297bfd0>]}
[0m09:54:17.142389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bb8af609-56fe-4901-80ce-053e00c88006', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a53b0b0f430>]}
[0m09:54:17.143728 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:54:17.566092 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:54:18.077561 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:54:18.078228 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:54:18.279958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bb8af609-56fe-4901-80ce-053e00c88006', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a53af7a6f10>]}
[0m09:54:18.773553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bb8af609-56fe-4901-80ce-053e00c88006', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a53b261cc70>]}
[0m09:54:18.774527 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:54:18.777848 [info ] [MainThread]: 
[0m09:54:18.778940 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:54:18.831498 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:54:18.791036 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:54:18.870674 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:54:18.935522 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:54:19.744259 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:54:19.748343 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:54:19.752606 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:54:19.757274 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:54:19.859658 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:54:19.861495 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:54:19.877472 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:54:19.934592 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:54:19.946970 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:54:19.949394 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:54:19.978998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb8af609-56fe-4901-80ce-053e00c88006', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a53afeb0940>]}
[0m09:54:19.980864 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:54:19.982182 [info ] [MainThread]: 
[0m09:54:20.055668 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:54:20.056948 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:54:20.058092 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:54:20.058972 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:54:20.078334 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:54:20.130657 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:54:20.261863 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:54:20.352771 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:54:20.354205 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:54:20.365530 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:54:20.470343 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:54:20.473772 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:54:20.475768 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:54:20.478918 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:54:20.533002 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:54:20.536927 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:54:20.538847 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:54:20.541863 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:54:20.635621 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:54:20.639103 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:54:20.645133 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb8af609-56fe-4901-80ce-053e00c88006', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a53b2977820>]}
[0m09:54:20.646291 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m09:54:20.647670 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:54:20.649716 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:54:20.650763 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:54:20.652091 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:54:20.654082 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:54:20.655464 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:54:20.656561 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:54:20.657640 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:54:20.659645 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:54:20.660865 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:54:20.662921 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:54:20.664338 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:54:20.731167 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:54:20.860172 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:54:20.862191 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:54:20.864112 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:54:20.866519 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:54:20.868497 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:54:20.876037 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:54:21.243850 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:54:21.248669 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:54:21.251385 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:54:21.254523 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:54:21.256735 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:54:21.261501 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:54:21.539792 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:54:21.547271 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:54:21.550147 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:54:21.558240 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:54:21.572741 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.92s]
[0m09:54:21.575738 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:54:21.578316 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:54:21.634135 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:54:21.641077 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.98s]
[0m09:54:21.644995 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.98s]
[0m09:54:21.646734 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:54:21.648251 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:54:21.650323 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:54:21.651222 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:54:21.652415 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:54:21.653479 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:54:21.655248 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:54:21.656748 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:54:21.657898 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:54:21.658938 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:54:21.660020 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:54:21.660751 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:54:21.661758 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:54:21.732360 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:54:21.734330 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:54:21.762731 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:54:21.767212 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:54:21.770406 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:54:21.773321 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:54:21.846747 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:54:21.934965 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:54:22.052044 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:54:22.147362 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:54:22.262291 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:54:22.438460 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:54:22.468931 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:54:22.549276 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:54:22.648571 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:54:22.737166 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:54:22.741478 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_bb8af609_56fe_4901_80ce_053e00c88006` 
  ...
[0m09:54:22.742963 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_bb8af609_56fe_4901_80ce_053e00c88006` 
  ...
[0m09:54:22.747230 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:54:22.755618 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:54:22.758179 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:54:22.760827 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:54:22.959227 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:54:23.137103 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:54:23.153881 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb8af609-56fe-4901-80ce-053e00c88006', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a53af34a430>]}
[0m09:54:23.237376 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_bb8af609_56fe_4901_80ce_053e00c88006`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:54:23.238895 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.49s]
[0m09:54:23.241818 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_bb8af609_56fe_4901_80ce_053e00c88006`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:54:23.246457 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:54:23.277617 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:54:23.292978 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:54:23.358433 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_bb8af609_56fe_4901_80ce_053e00c88006'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:54:23.359576 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_bb8af609_56fe_4901_80ce_053e00c88006'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:54:23.371164 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:54:23.373813 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:54:23.435397 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:54:23.441396 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:54:23.444589 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_bb8af609_56fe_4901_80ce_053e00c88006`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:54:23.447272 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_bb8af609_56fe_4901_80ce_053e00c88006`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:54:23.482101 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:54:23.484892 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:54:23.489857 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_bb8af609_56fe_4901_80ce_053e00c88006`)
      
    ...
[0m09:54:23.493598 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_bb8af609_56fe_4901_80ce_053e00c88006`)
      
    ...
[0m09:54:23.516255 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:54:23.531957 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:54:23.533676 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:54:23.544197 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:54:23.553926 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:54:23.562007 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:54:23.559873 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_bb8af609_56fe_4901_80ce_053e00c88006` 
    ...
[0m09:54:23.567473 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_bb8af609_56fe_4901_80ce_053e00c88006` 
    ...
[0m09:54:23.578990 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:54:23.632646 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:54:23.643066 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_bb8af609_56fe_4901_80ce_053e00c88006` 
  ...
[0m09:54:23.655142 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_bb8af609_56fe_4901_80ce_053e00c88006` 
  ...
[0m09:54:23.662392 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:54:23.670135 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:54:23.677497 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:54:23.743063 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:54:23.748668 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:54:23.750762 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:54:23.757430 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb8af609-56fe-4901-80ce-053e00c88006', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a53ae3c2640>]}
[0m09:54:23.763408 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb8af609-56fe-4901-80ce-053e00c88006', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a53b125b1f0>]}
[0m09:54:23.765952 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.10s]
[0m09:54:23.768774 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.10s]
[0m09:54:23.771901 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:54:23.775079 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:54:23.830569 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:54:23.831916 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:54:23.833054 [debug] [MainThread]: On list__mart: Close
[0m09:54:23.834121 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:54:23.835194 [debug] [MainThread]: On list__clean: Close
[0m09:54:23.836225 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:54:23.837392 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:54:23.838449 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:54:23.839654 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:54:23.840702 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:54:23.841768 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:54:23.842803 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m09:54:23.843875 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m09:54:23.846219 [info ] [MainThread]: 
[0m09:54:23.847945 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.07 seconds (5.07s).
[0m09:54:23.857818 [debug] [MainThread]: Command end result
[0m09:54:24.048995 [info ] [MainThread]: 
[0m09:54:24.050191 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:54:24.051064 [info ] [MainThread]: 
[0m09:54:24.051981 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:54:24.053761 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.879762, "process_in_blocks": "0", "process_kernel_time": 0.737697, "process_mem_max_rss": "115108", "process_out_blocks": "9744", "process_user_time": 6.52093}
[0m09:54:24.054748 [debug] [MainThread]: Command `dbt build` succeeded at 09:54:24.054474 after 7.88 seconds
[0m09:54:24.055588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a53b33e7310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a53b12fcf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a53b0b670a0>]}
[0m09:54:24.056384 [debug] [MainThread]: Flushing usage events
[0m09:55:15.853955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713a27781e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713a243d7b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713a243d7a30>]}


============================== 09:55:15.864124 | 45609e31-287d-4c99-bf13-e699bf035aa4 ==============================
[0m09:55:15.864124 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:55:15.865396 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt build --profiles-dir . --target local', 'cache_selected_only': 'False', 'fail_fast': 'False', 'introspect': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'static_parser': 'True', 'use_colors': 'True', 'quiet': 'False', 'version_check': 'True', 'debug': 'False', 'partial_parse': 'True', 'write_json': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'printer_width': '80', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '.', 'empty': 'False', 'target_path': 'None', 'no_print': 'None', 'use_experimental_parser': 'False', 'log_format': 'default'}
[0m09:55:16.448793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '45609e31-287d-4c99-bf13-e699bf035aa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713a279abb50>]}
[0m09:55:16.590000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '45609e31-287d-4c99-bf13-e699bf035aa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713a244ce160>]}
[0m09:55:16.591265 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:55:17.054144 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:55:17.559322 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:55:17.560021 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:55:17.764684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '45609e31-287d-4c99-bf13-e699bf035aa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713a23b3de50>]}
[0m09:55:18.247747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '45609e31-287d-4c99-bf13-e699bf035aa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713a23afc400>]}
[0m09:55:18.248643 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:55:18.251900 [info ] [MainThread]: 
[0m09:55:18.253009 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:55:18.265957 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:55:18.278190 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:55:18.355344 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:55:18.373407 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:55:19.055955 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:55:19.060272 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:55:19.062839 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:55:19.069661 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:55:19.168616 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:55:19.175181 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:55:19.254754 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:55:19.256694 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:55:19.269354 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:55:19.271730 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:55:19.345893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45609e31-287d-4c99-bf13-e699bf035aa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713a239fdac0>]}
[0m09:55:19.347874 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:55:19.349283 [info ] [MainThread]: 
[0m09:55:19.375692 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:55:19.377055 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:55:19.378157 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:55:19.378917 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:55:19.445836 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:55:19.447446 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:55:19.643078 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:55:19.706308 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:55:19.707800 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:55:19.719679 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:55:19.847101 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:55:19.850758 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:55:19.852735 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:55:19.855681 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:55:19.861522 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:55:19.864717 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:55:19.866590 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:55:19.869409 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:55:19.961586 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:55:19.965092 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:55:19.971043 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45609e31-287d-4c99-bf13-e699bf035aa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713a22ec08b0>]}
[0m09:55:19.972187 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m09:55:19.973577 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:55:19.975722 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:55:19.977225 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:55:19.978985 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:55:19.980792 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:55:19.982300 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:55:19.984496 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:55:19.986299 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:55:19.988557 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:55:19.990281 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:55:19.992317 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:55:20.043452 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:55:20.060918 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:55:20.160171 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:55:20.173296 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:55:20.182720 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:55:20.185258 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:55:20.252743 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:55:20.264753 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:55:20.555338 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:55:20.566585 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:55:20.572371 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:55:20.575043 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:55:20.577204 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:55:20.581862 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:55:20.831879 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:55:20.859307 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:55:20.862397 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:55:20.864929 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:55:20.877255 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.89s]
[0m09:55:20.886106 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:55:20.941618 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:55:20.943200 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:55:20.946018 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.96s]
[0m09:55:20.948861 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.96s]
[0m09:55:20.950234 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:55:20.951571 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:55:20.953454 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:55:20.954232 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:55:20.955149 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:55:20.956133 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:55:20.957397 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:55:20.958709 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:55:20.959689 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:55:20.960517 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:55:20.961760 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:55:20.962947 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:55:20.964016 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:55:20.965343 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:55:20.984097 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:55:21.051166 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:55:21.065004 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:55:21.067813 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:55:21.074911 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:55:21.087041 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:55:21.176806 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:55:21.351973 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:55:21.458453 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:55:21.649792 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:55:21.769300 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m09:55:21.783923 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:55:21.858712 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:55:21.958758 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:55:21.981906 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_45609e31_287d_4c99_bf13_e699bf035aa4` 
  ...
[0m09:55:22.043429 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_45609e31_287d_4c99_bf13_e699bf035aa4` 
  ...
[0m09:55:22.045446 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:55:22.055093 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:55:22.062968 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:55:22.145709 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:55:22.188738 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:55:22.287787 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:55:22.459453 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:55:22.474943 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45609e31-287d-4c99-bf13-e699bf035aa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713a238c8850>]}
[0m09:55:22.482453 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.51s]
[0m09:55:22.554682 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:55:22.563200 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_45609e31_287d_4c99_bf13_e699bf035aa4`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:55:22.565064 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_45609e31_287d_4c99_bf13_e699bf035aa4`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:55:22.601185 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:55:22.616907 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:55:22.685626 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_45609e31_287d_4c99_bf13_e699bf035aa4'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:55:22.682109 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_45609e31_287d_4c99_bf13_e699bf035aa4'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:55:22.743279 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:55:22.751681 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:55:22.754104 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:55:22.760156 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:55:22.763082 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_45609e31_287d_4c99_bf13_e699bf035aa4`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:55:22.765628 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_45609e31_287d_4c99_bf13_e699bf035aa4`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:55:22.801486 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:55:22.805989 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_45609e31_287d_4c99_bf13_e699bf035aa4`)
      
    ...
[0m09:55:22.808390 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:55:22.814332 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_45609e31_287d_4c99_bf13_e699bf035aa4`)
      
    ...
[0m09:55:22.842185 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:55:22.852196 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:55:22.857844 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:55:22.867624 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:55:22.876620 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:55:22.884728 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:55:22.882465 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_45609e31_287d_4c99_bf13_e699bf035aa4` 
    ...
[0m09:55:22.891482 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_45609e31_287d_4c99_bf13_e699bf035aa4` 
    ...
[0m09:55:22.951813 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:55:22.959561 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:55:22.966708 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_45609e31_287d_4c99_bf13_e699bf035aa4` 
  ...
[0m09:55:22.979330 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_45609e31_287d_4c99_bf13_e699bf035aa4` 
  ...
[0m09:55:22.985329 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:55:23.043177 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:55:23.048755 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:55:23.061687 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:55:23.067751 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:55:23.074286 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45609e31-287d-4c99-bf13-e699bf035aa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713a242bf850>]}
[0m09:55:23.077133 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.11s]
[0m09:55:23.079989 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:55:23.082935 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:55:23.142093 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45609e31-287d-4c99-bf13-e699bf035aa4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713a234e2a30>]}
[0m09:55:23.145242 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.18s]
[0m09:55:23.148025 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:55:23.151830 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:55:23.152972 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:55:23.154149 [debug] [MainThread]: On list__mart: Close
[0m09:55:23.155232 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:55:23.156345 [debug] [MainThread]: On list__clean: Close
[0m09:55:23.157439 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:55:23.158559 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:55:23.159623 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:55:23.160719 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:55:23.161805 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:55:23.162899 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:55:23.163971 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m09:55:23.165073 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m09:55:23.167385 [info ] [MainThread]: 
[0m09:55:23.168915 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.91 seconds (4.91s).
[0m09:55:23.177847 [debug] [MainThread]: Command end result
[0m09:55:23.444728 [info ] [MainThread]: 
[0m09:55:23.446507 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:55:23.447781 [info ] [MainThread]: 
[0m09:55:23.449241 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:55:23.452047 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.7896256, "process_in_blocks": "0", "process_kernel_time": 0.72191, "process_mem_max_rss": "114848", "process_out_blocks": "9752", "process_user_time": 6.531711}
[0m09:55:23.453619 [debug] [MainThread]: Command `dbt build` succeeded at 09:55:23.453171 after 7.79 seconds
[0m09:55:23.454929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713a27781e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713a2568a9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713a2265d040>]}
[0m09:55:23.456202 [debug] [MainThread]: Flushing usage events
[0m09:56:15.878749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790d73a70310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790d706d4b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790d706d4a00>]}


============================== 09:56:15.938587 | 4d9a5f64-2659-41f6-8afa-e35547486dfe ==============================
[0m09:56:15.938587 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:56:15.939653 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'cache_selected_only': 'False', 'version_check': 'True', 'quiet': 'False', 'log_cache_events': 'False', 'log_format': 'default', 'use_experimental_parser': 'False', 'use_colors': 'True', 'fail_fast': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'debug': 'False', 'warn_error': 'None', 'empty': 'False', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'indirect_selection': 'eager', 'target_path': 'None', 'profiles_dir': '.', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'introspect': 'True'}
[0m09:56:16.464207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4d9a5f64-2659-41f6-8afa-e35547486dfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790d73000ca0>]}
[0m09:56:16.661093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4d9a5f64-2659-41f6-8afa-e35547486dfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790d707c1e20>]}
[0m09:56:16.662385 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:56:17.072107 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:56:17.572351 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:56:17.572989 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:56:17.778691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4d9a5f64-2659-41f6-8afa-e35547486dfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790d6fe28eb0>]}
[0m09:56:18.264205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4d9a5f64-2659-41f6-8afa-e35547486dfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790d6fd1d4c0>]}
[0m09:56:18.265723 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:56:18.269402 [info ] [MainThread]: 
[0m09:56:18.270511 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:56:18.333614 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:56:18.335708 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:56:18.467284 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:56:18.468489 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:56:19.312468 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:56:19.337386 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:56:19.339768 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:56:19.352947 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:56:19.446845 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:56:19.448622 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:56:19.468631 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:56:19.475423 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:56:19.534354 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:56:19.483981 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:56:19.562838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4d9a5f64-2659-41f6-8afa-e35547486dfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790d739c37c0>]}
[0m09:56:19.564819 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:56:19.566285 [info ] [MainThread]: 
[0m09:56:19.645457 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:56:19.646624 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:56:19.647709 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:56:19.648521 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:56:19.665063 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:56:19.666299 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:56:19.849629 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:56:19.915379 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:56:19.916732 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:56:19.932594 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:56:20.064717 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:56:20.068435 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:56:20.070566 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:56:20.073642 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:56:20.079243 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:56:20.082062 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:56:20.083874 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:56:20.133100 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:56:20.178636 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:56:20.182006 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:56:20.237487 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4d9a5f64-2659-41f6-8afa-e35547486dfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790d6f187e50>]}
[0m09:56:20.238731 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m09:56:20.240117 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:56:20.242270 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:56:20.243457 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:56:20.244737 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:56:20.246067 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:56:20.247869 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:56:20.249793 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:56:20.251859 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:56:20.253782 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:56:20.255861 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:56:20.257967 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:56:20.333591 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:56:20.354399 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:56:20.355846 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:56:20.371885 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:56:20.439791 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:56:20.442310 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:56:20.449183 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:56:20.538629 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:56:20.742066 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:56:20.757323 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:56:20.773924 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:56:20.777389 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:56:20.778997 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:56:20.832961 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:56:21.064341 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:56:21.079381 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:56:21.096734 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.85s]
[0m09:56:21.136524 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:56:21.138136 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:56:21.139902 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:56:21.152485 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:56:21.154063 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:56:21.157601 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.90s]
[0m09:56:21.161239 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.91s]
[0m09:56:21.162891 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:56:21.164456 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:56:21.166419 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:56:21.167269 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:56:21.168271 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:56:21.169402 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:56:21.170656 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:56:21.171991 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:56:21.173034 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:56:21.173978 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:56:21.174959 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:56:21.175855 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:56:21.176812 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:56:21.178561 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:56:21.356965 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:56:21.358847 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:56:21.361202 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:56:21.363593 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:56:21.365693 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:56:21.434492 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:56:21.437219 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:56:21.575246 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:56:21.682093 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:56:21.834113 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:56:21.968239 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m09:56:22.045618 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:56:22.144419 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_4d9a5f64_2659_41f6_8afa_e35547486dfe` 
  ...
[0m09:56:22.149830 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_4d9a5f64_2659_41f6_8afa_e35547486dfe` 
  ...
[0m09:56:22.152707 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:56:22.154757 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:56:22.167233 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:56:22.168114 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:56:22.270642 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:56:22.344751 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_4d9a5f64_2659_41f6_8afa_e35547486dfe`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:56:22.346921 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:56:22.350336 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_4d9a5f64_2659_41f6_8afa_e35547486dfe`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:56:22.356226 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:56:22.363901 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:56:22.366979 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:56:22.369765 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4d9a5f64-2659-41f6-8afa-e35547486dfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790d6fa5d220>]}
[0m09:56:22.370927 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.19s]
[0m09:56:22.372566 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:56:22.380194 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:56:22.441109 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:56:22.457828 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_4d9a5f64_2659_41f6_8afa_e35547486dfe'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:56:22.464935 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_4d9a5f64_2659_41f6_8afa_e35547486dfe'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:56:22.472293 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:56:22.474485 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:56:22.485104 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:56:22.488495 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:56:22.490027 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_4d9a5f64_2659_41f6_8afa_e35547486dfe`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:56:22.533543 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_4d9a5f64_2659_41f6_8afa_e35547486dfe`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:56:22.549626 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:56:22.550930 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:56:22.552897 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_4d9a5f64_2659_41f6_8afa_e35547486dfe`)
      
    ...
[0m09:56:22.554892 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_4d9a5f64_2659_41f6_8afa_e35547486dfe`)
      
    ...
[0m09:56:22.573085 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:56:22.579565 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:56:22.581012 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:56:22.587459 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:56:22.590021 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:56:22.592932 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_4d9a5f64_2659_41f6_8afa_e35547486dfe` 
    ...
[0m09:56:22.594441 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:56:22.598499 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_4d9a5f64_2659_41f6_8afa_e35547486dfe` 
    ...
[0m09:56:22.600414 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:56:22.607607 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_4d9a5f64_2659_41f6_8afa_e35547486dfe` 
  ...
[0m09:56:22.633705 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:56:22.640821 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_4d9a5f64_2659_41f6_8afa_e35547486dfe` 
  ...
[0m09:56:22.642235 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:56:22.649954 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:56:22.651209 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:56:22.658662 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:56:22.659906 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:56:22.664135 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4d9a5f64-2659-41f6-8afa-e35547486dfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790d6f79d160>]}
[0m09:56:22.665331 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.49s]
[0m09:56:22.666732 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:56:22.668109 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:56:22.673231 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4d9a5f64-2659-41f6-8afa-e35547486dfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790d705c10a0>]}
[0m09:56:22.675346 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.50s]
[0m09:56:22.677774 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:56:22.680225 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:56:22.680803 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:56:22.681350 [debug] [MainThread]: On list__clean: Close
[0m09:56:22.733339 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:56:22.733939 [debug] [MainThread]: On list__mart: Close
[0m09:56:22.734424 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:56:22.734967 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:56:22.735502 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:56:22.736037 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:56:22.736504 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m09:56:22.737029 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m09:56:22.737520 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:56:22.738032 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:56:22.739204 [info ] [MainThread]: 
[0m09:56:22.739949 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.47 seconds (4.47s).
[0m09:56:22.743657 [debug] [MainThread]: Command end result
[0m09:56:22.849067 [info ] [MainThread]: 
[0m09:56:22.849959 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:56:22.850599 [info ] [MainThread]: 
[0m09:56:22.851237 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:56:22.852554 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.115892, "process_in_blocks": "0", "process_kernel_time": 0.6822, "process_mem_max_rss": "114604", "process_out_blocks": "9752", "process_user_time": 6.187747}
[0m09:56:22.853309 [debug] [MainThread]: Command `dbt build` succeeded at 09:56:22.853115 after 7.12 seconds
[0m09:56:22.853955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790d73a70310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790d707c1e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790d73000ca0>]}
[0m09:56:22.854627 [debug] [MainThread]: Flushing usage events
[0m09:57:16.339273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707ee5204d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707ee1e68be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707ee1e68a90>]}


============================== 09:57:16.399371 | 735eaff8-c13c-4420-b1ba-529fba20d468 ==============================
[0m09:57:16.399371 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:57:16.400471 [debug] [MainThread]: running dbt with arguments {'log_path': '/workdir/transforms/04_btc/logs', 'partial_parse': 'True', 'printer_width': '80', 'invocation_command': 'dbt build --profiles-dir . --target local', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '.', 'log_cache_events': 'False', 'write_json': 'True', 'version_check': 'True', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False'}
[0m09:57:16.930447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '735eaff8-c13c-4420-b1ba-529fba20d468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707ee1d46af0>]}
[0m09:57:17.133841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '735eaff8-c13c-4420-b1ba-529fba20d468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707ee297b610>]}
[0m09:57:17.135925 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:57:17.604836 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:57:18.115613 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:57:18.116277 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:57:18.319311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '735eaff8-c13c-4420-b1ba-529fba20d468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707ee15bbdf0>]}
[0m09:57:18.803497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '735eaff8-c13c-4420-b1ba-529fba20d468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707ee15cfb20>]}
[0m09:57:18.804364 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:57:18.807504 [info ] [MainThread]: 
[0m09:57:18.808513 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:57:18.820015 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:57:18.831701 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:57:18.925785 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:57:18.926580 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:57:19.719711 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:57:19.728844 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:57:19.790469 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:57:19.798487 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:57:19.831012 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:57:19.832657 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:57:19.915672 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:57:19.917186 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:57:19.925822 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:57:19.936494 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:57:20.006271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '735eaff8-c13c-4420-b1ba-529fba20d468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707ee0e70040>]}
[0m09:57:20.008307 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:57:20.009756 [info ] [MainThread]: 
[0m09:57:20.036714 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:57:20.037834 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:57:20.090268 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:57:20.091589 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:57:20.120106 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:57:20.121633 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:57:20.314075 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:57:20.379853 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:57:20.381249 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:57:20.393553 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:57:20.525359 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:57:20.528962 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:57:20.531353 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:57:20.535306 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:57:20.541168 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:57:20.592412 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:57:20.594355 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:57:20.597166 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:57:20.690882 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:57:20.694354 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:57:20.701226 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '735eaff8-c13c-4420-b1ba-529fba20d468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707ee090d730>]}
[0m09:57:20.702414 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.66s]
[0m09:57:20.703787 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:57:20.706033 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:57:20.707417 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:57:20.709269 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:57:20.710947 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:57:20.712970 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:57:20.715093 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:57:20.717390 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:57:20.719429 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:57:20.721509 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:57:20.723151 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:57:20.724790 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:57:20.726437 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:57:20.993157 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:57:20.995179 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:57:20.999563 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:57:21.002293 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:57:21.014612 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:57:21.032063 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:57:21.293429 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:57:21.317137 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:57:21.327260 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:57:21.330333 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:57:21.332642 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:57:21.334190 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:57:21.594637 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:57:21.616468 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:57:21.618816 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:57:21.620770 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:57:21.629695 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m09:57:21.634815 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:57:21.640929 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:57:21.690736 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:57:21.693777 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.97s]
[0m09:57:21.696593 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.98s]
[0m09:57:21.698036 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:57:21.699384 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:57:21.701286 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:57:21.702304 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:57:21.703176 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:57:21.703946 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:57:21.704736 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:57:21.705688 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:57:21.706771 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:57:21.707866 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:57:21.708952 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:57:21.709699 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:57:21.736145 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:57:21.792689 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:57:21.794299 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:57:21.812060 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:57:21.824166 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:57:21.828293 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:57:21.911494 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:57:21.918609 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:57:22.100824 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:57:22.206824 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:57:22.329154 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m09:57:22.334781 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:57:22.491383 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:57:22.530809 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:57:22.603529 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:57:22.635567 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:57:22.637134 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_735eaff8_c13c_4420_b1ba_529fba20d468` 
  ...
[0m09:57:22.729920 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_735eaff8_c13c_4420_b1ba_529fba20d468` 
  ...
[0m09:57:22.733425 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:57:22.735748 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:57:22.815044 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:57:22.829482 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:57:23.003631 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:57:23.098783 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:57:23.197083 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:57:23.202444 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_735eaff8_c13c_4420_b1ba_529fba20d468`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:57:23.210756 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_735eaff8_c13c_4420_b1ba_529fba20d468`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:57:23.216021 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '735eaff8-c13c-4420-b1ba-529fba20d468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707ee0952d00>]}
[0m09:57:23.223478 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.51s]
[0m09:57:23.228400 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:57:23.249921 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:57:23.296248 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:57:23.333744 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_735eaff8_c13c_4420_b1ba_529fba20d468'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:57:23.331528 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_735eaff8_c13c_4420_b1ba_529fba20d468'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:57:23.392211 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:57:23.408564 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:57:23.406132 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:57:23.414332 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:57:23.417387 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_735eaff8_c13c_4420_b1ba_529fba20d468`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:57:23.419674 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_735eaff8_c13c_4420_b1ba_529fba20d468`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:57:23.450634 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:57:23.452874 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:57:23.457085 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_735eaff8_c13c_4420_b1ba_529fba20d468`)
      
    ...
[0m09:57:23.490891 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_735eaff8_c13c_4420_b1ba_529fba20d468`)
      
    ...
[0m09:57:23.518886 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:57:23.524952 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:57:23.526508 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:57:23.533734 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:57:23.535505 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:57:23.540018 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_735eaff8_c13c_4420_b1ba_529fba20d468` 
    ...
[0m09:57:23.543066 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:57:23.548577 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_735eaff8_c13c_4420_b1ba_529fba20d468` 
    ...
[0m09:57:23.550794 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:57:23.593599 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_735eaff8_c13c_4420_b1ba_529fba20d468` 
  ...
[0m09:57:23.596115 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:57:23.605811 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:57:23.623175 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_735eaff8_c13c_4420_b1ba_529fba20d468` 
  ...
[0m09:57:23.626915 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:57:23.632170 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:57:23.691425 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:57:23.704338 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:57:23.707735 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '735eaff8-c13c-4420-b1ba-529fba20d468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707ee10e26d0>]}
[0m09:57:23.710344 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.00s]
[0m09:57:23.713212 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:57:23.716475 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:57:23.723139 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '735eaff8-c13c-4420-b1ba-529fba20d468', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707ee090b340>]}
[0m09:57:23.725451 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.02s]
[0m09:57:23.728331 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:57:23.732307 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:57:23.733467 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:57:23.734661 [debug] [MainThread]: On list__clean: Close
[0m09:57:23.735791 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:57:23.736884 [debug] [MainThread]: On list__mart: Close
[0m09:57:23.737937 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:57:23.739029 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:57:23.790449 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m09:57:23.791737 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m09:57:23.792808 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:57:23.793956 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:57:23.794995 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:57:23.796107 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:57:23.798360 [info ] [MainThread]: 
[0m09:57:23.799816 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.99 seconds (4.99s).
[0m09:57:23.807960 [debug] [MainThread]: Command end result
[0m09:57:24.025219 [info ] [MainThread]: 
[0m09:57:24.026727 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:57:24.027870 [info ] [MainThread]: 
[0m09:57:24.029001 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:57:24.031251 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.835518, "process_in_blocks": "0", "process_kernel_time": 0.73737, "process_mem_max_rss": "114860", "process_out_blocks": "9744", "process_user_time": 6.677303}
[0m09:57:24.032544 [debug] [MainThread]: Command `dbt build` succeeded at 09:57:24.032193 after 7.84 seconds
[0m09:57:24.033625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707ee5204d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707ee297b610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707ee15de1f0>]}
[0m09:57:24.034599 [debug] [MainThread]: Flushing usage events
[0m09:58:15.739607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a695cc4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a692927b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a6929279d0>]}


============================== 09:58:15.748937 | a653a888-9952-4fa2-9902-c79457351e51 ==============================
[0m09:58:15.748937 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:58:15.750015 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'empty': 'False', 'no_print': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'version_check': 'True', 'target_path': 'None', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'static_parser': 'True', 'profiles_dir': '.', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error': 'None', 'use_colors': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'partial_parse': 'True', 'debug': 'False', 'quiet': 'False', 'fail_fast': 'False', 'introspect': 'True'}
[0m09:58:16.329552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a653a888-9952-4fa2-9902-c79457351e51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a6927f42e0>]}
[0m09:58:16.521560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a653a888-9952-4fa2-9902-c79457351e51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a6927f4a90>]}
[0m09:58:16.522830 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:58:16.948402 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:58:17.451283 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:58:17.451969 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:58:17.655685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a653a888-9952-4fa2-9902-c79457351e51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a692090eb0>]}
[0m09:58:18.165241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a653a888-9952-4fa2-9902-c79457351e51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a6920cee80>]}
[0m09:58:18.166124 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:58:18.169356 [info ] [MainThread]: 
[0m09:58:18.170391 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:58:18.181892 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:58:18.183368 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:58:18.328864 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:58:18.330490 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:58:19.031020 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:58:19.038406 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:58:19.061928 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:58:19.068708 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:58:19.146722 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:58:19.158622 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:58:19.163363 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:58:19.219862 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:58:19.232333 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:58:19.244180 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:58:19.262716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a653a888-9952-4fa2-9902-c79457351e51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a6917ba3a0>]}
[0m09:58:19.264629 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:58:19.266073 [info ] [MainThread]: 
[0m09:58:19.338053 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:58:19.339172 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:58:19.340263 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:58:19.340986 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:58:19.358393 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:58:19.359732 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:58:19.547320 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:58:19.618779 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:58:19.620252 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:58:19.632053 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:58:19.756665 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:58:19.760339 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:58:19.762390 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:58:19.765357 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:58:19.819421 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:58:19.822670 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:58:19.824505 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:58:19.827264 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:58:19.921439 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:58:19.925054 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:58:19.930957 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a653a888-9952-4fa2-9902-c79457351e51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a691334a00>]}
[0m09:58:19.932086 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m09:58:19.933396 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:58:19.935446 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:58:19.936724 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:58:19.937924 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:58:19.938896 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:58:19.940558 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:58:19.942450 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:58:19.944590 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:58:19.946443 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:58:19.947988 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:58:19.949602 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:58:19.956372 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:58:20.030340 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:58:20.057934 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:58:20.130323 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:58:20.135757 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:58:20.138323 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:58:20.140337 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:58:20.157447 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:58:20.432478 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:58:20.458133 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:58:20.460895 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:58:20.462774 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:58:20.465353 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:58:20.467482 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:58:20.758982 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:58:20.779251 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:58:20.786745 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:58:20.823031 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:58:20.835903 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m09:58:20.841955 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:58:20.845044 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:58:20.851401 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.90s]
[0m09:58:20.854495 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:58:20.857262 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:58:20.863009 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.92s]
[0m09:58:20.866483 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:58:20.921107 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:58:20.922638 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:58:20.924257 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:58:20.925670 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:58:20.927771 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:58:20.929751 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:58:20.931789 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:58:20.933529 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:58:20.935454 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:58:20.937208 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:58:20.938864 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:58:20.961319 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:58:21.047136 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:58:21.054424 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:58:21.120650 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:58:21.123332 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:58:21.125168 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:58:21.147885 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:58:21.237245 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:58:21.325094 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:58:21.425728 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:58:21.463686 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:58:21.548067 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:58:21.562818 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:58:21.666176 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:58:21.751568 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:58:21.855646 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:58:21.864758 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:58:21.946381 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_a653a888_9952_4fa2_9902_c79457351e51` 
  ...
[0m09:58:21.949719 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:58:21.963445 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_a653a888_9952_4fa2_9902_c79457351e51` 
  ...
[0m09:58:21.966096 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:58:22.031672 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:58:22.045462 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:58:22.125646 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:58:22.151296 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a653a888-9952-4fa2-9902-c79457351e51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a690c81490>]}
[0m09:58:22.158828 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.21s]
[0m09:58:22.226020 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:58:22.440804 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_a653a888_9952_4fa2_9902_c79457351e51`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:58:22.438129 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_a653a888_9952_4fa2_9902_c79457351e51`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:58:22.475394 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:58:22.490556 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:58:22.554105 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_a653a888_9952_4fa2_9902_c79457351e51'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:58:22.559029 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_a653a888_9952_4fa2_9902_c79457351e51'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:58:22.569524 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:58:22.620480 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:58:22.644225 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:58:22.646807 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:58:22.649954 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_a653a888_9952_4fa2_9902_c79457351e51`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:58:22.653828 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_a653a888_9952_4fa2_9902_c79457351e51`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:58:22.684761 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:58:22.689172 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_a653a888_9952_4fa2_9902_c79457351e51`)
      
    ...
[0m09:58:22.720496 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:58:22.725783 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_a653a888_9952_4fa2_9902_c79457351e51`)
      
    ...
[0m09:58:22.750873 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:58:22.754247 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:58:22.764385 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:58:22.774684 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:58:22.784720 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:58:22.787263 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:58:22.823688 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_a653a888_9952_4fa2_9902_c79457351e51` 
    ...
[0m09:58:22.829798 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_a653a888_9952_4fa2_9902_c79457351e51` 
    ...
[0m09:58:22.840290 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:58:22.842943 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:58:22.855481 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_a653a888_9952_4fa2_9902_c79457351e51` 
  ...
[0m09:58:22.868168 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_a653a888_9952_4fa2_9902_c79457351e51` 
  ...
[0m09:58:22.919711 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:58:22.927851 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:58:22.929121 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:58:22.936358 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:58:22.938633 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:58:22.939985 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:58:22.943311 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a653a888-9952-4fa2-9902-c79457351e51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a691c6ea00>]}
[0m09:58:22.946142 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a653a888-9952-4fa2-9902-c79457351e51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a691455ca0>]}
[0m09:58:22.947375 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.01s]
[0m09:58:22.948659 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.01s]
[0m09:58:22.950036 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:58:22.951359 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:58:22.953624 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:58:22.954153 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:58:22.954705 [debug] [MainThread]: On list__clean: Close
[0m09:58:22.955250 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:58:22.955777 [debug] [MainThread]: On list__mart: Close
[0m09:58:22.956254 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:58:22.956746 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:58:22.957240 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m09:58:22.957754 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m09:58:22.958226 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:58:22.958720 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:58:22.959297 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:58:22.959963 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:58:22.961956 [info ] [MainThread]: 
[0m09:58:22.962856 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.79 seconds (4.79s).
[0m09:58:23.021213 [debug] [MainThread]: Command end result
[0m09:58:23.139410 [info ] [MainThread]: 
[0m09:58:23.140907 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:58:23.142017 [info ] [MainThread]: 
[0m09:58:23.143203 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:58:23.145427 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.5951653, "process_in_blocks": "0", "process_kernel_time": 0.69799, "process_mem_max_rss": "115152", "process_out_blocks": "9744", "process_user_time": 6.426704}
[0m09:58:23.146726 [debug] [MainThread]: Command `dbt build` succeeded at 09:58:23.146375 after 7.60 seconds
[0m09:58:23.147768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a695cc4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a693c5a850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78a693c56d00>]}
[0m09:58:23.148755 [debug] [MainThread]: Flushing usage events
[0m09:59:17.931785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71732a502310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71732716bb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71732716ba00>]}


============================== 09:59:17.941204 | 7e2c92f3-d221-41d6-a26a-bc64e9832107 ==============================
[0m09:59:17.941204 [info ] [MainThread]: Running with dbt=1.8.9
[0m09:59:17.993161 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'cache_selected_only': 'False', 'no_print': 'None', 'printer_width': '80', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'debug': 'False', 'use_colors': 'True', 'warn_error': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'log_cache_events': 'False', 'version_check': 'True', 'static_parser': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'log_format': 'default', 'fail_fast': 'False', 'profiles_dir': '.', 'quiet': 'False', 'empty': 'False'}
[0m09:59:18.529326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7e2c92f3-d221-41d6-a26a-bc64e9832107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717327063940>]}
[0m09:59:18.727003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7e2c92f3-d221-41d6-a26a-bc64e9832107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717327134310>]}
[0m09:59:18.728338 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m09:59:19.194619 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m09:59:19.703266 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:59:19.703940 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:59:19.905866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7e2c92f3-d221-41d6-a26a-bc64e9832107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7173268d1eb0>]}
[0m09:59:20.354618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7e2c92f3-d221-41d6-a26a-bc64e9832107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7173267c64c0>]}
[0m09:59:20.355504 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m09:59:20.393738 [info ] [MainThread]: 
[0m09:59:20.394977 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m09:59:20.406706 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:59:20.408126 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m09:59:20.430111 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:59:20.433675 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:59:20.961011 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:59:20.969859 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:59:20.972154 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m09:59:20.992757 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:59:21.034136 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m09:59:21.093178 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m09:59:21.110094 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m09:59:21.111221 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m09:59:21.122368 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:59:21.132478 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:59:21.200627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7e2c92f3-d221-41d6-a26a-bc64e9832107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717326123a30>]}
[0m09:59:21.202663 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m09:59:21.203935 [info ] [MainThread]: 
[0m09:59:21.234105 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m09:59:21.235243 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m09:59:21.236281 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m09:59:21.237038 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m09:59:21.308655 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:59:21.310254 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m09:59:21.500907 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m09:59:21.563052 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m09:59:21.564443 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:59:21.574665 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:59:21.705458 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:59:21.709463 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:59:21.711827 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m09:59:21.714793 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:59:21.720302 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m09:59:21.723266 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:59:21.725073 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m09:59:21.727886 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:59:21.820608 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m09:59:21.824104 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:59:21.829998 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7e2c92f3-d221-41d6-a26a-bc64e9832107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717329a12a60>]}
[0m09:59:21.831121 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m09:59:21.832519 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m09:59:21.834640 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:59:21.835845 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:59:21.837062 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:59:21.838429 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m09:59:21.840152 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m09:59:21.841772 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m09:59:21.843429 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m09:59:21.894179 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m09:59:21.895776 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m09:59:21.897651 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:59:21.899009 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:59:21.900262 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:59:22.101140 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:59:22.096704 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:59:22.108516 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:59:22.111222 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:59:22.112888 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:59:22.125009 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:59:22.433266 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m09:59:22.439785 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m09:59:22.493659 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m09:59:22.495889 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m09:59:22.498388 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m09:59:22.500267 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m09:59:22.777043 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m09:59:22.793305 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m09:59:22.796959 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:59:22.817354 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m09:59:22.825968 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:59:22.823312 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.93s]
[0m09:59:22.832326 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.94s]
[0m09:59:22.834455 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m09:59:22.836701 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m09:59:22.892305 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:59:22.898381 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.06s]
[0m09:59:22.901947 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m09:59:22.905190 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:59:22.906619 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:59:22.908244 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m09:59:22.909489 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:59:22.912224 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m09:59:22.914040 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m09:59:22.915884 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m09:59:22.917759 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m09:59:22.919982 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:59:22.921840 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m09:59:22.923832 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:59:22.942039 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m09:59:23.032369 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:59:23.033964 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:59:23.104307 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:59:23.106707 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:59:23.118775 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m09:59:23.125638 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:59:23.196416 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m09:59:23.313574 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m09:59:23.394213 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:59:23.437341 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:59:23.531845 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:59:23.611180 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m09:59:23.726756 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:59:23.833197 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:59:23.903708 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_7e2c92f3_d221_41d6_a26a_bc64e9832107` 
  ...
[0m09:59:23.923740 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:59:23.931472 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:59:23.937487 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_7e2c92f3_d221_41d6_a26a_bc64e9832107` 
  ...
[0m09:59:23.993845 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m09:59:24.099290 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:59:24.116727 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m09:59:24.233395 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m09:59:24.316334 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_7e2c92f3_d221_41d6_a26a_bc64e9832107`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m09:59:24.319660 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_7e2c92f3_d221_41d6_a26a_bc64e9832107`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m09:59:24.325243 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:59:24.330928 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7e2c92f3-d221-41d6-a26a-bc64e9832107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7173254fcfa0>]}
[0m09:59:24.332606 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.41s]
[0m09:59:24.334337 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m09:59:24.354089 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:59:24.398984 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:59:24.439926 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_7e2c92f3_d221_41d6_a26a_bc64e9832107'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:59:24.502391 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_7e2c92f3_d221_41d6_a26a_bc64e9832107'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:59:24.511644 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:59:24.514347 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:59:24.527624 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m09:59:24.532934 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m09:59:24.535919 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_7e2c92f3_d221_41d6_a26a_bc64e9832107`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m09:59:24.538226 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_7e2c92f3_d221_41d6_a26a_bc64e9832107`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m09:59:24.594155 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:59:24.598647 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_7e2c92f3_d221_41d6_a26a_bc64e9832107`)
      
    ...
[0m09:59:24.631102 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m09:59:24.633933 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m09:59:24.638213 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_7e2c92f3_d221_41d6_a26a_bc64e9832107`)
      
    ...
[0m09:59:24.648603 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:59:24.660837 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:59:24.669861 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_7e2c92f3_d221_41d6_a26a_bc64e9832107` 
    ...
[0m09:59:24.694325 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m09:59:24.711759 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m09:59:24.714755 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m09:59:24.729929 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:59:24.731944 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_7e2c92f3_d221_41d6_a26a_bc64e9832107` 
  ...
[0m09:59:24.737728 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_7e2c92f3_d221_41d6_a26a_bc64e9832107` 
    ...
[0m09:59:24.794027 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m09:59:24.810620 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m09:59:24.813462 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m09:59:24.828318 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m09:59:24.835963 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_7e2c92f3_d221_41d6_a26a_bc64e9832107` 
  ...
[0m09:59:24.837114 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7e2c92f3-d221-41d6-a26a-bc64e9832107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717325445190>]}
[0m09:59:24.892786 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.92s]
[0m09:59:24.895883 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m09:59:24.898554 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m09:59:24.911944 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m09:59:24.917496 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m09:59:24.924301 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7e2c92f3-d221-41d6-a26a-bc64e9832107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7173260994f0>]}
[0m09:59:24.926919 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.01s]
[0m09:59:24.929789 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m09:59:24.933828 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:59:24.935063 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m09:59:24.936276 [debug] [MainThread]: On list__clean: Close
[0m09:59:24.937334 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m09:59:24.938519 [debug] [MainThread]: On list__mart: Close
[0m09:59:24.939607 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m09:59:24.940778 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m09:59:24.992798 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m09:59:24.994135 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m09:59:24.995239 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m09:59:24.996409 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m09:59:24.997530 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m09:59:24.998730 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m09:59:25.001698 [info ] [MainThread]: 
[0m09:59:25.003860 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.61 seconds (4.61s).
[0m09:59:25.012095 [debug] [MainThread]: Command end result
[0m09:59:25.209654 [info ] [MainThread]: 
[0m09:59:25.210519 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:59:25.211153 [info ] [MainThread]: 
[0m09:59:25.211819 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m09:59:25.213147 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.511559, "process_in_blocks": "0", "process_kernel_time": 0.677079, "process_mem_max_rss": "115024", "process_out_blocks": "9752", "process_user_time": 6.431757}
[0m09:59:25.213911 [debug] [MainThread]: Command `dbt build` succeeded at 09:59:25.213694 after 7.51 seconds
[0m09:59:25.214552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71732a502310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717327063940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717327134310>]}
[0m09:59:25.215144 [debug] [MainThread]: Flushing usage events
[0m10:00:15.932880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb67ad36e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb67799ab80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb67799aa30>]}


============================== 10:00:15.942249 | 14f4cc56-8b46-47b7-a69d-2e7b4b23f002 ==============================
[0m10:00:15.942249 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:00:15.943302 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'printer_width': '80', 'fail_fast': 'False', 'write_json': 'True', 'indirect_selection': 'eager', 'introspect': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error': 'None', 'static_parser': 'True', 'empty': 'False', 'use_colors': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'log_cache_events': 'False', 'version_check': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'quiet': 'False', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'no_print': 'None', 'partial_parse': 'True'}
[0m10:00:16.473291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '14f4cc56-8b46-47b7-a69d-2e7b4b23f002', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb677a54b80>]}
[0m10:00:16.668029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '14f4cc56-8b46-47b7-a69d-2e7b4b23f002', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb6778976d0>]}
[0m10:00:16.669375 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:00:17.133206 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:00:17.635863 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:00:17.636529 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:00:17.840119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '14f4cc56-8b46-47b7-a69d-2e7b4b23f002', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb677104e50>]}
[0m10:00:18.288880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '14f4cc56-8b46-47b7-a69d-2e7b4b23f002', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb6770c3e80>]}
[0m10:00:18.289765 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:00:18.328744 [info ] [MainThread]: 
[0m10:00:18.329910 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:00:18.341641 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:00:18.348165 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:00:18.450269 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:00:18.459183 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:00:19.181274 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:00:19.192454 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:00:19.199586 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:00:19.208703 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:00:19.270467 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:00:19.272311 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:00:19.339420 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:00:19.346979 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:00:19.357708 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:00:19.360436 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:00:19.429115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '14f4cc56-8b46-47b7-a69d-2e7b4b23f002', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb67ac87430>]}
[0m10:00:19.431693 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:00:19.433226 [info ] [MainThread]: 
[0m10:00:19.452882 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:00:19.454122 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:00:19.455379 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:00:19.456261 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:00:19.473838 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:00:19.475016 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:00:19.655811 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:00:19.725361 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:00:19.728330 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:00:19.741071 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:00:19.866795 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:00:19.870390 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:00:19.872317 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:00:19.875319 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:00:19.929757 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:00:19.932991 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:00:19.934884 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:00:19.937695 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:00:20.031230 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:00:20.034806 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:00:20.040979 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14f4cc56-8b46-47b7-a69d-2e7b4b23f002', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb6763a67f0>]}
[0m10:00:20.042135 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.58s]
[0m10:00:20.043429 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:00:20.045383 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:00:20.046834 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:00:20.048517 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:00:20.049923 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:00:20.051261 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:00:20.052994 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:00:20.054328 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:00:20.056501 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:00:20.058320 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:00:20.060305 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:00:20.062093 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:00:20.128473 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:00:20.235673 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:00:20.253913 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:00:20.259004 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:00:20.261767 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:00:20.273857 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:00:20.337608 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:00:20.575135 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:00:20.635496 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:00:20.645454 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:00:20.648060 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:00:20.650234 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:00:20.653100 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:00:20.905734 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:00:20.931810 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:00:20.944676 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.88s]
[0m10:00:20.952517 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:00:20.956165 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:00:20.964788 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:00:20.972703 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:00:21.029366 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.97s]
[0m10:00:21.032372 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:00:21.035227 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:00:21.040988 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.99s]
[0m10:00:21.044411 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:00:21.047022 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:00:21.048082 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:00:21.049589 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:00:21.051311 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:00:21.052693 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:00:21.054575 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:00:21.056939 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:00:21.058829 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:00:21.060444 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:00:21.061975 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:00:21.127945 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:00:21.149359 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:00:21.164254 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:00:21.176462 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:00:21.241929 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:00:21.244374 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:00:21.251633 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:00:21.269349 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:00:21.433604 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:00:21.472155 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:00:21.571866 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:00:21.664346 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:00:21.749744 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:00:21.830688 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:00:21.845317 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:00:21.933101 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:00:22.035167 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:00:22.049737 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:00:22.139348 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:00:22.233077 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_14f4cc56_8b46_47b7_a69d_2e7b4b23f002` 
  ...
[0m10:00:22.262153 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:00:22.268209 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_14f4cc56_8b46_47b7_a69d_2e7b4b23f002` 
  ...
[0m10:00:22.272429 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:00:22.336208 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:00:22.343336 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:00:22.374182 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14f4cc56-8b46-47b7-a69d-2e7b4b23f002', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb675cfe280>]}
[0m10:00:22.433788 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.31s]
[0m10:00:22.468756 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:00:22.739321 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_14f4cc56_8b46_47b7_a69d_2e7b4b23f002`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:00:22.742488 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_14f4cc56_8b46_47b7_a69d_2e7b4b23f002`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:00:22.774229 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:00:22.789554 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:00:22.858357 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_14f4cc56_8b46_47b7_a69d_2e7b4b23f002'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:00:22.859894 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_14f4cc56_8b46_47b7_a69d_2e7b4b23f002'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:00:22.870067 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:00:22.872861 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:00:22.937706 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:00:22.943402 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:00:22.946643 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_14f4cc56_8b46_47b7_a69d_2e7b4b23f002`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:00:22.948792 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_14f4cc56_8b46_47b7_a69d_2e7b4b23f002`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:00:22.979368 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:00:22.981892 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:00:22.986168 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_14f4cc56_8b46_47b7_a69d_2e7b4b23f002`)
      
    ...
[0m10:00:22.990502 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_14f4cc56_8b46_47b7_a69d_2e7b4b23f002`)
      
    ...
[0m10:00:23.018302 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:00:23.033870 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:00:23.031681 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:00:23.040598 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:00:23.048068 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:00:23.054037 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_14f4cc56_8b46_47b7_a69d_2e7b4b23f002` 
    ...
[0m10:00:23.056927 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:00:23.064460 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_14f4cc56_8b46_47b7_a69d_2e7b4b23f002` 
    ...
[0m10:00:23.068731 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:00:23.076793 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_14f4cc56_8b46_47b7_a69d_2e7b4b23f002` 
  ...
[0m10:00:23.127688 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:00:23.135706 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:00:23.148547 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_14f4cc56_8b46_47b7_a69d_2e7b4b23f002` 
  ...
[0m10:00:23.156802 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:00:23.162349 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:00:23.169967 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:00:23.171475 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14f4cc56-8b46-47b7-a69d-2e7b4b23f002', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb675a51d60>]}
[0m10:00:23.235717 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:00:23.238711 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.11s]
[0m10:00:23.244324 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:00:23.247805 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:00:23.254430 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14f4cc56-8b46-47b7-a69d-2e7b4b23f002', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb676467520>]}
[0m10:00:23.256773 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.20s]
[0m10:00:23.259550 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:00:23.263561 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:00:23.264721 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:00:23.266321 [debug] [MainThread]: On list__clean: Close
[0m10:00:23.267434 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:00:23.268575 [debug] [MainThread]: On list__mart: Close
[0m10:00:23.269628 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:00:23.270769 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:00:23.271855 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:00:23.273063 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:00:23.274328 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:00:23.275478 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:00:23.328438 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:00:23.329653 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:00:23.332060 [info ] [MainThread]: 
[0m10:00:23.333487 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.00 seconds (5.00s).
[0m10:00:23.342159 [debug] [MainThread]: Command end result
[0m10:00:23.549633 [info ] [MainThread]: 
[0m10:00:23.550431 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:00:23.551032 [info ] [MainThread]: 
[0m10:00:23.551669 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:00:23.552929 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.8124027, "process_in_blocks": "0", "process_kernel_time": 0.714825, "process_mem_max_rss": "115104", "process_out_blocks": "9744", "process_user_time": 6.640928}
[0m10:00:23.553640 [debug] [MainThread]: Command `dbt build` succeeded at 10:00:23.553445 after 7.81 seconds
[0m10:00:23.554238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb67ad36e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb678cce0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eb6778976d0>]}
[0m10:00:23.554817 [debug] [MainThread]: Flushing usage events
[0m10:01:16.349522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fed08f3310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fecd550af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fecd5509a0>]}


============================== 10:01:16.359725 | 70594a6c-6b37-45a8-92ad-86b558616398 ==============================
[0m10:01:16.359725 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:01:16.360783 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'printer_width': '80', 'fail_fast': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'warn_error': 'None', 'empty': 'False', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'use_colors': 'True', 'write_json': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_format': 'default', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'profiles_dir': '.', 'no_print': 'None', 'debug': 'False'}
[0m10:01:16.939948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '70594a6c-6b37-45a8-92ad-86b558616398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fecfe873a0>]}
[0m10:01:17.083678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '70594a6c-6b37-45a8-92ad-86b558616398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fecd5b13a0>]}
[0m10:01:17.085003 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:01:17.548289 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:01:18.070933 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:01:18.071603 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:01:18.272027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '70594a6c-6b37-45a8-92ad-86b558616398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fecccb6ee0>]}
[0m10:01:18.750252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '70594a6c-6b37-45a8-92ad-86b558616398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78feccca0c70>]}
[0m10:01:18.751170 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:01:18.754428 [info ] [MainThread]: 
[0m10:01:18.755477 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:01:18.767281 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:01:18.769012 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:01:18.843212 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:01:18.850408 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:01:19.391870 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:01:19.395714 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:01:19.403121 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:01:19.407364 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:01:19.447972 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:01:19.449063 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:01:19.462900 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:01:19.467346 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:01:19.473545 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:01:19.482848 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:01:19.549263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '70594a6c-6b37-45a8-92ad-86b558616398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fecd44b370>]}
[0m10:01:19.551180 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:01:19.552499 [info ] [MainThread]: 
[0m10:01:19.570061 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:01:19.571635 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:01:19.573061 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:01:19.574090 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:01:19.645158 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:01:19.646773 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:01:19.846174 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:01:19.909959 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:01:19.911446 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:01:19.924061 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:01:20.053253 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:01:20.056771 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:01:20.058845 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:01:20.061745 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:01:20.067703 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:01:20.070703 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:01:20.072713 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:01:20.075370 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:01:20.173446 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:01:20.176980 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:01:20.183002 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70594a6c-6b37-45a8-92ad-86b558616398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fecfe7f7f0>]}
[0m10:01:20.184170 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m10:01:20.185570 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:01:20.187787 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:01:20.189109 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:01:20.240731 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:01:20.190740 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:01:20.242979 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:01:20.245593 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:01:20.248553 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:01:20.250732 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:01:20.252888 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:01:20.254646 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:01:20.256467 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:01:20.258188 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:01:20.445790 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:01:20.455249 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:01:20.459350 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:01:20.462154 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:01:20.464438 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:01:20.471514 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:01:20.767896 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:01:20.765280 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:01:20.840836 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:01:20.843048 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:01:20.845662 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:01:20.848718 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:01:21.098969 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:01:21.114391 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:01:21.141620 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:01:21.144580 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:01:21.146766 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:01:21.159150 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m10:01:21.164867 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.92s]
[0m10:01:21.169990 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:01:21.173122 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:01:21.182647 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:01:21.189025 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.94s]
[0m10:01:21.191821 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:01:21.240265 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:01:21.241616 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:01:21.243334 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:01:21.245065 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:01:21.247208 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:01:21.249494 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:01:21.251243 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:01:21.252841 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:01:21.254412 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:01:21.255980 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:01:21.257664 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:01:21.259615 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:01:21.369264 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:01:21.384697 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:01:21.386398 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:01:21.388822 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:01:21.441145 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:01:21.463941 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:01:21.485514 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:01:21.572261 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:01:21.677276 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:01:21.841225 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:01:21.887427 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:01:21.988251 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:01:22.163744 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:01:22.278721 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:01:22.370130 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:01:22.372807 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_70594a6c_6b37_45a8_92ad_86b558616398` 
  ...
[0m10:01:22.387515 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:01:22.384247 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_70594a6c_6b37_45a8_92ad_86b558616398` 
  ...
[0m10:01:22.447386 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:01:22.467997 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:01:22.471549 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:01:22.584081 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:01:22.675385 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:01:22.749096 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70594a6c-6b37-45a8-92ad-86b558616398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fecc7fbeb0>]}
[0m10:01:22.762004 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.49s]
[0m10:01:22.781448 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:01:22.873430 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_70594a6c_6b37_45a8_92ad_86b558616398`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:01:22.884869 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_70594a6c_6b37_45a8_92ad_86b558616398`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:01:22.941510 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:01:22.954296 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:01:23.041169 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_70594a6c_6b37_45a8_92ad_86b558616398'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:01:23.049492 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_70594a6c_6b37_45a8_92ad_86b558616398'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:01:23.056137 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:01:23.058876 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:01:23.077346 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:01:23.085101 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:01:23.087919 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_70594a6c_6b37_45a8_92ad_86b558616398`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:01:23.141105 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_70594a6c_6b37_45a8_92ad_86b558616398`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:01:23.160613 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:01:23.164240 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_70594a6c_6b37_45a8_92ad_86b558616398`)
      
    ...
[0m10:01:23.165731 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:01:23.170872 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_70594a6c_6b37_45a8_92ad_86b558616398`)
      
    ...
[0m10:01:23.194008 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:01:23.207163 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:01:23.209954 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:01:23.222840 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:01:23.243313 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:01:23.248882 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_70594a6c_6b37_45a8_92ad_86b558616398` 
    ...
[0m10:01:23.251930 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:01:23.259397 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_70594a6c_6b37_45a8_92ad_86b558616398` 
    ...
[0m10:01:23.263600 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:01:23.275998 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_70594a6c_6b37_45a8_92ad_86b558616398` 
  ...
[0m10:01:23.278820 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:01:23.341925 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:01:23.348475 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_70594a6c_6b37_45a8_92ad_86b558616398` 
  ...
[0m10:01:23.363256 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:01:23.368362 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:01:23.381837 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:01:23.384578 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:01:23.442312 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70594a6c-6b37-45a8-92ad-86b558616398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fecc0ec8e0>]}
[0m10:01:23.443703 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:01:23.444960 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.19s]
[0m10:01:23.448375 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70594a6c-6b37-45a8-92ad-86b558616398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fecbfc5580>]}
[0m10:01:23.449749 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:01:23.451034 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.20s]
[0m10:01:23.453171 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:01:23.455770 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:01:23.456671 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:01:23.457505 [debug] [MainThread]: On list__mart: Close
[0m10:01:23.458295 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:01:23.459120 [debug] [MainThread]: On list__clean: Close
[0m10:01:23.459942 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:01:23.460803 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:01:23.461658 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:01:23.462656 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:01:23.463667 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:01:23.464777 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:01:23.465863 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:01:23.466986 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:01:23.469258 [info ] [MainThread]: 
[0m10:01:23.470651 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.71 seconds (4.71s).
[0m10:01:23.479743 [debug] [MainThread]: Command end result
[0m10:01:23.688728 [info ] [MainThread]: 
[0m10:01:23.689693 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:01:23.690390 [info ] [MainThread]: 
[0m10:01:23.741176 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:01:23.743932 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.5883384, "process_in_blocks": "0", "process_kernel_time": 0.653859, "process_mem_max_rss": "114992", "process_out_blocks": "9744", "process_user_time": 6.435776}
[0m10:01:23.745461 [debug] [MainThread]: Command `dbt build` succeeded at 10:01:23.745054 after 7.59 seconds
[0m10:01:23.746767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fed08f3310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fece881850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fece87ed00>]}
[0m10:01:23.748010 [debug] [MainThread]: Flushing usage events
[0m10:02:16.858469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52b2666310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52af2c9af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52af2c99a0>]}


============================== 10:02:16.867745 | 6e90b0b6-7efb-45e8-8cfa-b2f77db37a5f ==============================
[0m10:02:16.867745 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:02:16.868792 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'log_format': 'default', 'introspect': 'True', 'printer_width': '80', 'empty': 'False', 'use_experimental_parser': 'False', 'use_colors': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager', 'quiet': 'False', 'version_check': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': '.', 'no_print': 'None', 'target_path': 'None', 'fail_fast': 'False', 'static_parser': 'True', 'debug': 'False'}
[0m10:02:17.447357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6e90b0b6-7efb-45e8-8cfa-b2f77db37a5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52b1c093a0>]}
[0m10:02:17.664484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6e90b0b6-7efb-45e8-8cfa-b2f77db37a5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52af32c3a0>]}
[0m10:02:17.666322 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:02:18.154855 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:02:18.729138 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:02:18.729845 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:02:18.935763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6e90b0b6-7efb-45e8-8cfa-b2f77db37a5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52aea30ee0>]}
[0m10:02:19.425985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6e90b0b6-7efb-45e8-8cfa-b2f77db37a5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52aea1ac70>]}
[0m10:02:19.426936 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:02:19.431804 [info ] [MainThread]: 
[0m10:02:19.433017 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:02:19.444928 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:02:19.446014 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:02:19.536224 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:02:19.540784 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:02:20.024878 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:02:20.028757 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:02:20.047365 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:02:20.052868 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:02:20.123900 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:02:20.135490 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__clean'
[0m10:02:20.139428 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:02:20.144629 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:02:20.153498 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:02:20.279061 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:02:20.284951 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:02:20.293103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e90b0b6-7efb-45e8-8cfa-b2f77db37a5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52ae977880>]}
[0m10:02:20.295173 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:02:20.296587 [info ] [MainThread]: 
[0m10:02:20.331467 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:02:20.332667 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:02:20.333789 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:02:20.334597 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:02:20.353572 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:02:20.354805 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:02:20.665471 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:02:20.772125 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:02:20.773943 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:02:20.784838 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:02:20.799861 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:02:20.803424 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:02:20.805757 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:02:20.808960 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:02:20.822844 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:02:20.826166 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:02:20.828296 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:02:20.831366 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:02:20.930013 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:02:20.933813 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:02:20.939702 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e90b0b6-7efb-45e8-8cfa-b2f77db37a5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52ae6dec70>]}
[0m10:02:20.940795 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m10:02:20.942099 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:02:20.944628 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:02:20.946510 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:02:20.948226 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:02:20.949787 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:02:20.951072 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:02:20.953403 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:02:20.955335 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:02:20.957623 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:02:20.959221 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:02:20.961460 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:02:20.963243 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:02:21.031694 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:02:21.065949 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:02:21.069832 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:02:21.134055 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:02:21.136852 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:02:21.138623 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:02:21.150754 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:02:21.456673 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:02:21.463814 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:02:21.526778 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:02:21.529151 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:02:21.532788 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:02:21.534865 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:02:21.808851 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:02:21.822430 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:02:21.829756 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:02:21.837666 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:02:21.840592 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:02:21.853908 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:02:21.856480 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.90s]
[0m10:02:21.862220 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.90s]
[0m10:02:21.867821 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m10:02:21.870873 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:02:21.921399 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:02:21.924631 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:02:21.928720 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:02:21.929963 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:02:21.931647 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:02:21.933091 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:02:21.935709 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:02:21.938969 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:02:21.940921 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:02:21.942448 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:02:21.944267 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:02:21.946100 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:02:21.947787 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:02:21.949522 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:02:22.133874 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:02:22.143909 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:02:22.148346 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:02:22.151045 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:02:22.152994 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:02:22.168326 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:02:22.222718 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:02:22.332113 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:02:22.453665 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:02:22.542664 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:02:22.655010 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:02:22.748807 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:02:22.931450 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:02:23.046763 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_6e90b0b6_7efb_45e8_8cfa_b2f77db37a5f` 
  ...
[0m10:02:23.052120 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:02:23.135513 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:02:23.133672 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_6e90b0b6_7efb_45e8_8cfa_b2f77db37a5f` 
  ...
[0m10:02:23.151526 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:02:23.237994 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:02:23.247508 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:02:23.355069 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:02:23.462296 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:02:23.524640 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_6e90b0b6_7efb_45e8_8cfa_b2f77db37a5f`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:02:23.529285 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_6e90b0b6_7efb_45e8_8cfa_b2f77db37a5f`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:02:23.534031 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:02:23.541592 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e90b0b6-7efb-45e8-8cfa-b2f77db37a5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52add3d430>]}
[0m10:02:23.544034 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.60s]
[0m10:02:23.546883 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:02:23.561738 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:02:23.578301 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:02:23.631115 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_6e90b0b6_7efb_45e8_8cfa_b2f77db37a5f'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:02:23.637174 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_6e90b0b6_7efb_45e8_8cfa_b2f77db37a5f'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:02:23.642987 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:02:23.650090 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:02:23.651670 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:02:23.654303 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:02:23.655783 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_6e90b0b6_7efb_45e8_8cfa_b2f77db37a5f`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:02:23.657657 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_6e90b0b6_7efb_45e8_8cfa_b2f77db37a5f`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:02:23.673390 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:02:23.674428 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:02:23.676394 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_6e90b0b6_7efb_45e8_8cfa_b2f77db37a5f`)
      
    ...
[0m10:02:23.678887 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_6e90b0b6_7efb_45e8_8cfa_b2f77db37a5f`)
      
    ...
[0m10:02:23.699108 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:02:23.721819 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:02:23.725806 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:02:23.730967 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:02:23.736990 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:02:23.738303 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:02:23.741239 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_6e90b0b6_7efb_45e8_8cfa_b2f77db37a5f` 
    ...
[0m10:02:23.744214 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_6e90b0b6_7efb_45e8_8cfa_b2f77db37a5f` 
    ...
[0m10:02:23.750870 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:02:23.752008 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:02:23.759412 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_6e90b0b6_7efb_45e8_8cfa_b2f77db37a5f` 
  ...
[0m10:02:23.769829 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_6e90b0b6_7efb_45e8_8cfa_b2f77db37a5f` 
  ...
[0m10:02:23.824145 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:02:23.826745 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:02:23.838943 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:02:23.853474 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:02:23.859708 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:02:23.867453 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:02:23.868568 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e90b0b6-7efb-45e8-8cfa-b2f77db37a5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52af123f40>]}
[0m10:02:23.925510 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e90b0b6-7efb-45e8-8cfa-b2f77db37a5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52ae93e430>]}
[0m10:02:23.928042 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.92s]
[0m10:02:23.930559 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.98s]
[0m10:02:23.933350 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:02:23.936109 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:02:23.940562 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:02:23.941700 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:02:23.942864 [debug] [MainThread]: On list__mart: Close
[0m10:02:23.943953 [debug] [MainThread]: Connection 'list_' was left open.
[0m10:02:23.945066 [debug] [MainThread]: On list_: Close
[0m10:02:23.946121 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:02:23.947241 [debug] [MainThread]: On list__clean: Close
[0m10:02:23.948298 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:02:23.949412 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:02:23.950545 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:02:23.951700 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:02:23.952805 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:02:23.953916 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:02:23.954969 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:02:23.956154 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:02:23.959471 [info ] [MainThread]: 
[0m10:02:23.960940 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.53 seconds (4.53s).
[0m10:02:23.969092 [debug] [MainThread]: Command end result
[0m10:02:24.232044 [info ] [MainThread]: 
[0m10:02:24.232957 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:02:24.233569 [info ] [MainThread]: 
[0m10:02:24.234243 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:02:24.235674 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.570377, "process_in_blocks": "0", "process_kernel_time": 0.647502, "process_mem_max_rss": "114744", "process_out_blocks": "9744", "process_user_time": 6.452073}
[0m10:02:24.236506 [debug] [MainThread]: Command `dbt build` succeeded at 10:02:24.236310 after 7.57 seconds
[0m10:02:24.237430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52b2666310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52b05fd850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c52b05f9d00>]}
[0m10:02:24.238699 [debug] [MainThread]: Flushing usage events
[0m10:03:16.631155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77da498bce20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77da4651db80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77da4651da30>]}


============================== 10:03:16.640459 | c69a65e2-31c8-4170-baf5-25a10ee08f76 ==============================
[0m10:03:16.640459 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:03:16.641597 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'version_check': 'True', 'introspect': 'True', 'write_json': 'True', 'log_format': 'default', 'use_colors': 'True', 'profiles_dir': '.', 'indirect_selection': 'eager', 'empty': 'False', 'log_cache_events': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'debug': 'False', 'partial_parse': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'warn_error': 'None', 'quiet': 'False'}
[0m10:03:17.219932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c69a65e2-31c8-4170-baf5-25a10ee08f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77da4839f790>]}
[0m10:03:17.411651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c69a65e2-31c8-4170-baf5-25a10ee08f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77da462ebd30>]}
[0m10:03:17.413004 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:03:17.824688 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:03:18.338091 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:03:18.338761 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:03:18.537026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c69a65e2-31c8-4170-baf5-25a10ee08f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77da45c89e50>]}
[0m10:03:19.011761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c69a65e2-31c8-4170-baf5-25a10ee08f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77da45c17af0>]}
[0m10:03:19.012678 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:03:19.015935 [info ] [MainThread]: 
[0m10:03:19.016982 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:03:19.028815 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:03:19.035364 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:03:19.151516 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:03:19.153122 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:03:19.997112 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:03:20.016367 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:03:20.020471 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:03:20.024614 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:03:20.125625 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:03:20.127629 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:03:20.155260 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:03:20.156747 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:03:20.216966 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:03:20.226978 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:03:20.245901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c69a65e2-31c8-4170-baf5-25a10ee08f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77da45be64c0>]}
[0m10:03:20.248526 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:03:20.249868 [info ] [MainThread]: 
[0m10:03:20.323914 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:03:20.325087 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:03:20.326170 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:03:20.326932 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:03:20.343652 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:03:20.344773 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:03:20.529966 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:03:20.590510 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:03:20.591905 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:03:20.603418 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:03:20.737181 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:03:20.741045 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:03:20.743087 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:03:20.746023 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:03:20.751612 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:03:20.754568 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:03:20.756368 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:03:20.759184 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:03:20.850452 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:03:20.853988 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:03:20.909416 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c69a65e2-31c8-4170-baf5-25a10ee08f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77da48dccc10>]}
[0m10:03:20.910837 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m10:03:20.912182 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:03:20.914517 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:03:20.916047 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:03:20.917627 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:03:20.919303 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:03:20.920953 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:03:20.922404 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:03:20.924838 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:03:20.926952 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:03:20.929105 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:03:20.930528 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:03:20.931811 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:03:20.933576 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:03:21.130829 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:03:21.137467 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:03:21.138940 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:03:21.141649 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:03:21.143727 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:03:21.155738 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:03:21.422836 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:03:21.447611 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:03:21.449363 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:03:21.450981 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:03:21.451838 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:03:21.453574 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:03:21.727711 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:03:21.730616 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:03:21.750611 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:03:21.753305 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:03:21.756177 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:03:21.818784 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m10:03:21.827060 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.90s]
[0m10:03:21.830219 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:03:21.833576 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:03:21.842557 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:03:21.848464 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.92s]
[0m10:03:21.851305 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:03:21.854110 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:03:21.855340 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:03:21.857324 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:03:21.859193 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:03:21.861146 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:03:21.863447 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:03:21.910633 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:03:21.912301 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:03:21.913986 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:03:21.915678 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:03:21.917579 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:03:21.919304 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:03:22.042299 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:03:22.116868 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:03:22.123493 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:03:22.126144 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:03:22.133059 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:03:22.148715 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:03:22.150394 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:03:22.246120 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:03:22.325594 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:03:22.419596 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:03:22.510447 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:03:22.519929 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:03:22.550025 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:03:22.646003 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:03:22.832180 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m10:03:22.853230 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:03:22.938021 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:03:23.047782 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:03:23.120170 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c69a65e2_31c8_4170_baf5_25a10ee08f76` 
  ...
[0m10:03:23.139906 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:03:23.153050 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:03:23.210472 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c69a65e2-31c8-4170-baf5-25a10ee08f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77da448a8a30>]}
[0m10:03:23.151229 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c69a65e2_31c8_4170_baf5_25a10ee08f76` 
  ...
[0m10:03:23.229413 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.30s]
[0m10:03:23.331207 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:03:23.339081 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:03:23.519460 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_c69a65e2_31c8_4170_baf5_25a10ee08f76`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:03:23.521357 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_c69a65e2_31c8_4170_baf5_25a10ee08f76`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:03:23.554235 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:03:23.568949 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:03:23.637140 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_c69a65e2_31c8_4170_baf5_25a10ee08f76'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:03:23.643210 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_c69a65e2_31c8_4170_baf5_25a10ee08f76'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:03:23.652136 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:03:23.655044 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:03:23.722767 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:03:23.731009 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:03:23.733790 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_c69a65e2_31c8_4170_baf5_25a10ee08f76`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:03:23.737989 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_c69a65e2_31c8_4170_baf5_25a10ee08f76`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:03:23.766351 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:03:23.769049 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:03:23.773202 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c69a65e2_31c8_4170_baf5_25a10ee08f76`)
      
    ...
[0m10:03:23.777563 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c69a65e2_31c8_4170_baf5_25a10ee08f76`)
      
    ...
[0m10:03:23.834135 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:03:23.842607 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:03:23.845308 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:03:23.857760 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:03:23.860752 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:03:23.869351 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c69a65e2_31c8_4170_baf5_25a10ee08f76` 
    ...
[0m10:03:23.873747 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:03:23.911026 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c69a65e2_31c8_4170_baf5_25a10ee08f76` 
    ...
[0m10:03:23.915498 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:03:23.924891 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c69a65e2_31c8_4170_baf5_25a10ee08f76` 
  ...
[0m10:03:23.926620 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:03:23.935328 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c69a65e2_31c8_4170_baf5_25a10ee08f76` 
  ...
[0m10:03:23.937020 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:03:23.945296 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:03:23.946950 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:03:23.956922 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:03:24.010847 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:03:24.019288 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c69a65e2-31c8-4170-baf5-25a10ee08f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77da462ebe80>]}
[0m10:03:24.021665 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:03:24.024260 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.11s]
[0m10:03:24.030370 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c69a65e2-31c8-4170-baf5-25a10ee08f76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77da47759370>]}
[0m10:03:24.033165 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:03:24.035771 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.12s]
[0m10:03:24.039048 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:03:24.043206 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:03:24.044351 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:03:24.045516 [debug] [MainThread]: On list__mart: Close
[0m10:03:24.046611 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:03:24.047694 [debug] [MainThread]: On list__clean: Close
[0m10:03:24.048746 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:03:24.049831 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:03:24.050876 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:03:24.051974 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:03:24.053022 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:03:24.054165 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:03:24.055217 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:03:24.056368 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:03:24.109980 [info ] [MainThread]: 
[0m10:03:24.111524 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.09 seconds (5.09s).
[0m10:03:24.119580 [debug] [MainThread]: Command end result
[0m10:03:24.321451 [info ] [MainThread]: 
[0m10:03:24.323062 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:03:24.324335 [info ] [MainThread]: 
[0m10:03:24.325822 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:03:24.328680 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.8882017, "process_in_blocks": "0", "process_kernel_time": 0.71648, "process_mem_max_rss": "115128", "process_out_blocks": "9752", "process_user_time": 6.590835}
[0m10:03:24.330264 [debug] [MainThread]: Command `dbt build` succeeded at 10:03:24.329827 after 7.89 seconds
[0m10:03:24.331657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77da498bce20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77da48c483d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77da45b76370>]}
[0m10:03:24.332921 [debug] [MainThread]: Flushing usage events
[0m10:04:15.998279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd39c798310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd3993edb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd3993ed9d0>]}


============================== 10:04:16.007914 | e1ab69fb-2c80-4418-be11-5cdffaef7c8b ==============================
[0m10:04:16.007914 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:04:16.009017 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'cache_selected_only': 'False', 'write_json': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'partial_parse': 'True', 'target_path': 'None', 'quiet': 'False', 'empty': 'False', 'printer_width': '80', 'debug': 'False', 'fail_fast': 'False', 'static_parser': 'True', 'use_experimental_parser': 'False', 'introspect': 'True', 'use_colors': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'indirect_selection': 'eager', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'log_format': 'default', 'version_check': 'True', 'no_print': 'None'}
[0m10:04:16.533361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e1ab69fb-2c80-4418-be11-5cdffaef7c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd39bd2d3a0>]}
[0m10:04:16.730489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e1ab69fb-2c80-4418-be11-5cdffaef7c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd399ed13d0>]}
[0m10:04:16.731764 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:04:17.210036 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:04:17.710187 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:04:17.710853 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:04:17.912324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e1ab69fb-2c80-4418-be11-5cdffaef7c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd398b56ee0>]}
[0m10:04:18.400105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e1ab69fb-2c80-4418-be11-5cdffaef7c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd398b40b50>]}
[0m10:04:18.401021 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:04:18.404227 [info ] [MainThread]: 
[0m10:04:18.405265 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:04:18.417147 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:04:18.429495 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:04:18.502385 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:04:18.505010 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:04:19.099921 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:04:19.104329 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:04:19.106926 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:04:19.123972 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:04:19.216967 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:04:19.218372 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:04:19.239639 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:04:19.293318 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:04:19.302627 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:04:19.312679 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:04:19.329936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1ab69fb-2c80-4418-be11-5cdffaef7c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd398a9d880>]}
[0m10:04:19.331809 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:04:19.333064 [info ] [MainThread]: 
[0m10:04:19.409029 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:04:19.410160 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:04:19.411238 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:04:19.412000 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:04:19.428848 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:04:19.430034 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:04:19.615832 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:04:19.681265 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:04:19.682658 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:04:19.703868 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:04:19.831387 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:04:19.834868 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:04:19.836705 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:04:19.839879 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:04:19.894276 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:04:19.897865 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:04:19.899759 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:04:19.902617 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:04:19.996009 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:04:19.999394 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:04:20.005931 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1ab69fb-2c80-4418-be11-5cdffaef7c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd39bd257f0>]}
[0m10:04:20.007208 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m10:04:20.008524 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:04:20.010615 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:04:20.011890 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:04:20.013369 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:04:20.014855 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:04:20.016366 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:04:20.017737 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:04:20.019388 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:04:20.021119 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:04:20.023138 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:04:20.024521 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:04:20.025807 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:04:20.027429 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:04:20.198876 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:04:20.208481 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:04:20.209846 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:04:20.212841 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:04:20.214659 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:04:20.291481 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:04:20.508529 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:04:20.509402 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:04:20.519925 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:04:20.521392 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:04:20.522405 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:04:20.523430 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:04:20.792436 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:04:20.807951 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:04:20.832195 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:04:20.833603 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.81s]
[0m10:04:20.836493 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:04:20.893918 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:04:20.911700 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:04:20.913884 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:04:20.919664 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.90s]
[0m10:04:20.925325 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.91s]
[0m10:04:20.929338 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:04:20.933213 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:04:20.937632 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:04:20.938875 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:04:20.940645 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:04:20.942201 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:04:20.944067 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:04:20.946344 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:04:20.948119 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:04:20.949737 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:04:20.991991 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:04:20.993442 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:04:20.994941 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:04:20.996382 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:04:21.107696 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:04:21.108871 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:04:21.110165 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:04:21.111658 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:04:21.112611 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:04:21.113798 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:04:21.203246 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:04:21.322856 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:04:21.517961 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m10:04:21.627660 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:04:21.730312 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:04:21.794414 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:04:21.904449 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:04:21.897102 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1ab69fb_2c80_4418_be11_5cdffaef7c8b` 
  ...
[0m10:04:21.995671 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:04:22.005964 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:04:22.031476 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1ab69fb_2c80_4418_be11_5cdffaef7c8b` 
  ...
[0m10:04:22.035001 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:04:22.130782 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:04:22.204640 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:04:22.392630 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1ab69fb_2c80_4418_be11_5cdffaef7c8b`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:04:22.396222 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1ab69fb_2c80_4418_be11_5cdffaef7c8b`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:04:22.402247 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:04:22.417210 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:04:22.422980 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:04:22.428215 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1ab69fb-2c80-4418-be11-5cdffaef7c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd39778f130>]}
[0m10:04:22.430634 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.44s]
[0m10:04:22.433339 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:04:22.436452 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:04:22.492476 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:04:22.534098 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_e1ab69fb_2c80_4418_be11_5cdffaef7c8b'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:04:22.593455 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_e1ab69fb_2c80_4418_be11_5cdffaef7c8b'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:04:22.600723 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:04:22.603877 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:04:22.617229 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:04:22.622549 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:04:22.625708 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1ab69fb_2c80_4418_be11_5cdffaef7c8b`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:04:22.629600 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1ab69fb_2c80_4418_be11_5cdffaef7c8b`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:04:22.659814 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:04:22.662409 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:04:22.691875 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1ab69fb_2c80_4418_be11_5cdffaef7c8b`)
      
    ...
[0m10:04:22.696249 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1ab69fb_2c80_4418_be11_5cdffaef7c8b`)
      
    ...
[0m10:04:22.727822 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:04:22.738056 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:04:22.740582 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:04:22.752361 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:04:22.755345 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:04:22.791427 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1ab69fb_2c80_4418_be11_5cdffaef7c8b` 
    ...
[0m10:04:22.796319 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:04:22.802091 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1ab69fb_2c80_4418_be11_5cdffaef7c8b` 
    ...
[0m10:04:22.809454 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:04:22.812186 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:04:22.826049 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1ab69fb_2c80_4418_be11_5cdffaef7c8b` 
  ...
[0m10:04:22.839345 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1ab69fb_2c80_4418_be11_5cdffaef7c8b` 
  ...
[0m10:04:22.895433 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:04:22.898291 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:04:22.910811 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:04:22.923355 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:04:22.929850 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:04:22.937713 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:04:22.939668 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1ab69fb-2c80-4418-be11-5cdffaef7c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd39778fd00>]}
[0m10:04:22.995371 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1ab69fb-2c80-4418-be11-5cdffaef7c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd397758fa0>]}
[0m10:04:22.997982 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.99s]
[0m10:04:23.000675 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.05s]
[0m10:04:23.003624 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:04:23.010019 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:04:23.014913 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:04:23.016197 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:04:23.017432 [debug] [MainThread]: On list__mart: Close
[0m10:04:23.018636 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:04:23.019791 [debug] [MainThread]: On list__clean: Close
[0m10:04:23.020935 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:04:23.022112 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:04:23.023229 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:04:23.024455 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:04:23.025668 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:04:23.026812 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:04:23.027920 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:04:23.029066 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:04:23.031766 [info ] [MainThread]: 
[0m10:04:23.033226 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.63 seconds (4.63s).
[0m10:04:23.091922 [debug] [MainThread]: Command end result
[0m10:04:23.304476 [info ] [MainThread]: 
[0m10:04:23.306060 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:04:23.307299 [info ] [MainThread]: 
[0m10:04:23.308621 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:04:23.311155 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.505025, "process_in_blocks": "0", "process_kernel_time": 0.685145, "process_mem_max_rss": "115240", "process_out_blocks": "9744", "process_user_time": 6.407005}
[0m10:04:23.312661 [debug] [MainThread]: Command `dbt build` succeeded at 10:04:23.312247 after 7.51 seconds
[0m10:04:23.313926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd39c798310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd398b40b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cd39a61c5e0>]}
[0m10:04:23.315165 [debug] [MainThread]: Flushing usage events
[0m10:05:16.245518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79624c4fd310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796249158af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962491589a0>]}


============================== 10:05:16.255146 | 9d092082-b602-48a1-8bd1-72481ffc6dab ==============================
[0m10:05:16.255146 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:05:16.256248 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'printer_width': '80', 'fail_fast': 'False', 'profiles_dir': '.', 'quiet': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'use_colors': 'True', 'empty': 'False', 'log_format': 'default', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_path': '/workdir/transforms/04_btc/logs', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'debug': 'False', 'log_cache_events': 'False', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'introspect': 'True'}
[0m10:05:16.836938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9d092082-b602-48a1-8bd1-72481ffc6dab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79624ba9a3a0>]}
[0m10:05:17.029304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9d092082-b602-48a1-8bd1-72481ffc6dab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962491b93a0>]}
[0m10:05:17.030583 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:05:17.441689 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:05:17.952633 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:05:17.953369 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:05:18.157725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9d092082-b602-48a1-8bd1-72481ffc6dab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962488beee0>]}
[0m10:05:18.635671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9d092082-b602-48a1-8bd1-72481ffc6dab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962488a8c70>]}
[0m10:05:18.636525 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:05:18.639914 [info ] [MainThread]: 
[0m10:05:18.641520 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:05:18.657517 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:05:18.659447 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:05:18.750015 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:05:18.767570 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:05:19.497333 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:05:19.504732 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:05:19.508273 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:05:19.524260 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:05:19.558517 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:05:19.570480 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:05:19.571953 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:05:19.628389 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:05:19.637881 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:05:19.640060 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:05:19.667251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9d092082-b602-48a1-8bd1-72481ffc6dab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79624b90d970>]}
[0m10:05:19.669175 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:05:19.670555 [info ] [MainThread]: 
[0m10:05:19.746069 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:05:19.747234 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:05:19.748389 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:05:19.749185 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:05:19.765754 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:05:19.766894 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:05:19.953948 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:05:20.029261 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:05:20.030834 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:05:20.042953 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:05:20.165026 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:05:20.168697 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:05:20.170759 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:05:20.223756 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:05:20.229879 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:05:20.233006 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:05:20.235292 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:05:20.238252 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:05:20.331793 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:05:20.335213 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:05:20.341220 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d092082-b602-48a1-8bd1-72481ffc6dab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796247c48dc0>]}
[0m10:05:20.342389 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m10:05:20.343803 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:05:20.345800 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:05:20.346852 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:05:20.348062 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:05:20.349644 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:05:20.351208 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:05:20.352744 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:05:20.355045 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:05:20.356631 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:05:20.358237 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:05:20.359998 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:05:20.361714 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:05:20.363463 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:05:20.655252 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:05:20.656874 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:05:20.658587 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:05:20.661027 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:05:20.727206 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:05:20.728869 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:05:20.950214 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:05:21.028520 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:05:21.046441 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:05:21.049173 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:05:21.050983 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:05:21.054271 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:05:21.321520 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:05:21.343892 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:05:21.346633 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:05:21.349177 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:05:21.360520 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 1.00s]
[0m10:05:21.365956 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:05:21.423004 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:05:21.370931 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:05:21.429488 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.07s]
[0m10:05:21.435120 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.08s]
[0m10:05:21.437886 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:05:21.440893 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:05:21.444680 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:05:21.445761 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:05:21.447514 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:05:21.449224 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:05:21.451204 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:05:21.453437 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:05:21.455439 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:05:21.457130 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:05:21.458715 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:05:21.460367 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:05:21.462183 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:05:21.463925 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:05:21.637570 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:05:21.640301 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:05:21.640792 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:05:21.642555 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:05:21.643389 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:05:21.654405 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:05:21.823725 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:05:21.927200 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:05:22.042998 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:05:22.149017 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:05:22.252404 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:05:22.334694 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:05:22.444515 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9d092082_b602_48a1_8bd1_72481ffc6dab` 
  ...
[0m10:05:22.459027 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:05:22.460489 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9d092082_b602_48a1_8bd1_72481ffc6dab` 
  ...
[0m10:05:22.524622 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:05:22.531066 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:05:22.544130 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:05:22.553799 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:05:22.556303 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:05:22.633231 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:05:22.729612 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:05:22.760072 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:05:22.830203 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d092082-b602-48a1-8bd1-72481ffc6dab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962474f3a60>]}
[0m10:05:22.837101 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.37s]
[0m10:05:22.849171 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:05:22.944073 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_9d092082_b602_48a1_8bd1_72481ffc6dab`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:05:22.941843 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_9d092082_b602_48a1_8bd1_72481ffc6dab`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:05:22.977185 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:05:22.993558 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:05:23.058511 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_9d092082_b602_48a1_8bd1_72481ffc6dab'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:05:23.063431 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_9d092082_b602_48a1_8bd1_72481ffc6dab'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:05:23.122666 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:05:23.123331 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:05:23.129937 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:05:23.135033 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:05:23.137912 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_9d092082_b602_48a1_8bd1_72481ffc6dab`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:05:23.140104 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_9d092082_b602_48a1_8bd1_72481ffc6dab`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:05:23.171434 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:05:23.175729 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9d092082_b602_48a1_8bd1_72481ffc6dab`)
      
    ...
[0m10:05:23.178341 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:05:23.184527 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9d092082_b602_48a1_8bd1_72481ffc6dab`)
      
    ...
[0m10:05:23.212215 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:05:23.221779 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:05:23.231960 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:05:23.233509 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:05:23.241643 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:05:23.244195 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:05:23.249407 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9d092082_b602_48a1_8bd1_72481ffc6dab` 
    ...
[0m10:05:23.255296 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9d092082_b602_48a1_8bd1_72481ffc6dab` 
    ...
[0m10:05:23.266666 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:05:23.274408 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:05:23.325265 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9d092082_b602_48a1_8bd1_72481ffc6dab` 
  ...
[0m10:05:23.337483 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9d092082_b602_48a1_8bd1_72481ffc6dab` 
  ...
[0m10:05:23.343767 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:05:23.351597 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:05:23.364188 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:05:23.425010 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:05:23.429506 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:05:23.432088 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:05:23.438729 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d092082-b602-48a1-8bd1-72481ffc6dab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962487ab310>]}
[0m10:05:23.446086 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d092082-b602-48a1-8bd1-72481ffc6dab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962484776d0>]}
[0m10:05:23.448574 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.98s]
[0m10:05:23.451346 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.99s]
[0m10:05:23.454292 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:05:23.457309 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:05:23.465461 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:05:23.466631 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:05:23.467797 [debug] [MainThread]: On list__clean: Close
[0m10:05:23.468861 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:05:23.469944 [debug] [MainThread]: On list__mart: Close
[0m10:05:23.470992 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:05:23.521975 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:05:23.523236 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:05:23.524376 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:05:23.525740 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:05:23.526867 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:05:23.527968 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:05:23.529047 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:05:23.531842 [info ] [MainThread]: 
[0m10:05:23.533360 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.89 seconds (4.89s).
[0m10:05:23.541625 [debug] [MainThread]: Command end result
[0m10:05:23.754031 [info ] [MainThread]: 
[0m10:05:23.755515 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:05:23.756793 [info ] [MainThread]: 
[0m10:05:23.758045 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:05:23.760485 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.7077117, "process_in_blocks": "0", "process_kernel_time": 0.683002, "process_mem_max_rss": "115164", "process_out_blocks": "9744", "process_user_time": 6.549084}
[0m10:05:23.761822 [debug] [MainThread]: Command `dbt build` succeeded at 10:05:23.761444 after 7.71 seconds
[0m10:05:23.762922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79624c4fd310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79624a486850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79624a483d00>]}
[0m10:05:23.763939 [debug] [MainThread]: Flushing usage events
[0m10:06:16.281426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72118a962310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211875d3b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211875d3a00>]}


============================== 10:06:16.341929 | dbf673cd-5ead-43e2-93cd-005929114be0 ==============================
[0m10:06:16.341929 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:06:16.342975 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'empty': 'False', 'write_json': 'True', 'fail_fast': 'False', 'partial_parse': 'True', 'log_format': 'default', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'debug': 'False', 'no_print': 'None', 'printer_width': '80', 'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'profiles_dir': '.', 'use_colors': 'True', 'version_check': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local'}
[0m10:06:16.866972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dbf673cd-5ead-43e2-93cd-005929114be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211874c6490>]}
[0m10:06:17.060575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dbf673cd-5ead-43e2-93cd-005929114be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211880a73a0>]}
[0m10:06:17.062204 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:06:17.475759 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:06:17.977851 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:06:17.978503 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:06:18.180496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dbf673cd-5ead-43e2-93cd-005929114be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721186d28eb0>]}
[0m10:06:18.676831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dbf673cd-5ead-43e2-93cd-005929114be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721186c16dc0>]}
[0m10:06:18.677725 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:06:18.680991 [info ] [MainThread]: 
[0m10:06:18.681989 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:06:18.693932 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:06:18.695392 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:06:18.770027 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:06:18.834148 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:06:19.567286 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:06:19.573731 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:06:19.593943 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:06:19.634121 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:06:19.671661 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:06:19.673206 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:06:19.744970 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:06:19.748819 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:06:19.758197 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:06:19.768614 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:06:19.834715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dbf673cd-5ead-43e2-93cd-005929114be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721187516400>]}
[0m10:06:19.836770 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:06:19.838138 [info ] [MainThread]: 
[0m10:06:19.864544 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:06:19.865715 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:06:19.866810 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:06:19.867602 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:06:19.935267 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:06:19.936983 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:06:20.076766 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:06:20.188438 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:06:20.190053 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:06:20.202702 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:06:20.345140 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:06:20.349251 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:06:20.351142 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:06:20.354055 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:06:20.359824 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:06:20.363002 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:06:20.364888 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:06:20.367836 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:06:20.462106 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:06:20.465737 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:06:20.471922 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbf673cd-5ead-43e2-93cd-005929114be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721185fd5cd0>]}
[0m10:06:20.473128 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m10:06:20.474473 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:06:20.476872 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:06:20.478048 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:06:20.479378 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:06:20.480674 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:06:20.482118 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:06:20.534030 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:06:20.536482 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:06:20.538626 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:06:20.540808 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:06:20.542763 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:06:20.544482 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:06:20.546263 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:06:20.744024 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:06:20.749334 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:06:20.751163 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:06:20.753849 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:06:20.765700 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:06:20.838363 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:06:21.063412 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:06:21.055892 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:06:21.077888 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:06:21.081132 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:06:21.133157 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:06:21.083389 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:06:21.374737 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:06:21.387909 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:06:21.394344 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:06:21.437063 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:06:21.451610 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m10:06:21.457052 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:06:21.462570 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.93s]
[0m10:06:21.466261 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:06:21.472962 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:06:21.487665 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:06:21.535577 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.00s]
[0m10:06:21.538487 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:06:21.541261 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:06:21.542391 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:06:21.544052 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:06:21.545867 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:06:21.547515 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:06:21.549761 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:06:21.551598 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:06:21.553075 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:06:21.554692 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:06:21.556740 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:06:21.558397 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:06:21.560088 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:06:21.742959 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:06:21.749386 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:06:21.750521 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:06:21.752247 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:06:21.758451 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:06:21.770933 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:06:21.833197 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:06:21.861230 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:06:22.044334 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:06:22.145394 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:06:22.236037 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:06:22.270427 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:06:22.369246 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:06:22.455908 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:06:22.535404 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:06:22.544818 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:06:22.577283 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:06:22.575209 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_dbf673cd_5ead_43e2_93cd_005929114be0` 
  ...
[0m10:06:22.651243 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_dbf673cd_5ead_43e2_93cd_005929114be0` 
  ...
[0m10:06:22.655353 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:06:22.663744 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:06:22.666029 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:06:22.679385 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:06:22.768386 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbf673cd-5ead-43e2-93cd-005929114be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72118595c550>]}
[0m10:06:22.859888 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.21s]
[0m10:06:22.878328 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:06:23.133057 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_dbf673cd_5ead_43e2_93cd_005929114be0`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:06:23.136018 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_dbf673cd_5ead_43e2_93cd_005929114be0`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:06:23.167734 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:06:23.183239 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:06:23.245607 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_dbf673cd_5ead_43e2_93cd_005929114be0'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:06:23.255310 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_dbf673cd_5ead_43e2_93cd_005929114be0'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:06:23.266187 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:06:23.268179 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:06:23.282590 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:06:23.336549 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:06:23.339514 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_dbf673cd_5ead_43e2_93cd_005929114be0`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:06:23.341912 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_dbf673cd_5ead_43e2_93cd_005929114be0`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:06:23.376447 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:06:23.379213 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:06:23.383245 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_dbf673cd_5ead_43e2_93cd_005929114be0`)
      
    ...
[0m10:06:23.387171 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_dbf673cd_5ead_43e2_93cd_005929114be0`)
      
    ...
[0m10:06:23.413696 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:06:23.415116 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:06:23.419896 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:06:23.427474 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:06:23.436743 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:06:23.438848 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:06:23.442083 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_dbf673cd_5ead_43e2_93cd_005929114be0` 
    ...
[0m10:06:23.447010 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_dbf673cd_5ead_43e2_93cd_005929114be0` 
    ...
[0m10:06:23.457749 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:06:23.460197 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:06:23.472616 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_dbf673cd_5ead_43e2_93cd_005929114be0` 
  ...
[0m10:06:23.484784 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_dbf673cd_5ead_43e2_93cd_005929114be0` 
  ...
[0m10:06:23.535506 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:06:23.541597 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:06:23.542966 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:06:23.552890 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:06:23.554750 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:06:23.559530 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbf673cd-5ead-43e2-93cd-005929114be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7211874c6790>]}
[0m10:06:23.561606 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:06:23.563255 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.01s]
[0m10:06:23.568946 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbf673cd-5ead-43e2-93cd-005929114be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721186851b80>]}
[0m10:06:23.571731 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:06:23.574701 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.02s]
[0m10:06:23.577616 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:06:23.581168 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:06:23.582298 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:06:23.633611 [debug] [MainThread]: On list__mart: Close
[0m10:06:23.634693 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:06:23.635823 [debug] [MainThread]: On list__clean: Close
[0m10:06:23.636872 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:06:23.638007 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:06:23.639059 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:06:23.640167 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:06:23.641251 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:06:23.642381 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:06:23.643432 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:06:23.644525 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:06:23.646833 [info ] [MainThread]: 
[0m10:06:23.648295 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.96 seconds (4.96s).
[0m10:06:23.656294 [debug] [MainThread]: Command end result
[0m10:06:23.864169 [info ] [MainThread]: 
[0m10:06:23.865002 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:06:23.865571 [info ] [MainThread]: 
[0m10:06:23.866174 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:06:23.867430 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.7307935, "process_in_blocks": "0", "process_kernel_time": 0.737136, "process_mem_max_rss": "115260", "process_out_blocks": "9744", "process_user_time": 6.574111}
[0m10:06:23.868152 [debug] [MainThread]: Command `dbt build` succeeded at 10:06:23.867961 after 7.73 seconds
[0m10:06:23.868767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72118a962310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721189107ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721188876dc0>]}
[0m10:06:23.869336 [debug] [MainThread]: Flushing usage events
[0m10:07:17.062870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b612cae20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b5df1fc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b5df1fac0>]}


============================== 10:07:17.122130 | 5e966ff3-3b6e-4fef-814d-188406d83b5f ==============================
[0m10:07:17.122130 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:07:17.123215 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'indirect_selection': 'eager', 'static_parser': 'True', 'printer_width': '80', 'partial_parse': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'target_path': 'None', 'empty': 'False', 'introspect': 'True', 'warn_error': 'None', 'use_colors': 'True', 'log_cache_events': 'False', 'log_format': 'default', 'version_check': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'debug': 'False', 'fail_fast': 'False', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'no_print': 'None'}
[0m10:07:17.647080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5e966ff3-3b6e-4fef-814d-188406d83b5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b5dd75190>]}
[0m10:07:17.839280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5e966ff3-3b6e-4fef-814d-188406d83b5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b5df7e490>]}
[0m10:07:17.840559 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:07:18.261322 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:07:18.818810 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:07:18.819448 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:07:19.017817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5e966ff3-3b6e-4fef-814d-188406d83b5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b5d683e20>]}
[0m10:07:19.469737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5e966ff3-3b6e-4fef-814d-188406d83b5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b5d698970>]}
[0m10:07:19.470634 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:07:19.473879 [info ] [MainThread]: 
[0m10:07:19.474872 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:07:19.518356 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:07:19.520346 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:07:19.559707 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:07:19.622663 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:07:20.421247 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:07:20.427247 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:07:20.429559 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:07:20.438551 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:07:20.530743 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:07:20.537451 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:07:20.562881 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:07:20.558672 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:07:20.624340 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:07:20.640396 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:07:20.652507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e966ff3-3b6e-4fef-814d-188406d83b5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b5de81700>]}
[0m10:07:20.654519 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:07:20.655868 [info ] [MainThread]: 
[0m10:07:20.727130 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:07:20.728250 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:07:20.729303 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:07:20.730041 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:07:20.746823 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:07:20.748240 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:07:20.930149 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:07:20.999890 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:07:21.001410 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:07:21.014601 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:07:21.155981 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:07:21.159740 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:07:21.161734 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:07:21.164684 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:07:21.218478 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:07:21.222469 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:07:21.224479 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:07:21.227310 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:07:21.321824 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:07:21.325765 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:07:21.331928 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e966ff3-3b6e-4fef-814d-188406d83b5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b5d2bc040>]}
[0m10:07:21.333095 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m10:07:21.334419 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:07:21.336646 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:07:21.338053 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:07:21.339654 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:07:21.341573 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:07:21.343390 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:07:21.345795 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:07:21.347700 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:07:21.349923 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:07:21.351721 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:07:21.353827 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:07:21.355576 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:07:21.414977 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:07:21.534713 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:07:21.547961 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:07:21.549154 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:07:21.551436 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:07:21.553198 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:07:21.615722 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:07:21.914721 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:07:21.921405 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:07:21.940143 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:07:21.942831 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:07:21.946103 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:07:21.948928 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:07:22.224285 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:07:22.229424 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:07:22.243612 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:07:22.247227 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:07:22.250146 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:07:22.321237 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:07:22.318372 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.97s]
[0m10:07:22.327138 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.98s]
[0m10:07:22.332967 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.98s]
[0m10:07:22.336124 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:07:22.339057 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:07:22.342006 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:07:22.345914 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:07:22.347118 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:07:22.348757 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:07:22.350125 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:07:22.352628 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:07:22.354453 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:07:22.356360 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:07:22.358078 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:07:22.359725 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:07:22.361245 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:07:22.362928 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:07:22.431384 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:07:22.455958 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:07:22.539243 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:07:22.541166 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:07:22.543399 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:07:22.545745 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:07:22.547261 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:07:22.725699 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:07:22.819859 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:07:22.863302 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:07:23.030675 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:07:23.146445 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:07:23.222799 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:07:23.258316 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:07:23.329617 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e966ff3_3b6e_4fef_814d_188406d83b5f` 
  ...
[0m10:07:23.343002 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:07:23.421421 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:07:23.424032 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e966ff3_3b6e_4fef_814d_188406d83b5f` 
  ...
[0m10:07:23.445994 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:07:23.459846 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:07:23.516146 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:07:23.621315 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:07:23.717948 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:07:23.755256 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:07:23.818390 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e966ff3-3b6e-4fef-814d-188406d83b5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b5de55160>]}
[0m10:07:23.841478 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.46s]
[0m10:07:23.844792 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e966ff3_3b6e_4fef_814d_188406d83b5f`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:07:23.847478 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e966ff3_3b6e_4fef_814d_188406d83b5f`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:07:23.850723 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:07:23.910946 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:07:23.926866 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:07:23.948583 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_5e966ff3_3b6e_4fef_814d_188406d83b5f'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:07:23.960516 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_5e966ff3_3b6e_4fef_814d_188406d83b5f'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:07:24.020859 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:07:24.025083 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:07:24.043419 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:07:24.041401 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:07:24.047321 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e966ff3_3b6e_4fef_814d_188406d83b5f`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:07:24.051225 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e966ff3_3b6e_4fef_814d_188406d83b5f`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:07:24.080014 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:07:24.084467 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e966ff3_3b6e_4fef_814d_188406d83b5f`)
      
    ...
[0m10:07:24.087179 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:07:24.118178 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e966ff3_3b6e_4fef_814d_188406d83b5f`)
      
    ...
[0m10:07:24.143462 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:07:24.145214 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:07:24.155453 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:07:24.161154 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:07:24.167432 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:07:24.168470 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:07:24.171332 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e966ff3_3b6e_4fef_814d_188406d83b5f` 
    ...
[0m10:07:24.174460 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e966ff3_3b6e_4fef_814d_188406d83b5f` 
    ...
[0m10:07:24.180692 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:07:24.181920 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:07:24.187551 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e966ff3_3b6e_4fef_814d_188406d83b5f` 
  ...
[0m10:07:24.222210 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e966ff3_3b6e_4fef_814d_188406d83b5f` 
  ...
[0m10:07:24.226137 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:07:24.227951 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:07:24.234218 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:07:24.245785 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:07:24.251811 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:07:24.254434 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:07:24.260773 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e966ff3-3b6e-4fef-814d-188406d83b5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b5c9f6370>]}
[0m10:07:24.317795 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e966ff3-3b6e-4fef-814d-188406d83b5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b5c2bba90>]}
[0m10:07:24.320281 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.90s]
[0m10:07:24.322850 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.96s]
[0m10:07:24.325704 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:07:24.328461 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:07:24.332828 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:07:24.333997 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:07:24.335118 [debug] [MainThread]: On list__mart: Close
[0m10:07:24.336176 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:07:24.337243 [debug] [MainThread]: On list__clean: Close
[0m10:07:24.338279 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:07:24.339350 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:07:24.340421 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:07:24.341685 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:07:24.342735 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:07:24.343809 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:07:24.344861 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:07:24.345932 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:07:24.348252 [info ] [MainThread]: 
[0m10:07:24.349681 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.87 seconds (4.87s).
[0m10:07:24.358647 [debug] [MainThread]: Command end result
[0m10:07:24.626342 [info ] [MainThread]: 
[0m10:07:24.628007 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:07:24.629224 [info ] [MainThread]: 
[0m10:07:24.630706 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:07:24.633413 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.71297, "process_in_blocks": "0", "process_kernel_time": 0.734677, "process_mem_max_rss": "114964", "process_out_blocks": "9744", "process_user_time": 6.516184}
[0m10:07:24.635017 [debug] [MainThread]: Command `dbt build` succeeded at 10:07:24.634611 after 7.71 seconds
[0m10:07:24.636300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b612cae20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b5f14b5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x789b5ea3bb80>]}
[0m10:07:24.637564 [debug] [MainThread]: Flushing usage events
[0m10:08:17.116992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70584144c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70583e0adaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70583e0ad9a0>]}


============================== 10:08:17.126218 | d769f03e-d055-4af2-be91-02e45c757212 ==============================
[0m10:08:17.126218 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:08:17.127275 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'warn_error': 'None', 'log_format': 'default', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'static_parser': 'True', 'write_json': 'True', 'indirect_selection': 'eager', 'profiles_dir': '.', 'version_check': 'True', 'partial_parse': 'True', 'fail_fast': 'False', 'printer_width': '80', 'invocation_command': 'dbt build --profiles-dir . --target local', 'debug': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'target_path': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'empty': 'False', 'cache_selected_only': 'False', 'introspect': 'True'}
[0m10:08:17.703262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd769f03e-d055-4af2-be91-02e45c757212', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70583dfe5160>]}
[0m10:08:17.896261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd769f03e-d055-4af2-be91-02e45c757212', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70583dff5f70>]}
[0m10:08:17.897539 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:08:18.324295 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:08:18.829584 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:08:18.830209 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:08:19.030058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd769f03e-d055-4af2-be91-02e45c757212', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70583d80fee0>]}
[0m10:08:19.528630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd769f03e-d055-4af2-be91-02e45c757212', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70583d7f9130>]}
[0m10:08:19.529485 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:08:19.532820 [info ] [MainThread]: 
[0m10:08:19.533821 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:08:19.545699 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:08:19.583662 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:08:19.631958 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:08:19.696476 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:08:20.444917 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:08:20.450373 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:08:20.460078 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:08:20.482615 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:08:20.522349 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:08:20.523850 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:08:20.592198 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:08:20.599849 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:08:20.609339 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:08:20.619718 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:08:20.684405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd769f03e-d055-4af2-be91-02e45c757212', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70583d757880>]}
[0m10:08:20.685421 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:08:20.686105 [info ] [MainThread]: 
[0m10:08:20.699839 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:08:20.700996 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:08:20.702083 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:08:20.702832 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:08:20.719358 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:08:20.720487 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:08:20.907240 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:08:20.974330 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:08:20.982652 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:08:20.994984 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:08:21.129148 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:08:21.133030 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:08:21.184689 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:08:21.188824 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:08:21.194627 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:08:21.197759 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:08:21.199648 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:08:21.202553 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:08:21.296685 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:08:21.300256 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:08:21.306149 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd769f03e-d055-4af2-be91-02e45c757212', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70583d3bb370>]}
[0m10:08:21.307343 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m10:08:21.308736 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:08:21.310857 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:08:21.311904 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:08:21.313098 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:08:21.314818 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:08:21.316615 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:08:21.318220 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:08:21.320587 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:08:21.322397 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:08:21.324136 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:08:21.325936 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:08:21.327479 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:08:21.328887 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:08:21.527202 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:08:21.528878 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:08:21.530903 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:08:21.584909 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:08:21.586714 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:08:21.693841 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:08:21.821938 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:08:21.814052 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:08:21.824972 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:08:21.827291 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:08:21.829711 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:08:21.886194 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:08:22.157264 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:08:22.171056 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:08:22.184083 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:08:22.201809 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.88s]
[0m10:08:22.205485 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:08:22.208609 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:08:22.211326 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:08:22.217413 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.90s]
[0m10:08:22.223575 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:08:22.232343 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:08:22.286327 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.96s]
[0m10:08:22.289298 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:08:22.292044 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:08:22.293238 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:08:22.295136 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:08:22.296656 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:08:22.298874 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:08:22.300937 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:08:22.302969 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:08:22.304706 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:08:22.306376 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:08:22.308003 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:08:22.309694 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:08:22.321756 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:08:22.330882 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:08:22.408577 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:08:22.412296 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:08:22.414992 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:08:22.426893 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:08:22.488673 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:08:22.584397 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:08:22.694055 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:08:22.784172 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:08:22.925013 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:08:23.007628 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:08:23.017128 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:08:23.129319 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:08:23.229892 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:08:23.292019 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_d769f03e_d055_4af2_be91_02e45c757212` 
  ...
[0m10:08:23.331509 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_d769f03e_d055_4af2_be91_02e45c757212` 
  ...
[0m10:08:23.384187 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:08:23.387841 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:08:23.390436 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:08:23.392234 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:08:23.426440 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:08:23.611076 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:08:23.697790 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:08:23.705829 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_d769f03e_d055_4af2_be91_02e45c757212`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:08:23.711320 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd769f03e-d055-4af2-be91-02e45c757212', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70583c4677c0>]}
[0m10:08:23.718212 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_d769f03e_d055_4af2_be91_02e45c757212`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:08:23.722950 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.40s]
[0m10:08:23.728224 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:08:23.783146 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:08:23.785989 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:08:23.895332 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_d769f03e_d055_4af2_be91_02e45c757212'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:08:23.897400 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_d769f03e_d055_4af2_be91_02e45c757212'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:08:23.907616 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:08:23.910199 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:08:23.923593 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:08:23.928942 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:08:23.931934 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_d769f03e_d055_4af2_be91_02e45c757212`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:08:23.934244 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_d769f03e_d055_4af2_be91_02e45c757212`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:08:24.011045 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:08:24.015476 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_d769f03e_d055_4af2_be91_02e45c757212`)
      
    ...
[0m10:08:24.018000 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:08:24.023640 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_d769f03e_d055_4af2_be91_02e45c757212`)
      
    ...
[0m10:08:24.048830 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:08:24.059472 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:08:24.062188 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:08:24.084289 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:08:24.087747 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:08:24.093512 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_d769f03e_d055_4af2_be91_02e45c757212` 
    ...
[0m10:08:24.103238 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:08:24.110091 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_d769f03e_d055_4af2_be91_02e45c757212` 
    ...
[0m10:08:24.112828 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:08:24.129298 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_d769f03e_d055_4af2_be91_02e45c757212` 
  ...
[0m10:08:24.132162 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:08:24.194753 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:08:24.195404 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_d769f03e_d055_4af2_be91_02e45c757212` 
  ...
[0m10:08:24.207350 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:08:24.214120 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:08:24.216570 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:08:24.223012 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd769f03e-d055-4af2-be91-02e45c757212', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70583c159430>]}
[0m10:08:24.287825 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:08:24.290497 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.92s]
[0m10:08:24.295477 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:08:24.298864 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:08:24.305385 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd769f03e-d055-4af2-be91-02e45c757212', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70583c410d00>]}
[0m10:08:24.307670 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.00s]
[0m10:08:24.310430 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:08:24.314351 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:08:24.315571 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:08:24.316760 [debug] [MainThread]: On list__mart: Close
[0m10:08:24.317868 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:08:24.319008 [debug] [MainThread]: On list__clean: Close
[0m10:08:24.320098 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:08:24.321547 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:08:24.322653 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:08:24.323675 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:08:24.324700 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:08:24.325773 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:08:24.326854 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:08:24.327918 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:08:24.330214 [info ] [MainThread]: 
[0m10:08:24.331677 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.80 seconds (4.80s).
[0m10:08:24.390987 [debug] [MainThread]: Command end result
[0m10:08:24.592122 [info ] [MainThread]: 
[0m10:08:24.593839 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:08:24.595064 [info ] [MainThread]: 
[0m10:08:24.596442 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:08:24.598801 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.6755404, "process_in_blocks": "0", "process_kernel_time": 0.671079, "process_mem_max_rss": "115064", "process_out_blocks": "9744", "process_user_time": 6.529024}
[0m10:08:24.600148 [debug] [MainThread]: Command `dbt build` succeeded at 10:08:24.599792 after 7.68 seconds
[0m10:08:24.601267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70584144c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70583dfe5160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70583dff5f70>]}
[0m10:08:24.602310 [debug] [MainThread]: Flushing usage events
[0m10:09:16.969942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7acf82df1310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7acf7fa58b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7acf7fa58a00>]}


============================== 10:09:16.979128 | c6f0f10f-5742-4e72-b37b-cc3312e74af8 ==============================
[0m10:09:16.979128 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:09:17.032164 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'profiles_dir': '.', 'indirect_selection': 'eager', 'printer_width': '80', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'no_print': 'None', 'version_check': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'empty': 'False', 'static_parser': 'True', 'debug': 'False', 'partial_parse': 'True', 'warn_error': 'None', 'log_cache_events': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_path': '/workdir/transforms/04_btc/logs', 'write_json': 'True'}
[0m10:09:17.560432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c6f0f10f-5742-4e72-b37b-cc3312e74af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7acf7f945940>]}
[0m10:09:17.754572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c6f0f10f-5742-4e72-b37b-cc3312e74af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7acf7fa15310>]}
[0m10:09:17.756043 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:09:18.173279 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:09:18.676004 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:09:18.676640 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:09:18.931622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c6f0f10f-5742-4e72-b37b-cc3312e74af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7acf7f1aeeb0>]}
[0m10:09:19.375070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c6f0f10f-5742-4e72-b37b-cc3312e74af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7acf7f0a34c0>]}
[0m10:09:19.375951 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:09:19.379228 [info ] [MainThread]: 
[0m10:09:19.380265 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:09:19.391705 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:09:19.392990 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:09:19.475023 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:09:19.539440 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:09:20.183598 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:09:20.189796 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:09:20.200926 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:09:20.210548 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:09:20.263387 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:09:20.270033 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:09:20.344598 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:09:20.348723 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:09:20.358977 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:09:20.361666 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:09:20.437530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c6f0f10f-5742-4e72-b37b-cc3312e74af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7acf7ebb5970>]}
[0m10:09:20.439489 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:09:20.440885 [info ] [MainThread]: 
[0m10:09:20.467340 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:09:20.468504 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:09:20.469620 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:09:20.470339 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:09:20.535962 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:09:20.537224 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:09:20.665758 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:09:20.754038 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:09:20.755447 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:09:20.767340 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:09:20.876547 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:09:20.879824 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:09:20.931489 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:09:20.934808 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:09:20.940457 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:09:20.943335 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:09:20.945149 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:09:20.947833 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:09:21.041298 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:09:21.044736 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:09:21.051992 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6f0f10f-5742-4e72-b37b-cc3312e74af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7acf7e533b20>]}
[0m10:09:21.053489 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.58s]
[0m10:09:21.055175 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:09:21.057005 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:09:21.058032 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:09:21.059150 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:09:21.060372 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:09:21.061312 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:09:21.062193 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:09:21.063311 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:09:21.064344 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:09:21.067685 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:09:21.066373 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:09:21.065326 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:09:21.152645 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:09:21.167380 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:09:21.232659 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:09:21.236459 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:09:21.238209 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:09:21.240144 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:09:21.268342 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:09:21.535477 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:09:21.560309 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:09:21.572433 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:09:21.574985 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:09:21.577178 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:09:21.632019 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:09:21.847720 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:09:21.866593 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:09:21.884393 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.82s]
[0m10:09:21.935184 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:09:21.939223 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:09:21.945837 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:09:21.955786 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:09:21.961589 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.90s]
[0m10:09:21.964464 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:09:21.967373 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:09:21.973703 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.91s]
[0m10:09:21.976395 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:09:21.979165 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:09:21.980331 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:09:21.981968 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:09:21.983550 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:09:21.985308 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:09:22.033868 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:09:22.035691 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:09:22.037207 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:09:22.038820 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:09:22.040413 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:09:22.042596 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:09:22.044321 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:09:22.167877 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:09:22.171704 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:09:22.232066 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:09:22.234285 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:09:22.237003 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:09:22.264610 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:09:22.371413 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:09:22.474003 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:09:22.565655 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:09:22.645278 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:09:22.663850 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:09:22.755997 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:09:22.848477 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:09:22.948012 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:09:23.065372 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:09:23.134492 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:09:23.142878 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c6f0f10f_5742_4e72_b37b_cc3312e74af8` 
  ...
[0m10:09:23.152225 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:09:23.160019 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:09:23.162201 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c6f0f10f_5742_4e72_b37b_cc3312e74af8` 
  ...
[0m10:09:23.176850 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:09:23.265784 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:09:23.358344 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:09:23.463322 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6f0f10f-5742-4e72-b37b-cc3312e74af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7acf7e4b06d0>]}
[0m10:09:23.471253 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_c6f0f10f_5742_4e72_b37b_cc3312e74af8`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:09:23.473770 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_c6f0f10f_5742_4e72_b37b_cc3312e74af8`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:09:23.476692 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.42s]
[0m10:09:23.536956 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:09:23.566514 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:09:23.581655 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:09:23.650190 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_c6f0f10f_5742_4e72_b37b_cc3312e74af8'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:09:23.655391 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_c6f0f10f_5742_4e72_b37b_cc3312e74af8'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:09:23.665804 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:09:23.668374 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:09:23.681980 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:09:23.734780 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:09:23.737929 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_c6f0f10f_5742_4e72_b37b_cc3312e74af8`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:09:23.740076 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_c6f0f10f_5742_4e72_b37b_cc3312e74af8`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:09:23.771845 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:09:23.773751 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:09:23.777868 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c6f0f10f_5742_4e72_b37b_cc3312e74af8`)
      
    ...
[0m10:09:23.781981 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c6f0f10f_5742_4e72_b37b_cc3312e74af8`)
      
    ...
[0m10:09:23.816233 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:09:23.818975 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:09:23.830182 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:09:23.842377 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:09:23.853302 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:09:23.856160 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:09:23.861980 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c6f0f10f_5742_4e72_b37b_cc3312e74af8` 
    ...
[0m10:09:23.867781 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c6f0f10f_5742_4e72_b37b_cc3312e74af8` 
    ...
[0m10:09:23.878232 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:09:23.880927 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:09:23.938806 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c6f0f10f_5742_4e72_b37b_cc3312e74af8` 
  ...
[0m10:09:23.945555 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c6f0f10f_5742_4e72_b37b_cc3312e74af8` 
  ...
[0m10:09:23.949683 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:09:23.950836 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:09:23.956890 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:09:23.963311 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:09:23.967708 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:09:23.969198 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:09:23.973728 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6f0f10f-5742-4e72-b37b-cc3312e74af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7acf7e4b00d0>]}
[0m10:09:23.976835 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6f0f10f-5742-4e72-b37b-cc3312e74af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7acf7eaaa430>]}
[0m10:09:23.978518 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.94s]
[0m10:09:23.980150 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.94s]
[0m10:09:24.033864 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:09:24.035896 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:09:24.039528 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:09:24.040741 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:09:24.041875 [debug] [MainThread]: On list__clean: Close
[0m10:09:24.042951 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:09:24.044074 [debug] [MainThread]: On list__mart: Close
[0m10:09:24.045171 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:09:24.046326 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:09:24.047378 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:09:24.048458 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:09:24.049604 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:09:24.050723 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:09:24.051809 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:09:24.052873 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:09:24.055083 [info ] [MainThread]: 
[0m10:09:24.056581 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.67 seconds (4.67s).
[0m10:09:24.064588 [debug] [MainThread]: Command end result
[0m10:09:24.277561 [info ] [MainThread]: 
[0m10:09:24.278796 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:09:24.279763 [info ] [MainThread]: 
[0m10:09:24.331571 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:09:24.334437 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.555333, "process_in_blocks": "0", "process_kernel_time": 0.711803, "process_mem_max_rss": "115040", "process_out_blocks": "9744", "process_user_time": 6.439848}
[0m10:09:24.336127 [debug] [MainThread]: Command `dbt build` succeeded at 10:09:24.335617 after 7.56 seconds
[0m10:09:24.337752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7acf82df1310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7acf7da3ed00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7acf7e514850>]}
[0m10:09:24.339142 [debug] [MainThread]: Flushing usage events
[0m10:10:15.928872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508aabf6310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508a7863b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508a78639d0>]}


============================== 10:10:15.938091 | cfd1fb65-5a41-4f4d-bb98-2d82fd66b94a ==============================
[0m10:10:15.938091 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:10:15.939180 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'debug': 'False', 'write_json': 'True', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False', 'use_colors': 'True', 'no_print': 'None', 'printer_width': '80', 'quiet': 'False', 'static_parser': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'introspect': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'profiles_dir': '.', 'log_path': '/workdir/transforms/04_btc/logs', 'empty': 'False'}
[0m10:10:16.516871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cfd1fb65-5a41-4f4d-bb98-2d82fd66b94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508aa18b3a0>]}
[0m10:10:16.711556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cfd1fb65-5a41-4f4d-bb98-2d82fd66b94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508a78c6220>]}
[0m10:10:16.712893 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:10:17.128279 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:10:17.636268 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:10:17.636946 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:10:17.836725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cfd1fb65-5a41-4f4d-bb98-2d82fd66b94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508a6fbbee0>]}
[0m10:10:18.345762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cfd1fb65-5a41-4f4d-bb98-2d82fd66b94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508a6fa5df0>]}
[0m10:10:18.346663 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:10:18.349905 [info ] [MainThread]: 
[0m10:10:18.350975 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:10:18.362467 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:10:18.369281 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:10:18.446383 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:10:18.504710 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:10:19.279141 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:10:19.286086 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:10:19.287921 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:10:19.302625 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:10:19.348243 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:10:19.403263 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:10:19.424066 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:10:19.426636 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:10:19.437206 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:10:19.442633 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:10:19.513030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cfd1fb65-5a41-4f4d-bb98-2d82fd66b94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508a6f02880>]}
[0m10:10:19.514996 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:10:19.516270 [info ] [MainThread]: 
[0m10:10:19.544051 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:10:19.545222 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:10:19.546314 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:10:19.547075 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:10:19.618894 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:10:19.620679 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:10:19.813315 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:10:19.881634 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:10:19.883017 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:10:19.895652 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:10:20.028749 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:10:20.032931 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:10:20.035039 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:10:20.038056 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:10:20.043760 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:10:20.046686 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:10:20.048576 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:10:20.051389 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:10:20.145484 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:10:20.149016 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:10:20.204364 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cfd1fb65-5a41-4f4d-bb98-2d82fd66b94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508aa1837f0>]}
[0m10:10:20.205700 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m10:10:20.207041 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:10:20.209377 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:10:20.210426 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:10:20.211473 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:10:20.212710 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:10:20.214112 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:10:20.214996 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:10:20.216755 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:10:20.218942 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:10:20.220489 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:10:20.221720 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:10:20.223469 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:10:20.224825 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:10:20.505077 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:10:20.506782 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:10:20.512823 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:10:20.516565 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:10:20.529622 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:10:20.532795 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:10:20.742499 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:10:20.745216 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:10:20.811604 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:10:20.814651 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:10:20.817880 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:10:20.821152 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:10:21.303209 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:10:21.311215 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:10:21.319396 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:10:21.322048 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:10:21.335524 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 1.11s]
[0m10:10:21.340403 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:10:21.343476 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:10:21.349276 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.13s]
[0m10:10:21.403698 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:10:21.407208 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:10:21.413278 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.20s]
[0m10:10:21.417935 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:10:21.420950 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:10:21.422182 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:10:21.424947 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:10:21.424185 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:10:21.426773 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:10:21.428843 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:10:21.430352 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:10:21.431715 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:10:21.433282 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:10:21.434736 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:10:21.436091 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:10:21.437761 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:10:21.613398 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:10:21.630867 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:10:21.633188 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:10:21.635773 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:10:21.637676 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:10:21.639273 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:10:21.649756 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:10:21.834344 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:10:21.936579 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:10:22.039917 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:10:22.204279 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:10:22.220086 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:10:22.250530 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:10:22.428029 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:10:22.517072 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:10:22.532592 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:10:22.544817 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_cfd1fb65_5a41_4f4d_bb98_2d82fd66b94a` 
  ...
[0m10:10:22.627716 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_cfd1fb65_5a41_4f4d_bb98_2d82fd66b94a` 
  ...
[0m10:10:22.635642 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:10:22.638345 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:10:22.646306 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:10:22.713328 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:10:22.805785 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:10:22.831943 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cfd1fb65-5a41-4f4d-bb98-2d82fd66b94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508a5ae3790>]}
[0m10:10:22.917978 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.40s]
[0m10:10:22.949587 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:10:23.116144 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_cfd1fb65_5a41_4f4d_bb98_2d82fd66b94a`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:10:23.119390 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_cfd1fb65_5a41_4f4d_bb98_2d82fd66b94a`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:10:23.271044 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.15 seconds
[0m10:10:23.286932 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.17 seconds
[0m10:10:23.333703 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_cfd1fb65_5a41_4f4d_bb98_2d82fd66b94a'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:10:23.336087 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_cfd1fb65_5a41_4f4d_bb98_2d82fd66b94a'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:10:23.346182 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:10:23.349001 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:10:23.406470 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:10:23.412259 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:10:23.415384 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_cfd1fb65_5a41_4f4d_bb98_2d82fd66b94a`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:10:23.419186 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_cfd1fb65_5a41_4f4d_bb98_2d82fd66b94a`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:10:23.452158 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:10:23.455234 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:10:23.459644 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_cfd1fb65_5a41_4f4d_bb98_2d82fd66b94a`)
      
    ...
[0m10:10:23.463965 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_cfd1fb65_5a41_4f4d_bb98_2d82fd66b94a`)
      
    ...
[0m10:10:23.496441 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:10:23.506690 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:10:23.510863 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:10:23.521150 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:10:23.523930 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:10:23.531918 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_cfd1fb65_5a41_4f4d_bb98_2d82fd66b94a` 
    ...
[0m10:10:23.534957 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:10:23.542642 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_cfd1fb65_5a41_4f4d_bb98_2d82fd66b94a` 
    ...
[0m10:10:23.546956 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:10:23.604058 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:10:23.618458 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_cfd1fb65_5a41_4f4d_bb98_2d82fd66b94a` 
  ...
[0m10:10:23.627352 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_cfd1fb65_5a41_4f4d_bb98_2d82fd66b94a` 
  ...
[0m10:10:23.630098 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:10:23.644917 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:10:23.647401 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:10:23.714376 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:10:23.720306 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:10:23.728166 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:10:23.729781 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cfd1fb65-5a41-4f4d-bb98-2d82fd66b94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508a76b0f40>]}
[0m10:10:23.736133 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cfd1fb65-5a41-4f4d-bb98-2d82fd66b94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508a5bf4dc0>]}
[0m10:10:23.738576 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.30s]
[0m10:10:23.741146 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.30s]
[0m10:10:23.743955 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:10:23.746778 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:10:23.803201 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:10:23.804505 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:10:23.805913 [debug] [MainThread]: On list__mart: Close
[0m10:10:23.807152 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:10:23.808243 [debug] [MainThread]: On list__clean: Close
[0m10:10:23.809352 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:10:23.810519 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:10:23.811610 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:10:23.812733 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:10:23.813785 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:10:23.814881 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:10:23.815926 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:10:23.817034 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:10:23.819364 [info ] [MainThread]: 
[0m10:10:23.820871 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.47 seconds (5.47s).
[0m10:10:23.829054 [debug] [MainThread]: Command end result
[0m10:10:24.024245 [info ] [MainThread]: 
[0m10:10:24.025143 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:10:24.025743 [info ] [MainThread]: 
[0m10:10:24.026367 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:10:24.027669 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 8.291408, "process_in_blocks": "0", "process_kernel_time": 0.764157, "process_mem_max_rss": "114968", "process_out_blocks": "9744", "process_user_time": 6.650928}
[0m10:10:24.028375 [debug] [MainThread]: Command `dbt build` succeeded at 10:10:24.028186 after 8.29 seconds
[0m10:10:24.028988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508aabf6310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508a8b11b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7508a8b14160>]}
[0m10:10:24.029567 [debug] [MainThread]: Flushing usage events
[0m10:11:17.365893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737d0437d310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737d00fe8b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737d00fe8a30>]}


============================== 10:11:17.374921 | 01b4644f-af39-4056-b8fc-d765e243a86b ==============================
[0m10:11:17.374921 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:11:17.375941 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'debug': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_colors': 'True', 'target_path': 'None', 'no_print': 'None', 'profiles_dir': '.', 'cache_selected_only': 'False', 'write_json': 'True', 'static_parser': 'True', 'use_experimental_parser': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'fail_fast': 'False', 'empty': 'False', 'partial_parse': 'True', 'printer_width': '80', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'indirect_selection': 'eager', 'log_format': 'default', 'log_cache_events': 'False'}
[0m10:11:17.959597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '01b4644f-af39-4056-b8fc-d765e243a86b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737d00fad0a0>]}
[0m10:11:18.157256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '01b4644f-af39-4056-b8fc-d765e243a86b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737d00e4ad00>]}
[0m10:11:18.158622 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:11:18.581162 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:11:19.087495 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:11:19.088137 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:11:19.288024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '01b4644f-af39-4056-b8fc-d765e243a86b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737d0073eeb0>]}
[0m10:11:19.799789 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '01b4644f-af39-4056-b8fc-d765e243a86b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737d0062adc0>]}
[0m10:11:19.800712 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:11:19.803875 [info ] [MainThread]: 
[0m10:11:19.804903 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:11:19.816573 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:11:19.818113 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:11:19.899060 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:11:19.969860 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:11:20.720688 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:11:20.724251 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:11:20.728208 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:11:20.730415 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:11:20.794958 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:11:20.796939 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:11:20.863916 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:11:20.872622 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:11:20.883479 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:11:20.885677 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:11:20.960934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01b4644f-af39-4056-b8fc-d765e243a86b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737d00cb1880>]}
[0m10:11:20.962849 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:11:20.963800 [info ] [MainThread]: 
[0m10:11:20.988060 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:11:20.989195 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:11:20.990253 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:11:20.990992 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:11:21.056880 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:11:21.058490 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:11:21.199765 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:11:21.313926 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:11:21.315438 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:11:21.327700 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:11:21.343351 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:11:21.346882 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:11:21.349125 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:11:21.352154 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:11:21.474783 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:11:21.478687 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:11:21.480767 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:11:21.483910 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:11:21.577585 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:11:21.581063 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:11:21.586976 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01b4644f-af39-4056-b8fc-d765e243a86b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737cff9c4a00>]}
[0m10:11:21.588110 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m10:11:21.589421 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:11:21.591764 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:11:21.592786 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:11:21.593961 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:11:21.595528 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:11:21.597214 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:11:21.598464 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:11:21.600777 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:11:21.602953 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:11:21.605150 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:11:21.656941 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:11:21.658689 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:11:21.660355 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:11:21.880308 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:11:21.882360 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:11:21.884674 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:11:21.887704 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:11:21.895204 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:11:21.902051 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:11:22.194841 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:11:22.192851 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:11:22.267410 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:11:22.269280 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:11:22.271842 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:11:22.275690 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:11:23.020621 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:11:23.031201 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:11:23.038866 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:11:23.056888 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:11:23.059706 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:11:23.070672 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 1.47s]
[0m10:11:23.077137 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.47s]
[0m10:11:23.080096 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:11:23.082963 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:11:23.085877 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:11:23.091715 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.49s]
[0m10:11:23.095687 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:11:23.098616 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:11:23.099928 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:11:23.101598 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:11:23.156524 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:11:23.102984 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:11:23.159033 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:11:23.160699 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:11:23.162899 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:11:23.164743 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:11:23.166467 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:11:23.168576 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:11:23.266628 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:11:23.356386 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:11:23.366049 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:11:23.370236 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:11:23.372991 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:11:23.374905 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:11:23.381915 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:11:23.502909 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:11:23.677189 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:11:23.757153 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:11:23.800756 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:11:23.874145 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:11:23.999974 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:11:24.100126 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:11:24.272860 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:11:24.283990 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_01b4644f_af39_4056_b8fc_d765e243a86b` 
  ...
[0m10:11:24.289298 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_01b4644f_af39_4056_b8fc_d765e243a86b` 
  ...
[0m10:11:24.297055 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:11:24.302483 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:11:24.357115 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:11:24.360938 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:11:24.472639 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:11:24.578911 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:11:24.699915 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:11:24.775242 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01b4644f-af39-4056-b8fc-d765e243a86b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737d004d87f0>]}
[0m10:11:24.800818 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.61s]
[0m10:11:24.859834 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_01b4644f_af39_4056_b8fc_d765e243a86b`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:11:24.864693 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_01b4644f_af39_4056_b8fc_d765e243a86b`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:11:24.868806 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:11:25.322312 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.45 seconds
[0m10:11:25.338419 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.47 seconds
[0m10:11:25.384936 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_01b4644f_af39_4056_b8fc_d765e243a86b'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:11:25.387410 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_01b4644f_af39_4056_b8fc_d765e243a86b'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:11:25.398599 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:11:25.401354 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:11:25.467368 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:11:25.464841 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:11:25.471139 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_01b4644f_af39_4056_b8fc_d765e243a86b`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:11:25.475370 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_01b4644f_af39_4056_b8fc_d765e243a86b`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:11:25.508569 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:11:25.513133 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_01b4644f_af39_4056_b8fc_d765e243a86b`)
      
    ...
[0m10:11:25.517148 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:11:25.521066 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_01b4644f_af39_4056_b8fc_d765e243a86b`)
      
    ...
[0m10:11:25.546955 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:11:25.558165 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:11:25.560840 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:11:25.574168 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:11:25.577166 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:11:25.585886 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_01b4644f_af39_4056_b8fc_d765e243a86b` 
    ...
[0m10:11:25.588760 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:11:25.595143 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_01b4644f_af39_4056_b8fc_d765e243a86b` 
    ...
[0m10:11:25.601978 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:11:25.603968 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:11:25.664500 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_01b4644f_af39_4056_b8fc_d765e243a86b` 
  ...
[0m10:11:25.678152 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_01b4644f_af39_4056_b8fc_d765e243a86b` 
  ...
[0m10:11:25.685728 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:11:25.693032 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:11:25.696400 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:11:25.702397 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:11:25.705452 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:11:25.755665 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:11:25.759004 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01b4644f-af39-4056-b8fc-d765e243a86b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737cff3176d0>]}
[0m10:11:25.761796 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01b4644f-af39-4056-b8fc-d765e243a86b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737d00edc5e0>]}
[0m10:11:25.762953 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.60s]
[0m10:11:25.764107 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.60s]
[0m10:11:25.765462 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:11:25.766821 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:11:25.768992 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:11:25.769596 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:11:25.770155 [debug] [MainThread]: On list__clean: Close
[0m10:11:25.770684 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:11:25.771208 [debug] [MainThread]: On list__mart: Close
[0m10:11:25.771764 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:11:25.772281 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:11:25.772826 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:11:25.773389 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:11:25.773901 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:11:25.774410 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:11:25.774917 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:11:25.775429 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:11:25.776601 [info ] [MainThread]: 
[0m10:11:25.777285 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.97 seconds (5.97s).
[0m10:11:25.781201 [debug] [MainThread]: Command end result
[0m10:11:25.967275 [info ] [MainThread]: 
[0m10:11:25.969004 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:11:25.970382 [info ] [MainThread]: 
[0m10:11:25.971863 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:11:25.974590 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 8.805775, "process_in_blocks": "0", "process_kernel_time": 0.674613, "process_mem_max_rss": "114352", "process_out_blocks": "9744", "process_user_time": 6.596771}
[0m10:11:25.976162 [debug] [MainThread]: Command `dbt build` succeeded at 10:11:25.975754 after 8.81 seconds
[0m10:11:25.977561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737d0437d310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737d022085e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737cfefde5e0>]}
[0m10:11:25.978938 [debug] [MainThread]: Flushing usage events
[0m10:12:16.719468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e08905ec310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e088d25ea90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e088d25e940>]}


============================== 10:12:16.729066 | 7124ca88-de1a-4e4c-b4c8-6c8120dce6a6 ==============================
[0m10:12:16.729066 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:12:16.730218 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'log_path': '/workdir/transforms/04_btc/logs', 'write_json': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'invocation_command': 'dbt build --profiles-dir . --target local', 'profiles_dir': '.', 'use_colors': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'version_check': 'True', 'quiet': 'False', 'use_experimental_parser': 'False', 'empty': 'False', 'static_parser': 'True', 'log_format': 'default', 'warn_error': 'None', 'introspect': 'True'}
[0m10:12:17.310134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7124ca88-de1a-4e4c-b4c8-6c8120dce6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e088fb8dfd0>]}
[0m10:12:17.451564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7124ca88-de1a-4e4c-b4c8-6c8120dce6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e088dd2f430>]}
[0m10:12:17.452855 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:12:17.914858 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:12:18.431115 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:12:18.431773 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:12:18.631430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7124ca88-de1a-4e4c-b4c8-6c8120dce6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e088c9b2f10>]}
[0m10:12:19.120081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7124ca88-de1a-4e4c-b4c8-6c8120dce6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e088f827c70>]}
[0m10:12:19.121348 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:12:19.124670 [info ] [MainThread]: 
[0m10:12:19.125707 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:12:19.137579 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:12:19.138921 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:12:19.240325 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:12:19.251839 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:12:19.917311 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:12:19.925179 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:12:19.936082 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:12:19.949753 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:12:20.031119 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:12:20.043052 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:12:20.047951 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:12:20.053292 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:12:20.105984 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:12:20.118384 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:12:20.136110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7124ca88-de1a-4e4c-b4c8-6c8120dce6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e088d0ba940>]}
[0m10:12:20.137919 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:12:20.139203 [info ] [MainThread]: 
[0m10:12:20.217213 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:12:20.218870 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:12:20.220356 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:12:20.221397 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:12:20.243133 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:12:20.244363 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:12:20.440592 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:12:20.555078 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:12:20.556492 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:12:20.569355 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:12:20.646143 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:12:20.649446 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:12:20.651362 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:12:20.654201 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:12:20.707816 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:12:20.712011 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:12:20.714006 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:12:20.716994 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:12:20.812209 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:12:20.815848 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:12:20.822104 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7124ca88-de1a-4e4c-b4c8-6c8120dce6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e088bc482b0>]}
[0m10:12:20.823259 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m10:12:20.824623 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:12:20.826489 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:12:20.827603 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:12:20.828670 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:12:20.830397 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:12:20.831916 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:12:20.833726 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:12:20.835065 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:12:20.836674 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:12:20.838818 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:12:20.841033 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:12:20.842794 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:12:20.855304 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:12:21.110345 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:12:21.114062 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:12:21.115938 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:12:21.118631 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:12:21.125522 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:12:21.127046 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:12:21.421924 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:12:21.428644 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:12:21.443008 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:12:21.445163 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:12:21.447646 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:12:21.451432 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:12:21.720117 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:12:21.735034 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:12:21.753173 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m10:12:21.756595 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:12:21.810277 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:12:21.817352 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:12:21.828160 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:12:21.834074 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.00s]
[0m10:12:21.837009 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:12:21.840067 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:12:21.845772 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.01s]
[0m10:12:21.849136 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:12:21.851917 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:12:21.853094 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:12:21.854845 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:12:21.856770 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:12:21.858510 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:12:21.906875 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:12:21.908874 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:12:21.910513 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:12:21.912156 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:12:21.913908 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:12:21.915695 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:12:21.917332 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:12:22.039569 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:12:22.050042 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:12:22.109742 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:12:22.112292 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:12:22.114369 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:12:22.126819 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:12:22.129802 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:12:22.315490 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:12:22.411072 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:12:22.517024 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:12:22.606052 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:12:22.620677 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:12:22.752892 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:12:22.911995 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:12:22.947602 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:12:23.022777 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:12:23.042887 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_7124ca88_de1a_4e4c_b4c8_6c8120dce6a6` 
  ...
[0m10:12:23.108003 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_7124ca88_de1a_4e4c_b4c8_6c8120dce6a6` 
  ...
[0m10:12:23.113156 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:12:23.117603 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:12:23.125367 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:12:23.134610 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:12:23.237406 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:12:23.250249 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7124ca88-de1a-4e4c-b4c8-6c8120dce6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e088c89f3a0>]}
[0m10:12:23.312752 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.34s]
[0m10:12:23.406122 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:12:23.446670 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_7124ca88_de1a_4e4c_b4c8_6c8120dce6a6`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:12:23.448375 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_7124ca88_de1a_4e4c_b4c8_6c8120dce6a6`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:12:24.104336 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.65 seconds
[0m10:12:24.120358 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.67 seconds
[0m10:12:24.205557 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_7124ca88_de1a_4e4c_b4c8_6c8120dce6a6'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:12:24.211253 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_7124ca88_de1a_4e4c_b4c8_6c8120dce6a6'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:12:24.222238 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:12:24.229597 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:12:24.248385 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:12:24.251092 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:12:24.254057 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_7124ca88_de1a_4e4c_b4c8_6c8120dce6a6`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:12:24.256412 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_7124ca88_de1a_4e4c_b4c8_6c8120dce6a6`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:12:24.334442 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:12:24.337770 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:12:24.343084 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_7124ca88_de1a_4e4c_b4c8_6c8120dce6a6`)
      
    ...
[0m10:12:24.348306 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_7124ca88_de1a_4e4c_b4c8_6c8120dce6a6`)
      
    ...
[0m10:12:24.378682 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:12:24.390897 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:12:24.394116 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:12:24.411307 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:12:24.414953 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:12:24.420736 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_7124ca88_de1a_4e4c_b4c8_6c8120dce6a6` 
    ...
[0m10:12:24.429799 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:12:24.432491 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:12:24.438741 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_7124ca88_de1a_4e4c_b4c8_6c8120dce6a6` 
    ...
[0m10:12:24.451687 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_7124ca88_de1a_4e4c_b4c8_6c8120dce6a6` 
  ...
[0m10:12:24.506594 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:12:24.519802 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:12:24.521720 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_7124ca88_de1a_4e4c_b4c8_6c8120dce6a6` 
  ...
[0m10:12:24.535383 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:12:24.539824 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:12:24.542426 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:12:24.611479 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:12:24.612934 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7124ca88-de1a-4e4c-b4c8-6c8120dce6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e088d215d90>]}
[0m10:12:24.617110 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.70s]
[0m10:12:24.619912 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:12:24.622685 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:12:24.629184 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7124ca88-de1a-4e4c-b4c8-6c8120dce6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e088c744130>]}
[0m10:12:24.631948 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.72s]
[0m10:12:24.634650 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:12:24.638455 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:12:24.639612 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:12:24.640851 [debug] [MainThread]: On list__mart: Close
[0m10:12:24.641945 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:12:24.643086 [debug] [MainThread]: On list__clean: Close
[0m10:12:24.644207 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:12:24.645378 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:12:24.646419 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:12:24.647494 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:12:24.648576 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:12:24.649722 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:12:24.650780 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:12:24.651903 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:12:24.654205 [info ] [MainThread]: 
[0m10:12:24.705649 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.53 seconds (5.53s).
[0m10:12:24.714200 [debug] [MainThread]: Command end result
[0m10:12:24.845489 [info ] [MainThread]: 
[0m10:12:24.846326 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:12:24.846937 [info ] [MainThread]: 
[0m10:12:24.847507 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:12:24.848768 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 8.32266, "process_in_blocks": "0", "process_kernel_time": 0.672076, "process_mem_max_rss": "115432", "process_out_blocks": "9744", "process_user_time": 6.623617}
[0m10:12:24.849467 [debug] [MainThread]: Command `dbt build` succeeded at 10:12:24.849281 after 8.32 seconds
[0m10:12:24.850083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e08905ec310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e088b3890a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e088dd810a0>]}
[0m10:12:24.850661 [debug] [MainThread]: Flushing usage events
[0m10:13:16.888934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768c22283310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768c1eee2b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768c1eee2a00>]}


============================== 10:13:16.898471 | fee7a90e-1828-49cc-bae3-eaed50f8c6c2 ==============================
[0m10:13:16.898471 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:13:16.899584 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'version_check': 'True', 'static_parser': 'True', 'use_colors': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'partial_parse': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'debug': 'False', 'no_print': 'None', 'log_format': 'default', 'quiet': 'False', 'fail_fast': 'False', 'log_cache_events': 'False', 'warn_error': 'None', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'write_json': 'True', 'indirect_selection': 'eager', 'profiles_dir': '.'}
[0m10:13:17.429528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fee7a90e-1828-49cc-bae3-eaed50f8c6c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768c1ee44fa0>]}
[0m10:13:17.622172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fee7a90e-1828-49cc-bae3-eaed50f8c6c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768c1eeb83d0>]}
[0m10:13:17.623623 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:13:18.089736 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:13:18.597987 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:13:18.598655 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:13:18.798622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fee7a90e-1828-49cc-bae3-eaed50f8c6c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768c1e646e80>]}
[0m10:13:19.283859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fee7a90e-1828-49cc-bae3-eaed50f8c6c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768c1e65b9a0>]}
[0m10:13:19.284773 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:13:19.288071 [info ] [MainThread]: 
[0m10:13:19.289105 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:13:19.300891 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:13:19.302706 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:13:19.405103 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:13:19.418824 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:13:20.164328 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:13:20.188259 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:13:20.192467 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:13:20.197092 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:13:20.286120 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:13:20.292503 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:13:20.302923 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:13:20.308636 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:13:20.315967 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:13:20.317676 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:13:20.395017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fee7a90e-1828-49cc-bae3-eaed50f8c6c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768c1ee44cd0>]}
[0m10:13:20.396942 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:13:20.398173 [info ] [MainThread]: 
[0m10:13:20.425079 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:13:20.426692 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:13:20.428150 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:13:20.429198 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:13:20.503394 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:13:20.504985 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:13:20.706824 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:13:20.771784 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:13:20.773207 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:13:20.787714 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:13:20.921640 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:13:20.925200 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:13:20.927241 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:13:20.930200 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:13:20.984862 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:13:20.988131 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:13:20.990046 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:13:20.992905 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:13:21.087702 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:13:21.091193 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:13:21.097283 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fee7a90e-1828-49cc-bae3-eaed50f8c6c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768c1d9b1e80>]}
[0m10:13:21.098478 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.67s]
[0m10:13:21.099889 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:13:21.102341 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:13:21.104090 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:13:21.105936 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:13:21.107509 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:13:21.109411 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:13:21.111383 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:13:21.113717 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:13:21.115849 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:13:21.117865 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:13:21.119615 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:13:21.121294 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:13:21.122964 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:13:21.299523 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:13:21.304158 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:13:21.305679 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:13:21.308352 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:13:21.315262 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:13:21.388134 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:13:21.611389 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:13:21.619763 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:13:21.686707 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:13:21.688900 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:13:21.691149 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:13:21.694018 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:13:21.950736 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:13:21.983329 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:13:21.988784 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:13:22.007398 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.89s]
[0m10:13:22.010639 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:13:22.013484 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:13:22.016139 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:13:22.024340 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.91s]
[0m10:13:22.027493 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:13:22.083382 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:13:22.089163 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.97s]
[0m10:13:22.091870 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:13:22.094659 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:13:22.095803 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:13:22.097455 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:13:22.099263 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:13:22.101133 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:13:22.102674 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:13:22.104003 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:13:22.106076 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:13:22.107890 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:13:22.109525 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:13:22.111176 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:13:22.198479 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:13:22.301368 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:13:22.306083 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:13:22.310262 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:13:22.312778 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:13:22.314889 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:13:22.316486 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:13:22.329797 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:13:22.498803 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:13:22.589310 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:13:22.627784 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:13:22.701682 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:13:22.716454 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:13:22.799572 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:13:22.896196 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:13:23.089451 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.16 seconds
[0m10:13:23.104254 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:13:23.129330 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:13:23.217701 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:13:23.327109 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:13:23.386379 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fee7a90e-1828-49cc-bae3-eaed50f8c6c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768c1e3cfd30>]}
[0m10:13:23.390139 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_fee7a90e_1828_49cc_bae3_eaed50f8c6c2` 
  ...
[0m10:13:23.396148 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_fee7a90e_1828_49cc_bae3_eaed50f8c6c2` 
  ...
[0m10:13:23.398657 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.28s]
[0m10:13:23.405555 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:13:23.408481 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:13:23.411184 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:13:23.812986 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_fee7a90e_1828_49cc_bae3_eaed50f8c6c2`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:13:23.817974 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_fee7a90e_1828_49cc_bae3_eaed50f8c6c2`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:13:24.092234 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.28 seconds
[0m10:13:24.094641 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.27 seconds
[0m10:13:24.186192 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_fee7a90e_1828_49cc_bae3_eaed50f8c6c2'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:13:24.197362 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_fee7a90e_1828_49cc_bae3_eaed50f8c6c2'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:13:24.206232 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:13:24.221499 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:13:24.219604 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:13:24.227619 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:13:24.230258 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_fee7a90e_1828_49cc_bae3_eaed50f8c6c2`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:13:24.232002 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_fee7a90e_1828_49cc_bae3_eaed50f8c6c2`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:13:24.315108 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:13:24.317737 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:13:24.321894 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_fee7a90e_1828_49cc_bae3_eaed50f8c6c2`)
      
    ...
[0m10:13:24.326071 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_fee7a90e_1828_49cc_bae3_eaed50f8c6c2`)
      
    ...
[0m10:13:24.354444 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:13:24.365358 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:13:24.373520 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:13:24.388724 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:13:24.399080 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:13:24.407084 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:13:24.404899 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_fee7a90e_1828_49cc_bae3_eaed50f8c6c2` 
    ...
[0m10:13:24.413833 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_fee7a90e_1828_49cc_bae3_eaed50f8c6c2` 
    ...
[0m10:13:24.424363 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:13:24.426935 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:13:24.485984 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_fee7a90e_1828_49cc_bae3_eaed50f8c6c2` 
  ...
[0m10:13:24.498261 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_fee7a90e_1828_49cc_bae3_eaed50f8c6c2` 
  ...
[0m10:13:24.504887 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:13:24.513150 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:13:24.520216 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:13:24.583011 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:13:24.589321 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:13:24.596066 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fee7a90e-1828-49cc-bae3-eaed50f8c6c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768c1ed628b0>]}
[0m10:13:24.598467 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:13:24.601053 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.49s]
[0m10:13:24.607695 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fee7a90e-1828-49cc-bae3-eaed50f8c6c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768c1edbf1c0>]}
[0m10:13:24.610390 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:13:24.612963 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.50s]
[0m10:13:24.616465 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:13:24.620216 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:13:24.621310 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:13:24.622482 [debug] [MainThread]: On list__mart: Close
[0m10:13:24.623565 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:13:24.624678 [debug] [MainThread]: On list__clean: Close
[0m10:13:24.625742 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:13:24.626869 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:13:24.627912 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:13:24.629065 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:13:24.630104 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:13:24.631308 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:13:24.632360 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:13:24.683617 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:13:24.686037 [info ] [MainThread]: 
[0m10:13:24.687444 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.40 seconds (5.40s).
[0m10:13:24.695572 [debug] [MainThread]: Command end result
[0m10:13:24.889481 [info ] [MainThread]: 
[0m10:13:24.891112 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:13:24.892343 [info ] [MainThread]: 
[0m10:13:24.893691 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:13:24.896112 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 8.201733, "process_in_blocks": "0", "process_kernel_time": 0.701431, "process_mem_max_rss": "114860", "process_out_blocks": "9744", "process_user_time": 6.677942}
[0m10:13:24.897531 [debug] [MainThread]: Command `dbt build` succeeded at 10:13:24.897152 after 8.20 seconds
[0m10:13:24.898787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768c22283310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768c1d14ef70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768c1d14ee50>]}
[0m10:13:24.899956 [debug] [MainThread]: Flushing usage events
[0m10:14:15.932497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ac4ef1e310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ac4bb8ab50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ac4bb8aa00>]}


============================== 10:14:15.941697 | e7ab40df-88e7-48e8-936f-4f947f596469 ==============================
[0m10:14:15.941697 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:14:15.942851 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'debug': 'False', 'fail_fast': 'False', 'introspect': 'True', 'partial_parse': 'True', 'log_format': 'default', 'invocation_command': 'dbt build --profiles-dir . --target local', 'cache_selected_only': 'False', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_path': '/workdir/transforms/04_btc/logs', 'empty': 'False', 'use_colors': 'True', 'static_parser': 'True', 'log_cache_events': 'False', 'target_path': 'None', 'profiles_dir': '.', 'use_experimental_parser': 'False', 'warn_error': 'None', 'no_print': 'None', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'quiet': 'False'}
[0m10:14:16.468104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e7ab40df-88e7-48e8-936f-4f947f596469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ac4bb3a100>]}
[0m10:14:16.662105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e7ab40df-88e7-48e8-936f-4f947f596469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ac4bbeb580>]}
[0m10:14:16.663409 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:14:17.127493 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:14:17.628135 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:14:17.628791 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:14:17.828686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e7ab40df-88e7-48e8-936f-4f947f596469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ac4b2deeb0>]}
[0m10:14:18.277831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e7ab40df-88e7-48e8-936f-4f947f596469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ac4b1d34c0>]}
[0m10:14:18.278776 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:14:18.282788 [info ] [MainThread]: 
[0m10:14:18.283980 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:14:18.331640 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:14:18.332666 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:14:18.361221 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:14:18.369395 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:14:18.981675 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:14:18.992491 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:14:19.000030 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:14:19.026277 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:14:19.071003 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:14:19.072739 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:14:19.150751 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:14:19.157322 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:14:19.171131 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:14:19.173636 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:14:19.248286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7ab40df-88e7-48e8-936f-4f947f596469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ac4ba5b130>]}
[0m10:14:19.250177 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:14:19.251525 [info ] [MainThread]: 
[0m10:14:19.329038 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:14:19.330232 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:14:19.331360 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:14:19.332104 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:14:19.348212 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:14:19.349670 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:14:19.528080 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:14:19.643098 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:14:19.644646 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:14:19.656631 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:14:19.771467 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:14:19.774966 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:14:19.826643 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:14:19.829989 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:14:19.835509 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:14:19.838255 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:14:19.840116 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:14:19.842888 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:14:19.935926 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:14:19.939310 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:14:19.945162 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7ab40df-88e7-48e8-936f-4f947f596469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ac4a572cd0>]}
[0m10:14:19.946297 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m10:14:19.947638 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:14:19.949661 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:14:19.950970 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:14:19.952479 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:14:19.954238 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:14:19.955916 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:14:19.957497 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:14:19.959424 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:14:19.961246 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:14:19.963307 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:14:19.965302 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:14:19.977484 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:14:19.979219 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:14:20.133865 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:14:20.137483 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:14:20.147470 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:14:20.149921 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:14:20.151476 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:14:20.226918 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:14:20.463300 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:14:20.466104 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:14:20.530162 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:14:20.533059 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:14:20.535213 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:14:20.538282 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:14:20.744510 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:14:20.747186 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:14:20.764992 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:14:20.829067 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.86s]
[0m10:14:20.831410 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:14:20.834119 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:14:20.836973 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:14:20.842772 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.88s]
[0m10:14:20.848760 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:14:20.856599 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:14:20.862292 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.91s]
[0m10:14:20.865126 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:14:20.867909 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:14:20.869132 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:14:20.870679 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:14:20.871906 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:14:20.874100 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:14:20.875701 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:14:20.877489 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:14:20.879417 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:14:20.881101 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:14:20.927674 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:14:20.929451 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:14:20.951840 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:14:20.970950 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:14:21.040116 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:14:21.054325 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:14:21.057190 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:14:21.058934 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:14:21.126929 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:14:21.251364 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:14:21.432263 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:14:21.532954 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:14:21.637372 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:14:21.743316 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:14:21.757914 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:14:21.833094 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:14:21.927703 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:14:21.972061 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:14:22.033521 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_e7ab40df_88e7_48e8_936f_4f947f596469` 
  ...
[0m10:14:22.042998 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_e7ab40df_88e7_48e8_936f_4f947f596469` 
  ...
[0m10:14:22.045299 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:14:22.050194 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:14:22.057063 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:14:22.065066 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:14:22.242848 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:14:22.327721 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:14:22.338034 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7ab40df-88e7-48e8-936f-4f947f596469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ac49ec83a0>]}
[0m10:14:22.345499 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.41s]
[0m10:14:22.363898 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:14:22.457089 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_e7ab40df_88e7_48e8_936f_4f947f596469`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:14:22.463360 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_e7ab40df_88e7_48e8_936f_4f947f596469`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:14:22.515980 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:14:22.527631 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:14:22.638046 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_e7ab40df_88e7_48e8_936f_4f947f596469'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:14:22.640448 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_e7ab40df_88e7_48e8_936f_4f947f596469'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:14:22.651769 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:14:22.654449 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:14:22.667681 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:14:22.673058 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:14:22.676141 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_e7ab40df_88e7_48e8_936f_4f947f596469`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:14:22.727258 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_e7ab40df_88e7_48e8_936f_4f947f596469`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:14:22.760882 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:14:22.765195 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_e7ab40df_88e7_48e8_936f_4f947f596469`)
      
    ...
[0m10:14:22.767641 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:14:22.773652 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_e7ab40df_88e7_48e8_936f_4f947f596469`)
      
    ...
[0m10:14:22.790711 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:14:22.800620 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:14:22.802391 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:14:22.810889 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:14:22.813073 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:14:22.828027 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:14:22.833934 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_e7ab40df_88e7_48e8_936f_4f947f596469` 
    ...
[0m10:14:22.839681 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_e7ab40df_88e7_48e8_936f_4f947f596469` 
    ...
[0m10:14:22.849937 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:14:22.852380 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:14:22.864915 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_e7ab40df_88e7_48e8_936f_4f947f596469` 
  ...
[0m10:14:22.876804 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_e7ab40df_88e7_48e8_936f_4f947f596469` 
  ...
[0m10:14:22.930733 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:14:22.938368 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:14:22.950750 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:14:22.959999 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:14:22.964236 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:14:22.970774 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7ab40df-88e7-48e8-936f-4f947f596469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ac4a66dd90>]}
[0m10:14:22.973216 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:14:23.026278 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.09s]
[0m10:14:23.033371 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7ab40df-88e7-48e8-936f-4f947f596469', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ac4a671a30>]}
[0m10:14:23.036018 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:14:23.038635 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.15s]
[0m10:14:23.041741 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:14:23.045646 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:14:23.046881 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:14:23.048086 [debug] [MainThread]: On list__mart: Close
[0m10:14:23.049227 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:14:23.050407 [debug] [MainThread]: On list__clean: Close
[0m10:14:23.051653 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:14:23.052843 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:14:23.053975 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:14:23.055168 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:14:23.056289 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:14:23.057442 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:14:23.058715 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:14:23.059992 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:14:23.062328 [info ] [MainThread]: 
[0m10:14:23.063836 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.78 seconds (4.78s).
[0m10:14:23.074047 [debug] [MainThread]: Command end result
[0m10:14:23.343663 [info ] [MainThread]: 
[0m10:14:23.345327 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:14:23.346707 [info ] [MainThread]: 
[0m10:14:23.348104 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:14:23.350782 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.607693, "process_in_blocks": "0", "process_kernel_time": 0.63494, "process_mem_max_rss": "114668", "process_out_blocks": "9744", "process_user_time": 6.470253}
[0m10:14:23.352321 [debug] [MainThread]: Command `dbt build` succeeded at 10:14:23.351918 after 7.61 seconds
[0m10:14:23.353606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ac4ef1e310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ac4b23c280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ac49e22cd0>]}
[0m10:14:23.354870 [debug] [MainThread]: Flushing usage events
[0m10:15:16.516975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b7828ca310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b77f526b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b77f5269d0>]}


============================== 10:15:16.527319 | c3596aee-8cad-4e77-836e-3cde03203b3d ==============================
[0m10:15:16.527319 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:15:16.528485 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'quiet': 'False', 'log_format': 'default', 'partial_parse': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'debug': 'False', 'static_parser': 'True', 'warn_error': 'None', 'profiles_dir': '.', 'target_path': 'None', 'indirect_selection': 'eager', 'log_path': '/workdir/transforms/04_btc/logs', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'introspect': 'True', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'fail_fast': 'False', 'no_print': 'None', 'version_check': 'True', 'empty': 'False'}
[0m10:15:17.309678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c3596aee-8cad-4e77-836e-3cde03203b3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b77f3f30a0>]}
[0m10:15:17.505441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c3596aee-8cad-4e77-836e-3cde03203b3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b77f6234f0>]}
[0m10:15:17.506819 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:15:17.928108 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:15:18.508337 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:15:18.509002 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:15:18.711809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c3596aee-8cad-4e77-836e-3cde03203b3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b77ec8beb0>]}
[0m10:15:19.196474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c3596aee-8cad-4e77-836e-3cde03203b3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b77eb804c0>]}
[0m10:15:19.197365 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:15:19.200620 [info ] [MainThread]: 
[0m10:15:19.201674 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:15:19.213959 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:15:19.214983 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:15:19.314277 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:15:19.313901 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:15:20.052920 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:15:20.058115 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:15:20.060696 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:15:20.064657 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:15:20.106775 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:15:20.118256 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:15:20.126182 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:15:20.131742 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:15:20.137832 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:15:20.139132 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:15:20.211296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c3596aee-8cad-4e77-836e-3cde03203b3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b77f57dc40>]}
[0m10:15:20.213689 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:15:20.215315 [info ] [MainThread]: 
[0m10:15:20.235893 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:15:20.237754 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:15:20.239021 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:15:20.239860 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:15:20.307796 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:15:20.308964 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:15:20.440841 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:15:20.585364 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:15:20.586769 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:15:20.605731 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:15:20.733236 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:15:20.736911 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:15:20.738780 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:15:20.741600 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:15:20.795508 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:15:20.799084 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:15:20.800975 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:15:20.803772 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:15:20.898845 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:15:20.902569 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:15:20.908673 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3596aee-8cad-4e77-836e-3cde03203b3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b77df85910>]}
[0m10:15:20.909840 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.67s]
[0m10:15:20.911202 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:15:20.913119 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:15:20.914274 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:15:20.915999 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:15:20.917593 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:15:20.919501 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:15:20.921510 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:15:20.923928 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:15:20.926009 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:15:20.928047 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:15:20.929824 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:15:20.931443 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:15:20.933152 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:15:21.115746 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:15:21.119492 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:15:21.121699 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:15:21.123309 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:15:21.129596 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:15:21.135995 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:15:21.407297 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:15:21.438012 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:15:21.492389 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:15:21.495089 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:15:21.497432 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:15:21.501642 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:15:21.819766 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:15:21.829449 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:15:21.836906 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:15:21.850050 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.93s]
[0m10:15:21.892488 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:15:21.895043 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:15:21.897925 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:15:21.904105 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.98s]
[0m10:15:21.911248 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:15:21.920876 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:15:21.926730 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.00s]
[0m10:15:21.929589 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:15:21.932281 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:15:21.933364 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:15:21.935162 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:15:21.937288 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:15:21.939455 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:15:21.941731 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:15:21.943592 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:15:21.945158 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:15:21.993321 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:15:21.994753 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:15:21.995899 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:15:21.997368 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:15:22.131861 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:15:22.133735 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:15:22.135998 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:15:22.138468 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:15:22.140261 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:15:22.206223 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:15:22.209872 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:15:22.329250 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:15:22.425856 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:15:22.513358 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:15:22.593401 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:15:22.602850 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:15:22.729850 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:15:22.825131 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:15:22.930444 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:15:22.994997 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:15:23.031213 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:15:23.114076 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c3596aee_8cad_4e77_836e_3cde03203b3d` 
  ...
[0m10:15:23.195080 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:15:23.197842 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c3596aee_8cad_4e77_836e_3cde03203b3d` 
  ...
[0m10:15:23.202615 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:15:23.206957 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:15:23.220074 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:15:23.238272 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3596aee-8cad-4e77-836e-3cde03203b3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b77e88d7c0>]}
[0m10:15:23.302823 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.25s]
[0m10:15:23.325012 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:15:23.529644 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_c3596aee_8cad_4e77_836e_3cde03203b3d`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:15:23.533251 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_c3596aee_8cad_4e77_836e_3cde03203b3d`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:15:23.592384 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:15:23.595000 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:15:23.706226 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_c3596aee_8cad_4e77_836e_3cde03203b3d'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:15:23.708788 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_c3596aee_8cad_4e77_836e_3cde03203b3d'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:15:23.718137 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:15:23.726105 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:15:23.739337 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:15:23.797457 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:15:23.800138 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_c3596aee_8cad_4e77_836e_3cde03203b3d`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:15:23.802379 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_c3596aee_8cad_4e77_836e_3cde03203b3d`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:15:23.836350 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:15:23.840719 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c3596aee_8cad_4e77_836e_3cde03203b3d`)
      
    ...
[0m10:15:23.843295 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:15:23.849299 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c3596aee_8cad_4e77_836e_3cde03203b3d`)
      
    ...
[0m10:15:23.872891 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:15:23.883360 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:15:23.892120 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:15:23.907917 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:15:23.905465 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:15:23.914316 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c3596aee_8cad_4e77_836e_3cde03203b3d` 
    ...
[0m10:15:23.924346 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:15:23.927241 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:15:23.930965 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c3596aee_8cad_4e77_836e_3cde03203b3d` 
    ...
[0m10:15:23.937607 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c3596aee_8cad_4e77_836e_3cde03203b3d` 
  ...
[0m10:15:23.943493 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:15:23.993402 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:15:24.012090 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:15:24.019182 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c3596aee_8cad_4e77_836e_3cde03203b3d` 
  ...
[0m10:15:24.025808 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:15:24.028633 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:15:24.035431 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3596aee-8cad-4e77-836e-3cde03203b3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b77f516f40>]}
[0m10:15:24.100227 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:15:24.102874 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.09s]
[0m10:15:24.107499 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:15:24.110567 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:15:24.117603 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3596aee-8cad-4e77-836e-3cde03203b3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b77e9251f0>]}
[0m10:15:24.120058 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.17s]
[0m10:15:24.122853 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:15:24.126814 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:15:24.127972 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:15:24.129143 [debug] [MainThread]: On list__mart: Close
[0m10:15:24.130249 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:15:24.131394 [debug] [MainThread]: On list__clean: Close
[0m10:15:24.132501 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:15:24.133668 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:15:24.134716 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:15:24.135846 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:15:24.136908 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:15:24.138067 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:15:24.139103 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:15:24.140161 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:15:24.192799 [info ] [MainThread]: 
[0m10:15:24.194397 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.99 seconds (4.99s).
[0m10:15:24.201868 [debug] [MainThread]: Command end result
[0m10:15:24.402472 [info ] [MainThread]: 
[0m10:15:24.404203 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:15:24.405518 [info ] [MainThread]: 
[0m10:15:24.406923 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:15:24.409682 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 8.096266, "process_in_blocks": "0", "process_kernel_time": 0.73485, "process_mem_max_rss": "114732", "process_out_blocks": "9744", "process_user_time": 6.647599}
[0m10:15:24.411249 [debug] [MainThread]: Command `dbt build` succeeded at 10:15:24.410838 after 8.10 seconds
[0m10:15:24.412706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b7828ca310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b77f3ab280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b7813b9c40>]}
[0m10:15:24.414007 [debug] [MainThread]: Flushing usage events
[0m10:16:16.897502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788bbf9e6310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788bbc63fb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788bbc63fa30>]}


============================== 10:16:16.907049 | 132197cf-e771-4565-be30-5737f3fa4df8 ==============================
[0m10:16:16.907049 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:16:16.908094 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'no_print': 'None', 'write_json': 'True', 'debug': 'False', 'static_parser': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'profiles_dir': '.', 'partial_parse': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_colors': 'True', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'use_experimental_parser': 'False', 'version_check': 'True', 'quiet': 'False', 'fail_fast': 'False', 'target_path': 'None', 'warn_error': 'None', 'empty': 'False', 'log_cache_events': 'False'}
[0m10:16:17.438495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '132197cf-e771-4565-be30-5737f3fa4df8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788bbc5389d0>]}
[0m10:16:17.629604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '132197cf-e771-4565-be30-5737f3fa4df8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788bbc679970>]}
[0m10:16:17.630881 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:16:18.095287 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:16:18.624549 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:16:18.625187 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:16:18.824129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '132197cf-e771-4565-be30-5737f3fa4df8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788bbbda5eb0>]}
[0m10:16:19.325366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '132197cf-e771-4565-be30-5737f3fa4df8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788bbbc9a4c0>]}
[0m10:16:19.326242 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:16:19.329353 [info ] [MainThread]: 
[0m10:16:19.330367 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:16:19.342060 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:16:19.343808 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:16:19.425898 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:16:19.490058 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:16:20.266108 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:16:20.297808 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:16:20.304432 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:16:20.315099 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:16:20.400492 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:16:20.402511 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:16:20.417981 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:16:20.423967 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:16:20.432716 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:16:20.438328 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:16:20.509154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '132197cf-e771-4565-be30-5737f3fa4df8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788bbb8e8f10>]}
[0m10:16:20.511149 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:16:20.512470 [info ] [MainThread]: 
[0m10:16:20.539002 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:16:20.589381 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:16:20.591051 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:16:20.592137 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:16:20.616421 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:16:20.617845 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:16:20.812502 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:16:20.888449 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:16:20.889995 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:16:20.903139 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:16:21.033987 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:16:21.037420 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:16:21.039424 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:16:21.091645 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:16:21.097306 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:16:21.100252 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:16:21.102151 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:16:21.105013 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:16:21.199984 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:16:21.203434 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:16:21.209760 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132197cf-e771-4565-be30-5737f3fa4df8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788bbb02ff70>]}
[0m10:16:21.210971 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.62s]
[0m10:16:21.212289 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:16:21.214728 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:16:21.216127 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:16:21.217775 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:16:21.219181 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:16:21.221125 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:16:21.223108 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:16:21.224856 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:16:21.226299 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:16:21.228353 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:16:21.229746 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:16:21.230926 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:16:21.232666 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:16:21.415388 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:16:21.427852 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:16:21.421387 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:16:21.431744 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:16:21.433846 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:16:21.510035 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:16:21.616703 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:16:21.617755 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:16:21.623350 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:16:21.624944 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:16:21.625936 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:16:21.626826 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:16:21.869455 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:16:21.894612 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:16:21.914719 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.69s]
[0m10:16:21.922818 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:16:21.928782 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:16:21.931595 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:16:22.000116 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:16:22.003097 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:16:22.008785 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.78s]
[0m10:16:22.014728 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.79s]
[0m10:16:22.017969 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:16:22.020903 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:16:22.023986 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:16:22.025234 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:16:22.026438 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:16:22.028156 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:16:22.029438 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:16:22.031206 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:16:22.033564 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:16:22.035459 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:16:22.037579 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:16:22.039141 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:16:22.046235 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:16:22.095268 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:16:22.192931 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:16:22.206405 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:16:22.208942 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:16:22.212158 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:16:22.214975 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:16:22.299521 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:16:22.326120 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:16:22.410265 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:16:22.521177 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:16:22.615479 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:16:22.700514 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:16:22.709983 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:16:22.828609 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:16:22.918452 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:16:23.106061 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_132197cf_e771_4565_be30_5737f3fa4df8` 
  ...
[0m10:16:23.115621 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:16:23.128514 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:16:23.132857 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:16:23.212846 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_132197cf_e771_4565_be30_5737f3fa4df8` 
  ...
[0m10:16:23.290208 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:16:23.309997 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:16:23.400086 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:16:23.425368 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:16:23.504183 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132197cf-e771-4565-be30-5737f3fa4df8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788bbb8cf640>]}
[0m10:16:23.518951 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.45s]
[0m10:16:23.602626 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:16:23.593288 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_132197cf_e771_4565_be30_5737f3fa4df8`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:16:23.606825 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_132197cf_e771_4565_be30_5737f3fa4df8`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:16:23.647501 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:16:23.663071 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:16:23.720790 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_132197cf_e771_4565_be30_5737f3fa4df8'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:16:23.723203 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_132197cf_e771_4565_be30_5737f3fa4df8'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:16:23.732931 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:16:23.735936 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:16:23.803099 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:16:23.811805 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:16:23.814916 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_132197cf_e771_4565_be30_5737f3fa4df8`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:16:23.817172 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_132197cf_e771_4565_be30_5737f3fa4df8`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:16:23.850117 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:16:23.853028 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:16:23.857268 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_132197cf_e771_4565_be30_5737f3fa4df8`)
      
    ...
[0m10:16:23.861309 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_132197cf_e771_4565_be30_5737f3fa4df8`)
      
    ...
[0m10:16:23.913040 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:16:23.919551 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:16:23.922607 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:16:23.941220 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:16:23.938322 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:16:23.948075 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_132197cf_e771_4565_be30_5737f3fa4df8` 
    ...
[0m10:16:23.958037 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:16:23.993666 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:16:23.993182 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_132197cf_e771_4565_be30_5737f3fa4df8` 
    ...
[0m10:16:24.003899 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_132197cf_e771_4565_be30_5737f3fa4df8` 
  ...
[0m10:16:24.008355 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:16:24.018639 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:16:24.021067 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:16:24.034716 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_132197cf_e771_4565_be30_5737f3fa4df8` 
  ...
[0m10:16:24.037362 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:16:24.095017 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132197cf-e771-4565-be30-5737f3fa4df8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788bba961f40>]}
[0m10:16:24.098147 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:16:24.100899 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.07s]
[0m10:16:24.114165 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:16:24.116525 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:16:24.121225 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:16:24.127274 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132197cf-e771-4565-be30-5737f3fa4df8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788bbb8d3250>]}
[0m10:16:24.129706 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.09s]
[0m10:16:24.132519 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:16:24.136499 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:16:24.188561 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:16:24.189923 [debug] [MainThread]: On list__clean: Close
[0m10:16:24.191054 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:16:24.192136 [debug] [MainThread]: On list__mart: Close
[0m10:16:24.193179 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:16:24.194295 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:16:24.195365 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:16:24.196587 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:16:24.197939 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:16:24.199031 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:16:24.200094 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:16:24.201203 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:16:24.203510 [info ] [MainThread]: 
[0m10:16:24.204985 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.87 seconds (4.87s).
[0m10:16:24.213083 [debug] [MainThread]: Command end result
[0m10:16:24.431175 [info ] [MainThread]: 
[0m10:16:24.432267 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:16:24.433049 [info ] [MainThread]: 
[0m10:16:24.433923 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:16:24.435668 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.731633, "process_in_blocks": "0", "process_kernel_time": 0.684925, "process_mem_max_rss": "115224", "process_out_blocks": "9744", "process_user_time": 6.544737}
[0m10:16:24.436637 [debug] [MainThread]: Command `dbt build` succeeded at 10:16:24.436350 after 7.73 seconds
[0m10:16:24.437414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788bbf9e6310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788bba8ac700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x788bba8ac640>]}
[0m10:16:24.489937 [debug] [MainThread]: Flushing usage events
[0m10:17:15.955523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e96ae209310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e96aae68b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e96aae68a30>]}


============================== 10:17:16.015498 | c093fb5c-25ef-479e-ac8c-f97960132978 ==============================
[0m10:17:16.015498 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:17:16.016618 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'log_format': 'default', 'quiet': 'False', 'use_experimental_parser': 'False', 'introspect': 'True', 'log_cache_events': 'False', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_colors': 'True', 'version_check': 'True', 'warn_error': 'None', 'no_print': 'None', 'write_json': 'True', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '.', 'indirect_selection': 'eager', 'debug': 'False', 'cache_selected_only': 'False', 'partial_parse': 'True', 'printer_width': '80', 'log_path': '/workdir/transforms/04_btc/logs'}
[0m10:17:16.546081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c093fb5c-25ef-479e-ac8c-f97960132978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e96aadca7c0>]}
[0m10:17:16.741231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c093fb5c-25ef-479e-ac8c-f97960132978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e96ac096fa0>]}
[0m10:17:16.742471 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:17:17.158243 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:17:17.709828 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:17:17.710494 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:17:17.859508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c093fb5c-25ef-479e-ac8c-f97960132978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e96aa5cde80>]}
[0m10:17:18.352033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c093fb5c-25ef-479e-ac8c-f97960132978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e96aa47c3d0>]}
[0m10:17:18.352953 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:17:18.356394 [info ] [MainThread]: 
[0m10:17:18.357458 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:17:18.409754 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:17:18.411213 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:17:18.435751 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:17:18.439710 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:17:19.024745 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:17:19.033735 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:17:19.042839 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:17:19.052379 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:17:19.138315 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:17:19.149967 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:17:19.216316 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:17:19.213841 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:17:19.223222 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:17:19.224509 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:17:19.239385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c093fb5c-25ef-479e-ac8c-f97960132978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e96aa107760>]}
[0m10:17:19.240473 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:17:19.241137 [info ] [MainThread]: 
[0m10:17:19.254159 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:17:19.255633 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:17:19.256743 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:17:19.257485 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:17:19.327065 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:17:19.328806 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:17:19.524634 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:17:19.591362 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:17:19.592871 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:17:19.604954 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:17:19.737359 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:17:19.741272 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:17:19.743210 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:17:19.746114 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:17:19.751734 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:17:19.754648 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:17:19.756485 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:17:19.759279 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:17:19.851043 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:17:19.854448 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:17:19.860270 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c093fb5c-25ef-479e-ac8c-f97960132978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e96aa1825b0>]}
[0m10:17:19.910213 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m10:17:19.911708 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:17:19.913889 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:17:19.915114 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:17:19.916281 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:17:19.917739 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:17:19.919300 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:17:19.920728 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:17:19.922078 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:17:19.923904 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:17:19.925583 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:17:19.942876 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:17:19.958244 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:17:20.021939 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:17:20.033129 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:17:20.049020 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:17:20.116346 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:17:20.118808 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:17:20.141675 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:17:20.148412 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:17:20.345853 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:17:20.435378 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:17:20.449137 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:17:20.451967 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:17:20.454123 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:17:20.455815 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:17:20.725518 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:17:20.740616 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:17:20.755674 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.81s]
[0m10:17:20.763493 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:17:20.814070 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:17:20.819183 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:17:20.829497 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:17:20.835513 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.91s]
[0m10:17:20.838377 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:17:20.841413 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:17:20.847710 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.93s]
[0m10:17:20.850514 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:17:20.853254 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:17:20.854489 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:17:20.856079 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:17:20.857519 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:17:20.859242 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:17:20.860449 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:17:20.861809 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:17:20.863258 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:17:20.910791 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:17:20.912446 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:17:20.914118 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:17:20.931346 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:17:20.956279 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:17:21.027988 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:17:21.042210 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:17:21.044807 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:17:21.055678 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:17:21.057262 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:17:21.133922 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:17:21.251767 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:17:21.414354 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:17:21.510318 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:17:21.535503 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:17:21.549982 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:17:21.647442 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:17:21.749616 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:17:21.821127 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:17:21.851612 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:17:21.854530 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c093fb5c_25ef_479e_ac8c_f97960132978` 
  ...
[0m10:17:21.925697 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c093fb5c_25ef_479e_ac8c_f97960132978` 
  ...
[0m10:17:21.927389 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:17:21.930372 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:17:22.015878 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:17:21.958178 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:17:22.126156 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:17:22.144358 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c093fb5c-25ef-479e-ac8c-f97960132978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e96aa351d30>]}
[0m10:17:22.228981 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.23s]
[0m10:17:22.247629 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:17:22.347398 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_c093fb5c_25ef_479e_ac8c_f97960132978`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:17:22.355616 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_c093fb5c_25ef_479e_ac8c_f97960132978`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:17:22.440653 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:17:22.455924 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:17:22.523304 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_c093fb5c_25ef_479e_ac8c_f97960132978'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:17:22.539234 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_c093fb5c_25ef_479e_ac8c_f97960132978'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:17:22.545861 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:17:22.553770 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:17:22.621876 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:17:22.624703 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:17:22.627705 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_c093fb5c_25ef_479e_ac8c_f97960132978`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:17:22.631831 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_c093fb5c_25ef_479e_ac8c_f97960132978`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:17:22.660109 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:17:22.662931 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:17:22.667135 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c093fb5c_25ef_479e_ac8c_f97960132978`)
      
    ...
[0m10:17:22.671473 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c093fb5c_25ef_479e_ac8c_f97960132978`)
      
    ...
[0m10:17:22.707489 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:17:22.709966 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:17:22.723182 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:17:22.733157 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:17:22.743206 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:17:22.751178 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:17:22.749432 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c093fb5c_25ef_479e_ac8c_f97960132978` 
    ...
[0m10:17:22.757982 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c093fb5c_25ef_479e_ac8c_f97960132978` 
    ...
[0m10:17:22.817191 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:17:22.819906 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:17:22.832597 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c093fb5c_25ef_479e_ac8c_f97960132978` 
  ...
[0m10:17:22.844849 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c093fb5c_25ef_479e_ac8c_f97960132978` 
  ...
[0m10:17:22.852162 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:17:22.854923 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:17:22.915930 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:17:22.928396 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:17:22.934483 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:17:22.942283 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:17:22.943527 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c093fb5c-25ef-479e-ac8c-f97960132978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e96a99abc40>]}
[0m10:17:22.949554 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c093fb5c-25ef-479e-ac8c-f97960132978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e96a98fb5e0>]}
[0m10:17:22.952898 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.08s]
[0m10:17:22.955869 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.09s]
[0m10:17:23.009786 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:17:23.013037 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:17:23.018085 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:17:23.019302 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:17:23.020506 [debug] [MainThread]: On list__mart: Close
[0m10:17:23.021694 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:17:23.022846 [debug] [MainThread]: On list__clean: Close
[0m10:17:23.023961 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:17:23.025135 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:17:23.026247 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:17:23.027425 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:17:23.028563 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:17:23.029726 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:17:23.030903 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:17:23.032068 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:17:23.034381 [info ] [MainThread]: 
[0m10:17:23.035853 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.68 seconds (4.68s).
[0m10:17:23.043939 [debug] [MainThread]: Command end result
[0m10:17:23.256513 [info ] [MainThread]: 
[0m10:17:23.257384 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:17:23.258085 [info ] [MainThread]: 
[0m10:17:23.309714 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:17:23.312641 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.4981737, "process_in_blocks": "0", "process_kernel_time": 0.618501, "process_mem_max_rss": "114768", "process_out_blocks": "9744", "process_user_time": 6.416957}
[0m10:17:23.314276 [debug] [MainThread]: Command `dbt build` succeeded at 10:17:23.313853 after 7.50 seconds
[0m10:17:23.315591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e96ae209310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e96aa5f0130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e96ac196a30>]}
[0m10:17:23.316865 [debug] [MainThread]: Flushing usage events
[0m10:18:15.741902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a10d8656310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a10d52acb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a10d52aca00>]}


============================== 10:18:15.751103 | d4df0b62-e06a-49e9-8c17-595ad526096d ==============================
[0m10:18:15.751103 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:18:15.752193 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'version_check': 'True', 'warn_error': 'None', 'use_experimental_parser': 'False', 'static_parser': 'True', 'no_print': 'None', 'log_format': 'default', 'indirect_selection': 'eager', 'fail_fast': 'False', 'empty': 'False', 'write_json': 'True', 'quiet': 'False', 'debug': 'False', 'profiles_dir': '.', 'invocation_command': 'dbt build --profiles-dir . --target local', 'target_path': 'None', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'printer_width': '80'}
[0m10:18:16.353396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd4df0b62-e06a-49e9-8c17-595ad526096d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a10d6d8e5b0>]}
[0m10:18:16.546812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd4df0b62-e06a-49e9-8c17-595ad526096d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a10d5717ca0>]}
[0m10:18:16.548079 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:18:17.014477 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:18:17.522813 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:18:17.523478 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:18:17.722498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd4df0b62-e06a-49e9-8c17-595ad526096d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a10d4a12eb0>]}
[0m10:18:18.161506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd4df0b62-e06a-49e9-8c17-595ad526096d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a10d4900dc0>]}
[0m10:18:18.162353 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:18:18.165585 [info ] [MainThread]: 
[0m10:18:18.166623 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:18:18.215810 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:18:18.222915 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:18:18.316794 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:18:18.319166 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:18:18.881994 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:18:18.889205 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:18:18.907753 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:18:18.919180 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:18:18.950009 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:18:19.012407 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__clean'
[0m10:18:19.021464 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:18:19.022957 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:18:19.031013 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:18:19.157807 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:18:19.168565 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:18:19.180505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd4df0b62-e06a-49e9-8c17-595ad526096d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a10d48d2d30>]}
[0m10:18:19.182401 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:18:19.183881 [info ] [MainThread]: 
[0m10:18:19.228544 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:18:19.229703 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:18:19.230786 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:18:19.231504 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:18:19.249240 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:18:19.250339 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:18:19.441254 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:18:19.668278 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:18:19.669673 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:18:19.681087 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:18:19.693450 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:18:19.696485 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:18:19.698324 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:18:19.701145 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:18:19.706841 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:18:19.710153 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:18:19.712086 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:18:19.715040 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:18:19.807644 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:18:19.811290 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:18:19.817242 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4df0b62-e06a-49e9-8c17-595ad526096d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a10d46cb880>]}
[0m10:18:19.818403 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m10:18:19.819838 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:18:19.822160 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:18:19.823305 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:18:19.825117 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:18:19.826323 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:18:19.827743 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:18:19.829713 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:18:19.832076 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:18:19.834443 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:18:19.835444 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:18:19.837139 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:18:19.838763 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:18:19.840455 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:18:20.047596 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:18:20.049894 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:18:20.106969 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:18:20.109530 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:18:20.117146 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:18:20.139600 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:18:20.338078 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:18:20.429948 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:18:20.440977 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:18:20.443795 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:18:20.445577 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:18:20.447211 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:18:20.728509 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:18:20.731351 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:18:20.736193 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:18:20.750711 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:18:20.753681 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:18:20.808119 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:18:20.822948 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.99s]
[0m10:18:20.828869 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.99s]
[0m10:18:20.834879 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.00s]
[0m10:18:20.838158 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:18:20.841127 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:18:20.844019 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:18:20.847877 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:18:20.849048 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:18:20.850629 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:18:20.851913 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:18:20.854132 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:18:20.856123 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:18:20.908259 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:18:20.910161 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:18:20.911992 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:18:20.913762 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:18:20.915436 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:18:20.927567 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:18:21.010365 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:18:21.026593 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:18:21.035843 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:18:21.037832 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:18:21.039038 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:18:21.117664 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:18:21.218680 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:18:21.317698 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:18:21.423311 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:18:21.547656 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:18:21.728628 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:18:21.748550 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:18:21.851101 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:18:21.943397 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:18:22.023762 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_d4df0b62_e06a_49e9_8c17_595ad526096d` 
  ...
[0m10:18:22.031765 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_d4df0b62_e06a_49e9_8c17_595ad526096d` 
  ...
[0m10:18:22.037660 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:18:22.040479 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:18:22.042391 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:18:22.120016 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:18:22.217633 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:18:22.306872 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:18:22.337456 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:18:22.421880 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4df0b62-e06a-49e9-8c17-595ad526096d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a10d479e8b0>]}
[0m10:18:22.424662 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_d4df0b62_e06a_49e9_8c17_595ad526096d`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:18:22.426789 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_d4df0b62_e06a_49e9_8c17_595ad526096d`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:18:22.428806 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.51s]
[0m10:18:22.434393 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:18:22.458566 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:18:22.473911 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:18:22.528064 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_d4df0b62_e06a_49e9_8c17_595ad526096d'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:18:22.540687 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_d4df0b62_e06a_49e9_8c17_595ad526096d'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:18:22.549633 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:18:22.552188 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:18:22.614439 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:18:22.620134 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:18:22.623305 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_d4df0b62_e06a_49e9_8c17_595ad526096d`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:18:22.627234 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_d4df0b62_e06a_49e9_8c17_595ad526096d`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:18:22.657652 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:18:22.660335 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:18:22.664256 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_d4df0b62_e06a_49e9_8c17_595ad526096d`)
      
    ...
[0m10:18:22.668487 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_d4df0b62_e06a_49e9_8c17_595ad526096d`)
      
    ...
[0m10:18:22.695688 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:18:22.706862 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:18:22.708922 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:18:22.721116 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:18:22.723967 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:18:22.732133 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_d4df0b62_e06a_49e9_8c17_595ad526096d` 
    ...
[0m10:18:22.735147 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:18:22.742795 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_d4df0b62_e06a_49e9_8c17_595ad526096d` 
    ...
[0m10:18:22.747359 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:18:22.808074 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:18:22.813761 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_d4df0b62_e06a_49e9_8c17_595ad526096d` 
  ...
[0m10:18:22.826435 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_d4df0b62_e06a_49e9_8c17_595ad526096d` 
  ...
[0m10:18:22.832964 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:18:22.835839 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:18:22.853495 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:18:22.913552 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:18:22.918984 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:18:22.921481 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:18:22.927935 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4df0b62-e06a-49e9-8c17-595ad526096d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a10d3c630a0>]}
[0m10:18:22.934037 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4df0b62-e06a-49e9-8c17-595ad526096d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a10d64c9220>]}
[0m10:18:22.936623 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.07s]
[0m10:18:22.939459 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.02s]
[0m10:18:22.942608 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:18:22.945437 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:18:22.950223 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:18:22.951366 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:18:22.952521 [debug] [MainThread]: On list__mart: Close
[0m10:18:22.953614 [debug] [MainThread]: Connection 'list_' was left open.
[0m10:18:22.954685 [debug] [MainThread]: On list_: Close
[0m10:18:23.007001 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:18:23.008310 [debug] [MainThread]: On list__clean: Close
[0m10:18:23.009627 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:18:23.010886 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:18:23.012131 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:18:23.013308 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:18:23.014497 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:18:23.015804 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:18:23.016924 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:18:23.018084 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:18:23.020637 [info ] [MainThread]: 
[0m10:18:23.022106 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.85 seconds (4.85s).
[0m10:18:23.030791 [debug] [MainThread]: Command end result
[0m10:18:23.250151 [info ] [MainThread]: 
[0m10:18:23.251442 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:18:23.252430 [info ] [MainThread]: 
[0m10:18:23.253479 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:18:23.256030 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.7056956, "process_in_blocks": "0", "process_kernel_time": 0.686839, "process_mem_max_rss": "114696", "process_out_blocks": "9744", "process_user_time": 6.487472}
[0m10:18:23.307704 [debug] [MainThread]: Command `dbt build` succeeded at 10:18:23.307156 after 7.76 seconds
[0m10:18:23.309055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a10d8656310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a10d6d8e5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a10d5717ca0>]}
[0m10:18:23.310361 [debug] [MainThread]: Flushing usage events
[0m10:19:17.117028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746adf24a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746adbea7b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746adbea79d0>]}


============================== 10:19:17.126551 | b2ca5578-9e5b-4541-b3f5-e86f0a63d6b9 ==============================
[0m10:19:17.126551 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:19:17.127615 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'empty': 'False', 'printer_width': '80', 'write_json': 'True', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_colors': 'True', 'fail_fast': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'no_print': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'version_check': 'True', 'log_format': 'default', 'debug': 'False', 'target_path': 'None', 'introspect': 'True', 'indirect_selection': 'eager', 'partial_parse': 'True', 'quiet': 'False'}
[0m10:19:17.702802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b2ca5578-9e5b-4541-b3f5-e86f0a63d6b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746adbe6e9a0>]}
[0m10:19:17.896557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b2ca5578-9e5b-4541-b3f5-e86f0a63d6b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746adbd75b50>]}
[0m10:19:17.897904 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:19:18.316832 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:19:18.831603 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:19:18.832249 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:19:19.033030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b2ca5578-9e5b-4541-b3f5-e86f0a63d6b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746adb60dee0>]}
[0m10:19:19.514399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b2ca5578-9e5b-4541-b3f5-e86f0a63d6b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746adb638850>]}
[0m10:19:19.515343 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:19:19.518786 [info ] [MainThread]: 
[0m10:19:19.520318 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:19:19.533007 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:19:19.539934 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:19:19.632749 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:19:19.630724 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:19:20.397517 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:19:20.406265 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:19:20.412508 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:19:20.435182 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:19:20.522827 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:19:20.534635 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__clean'
[0m10:19:20.540102 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:19:20.596844 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:19:20.607427 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:19:20.716111 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:19:20.725966 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:19:20.738407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b2ca5578-9e5b-4541-b3f5-e86f0a63d6b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746adb5cc400>]}
[0m10:19:20.740287 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:19:20.741672 [info ] [MainThread]: 
[0m10:19:20.800017 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:19:20.801162 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:19:20.802249 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:19:20.803003 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:19:20.819465 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:19:20.820956 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:19:21.002479 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:19:21.176791 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:19:21.178187 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:19:21.189967 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:19:21.204722 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:19:21.207916 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:19:21.209832 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:19:21.212888 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:19:21.218741 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:19:21.221939 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:19:21.223837 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:19:21.226774 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:19:21.321548 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:19:21.325012 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:19:21.331046 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2ca5578-9e5b-4541-b3f5-e86f0a63d6b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746adb2c6820>]}
[0m10:19:21.332194 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m10:19:21.333614 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:19:21.335449 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:19:21.336639 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:19:21.337935 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:19:21.338747 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:19:21.340110 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:19:21.342399 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:19:21.344385 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:19:21.395243 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:19:21.397306 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:19:21.399486 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:19:21.401206 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:19:21.423290 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:19:21.436172 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:19:21.500504 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:19:21.518717 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:19:21.521330 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:19:21.523053 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:19:21.616718 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:19:21.807285 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:19:21.809276 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:19:21.819782 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:19:21.822543 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:19:21.824174 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:19:21.826018 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:19:22.137260 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:19:22.148979 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:19:22.154120 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:19:22.157031 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:19:22.198820 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:19:22.217031 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:19:22.213767 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.87s]
[0m10:19:22.222907 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.82s]
[0m10:19:22.229348 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.88s]
[0m10:19:22.232379 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:19:22.235497 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:19:22.238485 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:19:22.242712 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:19:22.245478 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:19:22.243944 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:19:22.295669 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:19:22.297446 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:19:22.299667 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:19:22.301958 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:19:22.303893 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:19:22.305564 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:19:22.307150 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:19:22.329583 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:19:22.402519 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:19:22.404195 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:19:22.422250 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:19:22.434773 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:19:22.439910 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:19:22.501110 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:19:22.600958 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:19:22.644141 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:19:22.796140 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:19:22.920788 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:19:23.013605 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:19:23.114599 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:19:23.209068 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:19:23.225612 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b2ca5578_9e5b_4541_b3f5_e86f0a63d6b9` 
  ...
[0m10:19:23.305720 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b2ca5578_9e5b_4541_b3f5_e86f0a63d6b9` 
  ...
[0m10:19:23.308398 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:19:23.311128 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:19:23.325472 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:19:23.328105 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:19:23.429715 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:19:23.506226 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:19:23.603519 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:19:23.720008 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:19:23.803650 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_b2ca5578_9e5b_4541_b3f5_e86f0a63d6b9`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:19:23.813103 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_b2ca5578_9e5b_4541_b3f5_e86f0a63d6b9`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:19:23.818117 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:19:23.825664 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2ca5578-9e5b-4541-b3f5-e86f0a63d6b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746ada98ce50>]}
[0m10:19:23.828083 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.52s]
[0m10:19:23.830967 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:19:23.841942 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:19:23.896855 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:19:23.937278 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_b2ca5578_9e5b_4541_b3f5_e86f0a63d6b9'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:19:23.998362 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_b2ca5578_9e5b_4541_b3f5_e86f0a63d6b9'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:19:24.005121 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:19:24.010238 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:19:24.023352 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:19:24.029423 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:19:24.032562 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_b2ca5578_9e5b_4541_b3f5_e86f0a63d6b9`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:19:24.036439 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_b2ca5578_9e5b_4541_b3f5_e86f0a63d6b9`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:19:24.096803 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:19:24.070437 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:19:24.101061 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b2ca5578_9e5b_4541_b3f5_e86f0a63d6b9`)
      
    ...
[0m10:19:24.105088 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b2ca5578_9e5b_4541_b3f5_e86f0a63d6b9`)
      
    ...
[0m10:19:24.132545 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:19:24.137519 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:19:24.139465 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:19:24.150485 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:19:24.153219 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:19:24.160971 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b2ca5578_9e5b_4541_b3f5_e86f0a63d6b9` 
    ...
[0m10:19:24.195975 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:19:24.198670 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:19:24.204732 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b2ca5578_9e5b_4541_b3f5_e86f0a63d6b9` 
    ...
[0m10:19:24.217207 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b2ca5578_9e5b_4541_b3f5_e86f0a63d6b9` 
  ...
[0m10:19:24.224870 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:19:24.227305 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:19:24.240278 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:19:24.303475 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b2ca5578_9e5b_4541_b3f5_e86f0a63d6b9` 
  ...
[0m10:19:24.309621 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:19:24.318305 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:19:24.316570 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2ca5578-9e5b-4541-b3f5-e86f0a63d6b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746adb100c10>]}
[0m10:19:24.331211 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:19:24.333625 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.02s]
[0m10:19:24.338415 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:19:24.341699 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:19:24.401134 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2ca5578-9e5b-4541-b3f5-e86f0a63d6b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746ada08de80>]}
[0m10:19:24.403656 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.10s]
[0m10:19:24.406486 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:19:24.410427 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:19:24.411745 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:19:24.413026 [debug] [MainThread]: On list__mart: Close
[0m10:19:24.414184 [debug] [MainThread]: Connection 'list_' was left open.
[0m10:19:24.415450 [debug] [MainThread]: On list_: Close
[0m10:19:24.416635 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:19:24.417833 [debug] [MainThread]: On list__clean: Close
[0m10:19:24.418988 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:19:24.420204 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:19:24.421371 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:19:24.422604 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:19:24.423752 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:19:24.424910 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:19:24.426020 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:19:24.427213 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:19:24.429695 [info ] [MainThread]: 
[0m10:19:24.431106 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.91 seconds (4.91s).
[0m10:19:24.439422 [debug] [MainThread]: Command end result
[0m10:19:24.710296 [info ] [MainThread]: 
[0m10:19:24.711981 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:19:24.713328 [info ] [MainThread]: 
[0m10:19:24.714802 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:19:24.717441 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.7939262, "process_in_blocks": "0", "process_kernel_time": 0.704755, "process_mem_max_rss": "114584", "process_out_blocks": "9744", "process_user_time": 6.536806}
[0m10:19:24.719049 [debug] [MainThread]: Command `dbt build` succeeded at 10:19:24.718639 after 7.80 seconds
[0m10:19:24.720390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746adf24a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746adbd75b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746adbd08640>]}
[0m10:19:24.721745 [debug] [MainThread]: Flushing usage events
[0m10:20:16.681722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b37806310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b3445bb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b3445ba00>]}


============================== 10:20:16.691729 | 3b7123d4-ed59-4de3-9c07-ff082b4a859d ==============================
[0m10:20:16.691729 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:20:16.692895 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'no_print': 'None', 'partial_parse': 'True', 'quiet': 'False', 'write_json': 'True', 'debug': 'False', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'cache_selected_only': 'False', 'target_path': 'None', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'printer_width': '80', 'empty': 'False', 'indirect_selection': 'eager', 'log_path': '/workdir/transforms/04_btc/logs', 'invocation_command': 'dbt build --profiles-dir . --target local', 'static_parser': 'True', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'log_cache_events': 'False'}
[0m10:20:17.280349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3b7123d4-ed59-4de3-9c07-ff082b4a859d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b35f4c5b0>]}
[0m10:20:17.473595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3b7123d4-ed59-4de3-9c07-ff082b4a859d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b348c6ca0>]}
[0m10:20:17.474881 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:20:17.883729 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:20:18.391486 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:20:18.392208 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:20:18.660974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3b7123d4-ed59-4de3-9c07-ff082b4a859d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b33bc3eb0>]}
[0m10:20:19.105168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3b7123d4-ed59-4de3-9c07-ff082b4a859d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b33ab84c0>]}
[0m10:20:19.106093 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:20:19.109606 [info ] [MainThread]: 
[0m10:20:19.110687 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:20:19.159067 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:20:19.171015 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:20:19.199339 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:20:19.261519 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:20:20.040300 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:20:20.055462 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:20:20.057955 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:20:20.059981 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:20:20.154402 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:20:20.155740 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:20:20.168942 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:20:20.175066 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:20:20.182505 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:20:20.184761 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:20:20.201090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3b7123d4-ed59-4de3-9c07-ff082b4a859d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b343a6df0>]}
[0m10:20:20.202513 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:20:20.203376 [info ] [MainThread]: 
[0m10:20:20.276447 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:20:20.277584 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:20:20.278639 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:20:20.279381 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:20:20.295701 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:20:20.296839 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:20:20.488604 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:20:20.621544 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:20:20.623128 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:20:20.636159 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:20:20.773853 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:20:20.778099 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:20:20.780096 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:20:20.783055 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:20:20.788649 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:20:20.791604 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:20:20.793498 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:20:20.796506 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:20:20.889365 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:20:20.892496 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:20:20.898556 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b7123d4-ed59-4de3-9c07-ff082b4a859d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b36d1ea60>]}
[0m10:20:20.899689 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.62s]
[0m10:20:20.901013 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:20:20.952736 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:20:20.903456 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:20:20.955631 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:20:20.957336 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:20:20.959434 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:20:20.961505 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:20:20.963782 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:20:20.965916 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:20:20.968019 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:20:20.969679 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:20:20.971376 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:20:20.973091 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:20:21.179268 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:20:21.183866 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:20:21.185934 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:20:21.188920 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:20:21.190425 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:20:21.252662 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:20:21.562307 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:20:21.556163 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:20:21.571933 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:20:21.574735 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:20:21.576481 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:20:21.578172 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:20:21.839365 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:20:21.846679 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:20:21.854166 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:20:21.862408 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:20:21.869590 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.91s]
[0m10:20:21.875191 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:20:21.879038 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:20:21.885070 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.92s]
[0m10:20:21.888050 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:20:21.890999 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:20:21.897607 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.93s]
[0m10:20:21.953046 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:20:21.956438 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:20:21.958188 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:20:21.959927 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:20:21.961566 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:20:21.963164 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:20:21.965347 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:20:21.967376 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:20:21.969261 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:20:21.970446 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:20:21.987263 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:20:22.064045 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:20:22.066025 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:20:22.067818 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:20:22.086635 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:20:22.101710 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:20:22.153850 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:20:22.156507 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:20:22.174271 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:20:22.353848 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:20:22.484210 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:20:22.591687 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:20:22.764918 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:20:22.869078 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:20:22.883635 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:20:22.988076 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:20:23.057180 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_3b7123d4_ed59_4de3_9c07_ff082b4a859d` 
  ...
[0m10:20:23.064708 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:20:23.069880 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_3b7123d4_ed59_4de3_9c07_ff082b4a859d` 
  ...
[0m10:20:23.074667 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:20:23.083305 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:20:23.090980 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:20:23.155199 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:20:23.269808 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:20:23.370258 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:20:23.463120 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:20:23.473329 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b7123d4-ed59-4de3-9c07-ff082b4a859d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b32790370>]}
[0m10:20:23.475648 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.49s]
[0m10:20:23.498945 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_3b7123d4_ed59_4de3_9c07_ff082b4a859d`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:20:23.553714 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:20:23.500948 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_3b7123d4_ed59_4de3_9c07_ff082b4a859d`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:20:23.586036 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:20:23.601416 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:20:23.673811 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_3b7123d4_ed59_4de3_9c07_ff082b4a859d'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:20:23.674488 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_3b7123d4_ed59_4de3_9c07_ff082b4a859d'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:20:23.680579 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:20:23.681917 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:20:23.688218 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:20:23.691246 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:20:23.692891 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_3b7123d4_ed59_4de3_9c07_ff082b4a859d`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:20:23.694022 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_3b7123d4_ed59_4de3_9c07_ff082b4a859d`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:20:23.710498 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:20:23.712055 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:20:23.714782 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_3b7123d4_ed59_4de3_9c07_ff082b4a859d`)
      
    ...
[0m10:20:23.753215 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_3b7123d4_ed59_4de3_9c07_ff082b4a859d`)
      
    ...
[0m10:20:23.780959 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:20:23.790258 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:20:23.794024 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:20:23.804091 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:20:23.813066 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:20:23.818942 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_3b7123d4_ed59_4de3_9c07_ff082b4a859d` 
    ...
[0m10:20:23.821636 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:20:23.862876 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_3b7123d4_ed59_4de3_9c07_ff082b4a859d` 
    ...
[0m10:20:23.865643 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:20:23.879723 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_3b7123d4_ed59_4de3_9c07_ff082b4a859d` 
  ...
[0m10:20:23.882524 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:20:23.897931 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_3b7123d4_ed59_4de3_9c07_ff082b4a859d` 
  ...
[0m10:20:23.953580 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:20:23.967810 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:20:23.966222 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:20:23.981581 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:20:23.988229 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:20:23.996087 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:20:23.998187 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b7123d4-ed59-4de3-9c07-ff082b4a859d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b32e2a730>]}
[0m10:20:24.056339 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b7123d4-ed59-4de3-9c07-ff082b4a859d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b32790220>]}
[0m10:20:24.058977 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.04s]
[0m10:20:24.061599 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.09s]
[0m10:20:24.064593 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:20:24.067485 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:20:24.075497 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:20:24.076783 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:20:24.077926 [debug] [MainThread]: On list__clean: Close
[0m10:20:24.079142 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:20:24.080471 [debug] [MainThread]: On list__mart: Close
[0m10:20:24.081587 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:20:24.082719 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:20:24.083862 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:20:24.085014 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:20:24.086072 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:20:24.087837 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:20:24.089294 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:20:24.090594 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:20:24.092923 [info ] [MainThread]: 
[0m10:20:24.094674 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.98 seconds (4.98s).
[0m10:20:24.154949 [debug] [MainThread]: Command end result
[0m10:20:24.371278 [info ] [MainThread]: 
[0m10:20:24.373056 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:20:24.375023 [info ] [MainThread]: 
[0m10:20:24.377249 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:20:24.381310 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.894871, "process_in_blocks": "0", "process_kernel_time": 0.704914, "process_mem_max_rss": "115448", "process_out_blocks": "9744", "process_user_time": 6.589156}
[0m10:20:24.383638 [debug] [MainThread]: Command `dbt build` succeeded at 10:20:24.383054 after 7.90 seconds
[0m10:20:24.385544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b37806310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b33ab8d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0b33ab87c0>]}
[0m10:20:24.386578 [debug] [MainThread]: Flushing usage events
[0m10:21:15.926713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ab4b8abd310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ab4b5729af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ab4b57299a0>]}


============================== 10:21:15.936325 | 9c1e7b71-280d-4b0e-bb2c-27307ef2674c ==============================
[0m10:21:15.936325 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:21:15.937460 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'quiet': 'False', 'profiles_dir': '.', 'cache_selected_only': 'False', 'debug': 'False', 'target_path': 'None', 'introspect': 'True', 'log_format': 'default', 'use_colors': 'True', 'warn_error': 'None', 'indirect_selection': 'eager', 'log_path': '/workdir/transforms/04_btc/logs', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'use_experimental_parser': 'False', 'static_parser': 'True', 'fail_fast': 'False', 'printer_width': '80', 'empty': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'partial_parse': 'True'}
[0m10:21:16.514701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9c1e7b71-280d-4b0e-bb2c-27307ef2674c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ab4b5616490>]}
[0m10:21:16.706150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9c1e7b71-280d-4b0e-bb2c-27307ef2674c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ab4b6950520>]}
[0m10:21:16.707541 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:21:17.116953 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:21:17.621509 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:21:17.622154 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:21:17.820107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9c1e7b71-280d-4b0e-bb2c-27307ef2674c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ab4b4e7ff10>]}
[0m10:21:18.261233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9c1e7b71-280d-4b0e-bb2c-27307ef2674c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ab4b4ebdb20>]}
[0m10:21:18.262106 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:21:18.265370 [info ] [MainThread]: 
[0m10:21:18.304294 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:21:18.315967 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:21:18.327902 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:21:18.418875 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:21:18.420036 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:21:18.975936 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:21:19.011198 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:21:19.023076 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:21:19.037334 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:21:19.123067 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:21:19.129955 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:21:19.140688 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:21:19.148693 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:21:19.204958 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:21:19.218284 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:21:19.236470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c1e7b71-280d-4b0e-bb2c-27307ef2674c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ab4b56f7910>]}
[0m10:21:19.238385 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:21:19.239809 [info ] [MainThread]: 
[0m10:21:19.310836 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:21:19.311987 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:21:19.313072 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:21:19.313802 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:21:19.330581 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:21:19.331731 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:21:19.517666 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:21:19.584058 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:21:19.585681 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:21:19.597352 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:21:19.724745 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:21:19.728615 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:21:19.730553 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:21:19.733478 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:21:19.739274 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:21:19.742652 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:21:19.744668 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:21:19.747625 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:21:19.840012 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:21:19.843316 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:21:19.849291 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c1e7b71-280d-4b0e-bb2c-27307ef2674c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ab4b41efca0>]}
[0m10:21:19.850479 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.54s]
[0m10:21:19.851829 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:21:19.903953 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:21:19.905879 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:21:19.854275 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:21:19.908727 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:21:19.910984 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:21:19.913055 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:21:19.915279 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:21:19.917184 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:21:19.919337 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:21:19.921499 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:21:19.939260 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:21:20.003927 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:21:20.027720 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:21:20.042336 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:21:20.108144 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:21:20.110304 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:21:20.133802 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:21:20.135398 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:21:20.319279 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:21:20.320958 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:21:20.325508 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:21:20.328418 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:21:20.330673 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:21:20.334841 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:21:20.583220 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:21:20.608812 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:21:20.613928 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:21:20.619667 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:21:20.627891 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:21:20.641107 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:21:20.639302 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.72s]
[0m10:21:20.705255 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.79s]
[0m10:21:20.706908 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:21:20.648237 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.73s]
[0m10:21:20.708664 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:21:20.710318 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:21:20.712145 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:21:20.712898 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:21:20.713646 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:21:20.714652 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:21:20.715674 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:21:20.716653 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:21:20.717509 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:21:20.718382 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:21:20.719093 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:21:20.720009 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:21:20.720900 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:21:20.721935 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:21:20.809211 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:21:20.812190 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:21:20.826930 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:21:20.829849 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:21:20.831621 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:21:20.833149 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:21:20.926272 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:21:21.119786 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:21:21.204712 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:21:21.319676 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:21:21.420166 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:21:21.445105 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:21:21.516748 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:21:21.610655 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:21:21.634270 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c1e7b71_280d_4b0e_bb2c_27307ef2674c` 
  ...
[0m10:21:21.703360 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:21:21.704819 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c1e7b71_280d_4b0e_bb2c_27307ef2674c` 
  ...
[0m10:21:21.707093 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:21:21.708694 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:21:21.722352 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:21:21.723487 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:21:21.926173 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c1e7b71_280d_4b0e_bb2c_27307ef2674c`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:21:21.940757 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:21:21.944343 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c1e7b71_280d_4b0e_bb2c_27307ef2674c`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:21:22.004252 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:21:22.007923 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:21:22.013753 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c1e7b71-280d-4b0e-bb2c-27307ef2674c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ab4b4a0bcd0>]}
[0m10:21:22.031778 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:21:22.039661 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.29s]
[0m10:21:22.105310 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_9c1e7b71_280d_4b0e_bb2c_27307ef2674c'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:21:22.115997 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_9c1e7b71_280d_4b0e_bb2c_27307ef2674c'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:21:22.119309 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:21:22.130643 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:21:22.138574 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:21:22.203718 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:21:22.206779 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:21:22.209565 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c1e7b71_280d_4b0e_bb2c_27307ef2674c`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:21:22.211721 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c1e7b71_280d_4b0e_bb2c_27307ef2674c`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:21:22.238802 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:21:22.243499 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c1e7b71_280d_4b0e_bb2c_27307ef2674c`)
      
    ...
[0m10:21:22.246488 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:21:22.252298 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c1e7b71_280d_4b0e_bb2c_27307ef2674c`)
      
    ...
[0m10:21:22.275788 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:21:22.286402 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:21:22.289177 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:21:22.320413 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:21:22.317813 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:21:22.326516 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c1e7b71_280d_4b0e_bb2c_27307ef2674c` 
    ...
[0m10:21:22.335474 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:21:22.341427 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c1e7b71_280d_4b0e_bb2c_27307ef2674c` 
    ...
[0m10:21:22.345652 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:21:22.404989 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:21:22.410475 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c1e7b71_280d_4b0e_bb2c_27307ef2674c` 
  ...
[0m10:21:22.423190 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c1e7b71_280d_4b0e_bb2c_27307ef2674c` 
  ...
[0m10:21:22.429282 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:21:22.437118 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:21:22.449728 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:21:22.511095 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:21:22.515477 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:21:22.523658 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:21:22.524698 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c1e7b71-280d-4b0e-bb2c-27307ef2674c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ab4b4d6d6d0>]}
[0m10:21:22.530989 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c1e7b71-280d-4b0e-bb2c-27307ef2674c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ab4b49b9160>]}
[0m10:21:22.533628 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.80s]
[0m10:21:22.536185 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.81s]
[0m10:21:22.539219 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:21:22.542113 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:21:22.546670 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:21:22.547809 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:21:22.548936 [debug] [MainThread]: On list__clean: Close
[0m10:21:22.550004 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:21:22.603904 [debug] [MainThread]: On list__mart: Close
[0m10:21:22.605018 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:21:22.606137 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:21:22.607209 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:21:22.608355 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:21:22.609525 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:21:22.610635 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:21:22.611704 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:21:22.612835 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:21:22.615158 [info ] [MainThread]: 
[0m10:21:22.616696 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.31 seconds (4.31s).
[0m10:21:22.624693 [debug] [MainThread]: Command end result
[0m10:21:22.838400 [info ] [MainThread]: 
[0m10:21:22.839809 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:21:22.840881 [info ] [MainThread]: 
[0m10:21:22.842051 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:21:22.844205 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.1087146, "process_in_blocks": "0", "process_kernel_time": 0.698063, "process_mem_max_rss": "114580", "process_out_blocks": "9744", "process_user_time": 6.179592}
[0m10:21:22.845496 [debug] [MainThread]: Command `dbt build` succeeded at 10:21:22.845184 after 7.11 seconds
[0m10:21:22.846524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ab4b8abd310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ab4b5616490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ab4b49a54f0>]}
[0m10:21:22.847550 [debug] [MainThread]: Flushing usage events
[0m10:22:16.624983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x778b565ec310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x778b53246b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x778b532469d0>]}


============================== 10:22:16.699596 | e2193a08-6ae8-430d-9c7c-54800bcef140 ==============================
[0m10:22:16.699596 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:22:16.701335 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'log_format': 'default', 'warn_error': 'None', 'profiles_dir': '.', 'static_parser': 'True', 'target_path': 'None', 'debug': 'False', 'quiet': 'False', 'printer_width': '80', 'log_cache_events': 'False', 'use_colors': 'True', 'cache_selected_only': 'False', 'partial_parse': 'True', 'empty': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'no_print': 'None', 'indirect_selection': 'eager', 'version_check': 'True', 'use_experimental_parser': 'False', 'write_json': 'True', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_path': '/workdir/transforms/04_btc/logs', 'send_anonymous_usage_stats': 'True'}
[0m10:22:17.223118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e2193a08-6ae8-430d-9c7c-54800bcef140', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x778b53105bb0>]}
[0m10:22:17.416426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e2193a08-6ae8-430d-9c7c-54800bcef140', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x778b5330adc0>]}
[0m10:22:17.417727 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:22:17.881612 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:22:18.387455 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:22:18.388224 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:22:18.595866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e2193a08-6ae8-430d-9c7c-54800bcef140', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x778b52999e80>]}
[0m10:22:19.079840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e2193a08-6ae8-430d-9c7c-54800bcef140', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x778b529ae1f0>]}
[0m10:22:19.080719 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:22:19.083965 [info ] [MainThread]: 
[0m10:22:19.085028 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:22:19.096792 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:22:19.098304 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:22:19.206236 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:22:19.217180 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:22:19.980578 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:22:19.982435 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:22:19.989047 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:22:19.991889 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:22:20.086521 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:22:20.098120 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:22:20.102002 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:22:20.107764 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:22:20.117016 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:22:20.118922 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:22:20.190393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2193a08-6ae8-430d-9c7c-54800bcef140', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x778b5319b670>]}
[0m10:22:20.192380 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:22:20.193714 [info ] [MainThread]: 
[0m10:22:20.221403 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:22:20.223041 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:22:20.224481 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:22:20.225571 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:22:20.298364 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:22:20.300072 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:22:20.486190 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:22:20.554221 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:22:20.555556 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:22:20.569377 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:22:20.703727 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:22:20.707481 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:22:20.709502 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:22:20.712626 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:22:20.718282 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:22:20.721196 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:22:20.723065 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:22:20.725876 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:22:20.818402 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:22:20.822365 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:22:20.880697 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2193a08-6ae8-430d-9c7c-54800bcef140', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x778b51c31a00>]}
[0m10:22:20.882006 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.65s]
[0m10:22:20.883323 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:22:20.885028 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:22:20.886256 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:22:20.887814 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:22:20.888952 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:22:20.890686 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:22:20.892278 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:22:20.893882 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:22:20.895298 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:22:20.896716 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:22:20.897870 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:22:20.899176 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:22:20.900464 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:22:21.090519 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:22:21.094767 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:22:21.087958 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:22:21.098331 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:22:21.100294 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:22:21.107084 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:22:21.323609 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:22:21.378850 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:22:21.392959 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:22:21.396043 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:22:21.398109 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:22:21.400444 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:22:21.659741 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:22:21.683797 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:22:21.699082 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.80s]
[0m10:22:21.704196 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:22:21.707341 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:22:21.710220 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:22:21.724614 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:22:21.778601 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:22:21.731037 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.84s]
[0m10:22:21.785343 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.89s]
[0m10:22:21.788427 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:22:21.791403 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:22:21.794759 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:22:21.795773 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:22:21.797019 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:22:21.798754 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:22:21.800069 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:22:21.801777 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:22:21.803975 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:22:21.805910 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:22:21.807664 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:22:21.809189 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:22:21.878576 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:22:21.899223 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:22:21.913252 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:22:21.987701 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:22:21.997780 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:22:22.000641 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:22:22.003566 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:22:22.083886 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:22:22.194054 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:22:22.309860 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:22:22.417232 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:22:22.515212 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:22:22.684518 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:22:22.694517 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:22:22.812179 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:22:22.903438 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_e2193a08_6ae8_430d_9c7c_54800bcef140` 
  ...
[0m10:22:22.908617 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:22:22.982103 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_e2193a08_6ae8_430d_9c7c_54800bcef140` 
  ...
[0m10:22:22.987114 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:22:22.991410 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:22:23.011788 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:22:23.014407 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:22:23.095129 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:22:23.180898 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:22:23.221424 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:22:23.297608 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2193a08-6ae8-430d-9c7c-54800bcef140', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x778b515d9b80>]}
[0m10:22:23.310457 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.49s]
[0m10:22:23.391642 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:22:23.488442 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_e2193a08_6ae8_430d_9c7c_54800bcef140`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:22:23.497476 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_e2193a08_6ae8_430d_9c7c_54800bcef140`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:22:23.527550 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:22:23.543698 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:22:23.610352 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_e2193a08_6ae8_430d_9c7c_54800bcef140'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:22:23.615566 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_e2193a08_6ae8_430d_9c7c_54800bcef140'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:22:23.627351 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:22:23.630287 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:22:23.698041 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:22:23.706487 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:22:23.709132 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_e2193a08_6ae8_430d_9c7c_54800bcef140`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:22:23.711228 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_e2193a08_6ae8_430d_9c7c_54800bcef140`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:22:23.748505 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:22:23.751985 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:22:23.777941 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_e2193a08_6ae8_430d_9c7c_54800bcef140`)
      
    ...
[0m10:22:23.782665 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_e2193a08_6ae8_430d_9c7c_54800bcef140`)
      
    ...
[0m10:22:23.804318 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:22:23.814303 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:22:23.817077 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:22:23.826301 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:22:23.828731 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:22:23.836436 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_e2193a08_6ae8_430d_9c7c_54800bcef140` 
    ...
[0m10:22:23.838658 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:22:23.879427 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:22:23.880799 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_e2193a08_6ae8_430d_9c7c_54800bcef140` 
    ...
[0m10:22:23.893228 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_e2193a08_6ae8_430d_9c7c_54800bcef140` 
  ...
[0m10:22:23.900822 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:22:23.908523 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:22:23.921705 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:22:23.983368 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_e2193a08_6ae8_430d_9c7c_54800bcef140` 
  ...
[0m10:22:23.985961 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:22:23.994405 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2193a08-6ae8-430d-9c7c-54800bcef140', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x778b51478e20>]}
[0m10:22:23.996720 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:22:23.999219 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.19s]
[0m10:22:24.011989 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:22:24.015058 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:22:24.021100 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:22:24.079323 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2193a08-6ae8-430d-9c7c-54800bcef140', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x778b52706e50>]}
[0m10:22:24.081855 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.27s]
[0m10:22:24.084620 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:22:24.088380 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:22:24.089552 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:22:24.090704 [debug] [MainThread]: On list__mart: Close
[0m10:22:24.091818 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:22:24.092980 [debug] [MainThread]: On list__clean: Close
[0m10:22:24.094036 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:22:24.095130 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:22:24.096213 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:22:24.097325 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:22:24.098370 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:22:24.099456 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:22:24.100512 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:22:24.101659 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:22:24.103976 [info ] [MainThread]: 
[0m10:22:24.105308 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.02 seconds (5.02s).
[0m10:22:24.113697 [debug] [MainThread]: Command end result
[0m10:22:24.379912 [info ] [MainThread]: 
[0m10:22:24.381700 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:22:24.383045 [info ] [MainThread]: 
[0m10:22:24.384637 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:22:24.387793 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.9051733, "process_in_blocks": "8", "process_kernel_time": 0.677793, "process_mem_max_rss": "115144", "process_out_blocks": "9744", "process_user_time": 6.644372}
[0m10:22:24.389151 [debug] [MainThread]: Command `dbt build` succeeded at 10:22:24.388956 after 7.91 seconds
[0m10:22:24.389805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x778b565ec310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x778b528f7370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x778b5329dd30>]}
[0m10:22:24.390393 [debug] [MainThread]: Flushing usage events
[0m10:23:16.784973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e0eb4e9e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e0e8142b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e0e8142a30>]}


============================== 10:23:16.794776 | cb88aa29-4c29-410d-8c9f-8fee318fa990 ==============================
[0m10:23:16.794776 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:23:16.795899 [debug] [MainThread]: running dbt with arguments {'log_path': '/workdir/transforms/04_btc/logs', 'use_experimental_parser': 'False', 'static_parser': 'True', 'indirect_selection': 'eager', 'profiles_dir': '.', 'partial_parse': 'True', 'write_json': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'no_print': 'None', 'target_path': 'None', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'empty': 'False', 'quiet': 'False', 'printer_width': '80', 'fail_fast': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m10:23:17.379752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cb88aa29-4c29-410d-8c9f-8fee318fa990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e0e819bb80>]}
[0m10:23:17.570698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cb88aa29-4c29-410d-8c9f-8fee318fa990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e0e803d6d0>]}
[0m10:23:17.571956 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:23:17.982151 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:23:18.554207 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:23:18.554897 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:23:18.758786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cb88aa29-4c29-410d-8c9f-8fee318fa990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e0e78a8e50>]}
[0m10:23:19.201770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cb88aa29-4c29-410d-8c9f-8fee318fa990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e0e7867e80>]}
[0m10:23:19.202656 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:23:19.205872 [info ] [MainThread]: 
[0m10:23:19.206920 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:23:19.254020 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:23:19.265876 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:23:19.283331 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:23:19.289387 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:23:19.907228 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:23:19.916957 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:23:19.924668 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:23:19.957194 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:23:19.998066 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:23:20.055852 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:23:20.066844 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:23:20.072731 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:23:20.082815 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:23:20.092862 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:23:20.157994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cb88aa29-4c29-410d-8c9f-8fee318fa990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e0e7e1dc40>]}
[0m10:23:20.159956 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:23:20.161175 [info ] [MainThread]: 
[0m10:23:20.187465 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:23:20.188824 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:23:20.190009 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:23:20.190778 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:23:20.260584 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:23:20.262102 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:23:20.454160 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:23:20.518422 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:23:20.519809 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:23:20.531757 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:23:20.661514 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:23:20.665315 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:23:20.667214 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:23:20.670561 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:23:20.676287 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:23:20.679311 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:23:20.681114 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:23:20.683956 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:23:20.783464 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:23:20.786595 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:23:20.793466 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cb88aa29-4c29-410d-8c9f-8fee318fa990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e0ea9f1c10>]}
[0m10:23:20.795051 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m10:23:20.796567 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:23:20.798565 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:23:20.799686 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:23:20.850116 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:23:20.800910 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:23:20.852466 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:23:20.854433 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:23:20.856773 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:23:20.858954 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:23:20.861001 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:23:20.862780 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:23:20.864579 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:23:20.866315 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:23:21.081293 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:23:21.082969 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:23:21.084740 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:23:21.086924 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:23:21.089135 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:23:21.096060 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:23:21.381082 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:23:21.388138 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:23:21.451070 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:23:21.452802 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:23:21.454086 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:23:21.457764 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:23:21.690628 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:23:21.707210 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:23:21.722414 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.86s]
[0m10:23:21.754778 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:23:21.762822 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:23:21.768041 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:23:21.779204 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:23:21.782828 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.93s]
[0m10:23:21.784482 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:23:21.786321 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:23:21.789623 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.93s]
[0m10:23:21.791368 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:23:21.793498 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:23:21.794465 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:23:21.795605 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:23:21.796834 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:23:21.797941 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:23:21.799272 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:23:21.800491 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:23:21.801303 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:23:21.802164 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:23:21.803222 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:23:21.804083 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:23:21.805005 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:23:21.968422 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:23:22.050356 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:23:21.998408 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:23:22.054052 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:23:22.055629 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:23:22.067836 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:23:22.070702 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:23:22.250314 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:23:22.290758 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:23:22.386038 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:23:22.488633 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:23:22.567395 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:23:22.673410 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:23:22.782464 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:23:22.868140 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:23:22.891980 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:23:22.954314 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_cb88aa29_4c29_410d_8c9f_8fee318fa990` 
  ...
[0m10:23:22.963176 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:23:22.979627 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_cb88aa29_4c29_410d_8c9f_8fee318fa990` 
  ...
[0m10:23:22.981414 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:23:22.994553 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:23:23.061772 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:23:23.076353 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:23:23.174214 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cb88aa29-4c29-410d-8c9f-8fee318fa990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e0e762abb0>]}
[0m10:23:23.261389 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.37s]
[0m10:23:23.291674 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:23:23.466367 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_cb88aa29_4c29_410d_8c9f_8fee318fa990`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:23:23.464243 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_cb88aa29_4c29_410d_8c9f_8fee318fa990`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:23:23.503023 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:23:23.518977 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:23:23.569740 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_cb88aa29_4c29_410d_8c9f_8fee318fa990'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:23:23.576369 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_cb88aa29_4c29_410d_8c9f_8fee318fa990'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:23:23.585267 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:23:23.587996 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:23:23.656125 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:23:23.663328 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:23:23.666231 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_cb88aa29_4c29_410d_8c9f_8fee318fa990`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:23:23.668497 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_cb88aa29_4c29_410d_8c9f_8fee318fa990`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:23:23.698212 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:23:23.700979 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:23:23.705329 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_cb88aa29_4c29_410d_8c9f_8fee318fa990`)
      
    ...
[0m10:23:23.710177 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_cb88aa29_4c29_410d_8c9f_8fee318fa990`)
      
    ...
[0m10:23:23.736999 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:23:23.750207 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:23:23.760012 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:23:23.760790 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:23:23.769369 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:23:23.771419 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:23:23.774770 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_cb88aa29_4c29_410d_8c9f_8fee318fa990` 
    ...
[0m10:23:23.780150 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_cb88aa29_4c29_410d_8c9f_8fee318fa990` 
    ...
[0m10:23:23.790209 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:23:23.798384 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:23:23.851181 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_cb88aa29_4c29_410d_8c9f_8fee318fa990` 
  ...
[0m10:23:23.863426 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_cb88aa29_4c29_410d_8c9f_8fee318fa990` 
  ...
[0m10:23:23.869644 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:23:23.872259 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:23:23.884746 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:23:23.897125 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:23:23.953931 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:23:23.962174 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:23:23.963589 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cb88aa29-4c29-410d-8c9f-8fee318fa990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e0e70a3b50>]}
[0m10:23:23.969502 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cb88aa29-4c29-410d-8c9f-8fee318fa990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e0e7465d30>]}
[0m10:23:23.971985 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.16s]
[0m10:23:23.974705 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.17s]
[0m10:23:23.977572 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:23:23.980500 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:23:23.984977 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:23:23.986111 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:23:23.987258 [debug] [MainThread]: On list__clean: Close
[0m10:23:23.988365 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:23:23.989524 [debug] [MainThread]: On list__mart: Close
[0m10:23:23.990594 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:23:23.991684 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:23:23.992809 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:23:23.993890 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:23:23.994929 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:23:23.996034 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:23:23.997077 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:23:23.998148 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:23:24.050256 [info ] [MainThread]: 
[0m10:23:24.051772 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.84 seconds (4.84s).
[0m10:23:24.059674 [debug] [MainThread]: Command end result
[0m10:23:24.193554 [info ] [MainThread]: 
[0m10:23:24.194338 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:23:24.194981 [info ] [MainThread]: 
[0m10:23:24.195614 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:23:24.197068 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.609134, "process_in_blocks": "0", "process_kernel_time": 0.683886, "process_mem_max_rss": "114860", "process_out_blocks": "9744", "process_user_time": 6.447082}
[0m10:23:24.197828 [debug] [MainThread]: Command `dbt build` succeeded at 10:23:24.197630 after 7.61 seconds
[0m10:23:24.198438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e0eb4e9e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e0e819bb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e0e803d6d0>]}
[0m10:23:24.199036 [debug] [MainThread]: Flushing usage events
[0m10:24:16.809078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8d88cc2e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8d8591cbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8d8591ca90>]}


============================== 10:24:16.818777 | 66120c8d-e011-4dc5-ab39-5b167be12b96 ==============================
[0m10:24:16.818777 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:24:16.819971 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'partial_parse': 'True', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_cache_events': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'cache_selected_only': 'False', 'log_format': 'default', 'empty': 'False', 'static_parser': 'True', 'target_path': 'None', 'fail_fast': 'False', 'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'quiet': 'False', 'no_print': 'None', 'version_check': 'True'}
[0m10:24:17.354015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '66120c8d-e011-4dc5-ab39-5b167be12b96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8d857faf10>]}
[0m10:24:17.547897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '66120c8d-e011-4dc5-ab39-5b167be12b96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8d85955790>]}
[0m10:24:17.549270 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:24:18.014859 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:24:18.524825 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:24:18.525555 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:24:18.730819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '66120c8d-e011-4dc5-ab39-5b167be12b96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8d85081e50>]}
[0m10:24:19.211487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '66120c8d-e011-4dc5-ab39-5b167be12b96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8d850404f0>]}
[0m10:24:19.212410 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:24:19.215682 [info ] [MainThread]: 
[0m10:24:19.216686 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:24:19.228411 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:24:19.229952 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:24:19.334096 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:24:19.342285 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:24:20.162995 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:24:20.168341 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:24:20.169797 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:24:20.173059 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:24:20.231823 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:24:20.238658 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:24:20.254012 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:24:20.317210 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:24:20.325165 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:24:20.330570 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:24:20.354734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '66120c8d-e011-4dc5-ab39-5b167be12b96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8d84fdf4f0>]}
[0m10:24:20.405115 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:24:20.406711 [info ] [MainThread]: 
[0m10:24:20.433337 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:24:20.434448 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:24:20.435592 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:24:20.436339 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:24:20.453077 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:24:20.454254 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:24:20.648604 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:24:20.761168 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:24:20.762690 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:24:20.774852 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:24:20.853679 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:24:20.907947 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:24:20.910013 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:24:20.912878 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:24:20.918369 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:24:20.921252 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:24:20.923074 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:24:20.925992 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:24:21.017768 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:24:21.021261 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:24:21.027450 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66120c8d-e011-4dc5-ab39-5b167be12b96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8d84412d30>]}
[0m10:24:21.028960 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m10:24:21.030310 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:24:21.032393 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:24:21.033855 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:24:21.035286 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:24:21.036736 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:24:21.038568 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:24:21.040404 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:24:21.042289 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:24:21.044664 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:24:21.046742 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:24:21.049215 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:24:21.051101 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:24:21.115921 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:24:21.244336 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:24:21.247915 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:24:21.307947 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:24:21.310064 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:24:21.312276 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:24:21.313851 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:24:21.515655 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:24:21.514659 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:24:21.523735 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:24:21.525747 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:24:21.526688 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:24:21.527763 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:24:21.757123 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:24:21.773638 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:24:21.804908 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.74s]
[0m10:24:21.808038 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:24:21.813301 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:24:21.822152 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:24:21.829815 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:24:21.838843 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.80s]
[0m10:24:21.842050 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:24:21.844715 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:24:21.850353 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.81s]
[0m10:24:21.853870 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:24:21.856715 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:24:21.904991 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:24:21.906820 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:24:21.909448 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:24:21.910824 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:24:21.911837 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:24:21.913562 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:24:21.915502 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:24:21.918057 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:24:21.920486 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:24:21.938286 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:24:22.010832 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:24:22.020662 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:24:22.048686 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:24:22.052934 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:24:22.105581 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:24:22.055295 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:24:22.134731 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:24:22.227420 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:24:22.405803 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:24:22.520192 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:24:22.631854 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:24:22.733981 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:24:22.829366 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:24:22.910605 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_66120c8d_e011_4dc5_ab39_5b167be12b96` 
  ...
[0m10:24:22.909126 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_66120c8d_e011_4dc5_ab39_5b167be12b96` 
  ...
[0m10:24:22.919080 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:24:22.921708 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:24:22.929442 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:24:22.936599 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:24:23.124097 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:24:23.138751 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:24:23.237966 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:24:23.342527 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:24:23.351450 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_66120c8d_e011_4dc5_ab39_5b167be12b96`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:24:23.347871 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_66120c8d_e011_4dc5_ab39_5b167be12b96`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:24:23.406901 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:24:23.415779 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66120c8d-e011-4dc5-ab39-5b167be12b96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8d83c81b80>]}
[0m10:24:23.418489 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.50s]
[0m10:24:23.421468 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:24:23.439168 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:24:23.454374 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:24:23.533958 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_66120c8d_e011_4dc5_ab39_5b167be12b96'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:24:23.539075 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_66120c8d_e011_4dc5_ab39_5b167be12b96'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:24:23.548840 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:24:23.606667 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:24:23.619678 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:24:23.617672 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:24:23.622681 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_66120c8d_e011_4dc5_ab39_5b167be12b96`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:24:23.626783 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_66120c8d_e011_4dc5_ab39_5b167be12b96`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:24:23.652451 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:24:23.657277 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_66120c8d_e011_4dc5_ab39_5b167be12b96`)
      
    ...
[0m10:24:23.659722 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:24:23.665245 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_66120c8d_e011_4dc5_ab39_5b167be12b96`)
      
    ...
[0m10:24:23.706361 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:24:23.687768 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:24:23.716682 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:24:23.726650 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:24:23.736592 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:24:23.739310 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:24:23.745191 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_66120c8d_e011_4dc5_ab39_5b167be12b96` 
    ...
[0m10:24:23.750827 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_66120c8d_e011_4dc5_ab39_5b167be12b96` 
    ...
[0m10:24:23.805364 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:24:23.818384 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_66120c8d_e011_4dc5_ab39_5b167be12b96` 
  ...
[0m10:24:23.821243 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:24:23.836040 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:24:23.838079 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_66120c8d_e011_4dc5_ab39_5b167be12b96` 
  ...
[0m10:24:23.850913 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:24:23.908659 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:24:23.916589 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:24:23.928766 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:24:23.931444 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66120c8d-e011-4dc5-ab39-5b167be12b96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8d83c99a60>]}
[0m10:24:23.934612 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.01s]
[0m10:24:23.937398 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:24:23.940056 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:24:23.949926 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66120c8d-e011-4dc5-ab39-5b167be12b96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8d83ba8cd0>]}
[0m10:24:24.005070 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.04s]
[0m10:24:24.008203 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:24:24.012203 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:24:24.013339 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:24:24.014479 [debug] [MainThread]: On list__clean: Close
[0m10:24:24.015571 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:24:24.016646 [debug] [MainThread]: On list__mart: Close
[0m10:24:24.017680 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:24:24.018749 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:24:24.019786 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:24:24.020866 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:24:24.021905 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:24:24.023153 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:24:24.024293 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:24:24.025429 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:24:24.027755 [info ] [MainThread]: 
[0m10:24:24.029081 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.81 seconds (4.81s).
[0m10:24:24.037103 [debug] [MainThread]: Command end result
[0m10:24:24.241029 [info ] [MainThread]: 
[0m10:24:24.241840 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:24:24.242407 [info ] [MainThread]: 
[0m10:24:24.243046 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:24:24.244375 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.6298733, "process_in_blocks": "0", "process_kernel_time": 0.747563, "process_mem_max_rss": "115036", "process_out_blocks": "9744", "process_user_time": 6.498206}
[0m10:24:24.245139 [debug] [MainThread]: Command `dbt build` succeeded at 10:24:24.244931 after 7.63 seconds
[0m10:24:24.245759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8d88cc2e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8d839ba580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8d86bcdc70>]}
[0m10:24:24.246331 [debug] [MainThread]: Flushing usage events
[0m10:25:16.055612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b3f167a9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b3f13412af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b3f134129a0>]}


============================== 10:25:16.064982 | 1f9cafdf-d4f1-400d-bde3-48652e21aea6 ==============================
[0m10:25:16.064982 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:25:16.066047 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'partial_parse': 'True', 'fail_fast': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'quiet': 'False', 'debug': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'warn_error': 'None', 'profiles_dir': '.', 'log_format': 'default', 'static_parser': 'True', 'printer_width': '80', 'version_check': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager', 'empty': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'target_path': 'None'}
[0m10:25:16.646441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1f9cafdf-d4f1-400d-bde3-48652e21aea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b3f13d241c0>]}
[0m10:25:16.844423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1f9cafdf-d4f1-400d-bde3-48652e21aea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b3f1334cf10>]}
[0m10:25:16.845830 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:25:17.259973 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:25:17.765456 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:25:17.766116 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:25:17.964863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1f9cafdf-d4f1-400d-bde3-48652e21aea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b3f12b65ee0>]}
[0m10:25:18.444490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1f9cafdf-d4f1-400d-bde3-48652e21aea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b3f12b4ffa0>]}
[0m10:25:18.445462 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:25:18.448773 [info ] [MainThread]: 
[0m10:25:18.449790 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:25:18.461383 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:25:18.475485 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:25:18.550129 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:25:18.558641 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:25:19.080745 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:25:19.087363 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:25:19.108616 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:25:19.149604 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:25:19.181862 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:25:19.183305 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:25:19.260888 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:25:19.262591 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:25:19.272340 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:25:19.278641 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:25:19.350729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f9cafdf-d4f1-400d-bde3-48652e21aea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b3f1266e220>]}
[0m10:25:19.352713 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:25:19.354124 [info ] [MainThread]: 
[0m10:25:19.381713 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:25:19.383274 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:25:19.384344 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:25:19.385084 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:25:19.455184 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:25:19.456765 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:25:19.648112 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:25:19.716828 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:25:19.718190 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:25:19.730902 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:25:19.867528 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:25:19.871307 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:25:19.873188 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:25:19.876045 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:25:19.881404 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:25:19.884190 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:25:19.886028 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:25:19.889155 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:25:19.979945 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:25:19.983314 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:25:19.989182 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f9cafdf-d4f1-400d-bde3-48652e21aea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b3f11e73b20>]}
[0m10:25:19.990340 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m10:25:19.991721 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:25:20.044214 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:25:20.045906 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:25:19.993962 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:25:20.047740 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:25:20.049839 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:25:20.051996 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:25:20.054287 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:25:20.056460 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:25:20.058607 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:25:20.060258 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:25:20.062055 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:25:20.063866 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:25:20.278745 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:25:20.282444 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:25:20.284564 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:25:20.287120 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:25:20.289353 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:25:20.349424 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:25:20.666289 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:25:20.667869 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:25:20.670078 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:25:20.672652 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:25:20.674659 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:25:20.679502 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:25:20.949379 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:25:20.960184 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:25:20.968115 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:25:20.971066 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:25:20.985310 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:25:20.988480 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.93s]
[0m10:25:21.049717 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.99s]
[0m10:25:21.053235 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:25:21.056076 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:25:21.059025 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:25:21.065469 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 1.01s]
[0m10:25:21.068434 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:25:21.071171 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:25:21.072302 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:25:21.073962 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:25:21.075573 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:25:21.077477 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:25:21.079280 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:25:21.081230 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:25:21.082992 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:25:21.084735 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:25:21.086406 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:25:21.088009 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:25:21.159642 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:25:21.189073 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:25:21.257236 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:25:21.259824 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:25:21.262128 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:25:21.264186 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:25:21.276219 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:25:21.362352 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:25:21.491297 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:25:21.645207 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:25:21.761046 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:25:21.860435 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:25:21.879993 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:25:21.960610 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:25:22.077902 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_1f9cafdf_d4f1_400d_bde3_48652e21aea6` 
  ...
[0m10:25:22.079843 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:25:22.091477 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_1f9cafdf_d4f1_400d_bde3_48652e21aea6` 
  ...
[0m10:25:22.145511 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:25:22.147129 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:25:22.150026 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:25:22.152283 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:25:22.187224 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:25:22.377932 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_1f9cafdf_d4f1_400d_bde3_48652e21aea6`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:25:22.379675 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_1f9cafdf_d4f1_400d_bde3_48652e21aea6`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:25:22.384154 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:25:22.445146 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:25:22.447640 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:25:22.454599 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:25:22.547752 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f9cafdf-d4f1-400d-bde3-48652e21aea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b3f128eff70>]}
[0m10:25:22.569152 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_1f9cafdf_d4f1_400d_bde3_48652e21aea6'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:25:22.578275 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.46s]
[0m10:25:22.580644 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_1f9cafdf_d4f1_400d_bde3_48652e21aea6'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:25:22.586075 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:25:22.591241 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:25:22.658894 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:25:22.660551 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:25:22.666105 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:25:22.669336 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_1f9cafdf_d4f1_400d_bde3_48652e21aea6`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:25:22.673206 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_1f9cafdf_d4f1_400d_bde3_48652e21aea6`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:25:22.702509 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:25:22.704940 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:25:22.708595 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_1f9cafdf_d4f1_400d_bde3_48652e21aea6`)
      
    ...
[0m10:25:22.712496 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_1f9cafdf_d4f1_400d_bde3_48652e21aea6`)
      
    ...
[0m10:25:22.747616 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:25:22.757802 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:25:22.760050 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:25:22.771618 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:25:22.774606 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:25:22.782242 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_1f9cafdf_d4f1_400d_bde3_48652e21aea6` 
    ...
[0m10:25:22.785681 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:25:22.844119 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_1f9cafdf_d4f1_400d_bde3_48652e21aea6` 
    ...
[0m10:25:22.847233 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:25:22.861302 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_1f9cafdf_d4f1_400d_bde3_48652e21aea6` 
  ...
[0m10:25:22.863027 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:25:22.872086 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_1f9cafdf_d4f1_400d_bde3_48652e21aea6` 
  ...
[0m10:25:22.874091 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:25:22.881568 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:25:22.883828 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:25:22.889822 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:25:22.891086 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:25:22.945090 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f9cafdf-d4f1-400d-bde3-48652e21aea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b3f11f28160>]}
[0m10:25:22.947163 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:25:22.949005 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.86s]
[0m10:25:22.954947 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f9cafdf-d4f1-400d-bde3-48652e21aea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b3f1179eac0>]}
[0m10:25:22.957718 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:25:22.960301 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.88s]
[0m10:25:22.963623 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:25:22.966942 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:25:22.967462 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:25:22.967997 [debug] [MainThread]: On list__mart: Close
[0m10:25:22.968468 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:25:22.968972 [debug] [MainThread]: On list__clean: Close
[0m10:25:22.969432 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:25:22.969925 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:25:22.970385 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:25:22.970914 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:25:22.971377 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:25:22.971875 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:25:22.972333 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:25:22.972831 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:25:22.973903 [info ] [MainThread]: 
[0m10:25:22.974596 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.52 seconds (4.52s).
[0m10:25:22.978227 [debug] [MainThread]: Command end result
[0m10:25:23.173614 [info ] [MainThread]: 
[0m10:25:23.175195 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:25:23.176368 [info ] [MainThread]: 
[0m10:25:23.177658 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:25:23.179975 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.319589, "process_in_blocks": "0", "process_kernel_time": 0.662069, "process_mem_max_rss": "115016", "process_out_blocks": "9744", "process_user_time": 6.357636}
[0m10:25:23.181323 [debug] [MainThread]: Command `dbt build` succeeded at 10:25:23.180966 after 7.32 seconds
[0m10:25:23.182441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b3f167a9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b3f13f24f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b3f13d241c0>]}
[0m10:25:23.183594 [debug] [MainThread]: Flushing usage events
[0m10:26:15.629336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5f3f37b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5f3df76bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5f3c088970>]}


============================== 10:26:15.638734 | 09a475bb-7305-40b1-89d8-9b236662f22a ==============================
[0m10:26:15.638734 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:26:15.639847 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'static_parser': 'True', 'version_check': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'cache_selected_only': 'False', 'introspect': 'True', 'empty': 'False', 'debug': 'False', 'use_experimental_parser': 'False', 'log_format': 'default', 'write_json': 'True', 'partial_parse': 'True', 'printer_width': '80', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_colors': 'True', 'profiles_dir': '.', 'no_print': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'fail_fast': 'False', 'quiet': 'False'}
[0m10:26:16.215502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '09a475bb-7305-40b1-89d8-9b236662f22a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5f3e9143a0>]}
[0m10:26:16.408639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '09a475bb-7305-40b1-89d8-9b236662f22a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5f3c9068e0>]}
[0m10:26:16.410073 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:26:16.821700 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:26:17.331453 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:26:17.332115 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:26:17.532111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '09a475bb-7305-40b1-89d8-9b236662f22a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5f3b744ee0>]}
[0m10:26:18.015601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '09a475bb-7305-40b1-89d8-9b236662f22a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5f3b794d60>]}
[0m10:26:18.016453 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:26:18.019643 [info ] [MainThread]: 
[0m10:26:18.020690 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:26:18.033172 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:26:18.045110 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:26:18.147474 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:26:18.149243 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:26:18.772409 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:26:18.777013 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:26:18.784585 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:26:18.790086 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:26:18.826159 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:26:18.827210 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:26:18.839569 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:26:18.843604 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:26:18.849606 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:26:18.850565 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:26:18.924684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '09a475bb-7305-40b1-89d8-9b236662f22a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5f3b68b880>]}
[0m10:26:18.926481 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:26:18.927850 [info ] [MainThread]: 
[0m10:26:18.953754 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:26:18.954902 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:26:18.955956 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:26:18.956722 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:26:19.029448 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:26:19.030983 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:26:19.220656 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:26:19.288740 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:26:19.290099 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:26:19.303384 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:26:19.432987 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:26:19.436918 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:26:19.438977 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:26:19.442163 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:26:19.447764 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:26:19.450652 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:26:19.452518 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:26:19.455284 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:26:19.549437 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:26:19.553098 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:26:19.608428 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09a475bb-7305-40b1-89d8-9b236662f22a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5f3aab0ee0>]}
[0m10:26:19.609728 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m10:26:19.611086 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:26:19.613279 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:26:19.614425 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:26:19.615690 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:26:19.616979 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:26:19.618856 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:26:19.621166 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:26:19.623021 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:26:19.625329 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:26:19.627142 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:26:19.629219 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:26:19.630948 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:26:19.653488 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:26:19.755383 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:26:19.818144 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:26:19.825000 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:26:19.827376 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:26:19.834352 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:26:19.913335 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:26:20.138226 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:26:20.149193 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:26:20.209238 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:26:20.211821 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:26:20.213821 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:26:20.219068 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:26:20.441203 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:26:20.457196 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:26:20.470122 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.85s]
[0m10:26:20.510023 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:26:20.528003 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:26:20.530614 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:26:20.546704 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:26:20.548958 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:26:20.554622 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.93s]
[0m10:26:20.560807 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.93s]
[0m10:26:20.563816 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:26:20.609953 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:26:20.613768 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:26:20.615348 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:26:20.617170 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:26:20.619117 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:26:20.621251 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:26:20.623549 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:26:20.625438 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:26:20.626953 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:26:20.628591 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:26:20.630349 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:26:20.632137 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:26:20.633838 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:26:20.820282 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:26:20.824896 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:26:20.827063 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:26:20.830113 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:26:20.831956 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:26:20.844328 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:26:20.848396 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:26:21.039402 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:26:21.135001 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:26:21.230001 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:26:21.255107 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:26:21.321233 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:26:21.416490 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:26:21.509036 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:26:21.551564 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:26:21.621171 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:26:21.726275 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:26:21.820327 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_09a475bb_7305_40b1_89d8_9b236662f22a` 
  ...
[0m10:26:21.838880 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:26:21.852069 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:26:21.850219 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_09a475bb_7305_40b1_89d8_9b236662f22a` 
  ...
[0m10:26:21.919989 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:26:21.939992 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:26:21.951412 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09a475bb-7305-40b1-89d8-9b236662f22a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5f3a2f8fa0>]}
[0m10:26:22.040186 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.32s]
[0m10:26:22.119809 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:26:22.242323 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_09a475bb_7305_40b1_89d8_9b236662f22a`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:26:22.251889 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_09a475bb_7305_40b1_89d8_9b236662f22a`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:26:22.308419 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:26:22.310945 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:26:22.356972 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_09a475bb_7305_40b1_89d8_9b236662f22a'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:26:22.421807 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_09a475bb_7305_40b1_89d8_9b236662f22a'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:26:22.428253 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:26:22.431061 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:26:22.444665 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:26:22.450112 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:26:22.453154 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_09a475bb_7305_40b1_89d8_9b236662f22a`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:26:22.455364 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_09a475bb_7305_40b1_89d8_9b236662f22a`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:26:22.509235 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:26:22.515653 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_09a475bb_7305_40b1_89d8_9b236662f22a`)
      
    ...
[0m10:26:22.544050 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:26:22.547620 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:26:22.551778 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_09a475bb_7305_40b1_89d8_9b236662f22a`)
      
    ...
[0m10:26:22.562394 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:26:22.574742 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:26:22.580120 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_09a475bb_7305_40b1_89d8_9b236662f22a` 
    ...
[0m10:26:22.609951 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:26:22.620694 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:26:22.623483 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:26:22.638413 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_09a475bb_7305_40b1_89d8_9b236662f22a` 
  ...
[0m10:26:22.641416 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:26:22.649217 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_09a475bb_7305_40b1_89d8_9b236662f22a` 
    ...
[0m10:26:22.651889 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:26:22.714571 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:26:22.721776 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:26:22.734915 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_09a475bb_7305_40b1_89d8_9b236662f22a` 
  ...
[0m10:26:22.740963 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:26:22.746788 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09a475bb-7305-40b1-89d8-9b236662f22a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5f3aa320d0>]}
[0m10:26:22.749358 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:26:22.751386 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.12s]
[0m10:26:22.809548 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:26:22.818867 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:26:22.825235 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:26:22.829841 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09a475bb-7305-40b1-89d8-9b236662f22a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5f3c0e7340>]}
[0m10:26:22.831415 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.20s]
[0m10:26:22.833137 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:26:22.835181 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:26:22.835854 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:26:22.836430 [debug] [MainThread]: On list__clean: Close
[0m10:26:22.837052 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:26:22.837586 [debug] [MainThread]: On list__mart: Close
[0m10:26:22.838083 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:26:22.838621 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:26:22.839130 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:26:22.839743 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:26:22.840288 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:26:22.840841 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:26:22.841340 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:26:22.841886 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:26:22.843326 [info ] [MainThread]: 
[0m10:26:22.844049 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.82 seconds (4.82s).
[0m10:26:22.847793 [debug] [MainThread]: Command end result
[0m10:26:23.021842 [info ] [MainThread]: 
[0m10:26:23.023510 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:26:23.024777 [info ] [MainThread]: 
[0m10:26:23.026129 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:26:23.028458 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.5925665, "process_in_blocks": "0", "process_kernel_time": 0.700977, "process_mem_max_rss": "115232", "process_out_blocks": "9744", "process_user_time": 6.402328}
[0m10:26:23.029986 [debug] [MainThread]: Command `dbt build` succeeded at 10:26:23.029516 after 7.59 seconds
[0m10:26:23.031195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5f3f37b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5f3a091640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5f3a091220>]}
[0m10:26:23.032256 [debug] [MainThread]: Flushing usage events
[0m10:27:16.818526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70f6dd49f310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70f6da0f7b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70f6da0f79d0>]}


============================== 10:27:16.828128 | 4758c966-0ca5-46ae-bfd0-4f9b75df72bd ==============================
[0m10:27:16.828128 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:27:16.829293 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '.', 'introspect': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'use_colors': 'True', 'no_print': 'None', 'fail_fast': 'False', 'log_cache_events': 'False', 'empty': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_experimental_parser': 'False', 'debug': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'quiet': 'False', 'printer_width': '80', 'target_path': 'None', 'version_check': 'True', 'indirect_selection': 'eager'}
[0m10:27:17.426352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4758c966-0ca5-46ae-bfd0-4f9b75df72bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70f6da03f2e0>]}
[0m10:27:17.625196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4758c966-0ca5-46ae-bfd0-4f9b75df72bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70f6da1b7eb0>]}
[0m10:27:17.626640 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:27:18.134745 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:27:18.733326 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:27:18.734136 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:27:18.942672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4758c966-0ca5-46ae-bfd0-4f9b75df72bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70f6d9867ee0>]}
[0m10:27:19.426165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4758c966-0ca5-46ae-bfd0-4f9b75df72bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70f6d98b7850>]}
[0m10:27:19.427108 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:27:19.430396 [info ] [MainThread]: 
[0m10:27:19.431574 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:27:19.443654 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:27:19.445453 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:27:19.533814 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:27:19.550704 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:27:20.191317 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:27:20.196034 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:27:20.197700 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:27:20.216173 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:27:20.316869 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:27:20.318339 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:27:20.333953 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:27:20.340339 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:27:20.350267 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:27:20.351860 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:27:20.424079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4758c966-0ca5-46ae-bfd0-4f9b75df72bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70f6d97ae880>]}
[0m10:27:20.426051 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:27:20.427416 [info ] [MainThread]: 
[0m10:27:20.454730 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:27:20.455847 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:27:20.456929 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:27:20.457673 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:27:20.528437 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:27:20.530182 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:27:20.721793 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:27:20.785655 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:27:20.787040 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:27:20.798925 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:27:20.811768 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:27:20.814916 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:27:20.816861 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:27:20.819742 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:27:20.938250 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:27:20.941896 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:27:20.943719 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:27:20.946583 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:27:21.043793 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:27:21.047292 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:27:21.053419 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4758c966-0ca5-46ae-bfd0-4f9b75df72bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70f6d8be3760>]}
[0m10:27:21.054584 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m10:27:21.055902 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:27:21.058100 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:27:21.059147 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:27:21.060363 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:27:21.062071 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:27:21.063813 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:27:21.065952 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:27:21.117472 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:27:21.119786 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:27:21.121586 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:27:21.123755 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:27:21.125474 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:27:21.143785 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:27:21.249247 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:27:21.257603 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:27:21.261704 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:27:21.264143 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:27:21.328059 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:27:21.329873 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:27:21.624904 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:27:21.641166 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:27:21.653132 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:27:21.655219 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:27:21.657513 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:27:21.659412 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:27:21.935085 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:27:21.938357 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:27:21.955901 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:27:21.958960 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:27:21.961502 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:27:22.023049 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:27:22.035049 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.91s]
[0m10:27:22.033823 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.97s]
[0m10:27:22.041850 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.92s]
[0m10:27:22.044853 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:27:22.047656 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:27:22.050522 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:27:22.054648 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:27:22.055834 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:27:22.057431 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:27:22.058803 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:27:22.060968 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:27:22.062873 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:27:22.065038 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:27:22.117569 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:27:22.119333 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:27:22.121084 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:27:22.122790 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:27:22.145158 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:27:22.216397 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:27:22.246547 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:27:22.248777 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:27:22.250733 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:27:22.253241 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:27:22.316657 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:27:22.350164 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:27:22.463645 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:27:22.617731 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:27:22.727145 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:27:22.762873 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:27:22.919241 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:27:22.955228 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_4758c966_0ca5_46ae_bfd0_4f9b75df72bd` 
  ...
[0m10:27:23.021901 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:27:23.020320 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_4758c966_0ca5_46ae_bfd0_4f9b75df72bd` 
  ...
[0m10:27:23.030361 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:27:23.038902 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:27:23.054098 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:27:23.139916 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:27:23.232905 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:27:23.345723 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:27:23.429941 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_4758c966_0ca5_46ae_bfd0_4f9b75df72bd`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:27:23.434773 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:27:23.441429 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_4758c966_0ca5_46ae_bfd0_4f9b75df72bd`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:27:23.453117 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:27:23.459420 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4758c966-0ca5-46ae-bfd0-4f9b75df72bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70f6db3b1a60>]}
[0m10:27:23.462228 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.34s]
[0m10:27:23.517673 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:27:23.465173 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:27:23.521168 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:27:23.557770 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_4758c966_0ca5_46ae_bfd0_4f9b75df72bd'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:27:23.619691 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_4758c966_0ca5_46ae_bfd0_4f9b75df72bd'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:27:23.631218 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:27:23.634215 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:27:23.647841 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:27:23.653500 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:27:23.656373 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_4758c966_0ca5_46ae_bfd0_4f9b75df72bd`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:27:23.660722 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_4758c966_0ca5_46ae_bfd0_4f9b75df72bd`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:27:23.717410 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:27:23.687279 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:27:23.722486 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_4758c966_0ca5_46ae_bfd0_4f9b75df72bd`)
      
    ...
[0m10:27:23.726417 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_4758c966_0ca5_46ae_bfd0_4f9b75df72bd`)
      
    ...
[0m10:27:23.760598 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:27:23.762552 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:27:23.770800 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:27:23.782812 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:27:23.791958 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:27:23.817699 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:27:23.827094 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_4758c966_0ca5_46ae_bfd0_4f9b75df72bd` 
    ...
[0m10:27:23.823327 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_4758c966_0ca5_46ae_bfd0_4f9b75df72bd` 
    ...
[0m10:27:23.839706 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:27:23.847528 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:27:23.859293 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_4758c966_0ca5_46ae_bfd0_4f9b75df72bd` 
  ...
[0m10:27:23.864205 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_4758c966_0ca5_46ae_bfd0_4f9b75df72bd` 
  ...
[0m10:27:23.868341 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:27:23.917392 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:27:23.927370 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:27:23.939840 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:27:23.946860 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:27:23.954663 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:27:23.956403 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4758c966-0ca5-46ae-bfd0-4f9b75df72bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70f6d9fe4430>]}
[0m10:27:23.962345 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4758c966-0ca5-46ae-bfd0-4f9b75df72bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70f6d8adc5b0>]}
[0m10:27:23.965269 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.84s]
[0m10:27:24.017894 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.90s]
[0m10:27:24.019474 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:27:24.021189 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:27:24.023891 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:27:24.024624 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:27:24.025254 [debug] [MainThread]: On list__mart: Close
[0m10:27:24.025870 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:27:24.026448 [debug] [MainThread]: On list__clean: Close
[0m10:27:24.027034 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:27:24.027652 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:27:24.028202 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:27:24.028822 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:27:24.029371 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:27:24.030021 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:27:24.030599 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:27:24.031170 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:27:24.032487 [info ] [MainThread]: 
[0m10:27:24.033279 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.60 seconds (4.60s).
[0m10:27:24.037542 [debug] [MainThread]: Command end result
[0m10:27:24.164516 [info ] [MainThread]: 
[0m10:27:24.165457 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:27:24.166141 [info ] [MainThread]: 
[0m10:27:24.216937 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:27:24.220485 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.5987043, "process_in_blocks": "0", "process_kernel_time": 0.704214, "process_mem_max_rss": "114752", "process_out_blocks": "9744", "process_user_time": 6.479965}
[0m10:27:24.223114 [debug] [MainThread]: Command `dbt build` succeeded at 10:27:24.222383 after 7.60 seconds
[0m10:27:24.224678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70f6dd49f310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70f6d8304460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70f6db329f70>]}
[0m10:27:24.226066 [debug] [MainThread]: Flushing usage events
[0m10:28:17.043098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566cb72e310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566c8389b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566c83899d0>]}


============================== 10:28:17.106065 | 869f8f3b-ae35-4d20-8d7b-a45be6713985 ==============================
[0m10:28:17.106065 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:28:17.107088 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'static_parser': 'True', 'version_check': 'True', 'printer_width': '80', 'invocation_command': 'dbt build --profiles-dir . --target local', 'debug': 'False', 'profiles_dir': '.', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error': 'None', 'write_json': 'True', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'introspect': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'empty': 'False', 'target_path': 'None', 'log_cache_events': 'False', 'no_print': 'None'}
[0m10:28:17.633208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '869f8f3b-ae35-4d20-8d7b-a45be6713985', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566c82d42e0>]}
[0m10:28:17.828752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '869f8f3b-ae35-4d20-8d7b-a45be6713985', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566c83eceb0>]}
[0m10:28:17.830092 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:28:18.303027 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:28:18.836494 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:28:18.837305 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:28:19.040867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '869f8f3b-ae35-4d20-8d7b-a45be6713985', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566c7af1ee0>]}
[0m10:28:19.535367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '869f8f3b-ae35-4d20-8d7b-a45be6713985', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566c7b41850>]}
[0m10:28:19.536290 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:28:19.539603 [info ] [MainThread]: 
[0m10:28:19.540636 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:28:19.552225 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:28:19.564303 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:28:19.625891 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:28:19.638421 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:28:20.258297 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:28:20.263204 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:28:20.265259 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:28:20.271502 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:28:20.326119 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:28:20.327749 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:28:20.399575 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:28:20.402804 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:28:20.414832 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:28:20.417032 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:28:20.443396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '869f8f3b-ae35-4d20-8d7b-a45be6713985', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566c7a38880>]}
[0m10:28:20.445525 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:28:20.446911 [info ] [MainThread]: 
[0m10:28:20.523252 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:28:20.524398 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:28:20.525583 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:28:20.526307 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:28:20.543073 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:28:20.544256 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:28:20.724129 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:28:20.787908 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:28:20.789311 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:28:20.801645 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:28:20.933454 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:28:20.937395 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:28:20.939661 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:28:20.942640 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:28:20.948227 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:28:20.951072 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:28:21.000114 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:28:21.003395 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:28:21.048436 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:28:21.101314 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:28:21.107406 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '869f8f3b-ae35-4d20-8d7b-a45be6713985', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566cacb87f0>]}
[0m10:28:21.108617 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.58s]
[0m10:28:21.109926 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:28:21.111977 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:28:21.113443 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:28:21.114967 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:28:21.116052 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:28:21.117150 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:28:21.118645 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:28:21.119746 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:28:21.136388 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:28:21.148940 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:28:21.220760 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:28:21.224745 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:28:21.226463 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:28:21.228235 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:28:21.243003 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:28:21.309948 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:28:21.313236 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:28:21.325457 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:28:21.435498 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:28:21.609438 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:28:21.611462 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:28:21.539846 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:28:21.613986 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:28:21.616412 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:28:21.619889 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:28:21.865124 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:28:21.912816 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:28:21.916614 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:28:21.937425 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:28:21.946688 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.80s]
[0m10:28:22.007688 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:28:22.015380 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:28:22.018168 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:28:22.023939 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.91s]
[0m10:28:22.029989 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.81s]
[0m10:28:22.033043 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:28:22.036292 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:28:22.039915 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:28:22.041062 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:28:22.042628 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:28:22.043993 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:28:22.046121 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:28:22.047724 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:28:22.049588 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:28:22.100264 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:28:22.102650 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:28:22.104352 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:28:22.106395 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:28:22.123808 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:28:22.207042 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:28:22.211578 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:28:22.218311 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:28:22.219862 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:28:22.220670 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:28:22.247337 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:28:22.405857 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:28:22.510024 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:28:22.605627 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:28:22.715047 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:28:22.740299 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:28:22.806960 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:28:22.925854 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:28:22.929665 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_869f8f3b_ae35_4d20_8d7b_a45be6713985` 
  ...
[0m10:28:22.933248 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_869f8f3b_ae35_4d20_8d7b_a45be6713985` 
  ...
[0m10:28:22.941592 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:28:22.947383 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:28:23.001625 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:28:23.022177 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:28:23.102025 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:28:23.200369 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:28:23.303366 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:28:23.435315 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:28:23.438014 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_869f8f3b_ae35_4d20_8d7b_a45be6713985`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:28:23.499127 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_869f8f3b_ae35_4d20_8d7b_a45be6713985`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:28:23.503107 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '869f8f3b-ae35-4d20-8d7b-a45be6713985', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566c81e2520>]}
[0m10:28:23.509318 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.40s]
[0m10:28:23.512574 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:28:23.536357 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:28:23.553030 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:28:23.626753 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_869f8f3b_ae35_4d20_8d7b_a45be6713985'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:28:23.629214 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_869f8f3b_ae35_4d20_8d7b_a45be6713985'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:28:23.638274 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:28:23.641031 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:28:23.715150 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:28:23.718000 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:28:23.721021 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_869f8f3b_ae35_4d20_8d7b_a45be6713985`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:28:23.723193 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_869f8f3b_ae35_4d20_8d7b_a45be6713985`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:28:23.753084 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:28:23.755648 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:28:23.759964 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_869f8f3b_ae35_4d20_8d7b_a45be6713985`)
      
    ...
[0m10:28:23.764221 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_869f8f3b_ae35_4d20_8d7b_a45be6713985`)
      
    ...
[0m10:28:23.798832 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:28:23.812642 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:28:23.810353 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:28:23.826210 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:28:23.837212 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:28:23.840072 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:28:23.845750 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_869f8f3b_ae35_4d20_8d7b_a45be6713985` 
    ...
[0m10:28:23.899827 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_869f8f3b_ae35_4d20_8d7b_a45be6713985` 
    ...
[0m10:28:23.910396 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:28:23.918362 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:28:23.926129 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_869f8f3b_ae35_4d20_8d7b_a45be6713985` 
  ...
[0m10:28:23.938363 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_869f8f3b_ae35_4d20_8d7b_a45be6713985` 
  ...
[0m10:28:23.944505 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:28:24.000288 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:28:24.013205 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:28:24.019713 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:28:24.026068 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:28:24.032735 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '869f8f3b-ae35-4d20-8d7b-a45be6713985', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566c82c3be0>]}
[0m10:28:24.034725 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:28:24.036909 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.93s]
[0m10:28:24.041509 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '869f8f3b-ae35-4d20-8d7b-a45be6713985', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566ca096a00>]}
[0m10:28:24.043968 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:28:24.046072 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.99s]
[0m10:28:24.100065 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:28:24.104061 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:28:24.105193 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:28:24.106349 [debug] [MainThread]: On list__mart: Close
[0m10:28:24.107435 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:28:24.108677 [debug] [MainThread]: On list__clean: Close
[0m10:28:24.109739 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:28:24.110811 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:28:24.111851 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:28:24.112925 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:28:24.113968 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:28:24.115185 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:28:24.116305 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:28:24.117391 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:28:24.119699 [info ] [MainThread]: 
[0m10:28:24.121175 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.58 seconds (4.58s).
[0m10:28:24.129477 [debug] [MainThread]: Command end result
[0m10:28:24.307306 [info ] [MainThread]: 
[0m10:28:24.308923 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:28:24.310180 [info ] [MainThread]: 
[0m10:28:24.311556 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:28:24.314134 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.466946, "process_in_blocks": "0", "process_kernel_time": 0.722005, "process_mem_max_rss": "114040", "process_out_blocks": "9744", "process_user_time": 6.53087}
[0m10:28:24.315645 [debug] [MainThread]: Command `dbt build` succeeded at 10:28:24.315217 after 7.47 seconds
[0m10:28:24.316811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566cb72e310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566c83eceb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7566c66445b0>]}
[0m10:28:24.317941 [debug] [MainThread]: Flushing usage events
[0m10:29:16.598837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8ab919a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8ab5df9b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8ab5df9a30>]}


============================== 10:29:16.608021 | fb6102c4-5110-4d7a-996e-046c305baad3 ==============================
[0m10:29:16.608021 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:29:16.609025 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'target_path': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'static_parser': 'True', 'version_check': 'True', 'use_colors': 'True', 'profiles_dir': '.', 'write_json': 'True', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'no_print': 'None', 'debug': 'False', 'warn_error': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'printer_width': '80'}
[0m10:29:17.136911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fb6102c4-5110-4d7a-996e-046c305baad3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8ab5ce6af0>]}
[0m10:29:17.332739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fb6102c4-5110-4d7a-996e-046c305baad3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8ab5e33610>]}
[0m10:29:17.334029 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:29:17.798255 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:29:18.304250 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:29:18.304908 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:29:18.506466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fb6102c4-5110-4d7a-996e-046c305baad3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8ab555fe50>]}
[0m10:29:18.995779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fb6102c4-5110-4d7a-996e-046c305baad3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8ab5582970>]}
[0m10:29:18.996680 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:29:18.999939 [info ] [MainThread]: 
[0m10:29:19.001168 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:29:19.013231 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:29:19.014741 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:29:19.102335 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:29:19.120831 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:29:19.782994 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:29:19.794411 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:29:19.801743 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:29:19.807859 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:29:19.830647 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:29:19.832354 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:29:19.898179 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:29:19.902050 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:29:19.909360 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:29:19.916211 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:29:19.930614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb6102c4-5110-4d7a-996e-046c305baad3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8ab54bd340>]}
[0m10:29:19.932442 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:29:19.933814 [info ] [MainThread]: 
[0m10:29:20.008544 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:29:20.009747 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:29:20.010850 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:29:20.011626 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:29:20.028892 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:29:20.030286 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:29:20.215346 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:29:20.284320 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:29:20.285767 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:29:20.299763 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:29:20.426614 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:29:20.430411 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:29:20.432383 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:29:20.435221 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:29:20.440716 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:29:20.443650 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:29:20.494021 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:29:20.497556 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:29:20.543804 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:29:20.547149 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:29:20.599664 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb6102c4-5110-4d7a-996e-046c305baad3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8ab4921af0>]}
[0m10:29:20.600780 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m10:29:20.602099 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:29:20.604569 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:29:20.606210 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:29:20.607899 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:29:20.609506 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:29:20.611481 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:29:20.613351 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:29:20.615080 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:29:20.616646 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:29:20.618781 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:29:20.620233 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:29:20.621422 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:29:20.623197 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:29:20.728652 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:29:20.730343 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:29:20.739167 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:29:20.742022 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:29:20.793938 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:29:20.801526 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:29:21.104679 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:29:21.107647 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:29:21.127613 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:29:21.130035 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:29:21.132207 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:29:21.134337 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:29:21.411866 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:29:21.418761 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:29:21.421785 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:29:21.431674 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:29:21.495649 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:29:21.498367 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:29:21.502143 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.89s]
[0m10:29:21.507727 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m10:29:21.513293 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.90s]
[0m10:29:21.516142 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:29:21.518981 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:29:21.521720 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:29:21.525215 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:29:21.526353 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:29:21.527970 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:29:21.529605 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:29:21.531506 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:29:21.533909 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:29:21.535784 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:29:21.537403 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:29:21.538920 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:29:21.540758 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:29:21.542403 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:29:21.543989 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:29:21.718329 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:29:21.728321 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:29:21.730313 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:29:21.733659 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:29:21.735504 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:29:21.803054 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:29:21.804808 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:29:21.838216 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:29:21.927807 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:29:22.022824 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:29:22.111146 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:29:22.125775 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:29:22.221629 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:29:22.316286 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:29:22.419024 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:29:22.506858 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:29:22.538434 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:29:22.636067 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:29:22.713986 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:29:22.740905 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb6102c4-5110-4d7a-996e-046c305baad3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8ab5e47bb0>]}
[0m10:29:22.816872 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.20s]
[0m10:29:22.803966 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_fb6102c4_5110_4d7a_996e_046c305baad3` 
  ...
[0m10:29:22.828066 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_fb6102c4_5110_4d7a_996e_046c305baad3` 
  ...
[0m10:29:22.830448 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:29:22.835585 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:29:22.837603 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:29:23.217072 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_fb6102c4_5110_4d7a_996e_046c305baad3`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:29:23.222228 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_fb6102c4_5110_4d7a_996e_046c305baad3`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:29:23.251103 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:29:23.253907 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:29:23.338248 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_fb6102c4_5110_4d7a_996e_046c305baad3'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:29:23.401817 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_fb6102c4_5110_4d7a_996e_046c305baad3'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:29:23.408419 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:29:23.411448 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:29:23.425456 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:29:23.431166 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:29:23.434377 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_fb6102c4_5110_4d7a_996e_046c305baad3`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:29:23.438226 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_fb6102c4_5110_4d7a_996e_046c305baad3`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:29:23.495407 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:29:23.497134 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:29:23.501440 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_fb6102c4_5110_4d7a_996e_046c305baad3`)
      
    ...
[0m10:29:23.505798 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_fb6102c4_5110_4d7a_996e_046c305baad3`)
      
    ...
[0m10:29:23.531380 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:29:23.538174 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:29:23.540419 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:29:23.552184 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:29:23.555073 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:29:23.597713 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_fb6102c4_5110_4d7a_996e_046c305baad3` 
    ...
[0m10:29:23.600763 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:29:23.608751 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_fb6102c4_5110_4d7a_996e_046c305baad3` 
    ...
[0m10:29:23.611475 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:29:23.625552 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_fb6102c4_5110_4d7a_996e_046c305baad3` 
  ...
[0m10:29:23.628671 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:29:23.695271 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:29:23.643509 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_fb6102c4_5110_4d7a_996e_046c305baad3` 
  ...
[0m10:29:23.710468 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:29:23.715884 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:29:23.723610 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:29:23.724845 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb6102c4-5110-4d7a-996e-046c305baad3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8ab3ffd520>]}
[0m10:29:23.740009 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:29:23.794120 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.19s]
[0m10:29:23.799843 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:29:23.802822 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:29:23.809073 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb6102c4-5110-4d7a-996e-046c305baad3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8ab513b550>]}
[0m10:29:23.811384 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.27s]
[0m10:29:23.814170 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:29:23.818154 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:29:23.819448 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:29:23.820699 [debug] [MainThread]: On list__mart: Close
[0m10:29:23.822119 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:29:23.823323 [debug] [MainThread]: On list__clean: Close
[0m10:29:23.824443 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:29:23.825589 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:29:23.826648 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:29:23.827819 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:29:23.828888 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:29:23.830015 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:29:23.831057 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:29:23.832157 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:29:23.834425 [info ] [MainThread]: 
[0m10:29:23.835883 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.83 seconds (4.83s).
[0m10:29:23.894359 [debug] [MainThread]: Command end result
[0m10:29:24.109116 [info ] [MainThread]: 
[0m10:29:24.110786 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:29:24.112100 [info ] [MainThread]: 
[0m10:29:24.113482 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:29:24.116210 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.709843, "process_in_blocks": "0", "process_kernel_time": 0.70308, "process_mem_max_rss": "114312", "process_out_blocks": "9744", "process_user_time": 6.505236}
[0m10:29:24.117814 [debug] [MainThread]: Command `dbt build` succeeded at 10:29:24.117379 after 7.71 seconds
[0m10:29:24.119077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8ab919a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8ab5453b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8ab70b7e80>]}
[0m10:29:24.120315 [debug] [MainThread]: Flushing usage events
[0m10:30:15.914433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb46961de20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb46627abb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb46627aa60>]}


============================== 10:30:15.923713 | 76521054-0d3e-4c65-9301-58b461545548 ==============================
[0m10:30:15.923713 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:30:15.924800 [debug] [MainThread]: running dbt with arguments {'log_path': '/workdir/transforms/04_btc/logs', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'version_check': 'True', 'printer_width': '80', 'target_path': 'None', 'quiet': 'False', 'fail_fast': 'False', 'debug': 'False', 'log_format': 'default', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'partial_parse': 'True', 'empty': 'False', 'write_json': 'True', 'introspect': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'static_parser': 'True', 'profiles_dir': '.'}
[0m10:30:16.448479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '76521054-0d3e-4c65-9301-58b461545548', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb4662c83d0>]}
[0m10:30:16.640134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '76521054-0d3e-4c65-9301-58b461545548', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb4662b4a60>]}
[0m10:30:16.641434 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:30:17.054356 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:30:17.557290 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:30:17.557942 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:30:17.756431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '76521054-0d3e-4c65-9301-58b461545548', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb4659e0e50>]}
[0m10:30:18.240735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '76521054-0d3e-4c65-9301-58b461545548', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb465a1e4c0>]}
[0m10:30:18.241616 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:30:18.245039 [info ] [MainThread]: 
[0m10:30:18.246579 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:30:18.262461 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:30:18.263696 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:30:18.353438 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:30:18.417374 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:30:19.001611 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:30:19.015931 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:30:19.033390 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:30:19.043814 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:30:19.129383 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:30:19.131375 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:30:19.144430 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:30:19.149776 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:30:19.158202 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:30:19.160103 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:30:19.223796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '76521054-0d3e-4c65-9301-58b461545548', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb4661de9a0>]}
[0m10:30:19.224912 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:30:19.225552 [info ] [MainThread]: 
[0m10:30:19.245295 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:30:19.246482 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:30:19.247593 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:30:19.248321 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:30:19.316093 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:30:19.317776 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:30:19.456667 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:30:19.563470 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:30:19.564887 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:30:19.577012 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:30:19.656130 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:30:19.659372 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:30:19.661194 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:30:19.664004 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:30:19.718000 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:30:19.721201 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:30:19.722998 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:30:19.725678 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:30:19.820376 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:30:19.824105 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:30:19.830126 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76521054-0d3e-4c65-9301-58b461545548', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb464d4acd0>]}
[0m10:30:19.831248 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.58s]
[0m10:30:19.832549 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:30:19.835069 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:30:19.836518 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:30:19.837859 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:30:19.839228 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:30:19.841221 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:30:19.842592 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:30:19.844249 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:30:19.846453 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:30:19.848042 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:30:19.849298 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:30:19.850981 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:30:19.852407 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:30:20.117138 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:30:20.062518 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:30:20.057850 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:30:20.121968 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:30:20.149571 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:30:20.214519 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:30:20.432931 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:30:20.437769 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:30:20.449227 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:30:20.451294 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:30:20.452391 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:30:20.454239 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:30:20.632094 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:30:20.637102 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:30:20.644158 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:30:20.651208 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:30:20.659384 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:30:20.720649 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:30:20.731869 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.89s]
[0m10:30:20.739691 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.89s]
[0m10:30:20.737921 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m10:30:20.743259 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:30:20.746166 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:30:20.749115 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:30:20.753255 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:30:20.754617 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:30:20.756672 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:30:20.758775 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:30:20.760794 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:30:20.762498 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:30:20.816072 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:30:20.817936 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:30:20.819584 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:30:20.821241 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:30:20.822832 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:30:20.834965 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:30:20.917526 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:30:20.933891 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:30:20.948413 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:30:20.952127 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:30:20.959273 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:30:21.019783 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:30:21.146847 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:30:21.225165 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:30:21.260997 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:30:21.361948 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:30:21.638388 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m10:30:21.658179 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:30:21.731082 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:30:21.828077 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:30:21.927691 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_76521054_0d3e_4c65_9301_58b461545548` 
  ...
[0m10:30:21.930797 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_76521054_0d3e_4c65_9301_58b461545548` 
  ...
[0m10:30:21.933318 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:30:21.940179 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:30:21.942920 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:30:21.947010 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:30:22.133112 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:30:22.238646 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:30:22.331165 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:30:22.347195 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76521054-0d3e-4c65-9301-58b461545548', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb466175190>]}
[0m10:30:22.432417 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_76521054_0d3e_4c65_9301_58b461545548`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:30:22.435235 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_76521054_0d3e_4c65_9301_58b461545548`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:30:22.437996 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.53s]
[0m10:30:22.444774 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:30:22.470281 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:30:22.516388 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:30:22.615262 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_76521054_0d3e_4c65_9301_58b461545548'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:30:22.562694 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_76521054_0d3e_4c65_9301_58b461545548'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:30:22.626249 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:30:22.629022 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:30:22.648025 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:30:22.656313 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:30:22.659470 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_76521054_0d3e_4c65_9301_58b461545548`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:30:22.661795 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_76521054_0d3e_4c65_9301_58b461545548`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:30:22.742785 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:30:22.747105 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_76521054_0d3e_4c65_9301_58b461545548`)
      
    ...
[0m10:30:22.749643 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:30:22.754959 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_76521054_0d3e_4c65_9301_58b461545548`)
      
    ...
[0m10:30:22.784516 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:30:22.786335 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:30:22.795342 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:30:22.800653 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:30:22.814230 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:30:22.822135 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:30:22.820230 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_76521054_0d3e_4c65_9301_58b461545548` 
    ...
[0m10:30:22.828645 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_76521054_0d3e_4c65_9301_58b461545548` 
    ...
[0m10:30:22.840603 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:30:22.848501 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:30:22.855871 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_76521054_0d3e_4c65_9301_58b461545548` 
  ...
[0m10:30:22.868460 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_76521054_0d3e_4c65_9301_58b461545548` 
  ...
[0m10:30:22.921844 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:30:22.924440 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:30:22.937370 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:30:22.949781 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:30:22.955900 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:30:22.958622 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:30:23.016730 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76521054-0d3e-4c65-9301-58b461545548', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb4655169d0>]}
[0m10:30:23.023163 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76521054-0d3e-4c65-9301-58b461545548', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb4653f3400>]}
[0m10:30:23.025700 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.25s]
[0m10:30:23.028294 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.21s]
[0m10:30:23.031668 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:30:23.034678 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:30:23.042755 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:30:23.043936 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:30:23.045092 [debug] [MainThread]: On list__mart: Close
[0m10:30:23.046190 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:30:23.047305 [debug] [MainThread]: On list__clean: Close
[0m10:30:23.048356 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:30:23.049504 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:30:23.051246 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:30:23.052704 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:30:23.053765 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:30:23.054846 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:30:23.055932 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:30:23.057025 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:30:23.059293 [info ] [MainThread]: 
[0m10:30:23.060692 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.81 seconds (4.81s).
[0m10:30:23.119379 [debug] [MainThread]: Command end result
[0m10:30:23.328670 [info ] [MainThread]: 
[0m10:30:23.330314 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:30:23.331585 [info ] [MainThread]: 
[0m10:30:23.332965 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:30:23.335703 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.6166553, "process_in_blocks": "0", "process_kernel_time": 0.71499, "process_mem_max_rss": "114968", "process_out_blocks": "9744", "process_user_time": 6.452866}
[0m10:30:23.337254 [debug] [MainThread]: Command `dbt build` succeeded at 10:30:23.336827 after 7.62 seconds
[0m10:30:23.338586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb46961de20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb4643f2100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb46752c6d0>]}
[0m10:30:23.339860 [debug] [MainThread]: Flushing usage events
[0m10:31:16.835003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e1440ef310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e140d57b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e140d579d0>]}


============================== 10:31:16.844149 | 5af07036-7059-4059-b82d-61372384e290 ==============================
[0m10:31:16.844149 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:31:16.845251 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'version_check': 'True', 'introspect': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'fail_fast': 'False', 'profiles_dir': '.', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'debug': 'False', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'empty': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'target_path': 'None', 'printer_width': '80', 'use_colors': 'True', 'log_cache_events': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'write_json': 'True'}
[0m10:31:17.427072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5af07036-7059-4059-b82d-61372384e290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e1436843a0>]}
[0m10:31:17.620644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5af07036-7059-4059-b82d-61372384e290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e14182c3d0>]}
[0m10:31:17.621901 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:31:18.034890 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:31:18.540615 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:31:18.541249 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:31:18.746480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5af07036-7059-4059-b82d-61372384e290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e1404abee0>]}
[0m10:31:19.252255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5af07036-7059-4059-b82d-61372384e290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e140495b50>]}
[0m10:31:19.253128 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:31:19.256251 [info ] [MainThread]: 
[0m10:31:19.257265 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:31:19.269004 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:31:19.307033 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:31:19.419003 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:31:19.437950 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:31:20.271154 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:31:20.280315 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:31:20.288443 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:31:20.321524 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:31:20.409801 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:31:20.421447 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:31:20.426456 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:31:20.432021 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:31:20.440726 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:31:20.450982 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:31:20.518088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5af07036-7059-4059-b82d-61372384e290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e13fb4ca90>]}
[0m10:31:20.520068 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:31:20.521354 [info ] [MainThread]: 
[0m10:31:20.548513 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:31:20.550250 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:31:20.552032 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:31:20.553206 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:31:20.627114 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:31:20.628667 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:31:20.820629 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:31:20.888999 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:31:20.890317 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:31:20.901735 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:31:21.030982 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:31:21.034710 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:31:21.036704 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:31:21.039812 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:31:21.045297 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:31:21.048196 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:31:21.050076 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:31:21.052926 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:31:21.144803 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:31:21.148109 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:31:21.154241 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5af07036-7059-4059-b82d-61372384e290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e13f8326a0>]}
[0m10:31:21.155427 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m10:31:21.205785 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:31:21.207887 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:31:21.208724 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:31:21.209735 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:31:21.211073 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:31:21.212328 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:31:21.213257 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:31:21.214806 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:31:21.216162 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:31:21.217135 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:31:21.218160 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:31:21.219340 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:31:21.220102 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:31:21.307797 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:31:21.313466 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:31:21.330998 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:31:21.333415 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:31:21.411249 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:31:21.428673 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:31:21.524940 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:31:21.534355 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:31:21.614626 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:31:21.616369 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:31:21.619071 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:31:21.621730 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:31:21.885484 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:31:21.907252 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:31:21.913170 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:31:21.930574 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.71s]
[0m10:31:21.933529 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:31:21.937724 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:31:21.941261 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:31:21.950829 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.73s]
[0m10:31:22.007199 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:31:22.010072 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:31:22.016704 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.80s]
[0m10:31:22.019593 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:31:22.022518 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:31:22.023857 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:31:22.025319 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:31:22.026677 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:31:22.028625 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:31:22.030649 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:31:22.032779 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:31:22.034810 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:31:22.036357 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:31:22.037990 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:31:22.039633 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:31:22.106122 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:31:22.147087 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:31:22.155433 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:31:22.219615 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:31:22.222195 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:31:22.224253 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:31:22.241542 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:31:22.353413 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:31:22.453994 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:31:22.632694 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:31:22.732273 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:31:22.923421 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:31:22.937941 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:31:23.029276 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:31:23.148409 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:31:23.138314 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5af07036_7059_4059_b82d_61372384e290` 
  ...
[0m10:31:23.213317 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5af07036_7059_4059_b82d_61372384e290` 
  ...
[0m10:31:23.218246 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:31:23.224719 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:31:23.227306 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:31:23.231393 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:31:23.306940 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:31:23.352077 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:31:23.523562 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:31:23.533902 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5af07036-7059-4059-b82d-61372384e290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e13f0a05b0>]}
[0m10:31:23.541471 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.50s]
[0m10:31:23.626360 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:31:23.707145 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_5af07036_7059_4059_b82d_61372384e290`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:31:23.710879 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_5af07036_7059_4059_b82d_61372384e290`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:31:24.549685 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.84 seconds
[0m10:31:24.560258 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.85 seconds
[0m10:31:24.585294 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_5af07036_7059_4059_b82d_61372384e290'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:31:24.595478 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_5af07036_7059_4059_b82d_61372384e290'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:31:24.611810 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:31:24.619778 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:31:24.633055 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:31:24.642122 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:31:24.645134 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_5af07036_7059_4059_b82d_61372384e290`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:31:24.647396 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_5af07036_7059_4059_b82d_61372384e290`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:31:24.679927 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:31:24.708780 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5af07036_7059_4059_b82d_61372384e290`)
      
    ...
[0m10:31:24.711663 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:31:24.715957 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5af07036_7059_4059_b82d_61372384e290`)
      
    ...
[0m10:31:24.741413 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:31:24.744010 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:31:24.754149 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:31:24.764213 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:31:24.774892 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:31:24.812029 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:31:24.809873 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5af07036_7059_4059_b82d_61372384e290` 
    ...
[0m10:31:24.818377 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5af07036_7059_4059_b82d_61372384e290` 
    ...
[0m10:31:24.828740 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:31:24.831370 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:31:24.844178 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5af07036_7059_4059_b82d_61372384e290` 
  ...
[0m10:31:24.856482 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5af07036_7059_4059_b82d_61372384e290` 
  ...
[0m10:31:24.910894 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:31:24.923977 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:31:24.926775 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:31:24.939132 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:31:24.945485 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:31:24.948178 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:31:25.006798 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5af07036-7059-4059-b82d-61372384e290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e13ffce970>]}
[0m10:31:25.013484 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5af07036-7059-4059-b82d-61372384e290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e13f020f40>]}
[0m10:31:25.015950 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.98s]
[0m10:31:25.018487 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.98s]
[0m10:31:25.021333 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:31:25.024184 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:31:25.028777 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:31:25.030343 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:31:25.031558 [debug] [MainThread]: On list__clean: Close
[0m10:31:25.032700 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:31:25.033905 [debug] [MainThread]: On list__mart: Close
[0m10:31:25.034951 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:31:25.036064 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:31:25.037114 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:31:25.038204 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:31:25.039295 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:31:25.040361 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:31:25.041393 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:31:25.042463 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:31:25.044678 [info ] [MainThread]: 
[0m10:31:25.046072 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.79 seconds (5.79s).
[0m10:31:25.054039 [debug] [MainThread]: Command end result
[0m10:31:25.323114 [info ] [MainThread]: 
[0m10:31:25.325084 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:31:25.326424 [info ] [MainThread]: 
[0m10:31:25.327812 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:31:25.330829 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 8.687069, "process_in_blocks": "0", "process_kernel_time": 0.717572, "process_mem_max_rss": "114832", "process_out_blocks": "9744", "process_user_time": 6.594362}
[0m10:31:25.332806 [debug] [MainThread]: Command `dbt build` succeeded at 10:31:25.332284 after 8.69 seconds
[0m10:31:25.334332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e1440ef310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e13ef33640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e13ef33100>]}
[0m10:31:25.335925 [debug] [MainThread]: Flushing usage events
[0m10:32:17.827844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751e6b230310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751e67e8db20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751e67e8d9d0>]}


============================== 10:32:17.837138 | f97d2365-3a6f-4eb1-b884-2452bffe1779 ==============================
[0m10:32:17.837138 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:32:17.838279 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'no_print': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'empty': 'False', 'debug': 'False', 'profiles_dir': '.', 'quiet': 'False', 'static_parser': 'True', 'write_json': 'True', 'version_check': 'True', 'partial_parse': 'True', 'warn_error': 'None', 'log_cache_events': 'False', 'fail_fast': 'False', 'target_path': 'None', 'cache_selected_only': 'False', 'log_format': 'default', 'use_experimental_parser': 'False', 'use_colors': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'printer_width': '80'}
[0m10:32:18.412272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f97d2365-3a6f-4eb1-b884-2452bffe1779', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751e67d542e0>]}
[0m10:32:18.604120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f97d2365-3a6f-4eb1-b884-2452bffe1779', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751e67d54a90>]}
[0m10:32:18.605384 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:32:19.032335 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:32:19.534150 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:32:19.534810 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:32:19.743573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f97d2365-3a6f-4eb1-b884-2452bffe1779', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751e675f0eb0>]}
[0m10:32:20.307501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f97d2365-3a6f-4eb1-b884-2452bffe1779', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751e6762fe80>]}
[0m10:32:20.308390 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:32:20.311636 [info ] [MainThread]: 
[0m10:32:20.312638 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:32:20.325359 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:32:20.326866 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:32:20.425956 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:32:20.444649 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:32:21.333394 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:32:21.338801 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:32:21.363251 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:32:21.374014 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:32:21.418795 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:32:21.420204 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:32:21.434065 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:32:21.441822 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:32:21.497821 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:32:21.500327 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:32:21.524649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f97d2365-3a6f-4eb1-b884-2452bffe1779', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751e6738a1c0>]}
[0m10:32:21.525976 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:32:21.526784 [info ] [MainThread]: 
[0m10:32:21.600751 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:32:21.602229 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:32:21.603668 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:32:21.604548 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:32:21.623291 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:32:21.624422 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:32:21.819942 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:32:22.005898 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:32:22.007793 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:32:22.033753 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:32:22.206253 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:32:22.211042 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:32:22.212942 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:32:22.215853 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:32:22.221373 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:32:22.224223 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:32:22.226013 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:32:22.228894 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:32:22.321939 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:32:22.325399 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:32:22.331245 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f97d2365-3a6f-4eb1-b884-2452bffe1779', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751e66b2ef40>]}
[0m10:32:22.332362 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.73s]
[0m10:32:22.333804 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:32:22.336126 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:32:22.337554 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:32:22.339362 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:32:22.341308 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:32:22.342689 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:32:22.344004 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:32:22.345503 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:32:22.346845 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:32:22.349507 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:32:22.409029 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:32:22.434432 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:32:22.502494 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:32:22.504446 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:32:22.518876 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:32:22.533137 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:32:22.535369 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:32:22.537701 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:32:22.613934 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:32:22.906656 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:32:22.908418 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:32:22.902104 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:32:22.911671 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:32:22.946045 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:32:22.948401 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:32:23.233352 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:32:23.249647 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:32:23.263720 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.91s]
[0m10:32:23.266857 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:32:23.348430 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:32:23.366943 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:32:23.372975 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.03s]
[0m10:32:23.375841 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:32:23.378689 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:32:23.392025 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:32:23.398526 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.99s]
[0m10:32:23.401677 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:32:23.404392 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:32:23.405516 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:32:23.407260 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:32:23.408866 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:32:23.410960 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:32:23.412842 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:32:23.414891 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:32:23.416662 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:32:23.418426 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:32:23.420086 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:32:23.421705 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:32:23.444281 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:32:23.531447 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:32:23.533689 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:32:23.599697 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:32:23.601764 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:32:23.603923 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:32:23.610842 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:32:23.710620 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:32:23.744012 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:32:23.909445 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:32:24.034941 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:32:24.123221 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:32:24.140798 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:32:24.315301 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:32:24.421634 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:32:24.426974 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f97d2365_3a6f_4eb1_b884_2452bffe1779` 
  ...
[0m10:32:24.510872 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f97d2365_3a6f_4eb1_b884_2452bffe1779` 
  ...
[0m10:32:24.514024 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:32:24.522614 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:32:24.525398 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:32:24.599367 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:32:24.612726 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:32:24.724622 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:32:24.827822 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:32:24.903966 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f97d2365-3a6f-4eb1-b884-2452bffe1779', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751e6711fd00>]}
[0m10:32:24.922360 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.48s]
[0m10:32:24.999922 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_f97d2365_3a6f_4eb1_b884_2452bffe1779`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:32:25.004338 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:32:25.013379 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_f97d2365_3a6f_4eb1_b884_2452bffe1779`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:32:25.106352 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:32:25.138402 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.12 seconds
[0m10:32:25.143660 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_f97d2365_3a6f_4eb1_b884_2452bffe1779'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:32:25.154024 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_f97d2365_3a6f_4eb1_b884_2452bffe1779'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:32:25.204123 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:32:25.217176 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:32:25.220025 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:32:25.225450 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:32:25.228862 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_f97d2365_3a6f_4eb1_b884_2452bffe1779`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:32:25.231056 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_f97d2365_3a6f_4eb1_b884_2452bffe1779`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:32:25.262198 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:32:25.264780 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:32:25.298081 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f97d2365_3a6f_4eb1_b884_2452bffe1779`)
      
    ...
[0m10:32:25.302438 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f97d2365_3a6f_4eb1_b884_2452bffe1779`)
      
    ...
[0m10:32:25.353286 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:32:25.362898 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:32:25.368166 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:32:25.371337 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:32:25.384150 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:32:25.390216 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f97d2365_3a6f_4eb1_b884_2452bffe1779` 
    ...
[0m10:32:25.405384 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:32:25.411221 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f97d2365_3a6f_4eb1_b884_2452bffe1779` 
    ...
[0m10:32:25.415263 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:32:25.428705 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:32:25.431291 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f97d2365_3a6f_4eb1_b884_2452bffe1779` 
  ...
[0m10:32:25.446612 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f97d2365_3a6f_4eb1_b884_2452bffe1779` 
  ...
[0m10:32:25.503231 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:32:25.511070 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:32:25.518210 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:32:25.530105 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:32:25.536513 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:32:25.544409 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:32:25.546029 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f97d2365-3a6f-4eb1-b884-2452bffe1779', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751e67e3f9d0>]}
[0m10:32:25.603713 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f97d2365-3a6f-4eb1-b884-2452bffe1779', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751e65f8b4f0>]}
[0m10:32:25.606077 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.13s]
[0m10:32:25.608905 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.19s]
[0m10:32:25.611853 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:32:25.614921 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:32:25.620594 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:32:25.621783 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:32:25.622987 [debug] [MainThread]: On list__clean: Close
[0m10:32:25.624044 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:32:25.625160 [debug] [MainThread]: On list__mart: Close
[0m10:32:25.626253 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:32:25.627403 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:32:25.628447 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:32:25.629720 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:32:25.630796 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:32:25.631911 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:32:25.632971 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:32:25.634087 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:32:25.636331 [info ] [MainThread]: 
[0m10:32:25.637832 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.32 seconds (5.32s).
[0m10:32:25.646112 [debug] [MainThread]: Command end result
[0m10:32:25.917213 [info ] [MainThread]: 
[0m10:32:25.918907 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:32:25.920181 [info ] [MainThread]: 
[0m10:32:25.921568 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:32:25.924283 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 8.292522, "process_in_blocks": "0", "process_kernel_time": 0.745643, "process_mem_max_rss": "114604", "process_out_blocks": "9744", "process_user_time": 6.569323}
[0m10:32:25.925883 [debug] [MainThread]: Command `dbt build` succeeded at 10:32:25.925454 after 8.29 seconds
[0m10:32:25.927171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751e6b230310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751e6762fe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751e691b9d00>]}
[0m10:32:25.928383 [debug] [MainThread]: Flushing usage events
[0m10:33:18.293975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726e59a11310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726e5667eb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726e5667e9d0>]}


============================== 10:33:18.303146 | 5e935155-7d0d-4275-8873-0244ba7e3326 ==============================
[0m10:33:18.303146 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:33:18.354365 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'target_path': 'None', 'write_json': 'True', 'quiet': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'version_check': 'True', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'no_print': 'None', 'use_colors': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'debug': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'empty': 'False', 'log_cache_events': 'False', 'warn_error': 'None', 'printer_width': '80'}
[0m10:33:18.895710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5e935155-7d0d-4275-8873-0244ba7e3326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726e565c62e0>]}
[0m10:33:19.161215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5e935155-7d0d-4275-8873-0244ba7e3326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726e566deeb0>]}
[0m10:33:19.162515 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:33:19.574812 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:33:20.081201 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:33:20.081863 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:33:20.283359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5e935155-7d0d-4275-8873-0244ba7e3326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726e55de0ee0>]}
[0m10:33:20.808937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5e935155-7d0d-4275-8873-0244ba7e3326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726e55e307c0>]}
[0m10:33:20.809919 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:33:20.814750 [info ] [MainThread]: 
[0m10:33:20.815914 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:33:20.864002 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:33:20.884863 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:33:20.888169 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:33:20.891881 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:33:21.409649 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:33:21.414640 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:33:21.415875 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:33:21.420096 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:33:21.460490 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:33:21.472199 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:33:21.473131 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:33:21.477002 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:33:21.483589 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:33:21.492410 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:33:21.555233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e935155-7d0d-4275-8873-0244ba7e3326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726e554a4b20>]}
[0m10:33:21.556922 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:33:21.557999 [info ] [MainThread]: 
[0m10:33:21.573946 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:33:21.575130 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:33:21.576230 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:33:21.576989 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:33:21.594251 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:33:21.595444 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:33:21.768906 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:33:21.824388 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:33:21.826045 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:33:21.836138 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:33:21.974947 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:33:21.977901 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:33:21.979837 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:33:21.982352 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:33:21.990459 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:33:21.993501 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:33:21.995518 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:33:21.998195 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:33:22.156139 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:33:22.159870 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:33:22.167330 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e935155-7d0d-4275-8873-0244ba7e3326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726e550628b0>]}
[0m10:33:22.168643 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m10:33:22.170013 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:33:22.171631 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:33:22.172464 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:33:22.173355 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:33:22.174211 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:33:22.175199 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:33:22.176106 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:33:22.176968 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:33:22.178037 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:33:22.179377 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:33:22.180339 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:33:22.196859 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:33:22.256439 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:33:22.257307 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:33:22.264251 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:33:22.271480 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:33:22.272757 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:33:22.273840 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:33:22.358943 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:33:22.367088 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:33:22.379843 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:33:22.384146 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:33:22.385937 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:33:22.386870 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:33:22.388331 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:33:22.533055 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:33:22.555205 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:33:22.565031 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:33:22.563691 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.38s]
[0m10:33:22.569521 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:33:22.573596 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:33:22.576613 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.40s]
[0m10:33:22.578019 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:33:22.579334 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:33:22.586610 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:33:22.591568 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.42s]
[0m10:33:22.593028 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:33:22.594688 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:33:22.595596 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:33:22.596669 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:33:22.598640 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:33:22.600678 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:33:22.602605 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:33:22.603895 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:33:22.604664 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:33:22.605553 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:33:22.653820 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:33:22.654785 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:33:22.655571 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:33:22.674052 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:33:22.681962 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:33:22.688670 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:33:22.690111 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:33:22.690819 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:33:22.754046 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:33:22.796803 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:33:22.901285 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:33:23.070674 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:33:23.159473 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:33:23.195776 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e935155_7d0d_4275_8873_0244ba7e3326` 
  ...
[0m10:33:23.202176 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:33:23.271593 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:33:23.283593 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e935155_7d0d_4275_8873_0244ba7e3326` 
  ...
[0m10:33:23.285602 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:33:23.367398 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:33:23.459058 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:33:23.476150 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e935155_7d0d_4275_8873_0244ba7e3326`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:33:23.478249 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e935155_7d0d_4275_8873_0244ba7e3326`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:33:23.490335 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:33:23.497783 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:33:23.500490 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:33:23.555173 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:33:23.558281 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:33:23.566164 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:33:23.680389 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:33:23.685027 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_5e935155_7d0d_4275_8873_0244ba7e3326'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:33:23.678226 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_5e935155_7d0d_4275_8873_0244ba7e3326'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:33:23.696475 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:33:23.700032 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:33:23.755515 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:33:23.759566 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e935155-7d0d-4275-8873-0244ba7e3326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726e55a52dc0>]}
[0m10:33:23.772826 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:33:23.778283 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:33:23.780807 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.15s]
[0m10:33:23.784681 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:33:23.786908 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e935155_7d0d_4275_8873_0244ba7e3326`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:33:23.789703 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e935155_7d0d_4275_8873_0244ba7e3326`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:33:23.824786 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:33:23.826821 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:33:23.860375 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e935155_7d0d_4275_8873_0244ba7e3326`)
      
    ...
[0m10:33:23.868732 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e935155_7d0d_4275_8873_0244ba7e3326`)
      
    ...
[0m10:33:23.901693 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:33:23.913173 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:33:23.915447 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:33:23.927410 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:33:23.955441 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:33:23.959707 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e935155_7d0d_4275_8873_0244ba7e3326` 
    ...
[0m10:33:23.963404 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:33:23.965070 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:33:23.969492 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e935155_7d0d_4275_8873_0244ba7e3326` 
    ...
[0m10:33:23.977763 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e935155_7d0d_4275_8873_0244ba7e3326` 
  ...
[0m10:33:23.985875 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:33:23.999039 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:33:24.000923 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:33:24.062442 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e935155_7d0d_4275_8873_0244ba7e3326` 
  ...
[0m10:33:24.068452 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:33:24.076500 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:33:24.077898 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e935155-7d0d-4275-8873-0244ba7e3326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726e547f4d30>]}
[0m10:33:24.090622 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:33:24.093239 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.47s]
[0m10:33:24.098145 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:33:24.101617 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:33:24.159460 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e935155-7d0d-4275-8873-0244ba7e3326', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726e56aea580>]}
[0m10:33:24.161873 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.56s]
[0m10:33:24.164707 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:33:24.168751 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:33:24.169980 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:33:24.171253 [debug] [MainThread]: On list__clean: Close
[0m10:33:24.172405 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:33:24.173603 [debug] [MainThread]: On list__mart: Close
[0m10:33:24.174725 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:33:24.175873 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:33:24.177018 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:33:24.178141 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:33:24.179207 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:33:24.180729 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:33:24.181796 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:33:24.182902 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:33:24.185195 [info ] [MainThread]: 
[0m10:33:24.186627 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.37 seconds (3.37s).
[0m10:33:24.194687 [debug] [MainThread]: Command end result
[0m10:33:24.458931 [info ] [MainThread]: 
[0m10:33:24.459834 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:33:24.460404 [info ] [MainThread]: 
[0m10:33:24.461043 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:33:24.462325 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.3611183, "process_in_blocks": "0", "process_kernel_time": 0.657672, "process_mem_max_rss": "114332", "process_out_blocks": "9744", "process_user_time": 5.827763}
[0m10:33:24.463041 [debug] [MainThread]: Command `dbt build` succeeded at 10:33:24.462853 after 6.36 seconds
[0m10:33:24.463645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726e59a11310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726e566deeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726e5793e0a0>]}
[0m10:33:24.464225 [debug] [MainThread]: Flushing usage events
[0m10:34:16.325375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746d8af89310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746d87be3c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746d87be3ac0>]}


============================== 10:34:16.334823 | b930f511-ad49-49ae-ad4f-4541d3a42479 ==============================
[0m10:34:16.334823 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:34:16.335850 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'empty': 'False', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'fail_fast': 'False', 'debug': 'False', 'profiles_dir': '.', 'write_json': 'True', 'printer_width': '80', 'no_print': 'None', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True', 'quiet': 'False', 'partial_parse': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'cache_selected_only': 'False', 'introspect': 'True', 'version_check': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local'}
[0m10:34:16.859318 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b930f511-ad49-49ae-ad4f-4541d3a42479', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746d8a514b80>]}
[0m10:34:17.050439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b930f511-ad49-49ae-ad4f-4541d3a42479', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746d87adeee0>]}
[0m10:34:17.051720 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:34:17.462812 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:34:17.962440 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:34:17.963090 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:34:18.165503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b930f511-ad49-49ae-ad4f-4541d3a42479', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746d87345e80>]}
[0m10:34:18.663408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b930f511-ad49-49ae-ad4f-4541d3a42479', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746d8735c2e0>]}
[0m10:34:18.664323 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:34:18.667451 [info ] [MainThread]: 
[0m10:34:18.668452 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:34:18.680031 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:34:18.719175 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:34:18.820880 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:34:18.822182 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:34:19.300395 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:34:19.325876 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:34:19.337688 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:34:19.348803 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:34:19.435498 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:34:19.442135 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:34:19.450004 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:34:19.455009 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:34:19.463757 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:34:19.519860 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:34:19.537859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b930f511-ad49-49ae-ad4f-4541d3a42479', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746d878bbb50>]}
[0m10:34:19.539779 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:34:19.541098 [info ] [MainThread]: 
[0m10:34:19.567596 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:34:19.618690 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:34:19.620318 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:34:19.621426 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:34:19.642428 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:34:19.643645 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:34:19.765296 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:34:19.874952 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:34:19.876295 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:34:19.895040 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:34:20.031692 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:34:20.035206 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:34:20.037121 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:34:20.039666 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:34:20.045280 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:34:20.047871 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:34:20.049741 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:34:20.052225 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:34:20.146794 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:34:20.150777 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:34:20.158482 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b930f511-ad49-49ae-ad4f-4541d3a42479', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746d866d0460>]}
[0m10:34:20.159610 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.54s]
[0m10:34:20.160909 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:34:20.163118 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:34:20.164680 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:34:20.166286 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:34:20.168043 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:34:20.169916 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:34:20.220364 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:34:20.222307 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:34:20.224619 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:34:20.226361 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:34:20.229230 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:34:20.231348 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:34:20.243771 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:34:20.366576 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:34:20.367725 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:34:20.423048 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:34:20.426431 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:34:20.427923 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:34:20.455726 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:34:20.760057 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:34:20.762880 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:34:20.763976 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:34:20.818984 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:34:20.767358 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:34:20.824692 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:34:21.473317 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:34:21.482807 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:34:21.487779 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:34:21.499845 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.28s]
[0m10:34:21.501036 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:34:21.520504 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:34:21.522562 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:34:21.526346 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.31s]
[0m10:34:21.530141 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:34:21.539389 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:34:21.545699 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 1.32s]
[0m10:34:21.548629 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:34:21.551781 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:34:21.552968 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:34:21.554707 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:34:21.556265 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:34:21.558036 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:34:21.560266 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:34:21.562117 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:34:21.563686 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:34:21.565239 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:34:21.566827 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:34:21.568442 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:34:21.570245 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:34:21.744195 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:34:21.759649 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:34:21.763040 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:34:21.765795 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:34:21.818877 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:34:21.825783 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:34:21.835989 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:34:22.040089 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:34:22.140378 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:34:22.245911 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:34:22.346934 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:34:22.361686 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:34:22.535471 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:34:22.639802 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:34:22.647503 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b930f511_ad49_49ae_ad4f_4541d3a42479` 
  ...
[0m10:34:22.662794 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:34:22.721877 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:34:22.733255 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:34:22.745495 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b930f511_ad49_49ae_ad4f_4541d3a42479` 
  ...
[0m10:34:22.759150 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:34:22.832250 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:34:22.867370 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:34:23.025147 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:34:23.056940 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b930f511-ad49-49ae-ad4f-4541d3a42479', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746d86e64e50>]}
[0m10:34:23.135361 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.49s]
[0m10:34:23.148060 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_b930f511_ad49_49ae_ad4f_4541d3a42479`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:34:23.154562 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_b930f511_ad49_49ae_ad4f_4541d3a42479`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:34:23.157434 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:34:23.571185 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.41 seconds
[0m10:34:23.587222 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.43 seconds
[0m10:34:23.625886 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_b930f511_ad49_49ae_ad4f_4541d3a42479'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:34:23.632122 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_b930f511_ad49_49ae_ad4f_4541d3a42479'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:34:23.642531 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:34:23.645248 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:34:23.658975 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:34:23.664285 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:34:23.667281 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_b930f511_ad49_49ae_ad4f_4541d3a42479`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:34:23.671349 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_b930f511_ad49_49ae_ad4f_4541d3a42479`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:34:23.747906 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:34:23.752550 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b930f511_ad49_49ae_ad4f_4541d3a42479`)
      
    ...
[0m10:34:23.755140 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:34:23.761430 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b930f511_ad49_49ae_ad4f_4541d3a42479`)
      
    ...
[0m10:34:23.781258 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:34:23.789229 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:34:23.791676 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:34:23.803817 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:34:23.820436 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:34:23.826428 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b930f511_ad49_49ae_ad4f_4541d3a42479` 
    ...
[0m10:34:23.831206 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:34:23.837198 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b930f511_ad49_49ae_ad4f_4541d3a42479` 
    ...
[0m10:34:23.840358 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:34:23.854754 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b930f511_ad49_49ae_ad4f_4541d3a42479` 
  ...
[0m10:34:23.857722 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:34:23.925102 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:34:23.926663 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b930f511_ad49_49ae_ad4f_4541d3a42479` 
  ...
[0m10:34:23.939453 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:34:23.946698 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:34:23.949277 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:34:23.956038 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b930f511-ad49-49ae-ad4f-4541d3a42479', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746d85f443a0>]}
[0m10:34:24.023392 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:34:24.026337 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.39s]
[0m10:34:24.031276 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:34:24.034015 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:34:24.041144 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b930f511-ad49-49ae-ad4f-4541d3a42479', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746d85e7f4c0>]}
[0m10:34:24.043560 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.48s]
[0m10:34:24.046412 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:34:24.050276 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:34:24.051430 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:34:24.052614 [debug] [MainThread]: On list__clean: Close
[0m10:34:24.053737 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:34:24.054919 [debug] [MainThread]: On list__mart: Close
[0m10:34:24.056030 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:34:24.057122 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:34:24.058169 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:34:24.059271 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:34:24.060327 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:34:24.061421 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:34:24.062501 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:34:24.063611 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:34:24.065870 [info ] [MainThread]: 
[0m10:34:24.067562 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.40 seconds (5.40s).
[0m10:34:24.126672 [debug] [MainThread]: Command end result
[0m10:34:24.328093 [info ] [MainThread]: 
[0m10:34:24.329797 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:34:24.330993 [info ] [MainThread]: 
[0m10:34:24.332280 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:34:24.334925 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 8.20279, "process_in_blocks": "0", "process_kernel_time": 0.680462, "process_mem_max_rss": "114724", "process_out_blocks": "9744", "process_user_time": 6.428792}
[0m10:34:24.336471 [debug] [MainThread]: Command `dbt build` succeeded at 10:34:24.336070 after 8.20 seconds
[0m10:34:24.337911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746d8af89310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746d8a514b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746d87adecd0>]}
[0m10:34:24.339317 [debug] [MainThread]: Flushing usage events
[0m10:35:16.254140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7389f2f1f310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7389efb94be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7389efb94a90>]}


============================== 10:35:16.315743 | c850528f-1319-4b2b-bba2-ebcaab3954f3 ==============================
[0m10:35:16.315743 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:35:16.317042 [debug] [MainThread]: running dbt with arguments {'log_path': '/workdir/transforms/04_btc/logs', 'static_parser': 'True', 'printer_width': '80', 'invocation_command': 'dbt build --profiles-dir . --target local', 'no_print': 'None', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'profiles_dir': '.', 'log_format': 'default', 'quiet': 'False', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'target_path': 'None', 'log_cache_events': 'False', 'debug': 'False', 'empty': 'False', 'cache_selected_only': 'False', 'write_json': 'True', 'partial_parse': 'True', 'indirect_selection': 'eager'}
[0m10:35:16.847995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c850528f-1319-4b2b-bba2-ebcaab3954f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7389f24bab80>]}
[0m10:35:17.048057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c850528f-1319-4b2b-bba2-ebcaab3954f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7389efa78610>]}
[0m10:35:17.049409 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:35:17.459482 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:35:17.960353 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:35:17.961014 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:35:18.160227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c850528f-1319-4b2b-bba2-ebcaab3954f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7389ef2e6e80>]}
[0m10:35:18.656853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c850528f-1319-4b2b-bba2-ebcaab3954f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7389ef2fb8b0>]}
[0m10:35:18.657743 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:35:18.661001 [info ] [MainThread]: 
[0m10:35:18.662047 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:35:18.673831 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:35:18.675159 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:35:18.754648 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:35:18.818582 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:35:19.279379 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:35:19.288369 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:35:19.293474 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:35:19.319051 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:35:19.359880 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:35:19.416162 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:35:19.435057 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:35:19.437383 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:35:19.449597 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:35:19.451847 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:35:19.523390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c850528f-1319-4b2b-bba2-ebcaab3954f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7389ef2442b0>]}
[0m10:35:19.525477 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:35:19.526813 [info ] [MainThread]: 
[0m10:35:19.553915 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:35:19.555015 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:35:19.556118 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:35:19.556936 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:35:19.626406 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:35:19.627701 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:35:19.755212 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:35:19.862729 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:35:19.864155 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:35:19.876739 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:35:19.960120 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:35:19.963523 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:35:19.965406 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:35:19.968318 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:35:20.021460 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:35:20.024709 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:35:20.026560 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:35:20.029397 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:35:20.123038 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:35:20.126758 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:35:20.132911 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c850528f-1319-4b2b-bba2-ebcaab3954f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7389efaef670>]}
[0m10:35:20.134151 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.58s]
[0m10:35:20.135485 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:35:20.137847 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:35:20.139239 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:35:20.140790 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:35:20.142149 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:35:20.143978 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:35:20.146186 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:35:20.148067 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:35:20.150286 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:35:20.152003 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:35:20.153560 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:35:20.154637 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:35:20.227277 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:35:20.322517 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:35:20.329769 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:35:20.344398 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:35:20.347416 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:35:20.349071 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:35:20.361240 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:35:20.725398 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:35:20.735639 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:35:20.738417 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:35:20.742660 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:35:20.744257 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:35:20.746051 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:35:21.023878 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:35:21.035389 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:35:21.040321 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:35:21.043080 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:35:21.061684 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m10:35:21.117308 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:35:21.119432 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:35:21.122202 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:35:21.128163 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.98s]
[0m10:35:21.134380 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.98s]
[0m10:35:21.138099 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:35:21.141091 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:35:21.144413 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:35:21.145504 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:35:21.147094 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:35:21.148452 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:35:21.150440 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:35:21.151987 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:35:21.153725 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:35:21.155577 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:35:21.157264 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:35:21.158816 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:35:21.160383 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:35:21.231686 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:35:21.264616 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:35:21.322603 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:35:21.336492 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:35:21.339007 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:35:21.351260 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:35:21.421246 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:35:21.517092 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:35:21.626751 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:35:21.732402 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:35:21.856101 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:35:21.961152 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:35:22.054713 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:35:22.129154 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:35:22.226597 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:35:22.227369 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c850528f_1319_4b2b_bba2_ebcaab3954f3` 
  ...
[0m10:35:22.246177 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c850528f_1319_4b2b_bba2_ebcaab3954f3` 
  ...
[0m10:35:22.251946 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:35:22.257142 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:35:22.260078 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:35:22.321190 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:35:22.334306 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:35:22.449182 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:35:22.541219 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:35:22.628057 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c850528f-1319-4b2b-bba2-ebcaab3954f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7389ede92850>]}
[0m10:35:22.650124 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_c850528f_1319_4b2b_bba2_ebcaab3954f3`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:35:22.651842 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_c850528f_1319_4b2b_bba2_ebcaab3954f3`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:35:22.653251 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.47s]
[0m10:35:22.657455 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:35:22.681875 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:35:22.722125 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:35:22.734730 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_c850528f_1319_4b2b_bba2_ebcaab3954f3'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:35:22.747697 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_c850528f_1319_4b2b_bba2_ebcaab3954f3'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:35:22.756951 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:35:22.759606 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:35:22.832229 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:35:22.833567 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:35:22.836434 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_c850528f_1319_4b2b_bba2_ebcaab3954f3`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:35:22.840524 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_c850528f_1319_4b2b_bba2_ebcaab3954f3`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:35:22.866272 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:35:22.868851 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:35:22.873000 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c850528f_1319_4b2b_bba2_ebcaab3954f3`)
      
    ...
[0m10:35:22.877051 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c850528f_1319_4b2b_bba2_ebcaab3954f3`)
      
    ...
[0m10:35:22.915768 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:35:22.918210 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:35:22.928453 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:35:22.938255 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:35:22.946945 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:35:22.949642 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:35:22.955398 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c850528f_1319_4b2b_bba2_ebcaab3954f3` 
    ...
[0m10:35:22.961201 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c850528f_1319_4b2b_bba2_ebcaab3954f3` 
    ...
[0m10:35:23.016604 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:35:23.033110 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c850528f_1319_4b2b_bba2_ebcaab3954f3` 
  ...
[0m10:35:23.035732 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:35:23.051940 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:35:23.050209 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c850528f_1319_4b2b_bba2_ebcaab3954f3` 
  ...
[0m10:35:23.117448 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:35:23.123832 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:35:23.131600 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:35:23.144614 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:35:23.147674 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c850528f-1319-4b2b-bba2-ebcaab3954f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7389edbaef70>]}
[0m10:35:23.150595 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.99s]
[0m10:35:23.153373 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:35:23.156100 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:35:23.162570 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c850528f-1319-4b2b-bba2-ebcaab3954f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7389ede92bb0>]}
[0m10:35:23.165410 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.01s]
[0m10:35:23.218554 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:35:23.222481 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:35:23.223683 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:35:23.224834 [debug] [MainThread]: On list__mart: Close
[0m10:35:23.225888 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:35:23.227048 [debug] [MainThread]: On list__clean: Close
[0m10:35:23.228083 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:35:23.229149 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:35:23.230174 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:35:23.231269 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:35:23.232299 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:35:23.233366 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:35:23.234408 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:35:23.235603 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:35:23.237854 [info ] [MainThread]: 
[0m10:35:23.239358 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.58 seconds (4.58s).
[0m10:35:23.247431 [debug] [MainThread]: Command end result
[0m10:35:23.515819 [info ] [MainThread]: 
[0m10:35:23.517525 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:35:23.518850 [info ] [MainThread]: 
[0m10:35:23.520247 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:35:23.522890 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.4617147, "process_in_blocks": "0", "process_kernel_time": 0.672201, "process_mem_max_rss": "114308", "process_out_blocks": "9744", "process_user_time": 6.377041}
[0m10:35:23.523646 [debug] [MainThread]: Command `dbt build` succeeded at 10:35:23.523432 after 7.46 seconds
[0m10:35:23.524257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7389f2f1f310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7389f22728e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7389ef24d700>]}
[0m10:35:23.524947 [debug] [MainThread]: Flushing usage events
[0m10:36:18.376252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a074925f310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0745eb8af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0745eb89a0>]}


============================== 10:36:18.386172 | 4d7908f1-d930-4a65-8b4e-e71447dafe44 ==============================
[0m10:36:18.386172 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:36:18.387265 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'log_cache_events': 'False', 'log_format': 'default', 'fail_fast': 'False', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'use_colors': 'True', 'profiles_dir': '.', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'static_parser': 'True', 'indirect_selection': 'eager', 'no_print': 'None', 'empty': 'False', 'printer_width': '80', 'log_path': '/workdir/transforms/04_btc/logs', 'target_path': 'None', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m10:36:18.966219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4d7908f1-d930-4a65-8b4e-e71447dafe44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a07487f43a0>]}
[0m10:36:19.169539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4d7908f1-d930-4a65-8b4e-e71447dafe44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0745f193a0>]}
[0m10:36:19.170847 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:36:19.582360 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:36:20.149760 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:36:20.150577 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:36:20.356015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4d7908f1-d930-4a65-8b4e-e71447dafe44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a074561dee0>]}
[0m10:36:20.840978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4d7908f1-d930-4a65-8b4e-e71447dafe44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0745607c70>]}
[0m10:36:20.841923 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:36:20.845113 [info ] [MainThread]: 
[0m10:36:20.846135 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:36:20.857929 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:36:20.864711 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:36:20.948728 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:36:20.964701 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:36:21.650882 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:36:21.656725 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:36:21.677757 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:36:21.688072 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:36:21.771854 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:36:21.778330 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:36:21.788530 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:36:21.844222 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:36:21.856578 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:36:21.859073 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:36:21.886950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4d7908f1-d930-4a65-8b4e-e71447dafe44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0744ff4190>]}
[0m10:36:21.888807 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:36:21.890123 [info ] [MainThread]: 
[0m10:36:21.962456 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:36:21.963746 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:36:21.964805 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:36:21.965528 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:36:21.981862 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:36:21.982960 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:36:22.173028 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:36:22.249277 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:36:22.250799 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:36:22.263480 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:36:22.382883 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:36:22.386367 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:36:22.388344 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:36:22.391344 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:36:22.446479 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:36:22.449650 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:36:22.451524 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:36:22.454334 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:36:22.549073 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:36:22.552692 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:36:22.558850 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4d7908f1-d930-4a65-8b4e-e71447dafe44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a07449d9b80>]}
[0m10:36:22.560008 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m10:36:22.561329 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:36:22.563438 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:36:22.564860 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:36:22.566367 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:36:22.567881 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:36:22.569794 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:36:22.572164 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:36:22.574065 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:36:22.576454 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:36:22.578194 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:36:22.580295 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:36:22.582196 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:36:22.651468 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:36:22.686832 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:36:22.753713 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:36:22.763349 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:36:22.765703 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:36:22.772419 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:36:22.779281 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:36:23.085957 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:36:23.142170 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:36:23.154709 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:36:23.158075 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:36:23.159899 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:36:23.161459 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:36:23.434930 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:36:23.448229 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:36:23.453964 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:36:23.457995 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:36:23.471003 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m10:36:23.473947 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:36:23.476507 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:36:23.479379 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:36:23.485182 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.91s]
[0m10:36:23.544051 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.97s]
[0m10:36:23.547574 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:36:23.550506 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:36:23.554259 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:36:23.555718 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:36:23.557781 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:36:23.559226 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:36:23.561197 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:36:23.563017 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:36:23.564942 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:36:23.566674 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:36:23.568306 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:36:23.569898 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:36:23.571644 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:36:23.641200 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:36:23.669445 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:36:23.681918 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:36:23.747390 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:36:23.749781 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:36:23.772783 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:36:23.774478 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:36:23.878507 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:36:23.978123 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:36:24.142227 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:36:24.180316 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:36:24.357659 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:36:24.458213 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:36:24.483256 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:36:24.582000 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_4d7908f1_d930_4a65_8b4e_e71447dafe44` 
  ...
[0m10:36:24.646705 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:36:24.673485 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_4d7908f1_d930_4a65_8b4e_e71447dafe44` 
  ...
[0m10:36:24.676466 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:36:24.683504 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:36:24.758251 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:36:24.767692 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:36:24.875711 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:36:25.050043 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:36:25.147602 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:36:25.158709 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_4d7908f1_d930_4a65_8b4e_e71447dafe44`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:36:25.160679 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_4d7908f1_d930_4a65_8b4e_e71447dafe44`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:36:25.166054 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4d7908f1-d930-4a65-8b4e-e71447dafe44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a07451e69a0>]}
[0m10:36:25.173527 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.60s]
[0m10:36:25.178443 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:36:25.194091 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:36:25.247245 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:36:25.343575 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_4d7908f1_d930_4a65_8b4e_e71447dafe44'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:36:25.349565 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_4d7908f1_d930_4a65_8b4e_e71447dafe44'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:36:25.357996 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:36:25.360561 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:36:25.373051 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:36:25.378845 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:36:25.382060 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_4d7908f1_d930_4a65_8b4e_e71447dafe44`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:36:25.385707 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_4d7908f1_d930_4a65_8b4e_e71447dafe44`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:36:25.441990 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:36:25.443930 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:36:25.448137 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_4d7908f1_d930_4a65_8b4e_e71447dafe44`)
      
    ...
[0m10:36:25.452474 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_4d7908f1_d930_4a65_8b4e_e71447dafe44`)
      
    ...
[0m10:36:25.473623 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:36:25.479185 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:36:25.480667 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:36:25.486852 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:36:25.489352 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:36:25.492166 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_4d7908f1_d930_4a65_8b4e_e71447dafe44` 
    ...
[0m10:36:25.494371 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:36:25.497522 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_4d7908f1_d930_4a65_8b4e_e71447dafe44` 
    ...
[0m10:36:25.499470 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:36:25.547509 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:36:25.549391 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_4d7908f1_d930_4a65_8b4e_e71447dafe44` 
  ...
[0m10:36:25.561643 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_4d7908f1_d930_4a65_8b4e_e71447dafe44` 
  ...
[0m10:36:25.568301 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:36:25.571895 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:36:25.583238 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:36:25.643314 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:36:25.648691 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:36:25.656338 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:36:25.657673 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4d7908f1-d930-4a65-8b4e-e71447dafe44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0744997430>]}
[0m10:36:25.663521 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4d7908f1-d930-4a65-8b4e-e71447dafe44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0745632b20>]}
[0m10:36:25.666149 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.09s]
[0m10:36:25.668881 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.10s]
[0m10:36:25.671941 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:36:25.674930 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:36:25.679525 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:36:25.680694 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:36:25.681815 [debug] [MainThread]: On list__mart: Close
[0m10:36:25.682873 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:36:25.683964 [debug] [MainThread]: On list__clean: Close
[0m10:36:25.685009 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:36:25.686104 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:36:25.687145 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:36:25.688226 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:36:25.689252 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:36:25.741613 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:36:25.742712 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:36:25.744166 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:36:25.746552 [info ] [MainThread]: 
[0m10:36:25.747959 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.90 seconds (4.90s).
[0m10:36:25.756088 [debug] [MainThread]: Command end result
[0m10:36:25.965552 [info ] [MainThread]: 
[0m10:36:25.967163 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:36:25.968404 [info ] [MainThread]: 
[0m10:36:25.969733 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:36:25.972211 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.7898273, "process_in_blocks": "0", "process_kernel_time": 0.695895, "process_mem_max_rss": "114792", "process_out_blocks": "9744", "process_user_time": 6.575079}
[0m10:36:25.973641 [debug] [MainThread]: Command `dbt build` succeeded at 10:36:25.973248 after 7.79 seconds
[0m10:36:25.974832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a074925f310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a0745d859a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a07471e5d00>]}
[0m10:36:25.975998 [debug] [MainThread]: Flushing usage events
[0m10:37:15.871586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7010e36cd310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7010e0337b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7010e0337a00>]}


============================== 10:37:15.880726 | 26dcc5ae-aa63-4d87-9a7c-be9cbc57a074 ==============================
[0m10:37:15.880726 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:37:15.881765 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'cache_selected_only': 'False', 'warn_error': 'None', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'partial_parse': 'True', 'log_cache_events': 'False', 'log_format': 'default', 'write_json': 'True', 'static_parser': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'quiet': 'False', 'introspect': 'True', 'fail_fast': 'False', 'indirect_selection': 'eager', 'target_path': 'None', 'no_print': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_colors': 'True', 'version_check': 'True', 'empty': 'False', 'profiles_dir': '.'}
[0m10:37:16.476701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '26dcc5ae-aa63-4d87-9a7c-be9cbc57a074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7010e0222490>]}
[0m10:37:16.670105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '26dcc5ae-aa63-4d87-9a7c-be9cbc57a074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7010e0e083a0>]}
[0m10:37:16.671361 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:37:17.081963 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:37:17.637770 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:37:17.638420 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:37:17.837414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '26dcc5ae-aa63-4d87-9a7c-be9cbc57a074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7010dfa8beb0>]}
[0m10:37:18.277888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '26dcc5ae-aa63-4d87-9a7c-be9cbc57a074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7010df9804c0>]}
[0m10:37:18.278755 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:37:18.281945 [info ] [MainThread]: 
[0m10:37:18.282947 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:37:18.294862 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:37:18.296614 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:37:18.371486 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:37:18.380286 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:37:19.019802 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:37:19.027448 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:37:19.036969 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:37:19.042166 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:37:19.069387 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:37:19.070361 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:37:19.082434 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:37:19.138832 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:37:19.146440 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:37:19.162099 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:37:19.173766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '26dcc5ae-aa63-4d87-9a7c-be9cbc57a074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7010df5c1ac0>]}
[0m10:37:19.174977 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:37:19.175777 [info ] [MainThread]: 
[0m10:37:19.241767 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:37:19.242973 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:37:19.244064 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:37:19.244898 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:37:19.263219 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:37:19.264433 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:37:19.447703 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:37:19.512113 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:37:19.513429 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:37:19.531012 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:37:19.663707 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:37:19.666993 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:37:19.669138 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:37:19.671769 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:37:19.677984 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:37:19.681588 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:37:19.683788 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:37:19.686922 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:37:19.779554 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:37:19.783011 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:37:19.839185 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '26dcc5ae-aa63-4d87-9a7c-be9cbc57a074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7010df63f370>]}
[0m10:37:19.840387 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m10:37:19.841759 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:37:19.843942 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:37:19.845690 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:37:19.847097 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:37:19.848788 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:37:19.850569 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:37:19.852854 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:37:19.854874 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:37:19.857112 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:37:19.858932 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:37:19.860996 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:37:19.862656 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:37:19.874831 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:37:20.056128 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:37:20.058356 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:37:20.060179 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:37:20.062523 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:37:20.064708 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:37:20.066272 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:37:20.444642 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:37:20.445865 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:37:20.450476 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:37:20.455367 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:37:20.457422 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:37:20.462262 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:37:20.723088 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:37:20.743527 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:37:20.751138 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:37:20.755312 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:37:20.771307 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:37:20.773726 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m10:37:20.780164 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.93s]
[0m10:37:20.836731 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:37:20.839711 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:37:20.842443 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:37:20.848763 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.99s]
[0m10:37:20.852246 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:37:20.855447 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:37:20.856733 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:37:20.858279 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:37:20.859618 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:37:20.861763 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:37:20.863615 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:37:20.865726 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:37:20.867641 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:37:20.869346 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:37:20.871140 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:37:20.872787 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:37:20.945522 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:37:20.983165 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:37:21.036967 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:37:21.054119 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:37:21.056606 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:37:21.074304 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:37:21.081064 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:37:21.174641 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:37:21.356296 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:37:21.536242 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.16 seconds
[0m10:37:21.574131 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:37:21.646624 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:37:21.655924 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:37:21.756192 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:37:21.867984 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:37:21.861018 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_26dcc5ae_aa63_4d87_9a7c_be9cbc57a074` 
  ...
[0m10:37:21.955143 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:37:21.966335 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_26dcc5ae_aa63_4d87_9a7c_be9cbc57a074` 
  ...
[0m10:37:21.972293 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:37:21.976959 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:37:21.981031 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:37:22.036496 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:37:22.158291 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:37:22.252087 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:37:22.270013 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '26dcc5ae-aa63-4d87-9a7c-be9cbc57a074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7010de6581f0>]}
[0m10:37:22.344217 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.40s]
[0m10:37:22.381036 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:37:22.472922 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_26dcc5ae_aa63_4d87_9a7c_be9cbc57a074`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:37:22.470747 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_26dcc5ae_aa63_4d87_9a7c_be9cbc57a074`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:37:22.507343 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:37:22.541255 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:37:22.578652 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_26dcc5ae_aa63_4d87_9a7c_be9cbc57a074'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:37:22.580462 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_26dcc5ae_aa63_4d87_9a7c_be9cbc57a074'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:37:22.642107 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:37:22.647790 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:37:22.659906 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:37:22.665544 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:37:22.668382 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_26dcc5ae_aa63_4d87_9a7c_be9cbc57a074`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:37:22.672153 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_26dcc5ae_aa63_4d87_9a7c_be9cbc57a074`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:37:22.702158 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:37:22.706810 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_26dcc5ae_aa63_4d87_9a7c_be9cbc57a074`)
      
    ...
[0m10:37:22.736023 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:37:22.740157 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_26dcc5ae_aa63_4d87_9a7c_be9cbc57a074`)
      
    ...
[0m10:37:22.770427 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:37:22.781111 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:37:22.789034 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:37:22.797343 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:37:22.801723 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:37:22.807455 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_26dcc5ae_aa63_4d87_9a7c_be9cbc57a074` 
    ...
[0m10:37:22.842946 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:37:22.845616 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:37:22.852518 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_26dcc5ae_aa63_4d87_9a7c_be9cbc57a074` 
    ...
[0m10:37:22.867408 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_26dcc5ae_aa63_4d87_9a7c_be9cbc57a074` 
  ...
[0m10:37:22.874382 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:37:22.934899 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:37:22.937358 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:37:22.948580 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_26dcc5ae_aa63_4d87_9a7c_be9cbc57a074` 
  ...
[0m10:37:22.953150 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:37:22.954424 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:37:22.958633 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '26dcc5ae-aa63-4d87-9a7c-be9cbc57a074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7010dee94b80>]}
[0m10:37:22.970511 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.09s]
[0m10:37:22.968949 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:37:22.972349 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:37:22.976790 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:37:22.982988 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '26dcc5ae-aa63-4d87-9a7c-be9cbc57a074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7010df63fd60>]}
[0m10:37:23.036749 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.12s]
[0m10:37:23.039598 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:37:23.043769 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:37:23.044912 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:37:23.046077 [debug] [MainThread]: On list__mart: Close
[0m10:37:23.047165 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:37:23.048270 [debug] [MainThread]: On list__clean: Close
[0m10:37:23.049416 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:37:23.050595 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:37:23.051696 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:37:23.052811 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:37:23.053842 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:37:23.054909 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:37:23.055941 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:37:23.057032 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:37:23.059276 [info ] [MainThread]: 
[0m10:37:23.060642 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.78 seconds (4.78s).
[0m10:37:23.069000 [debug] [MainThread]: Command end result
[0m10:37:23.284472 [info ] [MainThread]: 
[0m10:37:23.336179 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:37:23.337380 [info ] [MainThread]: 
[0m10:37:23.338700 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:37:23.341330 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.66312, "process_in_blocks": "0", "process_kernel_time": 0.620747, "process_mem_max_rss": "115056", "process_out_blocks": "9744", "process_user_time": 6.505039}
[0m10:37:23.342874 [debug] [MainThread]: Command `dbt build` succeeded at 10:37:23.342454 after 7.66 seconds
[0m10:37:23.344152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7010e36cd310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7010e15d7dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7010de26ee50>]}
[0m10:37:23.345391 [debug] [MainThread]: Flushing usage events
[0m10:38:15.624712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ce63199310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ce5fdff520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ce5fdff670>]}


============================== 10:38:15.633952 | 8bb182a8-0f5a-40fe-92a0-96e50a97ecc1 ==============================
[0m10:38:15.633952 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:38:15.635017 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'printer_width': '80', 'quiet': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'debug': 'False', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '.', 'partial_parse': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'use_experimental_parser': 'False', 'target_path': 'None', 'use_colors': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager', 'warn_error': 'None', 'introspect': 'True', 'version_check': 'True', 'empty': 'False', 'no_print': 'None', 'cache_selected_only': 'False', 'fail_fast': 'False', 'log_format': 'default'}
[0m10:38:16.166520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8bb182a8-0f5a-40fe-92a0-96e50a97ecc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ce6272dfd0>]}
[0m10:38:16.359682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8bb182a8-0f5a-40fe-92a0-96e50a97ecc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ce635ad040>]}
[0m10:38:16.360974 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:38:16.826285 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:38:17.336757 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:38:17.337407 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:38:17.535155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8bb182a8-0f5a-40fe-92a0-96e50a97ecc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ce5f558f10>]}
[0m10:38:17.973042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8bb182a8-0f5a-40fe-92a0-96e50a97ecc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ce62462430>]}
[0m10:38:17.973916 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:38:17.977125 [info ] [MainThread]: 
[0m10:38:17.978194 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:38:18.029008 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:38:18.036055 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:38:18.120756 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:38:18.122499 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:38:18.728805 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:38:18.732562 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:38:18.735196 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:38:18.736896 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:38:18.836246 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:38:18.837963 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:38:18.857962 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:38:18.917057 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:38:18.921045 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:38:18.928698 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:38:18.938891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8bb182a8-0f5a-40fe-92a0-96e50a97ecc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ce625a2940>]}
[0m10:38:18.939919 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:38:18.940589 [info ] [MainThread]: 
[0m10:38:18.953595 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:38:18.954733 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:38:18.955861 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:38:18.956635 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:38:19.027530 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:38:19.029256 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:38:19.162989 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:38:19.270068 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:38:19.271455 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:38:19.281051 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:38:19.366279 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:38:19.420010 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:38:19.421968 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:38:19.424920 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:38:19.430793 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:38:19.433804 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:38:19.435821 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:38:19.438696 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:38:19.531248 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:38:19.534773 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:38:19.540761 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bb182a8-0f5a-40fe-92a0-96e50a97ecc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ce5e970b80>]}
[0m10:38:19.541917 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.58s]
[0m10:38:19.543232 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:38:19.545645 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:38:19.547035 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:38:19.548605 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:38:19.550289 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:38:19.552343 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:38:19.554337 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:38:19.556695 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:38:19.558891 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:38:19.561067 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:38:19.562837 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:38:19.564739 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:38:19.617947 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:38:19.756426 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:38:19.820399 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:38:19.822620 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:38:19.825482 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:38:19.827373 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:38:19.917345 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:38:20.128865 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:38:20.142408 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:38:20.157511 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:38:20.160105 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:38:20.162106 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:38:20.218207 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:38:20.381395 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:38:20.394178 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:38:20.424109 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:38:20.427570 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.86s]
[0m10:38:20.429426 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:38:20.430922 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:38:20.434229 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:38:20.437546 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.88s]
[0m10:38:20.439107 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:38:20.444039 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:38:20.453255 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.89s]
[0m10:38:20.456766 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:38:20.459720 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:38:20.460911 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:38:20.462405 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:38:20.463580 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:38:20.465380 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:38:20.467153 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:38:20.518499 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:38:20.520457 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:38:20.522218 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:38:20.523958 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:38:20.525674 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:38:20.548162 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:38:20.660364 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:38:20.717076 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:38:20.726091 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:38:20.729113 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:38:20.759272 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:38:20.760967 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:38:20.939618 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:38:21.028000 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:38:21.123497 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:38:21.217695 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:38:21.333895 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:38:21.343454 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:38:21.462717 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:38:21.551885 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:38:21.618470 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:38:21.625344 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_8bb182a8_0f5a_40fe_92a0_96e50a97ecc1` 
  ...
[0m10:38:21.639906 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:38:21.717393 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_8bb182a8_0f5a_40fe_92a0_96e50a97ecc1` 
  ...
[0m10:38:21.722301 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:38:21.738800 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:38:21.756830 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:38:21.929511 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:38:22.028887 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:38:22.044411 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bb182a8-0f5a-40fe-92a0-96e50a97ecc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ce5e1a7160>]}
[0m10:38:22.051958 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.52s]
[0m10:38:22.065308 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_8bb182a8_0f5a_40fe_92a0_96e50a97ecc1`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:38:22.119401 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_8bb182a8_0f5a_40fe_92a0_96e50a97ecc1`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:38:22.122332 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:38:22.155721 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:38:22.170935 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:38:22.235407 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_8bb182a8_0f5a_40fe_92a0_96e50a97ecc1'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:38:22.242445 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_8bb182a8_0f5a_40fe_92a0_96e50a97ecc1'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:38:22.249677 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:38:22.252407 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:38:22.265589 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:38:22.320708 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:38:22.323922 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_8bb182a8_0f5a_40fe_92a0_96e50a97ecc1`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:38:22.326306 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_8bb182a8_0f5a_40fe_92a0_96e50a97ecc1`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:38:22.363662 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:38:22.366203 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:38:22.370368 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_8bb182a8_0f5a_40fe_92a0_96e50a97ecc1`)
      
    ...
[0m10:38:22.374617 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_8bb182a8_0f5a_40fe_92a0_96e50a97ecc1`)
      
    ...
[0m10:38:22.404114 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:38:22.409670 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:38:22.412604 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:38:22.422916 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:38:22.426832 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:38:22.429916 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_8bb182a8_0f5a_40fe_92a0_96e50a97ecc1` 
    ...
[0m10:38:22.435142 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:38:22.441429 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_8bb182a8_0f5a_40fe_92a0_96e50a97ecc1` 
    ...
[0m10:38:22.444892 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:38:22.451063 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_8bb182a8_0f5a_40fe_92a0_96e50a97ecc1` 
  ...
[0m10:38:22.453252 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:38:22.516878 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_8bb182a8_0f5a_40fe_92a0_96e50a97ecc1` 
  ...
[0m10:38:22.518920 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:38:22.533617 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:38:22.536046 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:38:22.548634 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:38:22.555067 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:38:22.562932 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:38:22.564327 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bb182a8-0f5a-40fe-92a0-96e50a97ecc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ce5de5e3d0>]}
[0m10:38:22.620926 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8bb182a8-0f5a-40fe-92a0-96e50a97ecc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ce5f4467f0>]}
[0m10:38:22.623586 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.04s]
[0m10:38:22.626294 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.15s]
[0m10:38:22.629306 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:38:22.632448 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:38:22.637114 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:38:22.638284 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:38:22.639599 [debug] [MainThread]: On list__clean: Close
[0m10:38:22.640690 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:38:22.641823 [debug] [MainThread]: On list__mart: Close
[0m10:38:22.642886 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:38:22.644053 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:38:22.645109 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:38:22.646234 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:38:22.647325 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:38:22.648467 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:38:22.649624 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:38:22.650703 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:38:22.652922 [info ] [MainThread]: 
[0m10:38:22.654324 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.67 seconds (4.67s).
[0m10:38:22.662702 [debug] [MainThread]: Command end result
[0m10:38:22.926087 [info ] [MainThread]: 
[0m10:38:22.927868 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:38:22.929251 [info ] [MainThread]: 
[0m10:38:22.930820 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:38:22.933586 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.4997807, "process_in_blocks": "0", "process_kernel_time": 0.677134, "process_mem_max_rss": "114824", "process_out_blocks": "9744", "process_user_time": 6.426279}
[0m10:38:22.935161 [debug] [MainThread]: Command `dbt build` succeeded at 10:38:22.934734 after 7.50 seconds
[0m10:38:22.936465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ce63199310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ce5f516760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ce60a79be0>]}
[0m10:38:22.937780 [debug] [MainThread]: Flushing usage events
[0m10:39:15.891884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78707d9e6310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78707a656b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78707a6569d0>]}


============================== 10:39:15.901380 | a14d0a79-3cf1-445c-b5d8-6502e4752d7a ==============================
[0m10:39:15.901380 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:39:15.902655 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'printer_width': '80', 'write_json': 'True', 'quiet': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'log_cache_events': 'False', 'profiles_dir': '.', 'introspect': 'True', 'indirect_selection': 'eager', 'no_print': 'None', 'partial_parse': 'True', 'fail_fast': 'False', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'debug': 'False', 'use_colors': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'target_path': 'None', 'cache_selected_only': 'False'}
[0m10:39:16.436124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a14d0a79-3cf1-445c-b5d8-6502e4752d7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78707a541520>]}
[0m10:39:16.627394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a14d0a79-3cf1-445c-b5d8-6502e4752d7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78707dbca370>]}
[0m10:39:16.628648 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:39:17.039537 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:39:17.539080 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:39:17.539703 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:39:17.795696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a14d0a79-3cf1-445c-b5d8-6502e4752d7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x787079daaf10>]}
[0m10:39:18.238444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a14d0a79-3cf1-445c-b5d8-6502e4752d7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x787079cf38b0>]}
[0m10:39:18.239349 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:39:18.242503 [info ] [MainThread]: 
[0m10:39:18.243585 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:39:18.294627 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:39:18.296473 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:39:18.335900 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:39:18.338507 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:39:18.960157 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:39:18.964174 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:39:18.967428 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:39:18.971004 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:39:19.009279 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:39:19.010231 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:39:19.022337 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:39:19.029724 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:39:19.036393 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:39:19.038496 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:39:19.103172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a14d0a79-3cf1-445c-b5d8-6502e4752d7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78707a69a790>]}
[0m10:39:19.104113 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:39:19.104746 [info ] [MainThread]: 
[0m10:39:19.117515 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:39:19.118765 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:39:19.119927 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:39:19.121105 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:39:19.139006 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:39:19.140385 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:39:19.321848 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:39:19.394853 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:39:19.396435 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:39:19.409022 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:39:19.533405 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:39:19.537047 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:39:19.539076 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:39:19.542096 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:39:19.596616 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:39:19.599782 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:39:19.601707 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:39:19.604675 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:39:19.698987 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:39:19.702186 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:39:19.708460 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a14d0a79-3cf1-445c-b5d8-6502e4752d7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78707903ad00>]}
[0m10:39:19.709735 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m10:39:19.711062 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:39:19.712724 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:39:19.713583 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:39:19.714538 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:39:19.715527 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:39:19.716652 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:39:19.717730 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:39:19.719079 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:39:19.720186 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:39:19.721193 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:39:19.722921 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:39:19.724174 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:39:19.724991 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:39:19.905374 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:39:19.912479 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:39:19.914041 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:39:19.916583 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:39:19.918590 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:39:19.925419 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:39:20.209685 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:39:20.219093 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:39:20.296842 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:39:20.298901 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:39:20.302561 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:39:20.304602 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:39:20.577665 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:39:20.588876 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:39:20.596292 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:39:20.599013 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:39:20.612302 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.89s]
[0m10:39:20.615276 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:39:20.620337 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:39:20.626362 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.91s]
[0m10:39:20.630692 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:39:20.633928 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:39:20.691283 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.92s]
[0m10:39:20.694931 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:39:20.698344 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:39:20.699579 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:39:20.701310 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:39:20.703667 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:39:20.705473 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:39:20.708484 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:39:20.710355 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:39:20.712047 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:39:20.713708 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:39:20.715384 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:39:20.717224 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:39:20.719000 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:39:20.812594 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:39:20.814337 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:39:20.826406 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:39:20.828634 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:39:20.829969 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:39:20.836262 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:39:20.926696 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:39:21.097380 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:39:21.302371 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.16 seconds
[0m10:39:21.407547 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:39:21.513179 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:39:21.532955 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:39:21.635003 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:39:21.708416 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_a14d0a79_3cf1_445c_b5d8_6502e4752d7a` 
  ...
[0m10:39:21.731887 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:39:21.794699 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:39:21.739875 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_a14d0a79_3cf1_445c_b5d8_6502e4752d7a` 
  ...
[0m10:39:21.808372 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:39:21.836267 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:39:21.898418 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:39:21.917809 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:39:22.100722 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:39:22.137784 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:39:22.196599 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_a14d0a79_3cf1_445c_b5d8_6502e4752d7a`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:39:22.195763 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_a14d0a79_3cf1_445c_b5d8_6502e4752d7a`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:39:22.203403 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a14d0a79-3cf1-445c-b5d8-6502e4752d7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7870789e89a0>]}
[0m10:39:22.211192 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.49s]
[0m10:39:22.216122 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:39:22.238724 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:39:22.254221 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:39:22.327302 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_a14d0a79_3cf1_445c_b5d8_6502e4752d7a'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:39:22.329662 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_a14d0a79_3cf1_445c_b5d8_6502e4752d7a'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:39:22.341372 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:39:22.393291 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:39:22.406744 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:39:22.412108 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:39:22.415188 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_a14d0a79_3cf1_445c_b5d8_6502e4752d7a`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:39:22.417467 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_a14d0a79_3cf1_445c_b5d8_6502e4752d7a`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:39:22.446175 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:39:22.449018 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:39:22.452993 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_a14d0a79_3cf1_445c_b5d8_6502e4752d7a`)
      
    ...
[0m10:39:22.457060 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_a14d0a79_3cf1_445c_b5d8_6502e4752d7a`)
      
    ...
[0m10:39:22.492795 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:39:22.503948 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:39:22.513751 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:39:22.516305 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:39:22.522264 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_a14d0a79_3cf1_445c_b5d8_6502e4752d7a` 
    ...
[0m10:39:22.532224 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:39:22.542616 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:39:22.545200 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:39:22.596178 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_a14d0a79_3cf1_445c_b5d8_6502e4752d7a` 
    ...
[0m10:39:22.607309 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_a14d0a79_3cf1_445c_b5d8_6502e4752d7a` 
  ...
[0m10:39:22.612418 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:39:22.613866 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:39:22.620825 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:39:22.626524 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_a14d0a79_3cf1_445c_b5d8_6502e4752d7a` 
  ...
[0m10:39:22.629588 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:39:22.630767 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:39:22.633809 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a14d0a79-3cf1-445c-b5d8-6502e4752d7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78707aaa31f0>]}
[0m10:39:22.639326 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:39:22.640788 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.92s]
[0m10:39:22.693326 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:39:22.696683 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:39:22.703374 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a14d0a79-3cf1-445c-b5d8-6502e4752d7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7870798e0d30>]}
[0m10:39:22.705317 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.99s]
[0m10:39:22.707513 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:39:22.711229 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:39:22.712522 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:39:22.713783 [debug] [MainThread]: On list__mart: Close
[0m10:39:22.714926 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:39:22.716083 [debug] [MainThread]: On list__clean: Close
[0m10:39:22.717218 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:39:22.718406 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:39:22.719590 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:39:22.720768 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:39:22.721916 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:39:22.723079 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:39:22.724210 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:39:22.725371 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:39:22.727712 [info ] [MainThread]: 
[0m10:39:22.729309 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.48 seconds (4.48s).
[0m10:39:22.737265 [debug] [MainThread]: Command end result
[0m10:39:22.925931 [info ] [MainThread]: 
[0m10:39:22.926790 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:39:22.927393 [info ] [MainThread]: 
[0m10:39:22.928034 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:39:22.929389 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.2307615, "process_in_blocks": "0", "process_kernel_time": 0.670903, "process_mem_max_rss": "115004", "process_out_blocks": "9744", "process_user_time": 6.290462}
[0m10:39:22.930106 [debug] [MainThread]: Command `dbt build` succeeded at 10:39:22.929917 after 7.23 seconds
[0m10:39:22.930705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78707d9e6310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x787079cf38b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78707b072100>]}
[0m10:39:22.931276 [debug] [MainThread]: Flushing usage events
[0m10:40:15.872630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5afc6a1310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5af9311af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5af93119a0>]}


============================== 10:40:15.932676 | 9c32fe08-3b6a-469b-96bb-51387d34e8eb ==============================
[0m10:40:15.932676 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:40:15.933769 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'no_print': 'None', 'use_experimental_parser': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'profiles_dir': '.', 'debug': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'printer_width': '80', 'write_json': 'True', 'fail_fast': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'version_check': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'partial_parse': 'True', 'empty': 'False', 'quiet': 'False', 'static_parser': 'True'}
[0m10:40:16.474664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9c32fe08-3b6a-469b-96bb-51387d34e8eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5af9243160>]}
[0m10:40:16.674994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9c32fe08-3b6a-469b-96bb-51387d34e8eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5af9254f70>]}
[0m10:40:16.676414 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:40:17.141637 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:40:17.648183 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:40:17.648876 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:40:17.850875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9c32fe08-3b6a-469b-96bb-51387d34e8eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5af8a66ee0>]}
[0m10:40:18.330781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9c32fe08-3b6a-469b-96bb-51387d34e8eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5af8a50130>]}
[0m10:40:18.331689 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:40:18.335011 [info ] [MainThread]: 
[0m10:40:18.336074 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:40:18.347984 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:40:18.349483 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:40:18.466661 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:40:18.473864 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:40:19.189360 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:40:19.197428 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:40:19.204610 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:40:19.229140 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:40:19.264020 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:40:19.264998 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:40:19.331493 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:40:19.332286 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:40:19.338703 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:40:19.342130 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:40:19.353176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c32fe08-3b6a-469b-96bb-51387d34e8eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5afbabe970>]}
[0m10:40:19.354142 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:40:19.354799 [info ] [MainThread]: 
[0m10:40:19.367326 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:40:19.368446 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:40:19.369576 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:40:19.370358 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:40:19.439058 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:40:19.440641 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:40:19.578072 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:40:19.695655 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:40:19.697526 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:40:19.710091 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:40:19.840364 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:40:19.844165 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:40:19.846044 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:40:19.849300 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:40:19.855014 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:40:19.857930 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:40:19.859796 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:40:19.862593 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:40:19.954307 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:40:19.957794 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:40:19.963799 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c32fe08-3b6a-469b-96bb-51387d34e8eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5af7ceea30>]}
[0m10:40:19.964995 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m10:40:19.966420 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:40:19.968736 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:40:19.970095 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:40:19.971645 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:40:19.972894 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:40:19.974975 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:40:19.977082 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:40:19.979416 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:40:20.028489 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:40:20.031014 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:40:20.032831 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:40:20.034692 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:40:20.036460 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:40:20.247792 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:40:20.249636 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:40:20.252627 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:40:20.254734 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:40:20.261824 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:40:20.268356 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:40:20.644825 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:40:20.640174 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:40:20.648159 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:40:20.650965 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:40:20.653583 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:40:20.657131 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:40:20.873557 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:40:20.882029 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:40:20.891853 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:40:20.930086 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:40:20.937878 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:40:20.936154 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m10:40:20.944620 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.97s]
[0m10:40:20.949721 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:40:20.953049 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:40:20.959215 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:40:20.964943 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.98s]
[0m10:40:20.967755 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:40:20.970496 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:40:20.971624 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:40:20.973407 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:40:20.975473 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:40:20.977476 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:40:20.979553 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:40:20.980955 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:40:20.982063 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:40:21.029429 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:40:21.031221 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:40:21.033028 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:40:21.034830 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:40:21.146587 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:40:21.232150 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:40:21.238014 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:40:21.240675 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:40:21.259335 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:40:21.261136 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:40:21.262963 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:40:21.434612 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:40:21.530025 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:40:21.629043 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:40:21.676090 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:40:21.839415 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:40:21.872160 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c32fe08_3b6a_469b_96bb_51387d34e8eb` 
  ...
[0m10:40:21.952389 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:40:22.039308 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c32fe08_3b6a_469b_96bb_51387d34e8eb` 
  ...
[0m10:40:22.042441 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:40:22.054971 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:40:22.070082 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:40:22.153038 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:40:22.250475 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:40:22.340623 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:40:22.454750 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:40:22.469853 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c32fe08_3b6a_469b_96bb_51387d34e8eb`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:40:22.472682 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c32fe08_3b6a_469b_96bb_51387d34e8eb`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:40:22.532986 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:40:22.538309 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c32fe08-3b6a-469b-96bb-51387d34e8eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5af75d3490>]}
[0m10:40:22.542266 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.51s]
[0m10:40:22.547070 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:40:22.558841 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:40:22.574648 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:40:22.659205 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_9c32fe08_3b6a_469b_96bb_51387d34e8eb'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:40:22.665703 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_9c32fe08_3b6a_469b_96bb_51387d34e8eb'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:40:22.672465 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:40:22.675569 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:40:22.739378 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:40:22.745313 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:40:22.748585 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c32fe08_3b6a_469b_96bb_51387d34e8eb`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:40:22.752499 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c32fe08_3b6a_469b_96bb_51387d34e8eb`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:40:22.785138 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:40:22.790447 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c32fe08_3b6a_469b_96bb_51387d34e8eb`)
      
    ...
[0m10:40:22.794185 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:40:22.798523 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c32fe08_3b6a_469b_96bb_51387d34e8eb`)
      
    ...
[0m10:40:22.829215 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:40:22.837046 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:40:22.842250 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:40:22.852216 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:40:22.861241 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:40:22.869316 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:40:22.867200 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c32fe08_3b6a_469b_96bb_51387d34e8eb` 
    ...
[0m10:40:22.875822 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c32fe08_3b6a_469b_96bb_51387d34e8eb` 
    ...
[0m10:40:22.935820 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:40:22.938401 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:40:22.951360 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c32fe08_3b6a_469b_96bb_51387d34e8eb` 
  ...
[0m10:40:22.963353 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c32fe08_3b6a_469b_96bb_51387d34e8eb` 
  ...
[0m10:40:22.969608 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:40:23.030104 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:40:23.033365 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:40:23.050300 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:40:23.055220 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:40:23.062823 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:40:23.069217 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c32fe08-3b6a-469b-96bb-51387d34e8eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5af7cee700>]}
[0m10:40:23.068815 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c32fe08-3b6a-469b-96bb-51387d34e8eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5af7642a90>]}
[0m10:40:23.072636 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.08s]
[0m10:40:23.075297 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.09s]
[0m10:40:23.129388 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:40:23.132242 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:40:23.137295 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:40:23.138455 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:40:23.139634 [debug] [MainThread]: On list__clean: Close
[0m10:40:23.140723 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:40:23.141831 [debug] [MainThread]: On list__mart: Close
[0m10:40:23.142890 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:40:23.144024 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:40:23.145078 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:40:23.146225 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:40:23.147301 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:40:23.148423 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:40:23.149494 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:40:23.150623 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:40:23.152883 [info ] [MainThread]: 
[0m10:40:23.154263 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.82 seconds (4.82s).
[0m10:40:23.162617 [debug] [MainThread]: Command end result
[0m10:40:23.360271 [info ] [MainThread]: 
[0m10:40:23.361102 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:40:23.361747 [info ] [MainThread]: 
[0m10:40:23.362433 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:40:23.363768 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.6345177, "process_in_blocks": "0", "process_kernel_time": 0.709295, "process_mem_max_rss": "115188", "process_out_blocks": "9744", "process_user_time": 6.499397}
[0m10:40:23.364561 [debug] [MainThread]: Command `dbt build` succeeded at 10:40:23.364318 after 7.64 seconds
[0m10:40:23.365221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5afc6a1310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5af9243160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5afb96dcd0>]}
[0m10:40:23.365845 [debug] [MainThread]: Flushing usage events
[0m10:41:16.364009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70c4260310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70c0ecca90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70c0ecc940>]}


============================== 10:41:16.373262 | 08c5b1fd-8b1e-4626-b8b4-5793b9d22d3a ==============================
[0m10:41:16.373262 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:41:16.374490 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'profiles_dir': '.', 'fail_fast': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'empty': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_format': 'default', 'printer_width': '80', 'quiet': 'False', 'warn_error': 'None', 'debug': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'write_json': 'True', 'cache_selected_only': 'False'}
[0m10:41:16.951009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '08c5b1fd-8b1e-4626-b8b4-5793b9d22d3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70c37fbfd0>]}
[0m10:41:17.146196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '08c5b1fd-8b1e-4626-b8b4-5793b9d22d3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70c199c430>]}
[0m10:41:17.147466 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:41:17.558126 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:41:18.057685 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:41:18.058405 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:41:18.257446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '08c5b1fd-8b1e-4626-b8b4-5793b9d22d3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70c0621f10>]}
[0m10:41:18.735824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '08c5b1fd-8b1e-4626-b8b4-5793b9d22d3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70c3496c70>]}
[0m10:41:18.736696 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:41:18.740182 [info ] [MainThread]: 
[0m10:41:18.741241 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:41:18.753164 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:41:18.754767 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:41:18.852455 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:41:18.865879 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:41:19.443248 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:41:19.445593 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:41:19.453130 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:41:19.455093 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:41:19.554993 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:41:19.561446 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:41:19.630888 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:41:19.635207 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:41:19.644892 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:41:19.647146 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:41:19.678337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '08c5b1fd-8b1e-4626-b8b4-5793b9d22d3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70c3679940>]}
[0m10:41:19.680173 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:41:19.730109 [info ] [MainThread]: 
[0m10:41:19.757292 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:41:19.758989 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:41:19.760561 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:41:19.761695 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:41:19.831311 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:41:19.833079 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:41:19.978861 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:41:20.088477 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:41:20.089947 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:41:20.101803 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:41:20.232673 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:41:20.236200 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:41:20.238119 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:41:20.241240 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:41:20.247035 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:41:20.250132 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:41:20.251988 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:41:20.254750 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:41:20.347212 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:41:20.350851 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:41:20.357477 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08c5b1fd-8b1e-4626-b8b4-5793b9d22d3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70bffd71c0>]}
[0m10:41:20.358699 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m10:41:20.360156 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:41:20.362696 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:41:20.364029 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:41:20.365807 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:41:20.367348 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:41:20.369033 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:41:20.371110 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:41:20.373343 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:41:20.375480 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:41:20.377632 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:41:20.379337 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:41:20.380883 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:41:20.382189 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:41:20.638715 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:41:20.640801 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:41:20.642848 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:41:20.645498 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:41:20.647662 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:41:20.669985 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:41:20.979233 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:41:20.975161 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:41:21.032173 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:41:21.035799 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:41:21.038820 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:41:21.040912 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:41:21.274548 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:41:21.285493 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:41:21.288069 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:41:21.331973 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:41:21.294169 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:41:21.347493 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.97s]
[0m10:41:21.356488 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:41:21.353484 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.98s]
[0m10:41:21.360604 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:41:21.366448 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.99s]
[0m10:41:21.369373 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:41:21.372803 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:41:21.376083 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:41:21.377138 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:41:21.378834 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:41:21.431595 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:41:21.433855 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:41:21.436217 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:41:21.438053 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:41:21.439698 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:41:21.441325 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:41:21.443086 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:41:21.444889 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:41:21.446720 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:41:21.571723 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:41:21.640828 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:41:21.642360 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:41:21.645176 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:41:21.659318 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:41:21.662220 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:41:21.664025 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:41:21.762667 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:41:21.856592 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:41:21.942684 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:41:22.053814 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:41:22.073792 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:41:22.149005 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:41:22.267233 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:41:22.337018 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:41:22.366085 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:41:22.377852 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_08c5b1fd_8b1e_4626_b8b4_5793b9d22d3a` 
  ...
[0m10:41:22.455153 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_08c5b1fd_8b1e_4626_b8b4_5793b9d22d3a` 
  ...
[0m10:41:22.458199 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:41:22.463229 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:41:22.477309 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:41:22.530897 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:41:22.573030 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:41:22.659950 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08c5b1fd-8b1e-4626-b8b4-5793b9d22d3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70bf22e250>]}
[0m10:41:22.667630 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.22s]
[0m10:41:22.739822 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:41:22.869844 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_08c5b1fd_8b1e_4626_b8b4_5793b9d22d3a`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:41:22.872861 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_08c5b1fd_8b1e_4626_b8b4_5793b9d22d3a`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:41:22.931496 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:41:22.932942 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:41:23.046802 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_08c5b1fd_8b1e_4626_b8b4_5793b9d22d3a'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:41:23.048657 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_08c5b1fd_8b1e_4626_b8b4_5793b9d22d3a'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:41:23.060639 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:41:23.063692 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:41:23.078873 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:41:23.133940 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:41:23.137214 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_08c5b1fd_8b1e_4626_b8b4_5793b9d22d3a`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:41:23.139527 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_08c5b1fd_8b1e_4626_b8b4_5793b9d22d3a`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:41:23.171078 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:41:23.175524 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_08c5b1fd_8b1e_4626_b8b4_5793b9d22d3a`)
      
    ...
[0m10:41:23.178156 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:41:23.186100 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_08c5b1fd_8b1e_4626_b8b4_5793b9d22d3a`)
      
    ...
[0m10:41:23.207254 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:41:23.217118 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:41:23.230483 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:41:23.242980 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:41:23.246042 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:41:23.254401 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_08c5b1fd_8b1e_4626_b8b4_5793b9d22d3a` 
    ...
[0m10:41:23.259869 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:41:23.265885 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_08c5b1fd_8b1e_4626_b8b4_5793b9d22d3a` 
    ...
[0m10:41:23.268865 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:41:23.331791 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:41:23.343428 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_08c5b1fd_8b1e_4626_b8b4_5793b9d22d3a` 
  ...
[0m10:41:23.353205 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_08c5b1fd_8b1e_4626_b8b4_5793b9d22d3a` 
  ...
[0m10:41:23.359134 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:41:23.361841 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:41:23.375648 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:41:23.444112 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:41:23.448179 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:41:23.455208 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08c5b1fd-8b1e-4626-b8b4-5793b9d22d3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70bf946fd0>]}
[0m10:41:23.457945 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:41:23.460441 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.02s]
[0m10:41:23.466768 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08c5b1fd-8b1e-4626-b8b4-5793b9d22d3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70bf120640>]}
[0m10:41:23.469561 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:41:23.472172 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.03s]
[0m10:41:23.475498 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:41:23.479305 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:41:23.480517 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:41:23.531433 [debug] [MainThread]: On list__mart: Close
[0m10:41:23.532527 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:41:23.533662 [debug] [MainThread]: On list__clean: Close
[0m10:41:23.534766 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:41:23.535919 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:41:23.536965 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:41:23.538100 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:41:23.539142 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:41:23.540256 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:41:23.541313 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:41:23.542451 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:41:23.544728 [info ] [MainThread]: 
[0m10:41:23.546107 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.80 seconds (4.80s).
[0m10:41:23.554283 [debug] [MainThread]: Command end result
[0m10:41:23.747343 [info ] [MainThread]: 
[0m10:41:23.748921 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:41:23.750037 [info ] [MainThread]: 
[0m10:41:23.751243 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:41:23.753563 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.583284, "process_in_blocks": "0", "process_kernel_time": 0.694555, "process_mem_max_rss": "115064", "process_out_blocks": "9752", "process_user_time": 6.471275}
[0m10:41:23.754845 [debug] [MainThread]: Command `dbt build` succeeded at 10:41:23.754487 after 7.58 seconds
[0m10:41:23.755886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70c4260310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70c19ee0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f70c05e0760>]}
[0m10:41:23.756886 [debug] [MainThread]: Flushing usage events
[0m10:42:16.670741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f78a70c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f78736bb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f78736b9d0>]}


============================== 10:42:16.730817 | c1718d4b-0b09-4305-95d6-6fdc8ade7db6 ==============================
[0m10:42:16.730817 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:42:16.731866 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error': 'None', 'printer_width': '80', 'quiet': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False', 'profiles_dir': '.', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'log_format': 'default', 'target_path': 'None', 'write_json': 'True', 'no_print': 'None', 'version_check': 'True', 'debug': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'use_colors': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m10:42:17.256129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c1718d4b-0b09-4305-95d6-6fdc8ade7db6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f7871c7cd0>]}
[0m10:42:17.450536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c1718d4b-0b09-4305-95d6-6fdc8ade7db6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f788583e20>]}
[0m10:42:17.451868 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:42:17.864983 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:42:18.370702 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:42:18.371346 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:42:18.572523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c1718d4b-0b09-4305-95d6-6fdc8ade7db6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f786aceeb0>]}
[0m10:42:19.065451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c1718d4b-0b09-4305-95d6-6fdc8ade7db6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f7869c34c0>]}
[0m10:42:19.066367 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:42:19.069751 [info ] [MainThread]: 
[0m10:42:19.070897 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:42:19.082903 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:42:19.083963 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:42:19.228844 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:42:19.235692 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:42:19.806379 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:42:19.828853 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:42:19.833091 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:42:19.837282 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:42:19.936735 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:42:19.943700 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__mart'
[0m10:42:19.959168 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:42:19.966334 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:42:19.974828 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:42:20.112645 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:42:20.122799 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:42:20.141127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1718d4b-0b09-4305-95d6-6fdc8ade7db6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f787405190>]}
[0m10:42:20.142955 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:42:20.144266 [info ] [MainThread]: 
[0m10:42:20.171270 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:42:20.172830 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:42:20.174294 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:42:20.175322 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:42:20.249043 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:42:20.250648 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:42:20.569659 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:42:20.677860 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:42:20.679313 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:42:20.691693 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:42:20.705205 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:42:20.708598 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:42:20.710628 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:42:20.713628 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:42:20.719399 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:42:20.722341 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:42:20.724285 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:42:20.727162 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:42:20.774121 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:42:20.825956 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:42:20.831980 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1718d4b-0b09-4305-95d6-6fdc8ade7db6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f7867bcbe0>]}
[0m10:42:20.833098 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.66s]
[0m10:42:20.834421 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:42:20.836701 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:42:20.837965 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:42:20.839438 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:42:20.840875 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:42:20.842727 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:42:20.844281 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:42:20.845976 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:42:20.848080 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:42:20.849633 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:42:20.850871 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:42:20.852758 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:42:20.854089 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:42:21.065110 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:42:21.070690 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:42:21.130475 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:42:21.133701 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:42:21.151440 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:42:21.159542 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:42:21.261921 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:42:21.264624 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:42:21.340790 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:42:21.343633 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:42:21.345485 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:42:21.347039 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:42:21.610640 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:42:21.635069 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:42:21.643234 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:42:21.647366 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:42:21.661498 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:42:21.664316 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.82s]
[0m10:42:21.726369 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:42:21.672205 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.83s]
[0m10:42:21.729972 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:42:21.735865 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m10:42:21.738977 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:42:21.742721 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:42:21.745920 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:42:21.746939 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:42:21.748631 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:42:21.750277 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:42:21.751965 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:42:21.754232 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:42:21.756100 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:42:21.757601 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:42:21.759205 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:42:21.760881 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:42:21.762457 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:42:21.764167 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:42:21.868907 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:42:21.871060 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:42:21.932053 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:42:21.935242 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:42:21.937836 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:42:21.960984 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:42:22.063272 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:42:22.172024 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:42:22.356688 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:42:22.443311 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:42:22.473239 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:42:22.636812 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:42:22.744851 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1718d4b_0b09_4305_95d6_6fdc8ade7db6` 
  ...
[0m10:42:22.767875 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:42:22.769256 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1718d4b_0b09_4305_95d6_6fdc8ade7db6` 
  ...
[0m10:42:22.833255 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:42:22.837391 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:42:22.841906 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:42:22.860394 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:42:22.869937 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:42:22.949569 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:42:23.057164 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:42:23.145530 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:42:23.235110 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1718d4b-0b09-4305-95d6-6fdc8ade7db6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f785ddc640>]}
[0m10:42:23.268624 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.48s]
[0m10:42:23.331165 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1718d4b_0b09_4305_95d6_6fdc8ade7db6`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:42:23.333708 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1718d4b_0b09_4305_95d6_6fdc8ade7db6`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:42:23.336719 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:42:23.398411 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:42:23.415401 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:42:23.459879 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_c1718d4b_0b09_4305_95d6_6fdc8ade7db6'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:42:23.462513 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_c1718d4b_0b09_4305_95d6_6fdc8ade7db6'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:42:23.473392 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:42:23.476202 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:42:23.535062 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:42:23.541105 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:42:23.544173 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1718d4b_0b09_4305_95d6_6fdc8ade7db6`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:42:23.546369 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1718d4b_0b09_4305_95d6_6fdc8ade7db6`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:42:23.583939 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:42:23.586436 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:42:23.590666 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1718d4b_0b09_4305_95d6_6fdc8ade7db6`)
      
    ...
[0m10:42:23.594990 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1718d4b_0b09_4305_95d6_6fdc8ade7db6`)
      
    ...
[0m10:42:23.624989 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:42:23.627477 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:42:23.637997 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:42:23.648154 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:42:23.659771 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:42:23.662666 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:42:23.668396 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1718d4b_0b09_4305_95d6_6fdc8ade7db6` 
    ...
[0m10:42:23.674124 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1718d4b_0b09_4305_95d6_6fdc8ade7db6` 
    ...
[0m10:42:23.727817 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:42:23.740620 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1718d4b_0b09_4305_95d6_6fdc8ade7db6` 
  ...
[0m10:42:23.743307 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:42:23.758363 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:42:23.761805 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1718d4b_0b09_4305_95d6_6fdc8ade7db6` 
  ...
[0m10:42:23.825805 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:42:23.829680 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:42:23.837372 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:42:23.839772 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:42:23.842836 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1718d4b-0b09-4305-95d6-6fdc8ade7db6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f786859130>]}
[0m10:42:23.844133 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.09s]
[0m10:42:23.846075 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:42:23.847578 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:42:23.852177 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1718d4b-0b09-4305-95d6-6fdc8ade7db6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f785d1af10>]}
[0m10:42:23.853901 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.10s]
[0m10:42:23.855205 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:42:23.857169 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:42:23.857748 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:42:23.858274 [debug] [MainThread]: On list__clean: Close
[0m10:42:23.858830 [debug] [MainThread]: Connection 'list_' was left open.
[0m10:42:23.859320 [debug] [MainThread]: On list_: Close
[0m10:42:23.859820 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:42:23.860293 [debug] [MainThread]: On list__mart: Close
[0m10:42:23.860770 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:42:23.861240 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:42:23.861727 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:42:23.862202 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:42:23.862676 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:42:23.863147 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:42:23.863616 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:42:23.864089 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:42:23.865354 [info ] [MainThread]: 
[0m10:42:23.866020 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.79 seconds (4.79s).
[0m10:42:23.869726 [debug] [MainThread]: Command end result
[0m10:42:24.024472 [info ] [MainThread]: 
[0m10:42:24.026430 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:42:24.027649 [info ] [MainThread]: 
[0m10:42:24.028915 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:42:24.031501 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.5011015, "process_in_blocks": "0", "process_kernel_time": 0.676334, "process_mem_max_rss": "114592", "process_out_blocks": "9744", "process_user_time": 6.442457}
[0m10:42:24.033137 [debug] [MainThread]: Command `dbt build` succeeded at 10:42:24.032757 after 7.50 seconds
[0m10:42:24.034343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f78a70c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f78697b400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f787332670>]}
[0m10:42:24.035649 [debug] [MainThread]: Flushing usage events
[0m10:43:16.382413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b02c36e6310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b02c034bac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b02c034b970>]}


============================== 10:43:16.442672 | b25addac-f869-464f-922f-6ea4b01cf29b ==============================
[0m10:43:16.442672 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:43:16.443878 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'version_check': 'True', 'target_path': 'None', 'profiles_dir': '.', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'introspect': 'True', 'empty': 'False', 'log_format': 'default', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error': 'None', 'fail_fast': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'no_print': 'None', 'partial_parse': 'True', 'static_parser': 'True', 'use_colors': 'True'}
[0m10:43:16.970064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b25addac-f869-464f-922f-6ea4b01cf29b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b02c0327190>]}
[0m10:43:17.163900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b25addac-f869-464f-922f-6ea4b01cf29b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b02c3917a00>]}
[0m10:43:17.165203 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:43:17.580348 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:43:18.086694 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:43:18.087342 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:43:18.339109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b25addac-f869-464f-922f-6ea4b01cf29b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b02bfab0f40>]}
[0m10:43:18.781757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b25addac-f869-464f-922f-6ea4b01cf29b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b02bfaee400>]}
[0m10:43:18.782626 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:43:18.785837 [info ] [MainThread]: 
[0m10:43:18.786818 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:43:18.798655 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:43:18.800260 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:43:18.965848 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:43:18.967644 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:43:19.590683 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:43:19.596848 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:43:19.613650 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:43:19.642523 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:43:19.679728 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:43:19.681209 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:43:19.755514 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:43:19.758017 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:43:19.768543 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:43:19.770946 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:43:19.846460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b25addac-f869-464f-922f-6ea4b01cf29b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b02c2afc070>]}
[0m10:43:19.848412 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:43:19.849766 [info ] [MainThread]: 
[0m10:43:19.876134 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:43:19.877391 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:43:19.878506 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:43:19.879283 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:43:19.947965 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:43:19.949562 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:43:20.142864 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:43:20.210796 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:43:20.212114 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:43:20.224087 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:43:20.354186 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:43:20.357360 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:43:20.359272 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:43:20.362551 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:43:20.368556 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:43:20.371397 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:43:20.373477 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:43:20.376573 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:43:20.469712 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:43:20.473209 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:43:20.479079 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b25addac-f869-464f-922f-6ea4b01cf29b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b02bed34ac0>]}
[0m10:43:20.480334 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m10:43:20.481726 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:43:20.484148 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:43:20.485748 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:43:20.539048 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:43:20.487589 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:43:20.541322 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:43:20.543220 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:43:20.544901 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:43:20.546586 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:43:20.548727 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:43:20.550466 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:43:20.552253 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:43:20.554005 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:43:20.756726 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:43:20.758499 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:43:20.762631 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:43:20.765189 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:43:20.772185 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:43:20.844103 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:43:21.145036 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:43:21.146393 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:43:21.142604 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:43:21.149175 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:43:21.152940 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:43:21.154490 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:43:21.409100 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:43:21.443571 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:43:21.454062 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:43:21.458232 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.91s]
[0m10:43:21.461514 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:43:21.463324 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:43:21.468796 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:43:21.473699 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.93s]
[0m10:43:21.476041 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:43:21.478331 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:43:21.483855 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.94s]
[0m10:43:21.487256 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:43:21.540981 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:43:21.542123 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:43:21.543330 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:43:21.545161 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:43:21.546705 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:43:21.548734 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:43:21.551036 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:43:21.552939 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:43:21.554745 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:43:21.556514 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:43:21.578971 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:43:21.654410 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:43:21.652493 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:43:21.678986 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:43:21.738953 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:43:21.740503 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:43:21.741932 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:43:21.945770 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:43:22.055910 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:43:22.144312 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:43:22.257874 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:43:22.368271 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:43:22.450886 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:43:22.465777 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:43:22.540036 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:43:22.656019 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:43:22.667094 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b25addac_f869_464f_922f_6ea4b01cf29b` 
  ...
[0m10:43:22.673117 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b25addac_f869_464f_922f_6ea4b01cf29b` 
  ...
[0m10:43:22.681085 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:43:22.739896 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:43:22.685514 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:43:22.748017 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:43:22.786077 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:43:22.947118 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:43:23.039761 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:43:23.074814 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b25addac-f869-464f-922f-6ea4b01cf29b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b02be68aca0>]}
[0m10:43:23.076408 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.52s]
[0m10:43:23.071486 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_b25addac_f869_464f_922f_6ea4b01cf29b`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:43:23.079368 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_b25addac_f869_464f_922f_6ea4b01cf29b`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:43:23.081041 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:43:23.105546 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:43:23.144826 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:43:23.185213 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_b25addac_f869_464f_922f_6ea4b01cf29b'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:43:23.187352 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_b25addac_f869_464f_922f_6ea4b01cf29b'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:43:23.247811 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:43:23.250393 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:43:23.263317 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:43:23.268927 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:43:23.271890 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_b25addac_f869_464f_922f_6ea4b01cf29b`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:43:23.274212 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_b25addac_f869_464f_922f_6ea4b01cf29b`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:43:23.309493 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:43:23.311430 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:43:23.338278 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b25addac_f869_464f_922f_6ea4b01cf29b`)
      
    ...
[0m10:43:23.342469 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b25addac_f869_464f_922f_6ea4b01cf29b`)
      
    ...
[0m10:43:23.371305 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:43:23.380603 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:43:23.383333 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:43:23.398586 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:43:23.396089 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:43:23.404743 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b25addac_f869_464f_922f_6ea4b01cf29b` 
    ...
[0m10:43:23.440077 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:43:23.445972 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b25addac_f869_464f_922f_6ea4b01cf29b` 
    ...
[0m10:43:23.455125 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:43:23.457701 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:43:23.470343 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b25addac_f869_464f_922f_6ea4b01cf29b` 
  ...
[0m10:43:23.485180 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b25addac_f869_464f_922f_6ea4b01cf29b` 
  ...
[0m10:43:23.489525 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:43:23.541227 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:43:23.554792 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:43:23.566979 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:43:23.573115 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:43:23.579899 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b25addac-f869-464f-922f-6ea4b01cf29b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b02be557e80>]}
[0m10:43:23.582340 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:43:23.584843 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.03s]
[0m10:43:23.642580 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b25addac-f869-464f-922f-6ea4b01cf29b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b02be68a190>]}
[0m10:43:23.645469 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:43:23.648433 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.09s]
[0m10:43:23.651872 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:43:23.655841 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:43:23.656982 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:43:23.658127 [debug] [MainThread]: On list__clean: Close
[0m10:43:23.659202 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:43:23.660292 [debug] [MainThread]: On list__mart: Close
[0m10:43:23.661334 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:43:23.662464 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:43:23.663522 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:43:23.664701 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:43:23.665764 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:43:23.666890 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:43:23.667934 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:43:23.669055 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:43:23.671271 [info ] [MainThread]: 
[0m10:43:23.672650 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.88 seconds (4.88s).
[0m10:43:23.681019 [debug] [MainThread]: Command end result
[0m10:43:23.949378 [info ] [MainThread]: 
[0m10:43:23.951048 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:43:23.952363 [info ] [MainThread]: 
[0m10:43:23.953788 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:43:23.956467 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.7713537, "process_in_blocks": "0", "process_kernel_time": 0.719768, "process_mem_max_rss": "114656", "process_out_blocks": "9744", "process_user_time": 6.48089}
[0m10:43:23.958076 [debug] [MainThread]: Command `dbt build` succeeded at 10:43:23.957663 after 7.77 seconds
[0m10:43:23.959414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b02c36e6310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b02bfa19520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b02be5a0040>]}
[0m10:43:23.960727 [debug] [MainThread]: Flushing usage events
[0m10:44:16.191548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fd6708310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fd336bb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fd336b9d0>]}


============================== 10:44:16.201174 | d6594ddc-7220-4934-aedd-850a4b076cf8 ==============================
[0m10:44:16.201174 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:44:16.202286 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt build --profiles-dir . --target local', 'empty': 'False', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager', 'target_path': 'None', 'version_check': 'True', 'fail_fast': 'False', 'debug': 'False', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'printer_width': '80', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'use_colors': 'True', 'no_print': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'write_json': 'True', 'quiet': 'False'}
[0m10:44:16.730345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd6594ddc-7220-4934-aedd-850a4b076cf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fd33300a0>]}
[0m10:44:16.927430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd6594ddc-7220-4934-aedd-850a4b076cf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fd335aa60>]}
[0m10:44:16.928701 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:44:17.388507 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:44:17.893213 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:44:17.893976 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:44:18.102854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd6594ddc-7220-4934-aedd-850a4b076cf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fd2ad0e80>]}
[0m10:44:18.540769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd6594ddc-7220-4934-aedd-850a4b076cf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fd2ae6670>]}
[0m10:44:18.541717 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:44:18.582413 [info ] [MainThread]: 
[0m10:44:18.583664 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:44:18.595503 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:44:18.596967 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:44:18.682678 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:44:18.706912 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:44:19.406868 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:44:19.411050 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:44:19.414308 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:44:19.417971 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:44:19.441092 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:44:19.442092 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:44:19.496952 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:44:19.503356 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:44:19.513095 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:44:19.515097 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:44:19.588690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd6594ddc-7220-4934-aedd-850a4b076cf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fd3264c70>]}
[0m10:44:19.590611 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:44:19.591902 [info ] [MainThread]: 
[0m10:44:19.618814 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:44:19.620330 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:44:19.621815 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:44:19.622908 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:44:19.696990 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:44:19.698676 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:44:19.894312 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:44:19.959773 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:44:19.961189 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:44:19.973465 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:44:20.102902 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:44:20.107256 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:44:20.109376 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:44:20.113134 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:44:20.119072 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:44:20.121948 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:44:20.123759 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:44:20.126518 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:44:20.218749 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:44:20.222257 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:44:20.228187 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6594ddc-7220-4934-aedd-850a4b076cf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fd5c21c40>]}
[0m10:44:20.229494 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m10:44:20.230868 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:44:20.233192 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:44:20.282137 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:44:20.284157 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:44:20.285901 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:44:20.287771 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:44:20.289764 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:44:20.292614 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:44:20.294715 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:44:20.296796 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:44:20.298456 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:44:20.300172 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:44:20.301835 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:44:20.491074 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:44:20.493452 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:44:20.498667 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:44:20.500770 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:44:20.501876 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:44:20.513657 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:44:20.718031 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:44:20.792313 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:44:20.811850 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:44:20.814010 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:44:20.816260 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:44:20.819161 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:44:21.075579 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:44:21.087126 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:44:21.094095 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:44:21.098299 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:44:21.103792 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:44:21.122411 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:44:21.119721 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.83s]
[0m10:44:21.127931 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.83s]
[0m10:44:21.184111 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.89s]
[0m10:44:21.187153 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:44:21.190173 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:44:21.193912 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:44:21.198033 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:44:21.199451 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:44:21.201153 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:44:21.203208 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:44:21.205350 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:44:21.207584 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:44:21.209434 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:44:21.211023 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:44:21.212899 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:44:21.215230 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:44:21.216896 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:44:21.218993 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:44:21.408018 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:44:21.415616 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:44:21.413828 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:44:21.418996 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:44:21.420829 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:44:21.422628 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:44:21.512047 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:44:21.688230 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:44:21.783698 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:44:21.883328 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:44:21.913692 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:44:21.999827 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:44:22.102369 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:44:22.189628 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:44:22.382113 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_d6594ddc_7220_4934_aedd_850a4b076cf8` 
  ...
[0m10:44:22.387434 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_d6594ddc_7220_4934_aedd_850a4b076cf8` 
  ...
[0m10:44:22.389945 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:44:22.395788 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:44:22.400065 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:44:22.402517 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:44:22.499403 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:44:22.612327 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:44:22.700833 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:44:22.716596 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6594ddc-7220-4934-aedd-850a4b076cf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fd16caac0>]}
[0m10:44:22.804246 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.50s]
[0m10:44:22.806283 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_d6594ddc_7220_4934_aedd_850a4b076cf8`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:44:22.809285 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:44:22.816809 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_d6594ddc_7220_4934_aedd_850a4b076cf8`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:44:22.848130 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:44:22.883529 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:44:22.996725 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_d6594ddc_7220_4934_aedd_850a4b076cf8'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:44:22.999113 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_d6594ddc_7220_4934_aedd_850a4b076cf8'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:44:23.009393 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:44:23.012144 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:44:23.026098 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:44:23.082526 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_d6594ddc_7220_4934_aedd_850a4b076cf8`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:44:23.084446 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:44:23.089041 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_d6594ddc_7220_4934_aedd_850a4b076cf8`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:44:23.117424 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:44:23.120059 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:44:23.124229 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_d6594ddc_7220_4934_aedd_850a4b076cf8`)
      
    ...
[0m10:44:23.128509 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_d6594ddc_7220_4934_aedd_850a4b076cf8`)
      
    ...
[0m10:44:23.159721 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:44:23.162449 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:44:23.174261 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:44:23.190181 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:44:23.199848 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:44:23.202558 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:44:23.208595 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_d6594ddc_7220_4934_aedd_850a4b076cf8` 
    ...
[0m10:44:23.215140 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_d6594ddc_7220_4934_aedd_850a4b076cf8` 
    ...
[0m10:44:23.226429 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:44:23.234180 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:44:23.291691 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_d6594ddc_7220_4934_aedd_850a4b076cf8` 
  ...
[0m10:44:23.299113 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_d6594ddc_7220_4934_aedd_850a4b076cf8` 
  ...
[0m10:44:23.305248 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:44:23.313163 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:44:23.325241 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:44:23.387177 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:44:23.392044 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:44:23.399737 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:44:23.401101 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6594ddc-7220-4934-aedd-850a4b076cf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fd3e46c40>]}
[0m10:44:23.407383 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6594ddc-7220-4934-aedd-850a4b076cf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fd16d6490>]}
[0m10:44:23.409950 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.19s]
[0m10:44:23.412683 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.20s]
[0m10:44:23.415480 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:44:23.418331 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:44:23.422956 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:44:23.424081 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:44:23.425267 [debug] [MainThread]: On list__mart: Close
[0m10:44:23.426364 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:44:23.427586 [debug] [MainThread]: On list__clean: Close
[0m10:44:23.428683 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:44:23.429772 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:44:23.430829 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:44:23.431959 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:44:23.482691 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:44:23.483860 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:44:23.484913 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:44:23.485982 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:44:23.488279 [info ] [MainThread]: 
[0m10:44:23.489619 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.90 seconds (4.90s).
[0m10:44:23.497778 [debug] [MainThread]: Command end result
[0m10:44:23.701107 [info ] [MainThread]: 
[0m10:44:23.702032 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:44:23.702641 [info ] [MainThread]: 
[0m10:44:23.703396 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:44:23.705147 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.7076473, "process_in_blocks": "0", "process_kernel_time": 0.676165, "process_mem_max_rss": "115248", "process_out_blocks": "9744", "process_user_time": 6.600572}
[0m10:44:23.706020 [debug] [MainThread]: Command `dbt build` succeeded at 10:44:23.705818 after 7.71 seconds
[0m10:44:23.706689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fd6708310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fd2a2e370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797fd2a38640>]}
[0m10:44:23.707334 [debug] [MainThread]: Flushing usage events
[0m10:45:15.885938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75df77fde310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75df74c4faf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75df74c4f9a0>]}


============================== 10:45:15.895325 | cdd6ff4a-52c3-4eba-aa65-7f2b3c30e2cc ==============================
[0m10:45:15.895325 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:45:15.896377 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'no_print': 'None', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'debug': 'False', 'log_format': 'default', 'warn_error': 'None', 'profiles_dir': '.', 'use_colors': 'True', 'version_check': 'True', 'static_parser': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'partial_parse': 'True', 'write_json': 'True', 'fail_fast': 'False', 'target_path': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'use_experimental_parser': 'False', 'quiet': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local'}
[0m10:45:16.422833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cdd6ff4a-52c3-4eba-aa65-7f2b3c30e2cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75df775793a0>]}
[0m10:45:16.614949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cdd6ff4a-52c3-4eba-aa65-7f2b3c30e2cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75df74caf3a0>]}
[0m10:45:16.616260 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:45:17.079089 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:45:17.583358 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:45:17.584072 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:45:17.784461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cdd6ff4a-52c3-4eba-aa65-7f2b3c30e2cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75df743a1ee0>]}
[0m10:45:18.224958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cdd6ff4a-52c3-4eba-aa65-7f2b3c30e2cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75df7438bc70>]}
[0m10:45:18.225822 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:45:18.229191 [info ] [MainThread]: 
[0m10:45:18.230243 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:45:18.280266 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:45:18.282300 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:45:18.375056 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:45:18.324284 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:45:18.992114 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:45:18.994690 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:45:19.001723 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:45:19.004407 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:45:19.088930 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:45:19.090035 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:45:19.103075 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:45:19.107240 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:45:19.115454 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:45:19.116758 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:45:19.184272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cdd6ff4a-52c3-4eba-aa65-7f2b3c30e2cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75df742e8880>]}
[0m10:45:19.185308 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:45:19.186008 [info ] [MainThread]: 
[0m10:45:19.199147 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:45:19.200506 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:45:19.201751 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:45:19.202549 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:45:19.220576 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:45:19.221841 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:45:19.393142 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:45:19.452142 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:45:19.453519 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:45:19.463579 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:45:19.599157 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:45:19.602822 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:45:19.604674 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:45:19.607494 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:45:19.612911 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:45:19.615780 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:45:19.617580 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:45:19.620404 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:45:19.715270 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:45:19.718800 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:45:19.724774 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cdd6ff4a-52c3-4eba-aa65-7f2b3c30e2cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75df73636130>]}
[0m10:45:19.774725 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.52s]
[0m10:45:19.776260 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:45:19.778514 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:45:19.780265 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:45:19.782155 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:45:19.784268 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:45:19.785764 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:45:19.786848 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:45:19.788387 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:45:19.789813 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:45:19.791200 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:45:19.792967 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:45:19.794506 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:45:19.901914 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:45:19.984154 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:45:19.994300 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:45:20.002469 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:45:20.005224 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:45:20.012206 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:45:20.085357 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:45:20.380326 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:45:20.378734 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:45:20.397303 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:45:20.400322 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:45:20.402428 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:45:20.406059 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:45:20.655806 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:45:20.679130 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:45:20.695043 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.91s]
[0m10:45:20.705605 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:45:20.711220 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:45:20.716932 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:45:20.775280 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:45:20.777960 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:45:20.783623 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.00s]
[0m10:45:20.789185 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.99s]
[0m10:45:20.792011 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:45:20.794788 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:45:20.797968 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:45:20.799097 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:45:20.800673 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:45:20.801959 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:45:20.804302 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:45:20.805960 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:45:20.807717 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:45:20.809449 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:45:20.811154 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:45:20.812891 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:45:20.814512 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:45:20.879994 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:45:20.915499 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:45:20.987234 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:45:20.978584 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:45:20.990035 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:45:20.992082 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:45:21.014656 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:45:21.107458 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:45:21.186157 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:45:21.301690 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:45:21.402646 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:45:21.486803 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:45:21.501422 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:45:21.607588 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:45:21.687274 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:45:21.712672 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:45:21.716859 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:45:21.895957 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:45:21.884436 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_cdd6ff4a_52c3_4eba_aa65_7f2b3c30e2cc` 
  ...
[0m10:45:21.921500 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_cdd6ff4a_52c3_4eba_aa65_7f2b3c30e2cc` 
  ...
[0m10:45:21.976393 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:45:21.982520 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:45:21.987261 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:45:21.995192 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:45:22.088827 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cdd6ff4a-52c3-4eba-aa65-7f2b3c30e2cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75df72f8c6a0>]}
[0m10:45:22.175976 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.28s]
[0m10:45:22.189303 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:45:22.409724 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_cdd6ff4a_52c3_4eba_aa65_7f2b3c30e2cc`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:45:22.416754 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_cdd6ff4a_52c3_4eba_aa65_7f2b3c30e2cc`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:45:22.475808 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:45:22.477626 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:45:22.575705 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_cdd6ff4a_52c3_4eba_aa65_7f2b3c30e2cc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:45:22.587003 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_cdd6ff4a_52c3_4eba_aa65_7f2b3c30e2cc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:45:22.593608 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:45:22.596455 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:45:22.609930 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:45:22.615740 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:45:22.618769 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_cdd6ff4a_52c3_4eba_aa65_7f2b3c30e2cc`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:45:22.621095 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_cdd6ff4a_52c3_4eba_aa65_7f2b3c30e2cc`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:45:22.704122 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:45:22.706842 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:45:22.710775 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_cdd6ff4a_52c3_4eba_aa65_7f2b3c30e2cc`)
      
    ...
[0m10:45:22.714960 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_cdd6ff4a_52c3_4eba_aa65_7f2b3c30e2cc`)
      
    ...
[0m10:45:22.743172 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:45:22.748996 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:45:22.750814 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:45:22.759610 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:45:22.762208 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:45:22.767503 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_cdd6ff4a_52c3_4eba_aa65_7f2b3c30e2cc` 
    ...
[0m10:45:22.775565 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:45:22.786441 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_cdd6ff4a_52c3_4eba_aa65_7f2b3c30e2cc` 
    ...
[0m10:45:22.790414 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:45:22.800286 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_cdd6ff4a_52c3_4eba_aa65_7f2b3c30e2cc` 
  ...
[0m10:45:22.802328 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:45:22.813811 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_cdd6ff4a_52c3_4eba_aa65_7f2b3c30e2cc` 
  ...
[0m10:45:22.815648 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:45:22.881086 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:45:22.882818 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:45:22.897492 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:45:22.903397 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:45:22.909979 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cdd6ff4a-52c3-4eba-aa65-7f2b3c30e2cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75df72ee5a30>]}
[0m10:45:22.912304 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:45:22.914759 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.10s]
[0m10:45:22.921443 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cdd6ff4a-52c3-4eba-aa65-7f2b3c30e2cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75df74127250>]}
[0m10:45:22.975073 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:45:22.978001 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.11s]
[0m10:45:22.981427 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:45:22.985477 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:45:22.986650 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:45:22.987847 [debug] [MainThread]: On list__mart: Close
[0m10:45:22.988987 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:45:22.990167 [debug] [MainThread]: On list__clean: Close
[0m10:45:22.991281 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:45:22.992422 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:45:22.993511 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:45:22.994727 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:45:22.995826 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:45:22.996905 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:45:22.997953 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:45:22.999031 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:45:23.001403 [info ] [MainThread]: 
[0m10:45:23.002964 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.77 seconds (4.77s).
[0m10:45:23.011232 [debug] [MainThread]: Command end result
[0m10:45:23.275449 [info ] [MainThread]: 
[0m10:45:23.277218 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:45:23.278624 [info ] [MainThread]: 
[0m10:45:23.280092 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:45:23.282921 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.590142, "process_in_blocks": "0", "process_kernel_time": 0.670823, "process_mem_max_rss": "114812", "process_out_blocks": "9752", "process_user_time": 6.493179}
[0m10:45:23.284567 [debug] [MainThread]: Command `dbt build` succeeded at 10:45:23.284136 after 7.59 seconds
[0m10:45:23.285971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75df77fde310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75df75f6bd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75df72bcce20>]}
[0m10:45:23.287296 [debug] [MainThread]: Flushing usage events
[0m10:46:15.814788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d9ce5f4d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d9cb243ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d9cb243b50>]}


============================== 10:46:15.874496 | 39377b43-25d6-4484-a22c-eb47c5978c59 ==============================
[0m10:46:15.874496 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:46:15.875707 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'no_print': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'log_format': 'default', 'profiles_dir': '.', 'write_json': 'True', 'static_parser': 'True', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False', 'use_colors': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'target_path': 'None', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'version_check': 'True', 'empty': 'False', 'debug': 'False', 'cache_selected_only': 'False', 'partial_parse': 'True', 'quiet': 'False', 'warn_error': 'None'}
[0m10:46:16.406351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '39377b43-25d6-4484-a22c-eb47c5978c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d9cb2916d0>]}
[0m10:46:16.601267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '39377b43-25d6-4484-a22c-eb47c5978c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d9cb27c7f0>]}
[0m10:46:16.602576 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:46:17.015609 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:46:17.576443 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:46:17.577125 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:46:17.777582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '39377b43-25d6-4484-a22c-eb47c5978c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d9ca9a7df0>]}
[0m10:46:18.223125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '39377b43-25d6-4484-a22c-eb47c5978c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d9ca9a7dc0>]}
[0m10:46:18.224027 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:46:18.227301 [info ] [MainThread]: 
[0m10:46:18.228394 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:46:18.278547 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:46:18.291003 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:46:18.367372 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:46:18.380372 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:46:19.101601 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:46:19.108839 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:46:19.110894 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:46:19.124491 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:46:19.202628 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:46:19.203934 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:46:19.270194 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:46:19.274350 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:46:19.280701 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:46:19.281991 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:46:19.303066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '39377b43-25d6-4484-a22c-eb47c5978c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d9cb1a5dc0>]}
[0m10:46:19.304672 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:46:19.305866 [info ] [MainThread]: 
[0m10:46:19.367836 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:46:19.369100 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:46:19.370247 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:46:19.371043 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:46:19.389749 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:46:19.391038 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:46:19.513327 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:46:19.623783 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:46:19.625191 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:46:19.637384 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:46:19.715359 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:46:19.768983 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:46:19.771047 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:46:19.773950 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:46:19.779811 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:46:19.782848 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:46:19.784751 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:46:19.787623 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:46:19.881109 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:46:19.884482 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:46:19.890445 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '39377b43-25d6-4484-a22c-eb47c5978c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d9cdae7bb0>]}
[0m10:46:19.891623 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.52s]
[0m10:46:19.892983 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:46:19.895462 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:46:19.897153 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:46:19.898938 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:46:19.900667 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:46:19.902674 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:46:19.904656 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:46:19.906409 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:46:19.907873 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:46:19.909929 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:46:19.911252 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:46:19.912323 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:46:19.914047 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:46:20.167380 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:46:20.169388 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:46:20.176519 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:46:20.179469 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:46:20.181190 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:46:20.193236 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:46:20.477011 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:46:20.490333 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:46:20.506073 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:46:20.508355 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:46:20.510007 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:46:20.512087 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:46:20.814303 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:46:20.828839 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:46:20.834618 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:46:20.868725 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:46:20.870394 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:46:20.883086 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.97s]
[0m10:46:20.888987 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.98s]
[0m10:46:20.894280 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:46:20.897601 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:46:20.903128 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:46:20.909007 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.00s]
[0m10:46:20.911891 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:46:20.915095 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:46:20.916570 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:46:20.918240 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:46:20.966774 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:46:20.969058 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:46:20.970735 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:46:20.972609 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:46:20.974515 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:46:20.976200 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:46:20.977926 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:46:20.979765 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:46:20.997083 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:46:21.104345 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:46:21.096727 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:46:21.108078 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:46:21.110623 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:46:21.167413 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:46:21.169135 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:46:21.271324 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:46:21.388464 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:46:21.483824 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:46:21.578271 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:46:21.613706 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:46:21.675074 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:46:21.788273 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:46:21.880675 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:46:21.982806 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:46:21.997366 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:46:22.076613 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_39377b43_25d6_4484_a22c_eb47c5978c59` 
  ...
[0m10:46:22.078990 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:46:22.091726 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_39377b43_25d6_4484_a22c_eb47c5978c59` 
  ...
[0m10:46:22.104369 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:46:22.110932 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:46:22.173351 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:46:22.202171 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:46:22.295737 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '39377b43-25d6-4484-a22c-eb47c5978c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d9c9cc4760>]}
[0m10:46:22.304462 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_39377b43_25d6_4484_a22c_eb47c5978c59`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:46:22.310470 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_39377b43_25d6_4484_a22c_eb47c5978c59`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:46:22.312172 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.32s]
[0m10:46:22.315940 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:46:22.366976 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:46:22.402631 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_39377b43_25d6_4484_a22c_eb47c5978c59'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:46:22.404039 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:46:22.413892 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_39377b43_25d6_4484_a22c_eb47c5978c59'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:46:22.471397 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:46:22.484332 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:46:22.482655 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:46:22.491007 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:46:22.493870 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_39377b43_25d6_4484_a22c_eb47c5978c59`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:46:22.496030 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_39377b43_25d6_4484_a22c_eb47c5978c59`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:46:22.530305 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:46:22.533148 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:46:22.537854 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_39377b43_25d6_4484_a22c_eb47c5978c59`)
      
    ...
[0m10:46:22.567482 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_39377b43_25d6_4484_a22c_eb47c5978c59`)
      
    ...
[0m10:46:22.598748 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:46:22.604000 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:46:22.605410 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:46:22.615478 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:46:22.620590 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:46:22.629081 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_39377b43_25d6_4484_a22c_eb47c5978c59` 
    ...
[0m10:46:22.632063 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:46:22.639265 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_39377b43_25d6_4484_a22c_eb47c5978c59` 
    ...
[0m10:46:22.674807 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:46:22.682642 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:46:22.696423 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_39377b43_25d6_4484_a22c_eb47c5978c59` 
  ...
[0m10:46:22.704599 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_39377b43_25d6_4484_a22c_eb47c5978c59` 
  ...
[0m10:46:22.710767 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:46:22.772021 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:46:22.774692 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:46:22.787167 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:46:22.794407 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:46:22.796891 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:46:22.804061 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '39377b43-25d6-4484-a22c-eb47c5978c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d9c95c3eb0>]}
[0m10:46:22.810314 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '39377b43-25d6-4484-a22c-eb47c5978c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d9c9d7f610>]}
[0m10:46:22.812810 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.83s]
[0m10:46:22.815584 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.84s]
[0m10:46:22.869027 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:46:22.871931 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:46:22.876882 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:46:22.878075 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:46:22.879232 [debug] [MainThread]: On list__mart: Close
[0m10:46:22.880315 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:46:22.881407 [debug] [MainThread]: On list__clean: Close
[0m10:46:22.882472 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:46:22.883602 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:46:22.884690 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:46:22.885790 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:46:22.886872 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:46:22.887961 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:46:22.889015 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:46:22.890099 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:46:22.892380 [info ] [MainThread]: 
[0m10:46:22.893765 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.66 seconds (4.66s).
[0m10:46:22.901783 [debug] [MainThread]: Command end result
[0m10:46:23.116051 [info ] [MainThread]: 
[0m10:46:23.167910 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:46:23.169343 [info ] [MainThread]: 
[0m10:46:23.170933 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:46:23.173664 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.504488, "process_in_blocks": "0", "process_kernel_time": 0.689308, "process_mem_max_rss": "115316", "process_out_blocks": "9744", "process_user_time": 6.404287}
[0m10:46:23.175276 [debug] [MainThread]: Command `dbt build` succeeded at 10:46:23.174864 after 7.51 seconds
[0m10:46:23.176679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d9ce5f4d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d9ca857340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d9c94992e0>]}
[0m10:46:23.178039 [debug] [MainThread]: Flushing usage events
[0m10:47:16.919985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72a515262310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72a511ec3a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72a511ec3940>]}


============================== 10:47:16.929304 | 24c7a2f8-7ec5-42ef-ba99-44de3b520245 ==============================
[0m10:47:16.929304 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:47:16.930473 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'debug': 'False', 'write_json': 'True', 'quiet': 'False', 'warn_error': 'None', 'no_print': 'None', 'introspect': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'version_check': 'True', 'empty': 'False', 'static_parser': 'True', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'log_format': 'default', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None'}
[0m10:47:17.510028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '24c7a2f8-7ec5-42ef-ba99-44de3b520245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72a511e9ec70>]}
[0m10:47:17.651605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '24c7a2f8-7ec5-42ef-ba99-44de3b520245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72a511dbbb20>]}
[0m10:47:17.652889 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:47:18.117273 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:47:18.619045 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:47:18.619701 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:47:18.818676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '24c7a2f8-7ec5-42ef-ba99-44de3b520245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72a511628f40>]}
[0m10:47:19.269527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '24c7a2f8-7ec5-42ef-ba99-44de3b520245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72a511622400>]}
[0m10:47:19.270411 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:47:19.310779 [info ] [MainThread]: 
[0m10:47:19.312016 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:47:19.324012 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:47:19.325917 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:47:19.428446 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:47:19.445384 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:47:20.181672 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:47:20.187120 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:47:20.190470 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:47:20.223785 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:47:20.314486 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:47:20.326196 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:47:20.331392 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:47:20.337654 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:47:20.347027 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:47:20.348844 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:47:20.423701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '24c7a2f8-7ec5-42ef-ba99-44de3b520245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72a51117fc10>]}
[0m10:47:20.425615 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:47:20.427006 [info ] [MainThread]: 
[0m10:47:20.453726 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:47:20.454842 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:47:20.455982 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:47:20.456759 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:47:20.532041 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:47:20.533765 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:47:20.723100 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:47:20.801171 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:47:20.803051 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:47:20.815198 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:47:20.950182 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:47:20.953928 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:47:20.955827 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:47:20.958593 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:47:21.013691 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:47:21.017194 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:47:21.019177 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:47:21.022169 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:47:21.115641 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:47:21.119128 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:47:21.125035 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '24c7a2f8-7ec5-42ef-ba99-44de3b520245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72a5108b7a00>]}
[0m10:47:21.126209 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.67s]
[0m10:47:21.127600 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:47:21.129957 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:47:21.131641 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:47:21.132618 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:47:21.134098 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:47:21.135973 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:47:21.138309 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:47:21.140209 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:47:21.142528 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:47:21.144213 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:47:21.146300 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:47:21.148092 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:47:21.215635 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:47:21.332914 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:47:21.337409 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:47:21.346803 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:47:21.349385 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:47:21.415347 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:47:21.356230 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:47:21.655751 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:47:21.716641 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:47:21.719470 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:47:21.722604 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:47:21.724353 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:47:21.726602 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:47:21.977958 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:47:22.011382 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:47:22.026904 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:47:22.028868 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.89s]
[0m10:47:22.036946 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:47:22.038872 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:47:22.043344 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:47:22.047873 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.91s]
[0m10:47:22.050117 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:47:22.052625 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:47:22.110202 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m10:47:22.113155 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:47:22.115775 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:47:22.117139 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:47:22.118813 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:47:22.120588 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:47:22.122590 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:47:22.124867 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:47:22.126924 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:47:22.128623 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:47:22.130258 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:47:22.132177 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:47:22.134057 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:47:22.135888 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:47:22.249858 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:47:22.313600 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:47:22.328304 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:47:22.330590 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:47:22.332102 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:47:22.333848 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:47:22.448221 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:47:22.610451 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:47:22.726665 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:47:22.832197 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:47:22.916322 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:47:22.936262 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:47:23.053734 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:47:23.140803 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:47:23.217641 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_24c7a2f8_7ec5_42ef_ba99_44de3b520245` 
  ...
[0m10:47:23.233894 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:47:23.236477 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:47:23.247647 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_24c7a2f8_7ec5_42ef_ba99_44de3b520245` 
  ...
[0m10:47:23.251950 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:47:23.343938 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:47:23.416358 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:47:23.451292 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:47:23.546128 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:47:23.556494 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '24c7a2f8-7ec5-42ef-ba99-44de3b520245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72a51024e820>]}
[0m10:47:23.616182 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.43s]
[0m10:47:23.645554 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:47:23.732471 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_24c7a2f8_7ec5_42ef_ba99_44de3b520245`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:47:23.734124 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_24c7a2f8_7ec5_42ef_ba99_44de3b520245`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:47:23.765854 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:47:23.781071 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:47:23.853439 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_24c7a2f8_7ec5_42ef_ba99_44de3b520245'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:47:23.855113 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_24c7a2f8_7ec5_42ef_ba99_44de3b520245'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:47:23.912082 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:47:23.928382 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:47:23.929760 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:47:23.935281 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:47:23.938266 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_24c7a2f8_7ec5_42ef_ba99_44de3b520245`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:47:23.940583 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_24c7a2f8_7ec5_42ef_ba99_44de3b520245`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:47:23.976884 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:47:23.981558 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_24c7a2f8_7ec5_42ef_ba99_44de3b520245`)
      
    ...
[0m10:47:23.984202 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:47:24.013344 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_24c7a2f8_7ec5_42ef_ba99_44de3b520245`)
      
    ...
[0m10:47:24.036395 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:47:24.051462 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:47:24.048770 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:47:24.061121 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:47:24.070990 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:47:24.109845 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_24c7a2f8_7ec5_42ef_ba99_44de3b520245` 
    ...
[0m10:47:24.112702 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:47:24.120203 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_24c7a2f8_7ec5_42ef_ba99_44de3b520245` 
    ...
[0m10:47:24.123107 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:47:24.137823 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:47:24.139762 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_24c7a2f8_7ec5_42ef_ba99_44de3b520245` 
  ...
[0m10:47:24.151988 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_24c7a2f8_7ec5_42ef_ba99_44de3b520245` 
  ...
[0m10:47:24.211073 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:47:24.212720 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:47:24.230405 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:47:24.237722 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:47:24.243646 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:47:24.250723 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '24c7a2f8-7ec5-42ef-ba99-44de3b520245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72a51024e640>]}
[0m10:47:24.253170 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:47:24.255706 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.12s]
[0m10:47:24.313376 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '24c7a2f8-7ec5-42ef-ba99-44de3b520245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72a5102376a0>]}
[0m10:47:24.316209 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:47:24.319370 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.19s]
[0m10:47:24.322709 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:47:24.326527 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:47:24.327681 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:47:24.328849 [debug] [MainThread]: On list__mart: Close
[0m10:47:24.329935 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:47:24.331077 [debug] [MainThread]: On list__clean: Close
[0m10:47:24.332150 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:47:24.333334 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:47:24.334416 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:47:24.335570 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:47:24.336639 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:47:24.337832 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:47:24.339702 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:47:24.340947 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:47:24.343242 [info ] [MainThread]: 
[0m10:47:24.344721 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.03 seconds (5.03s).
[0m10:47:24.352824 [debug] [MainThread]: Command end result
[0m10:47:24.558695 [info ] [MainThread]: 
[0m10:47:24.559507 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:47:24.611065 [info ] [MainThread]: 
[0m10:47:24.612450 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:47:24.615067 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.889144, "process_in_blocks": "0", "process_kernel_time": 0.638424, "process_mem_max_rss": "114832", "process_out_blocks": "9744", "process_user_time": 6.63488}
[0m10:47:24.616467 [debug] [MainThread]: Command `dbt build` succeeded at 10:47:24.616103 after 7.89 seconds
[0m10:47:24.617705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72a515262310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72a511612250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72a5127e3bb0>]}
[0m10:47:24.618763 [debug] [MainThread]: Flushing usage events
[0m10:48:16.033208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799655a9e310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7996526f7af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7996526f79a0>]}


============================== 10:48:16.042280 | 385ed9a8-fec6-4f61-9655-b745957991e9 ==============================
[0m10:48:16.042280 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:48:16.043426 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'fail_fast': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'profiles_dir': '.', 'introspect': 'True', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'static_parser': 'True', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'no_print': 'None', 'target_path': 'None', 'log_format': 'default', 'debug': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'partial_parse': 'True', 'cache_selected_only': 'False', 'version_check': 'True', 'warn_error': 'None', 'use_experimental_parser': 'False', 'write_json': 'True', 'empty': 'False'}
[0m10:48:16.574796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '385ed9a8-fec6-4f61-9655-b745957991e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7996550393a0>]}
[0m10:48:16.772678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '385ed9a8-fec6-4f61-9655-b745957991e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7996527b83a0>]}
[0m10:48:16.774125 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:48:17.267127 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:48:17.770174 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:48:17.770815 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:48:17.970475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '385ed9a8-fec6-4f61-9655-b745957991e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799651e5eee0>]}
[0m10:48:18.447107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '385ed9a8-fec6-4f61-9655-b745957991e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799651e48c70>]}
[0m10:48:18.447963 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:48:18.451155 [info ] [MainThread]: 
[0m10:48:18.452206 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:48:18.464313 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:48:18.465943 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:48:18.567679 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:48:18.634860 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:48:19.329266 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:48:19.333379 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:48:19.336788 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:48:19.341033 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:48:19.374312 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:48:19.434422 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:48:19.438595 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:48:19.444581 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:48:19.454387 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:48:19.464010 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:48:19.482378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '385ed9a8-fec6-4f61-9655-b745957991e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799654eb8970>]}
[0m10:48:19.529844 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:48:19.531310 [info ] [MainThread]: 
[0m10:48:19.557307 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:48:19.558382 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:48:19.559498 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:48:19.560223 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:48:19.577955 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:48:19.579180 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:48:19.768729 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:48:19.883083 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:48:19.884521 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:48:19.897094 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:48:19.976457 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:48:20.031373 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:48:20.033564 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:48:20.036740 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:48:20.043142 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:48:20.046212 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:48:20.048152 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:48:20.050819 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:48:20.144196 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:48:20.147634 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:48:20.153516 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385ed9a8-fec6-4f61-9655-b745957991e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7996519f6220>]}
[0m10:48:20.154729 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m10:48:20.156071 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:48:20.157937 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:48:20.159145 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:48:20.160452 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:48:20.161708 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:48:20.163530 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:48:20.165462 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:48:20.167482 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:48:20.169386 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:48:20.171579 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:48:20.173702 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:48:20.239683 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:48:20.265417 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:48:20.278113 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:48:20.361153 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:48:20.356689 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:48:20.363769 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:48:20.366138 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:48:20.367805 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:48:20.669058 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:48:20.667253 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:48:20.740059 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:48:20.742819 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:48:20.746990 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:48:20.749082 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:48:21.001434 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:48:21.030816 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:48:21.047038 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.87s]
[0m10:48:21.053178 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:48:21.063529 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:48:21.068324 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:48:21.078890 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:48:21.130371 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:48:21.135488 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.96s]
[0m10:48:21.141179 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.98s]
[0m10:48:21.144313 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:48:21.147306 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:48:21.150783 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:48:21.152019 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:48:21.153756 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:48:21.155240 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:48:21.157026 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:48:21.159244 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:48:21.161192 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:48:21.162815 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:48:21.164380 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:48:21.166102 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:48:21.167822 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:48:21.169454 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:48:21.331829 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:48:21.361389 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:48:21.370294 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:48:21.372429 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:48:21.374202 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:48:21.434402 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:48:21.452437 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:48:21.634489 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:48:21.730202 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:48:21.850774 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:48:22.030233 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:48:22.044864 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:48:22.075071 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:48:22.241604 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_385ed9a8_fec6_4f61_9655_b745957991e9` 
  ...
[0m10:48:22.232674 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:48:22.270222 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:48:22.334721 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_385ed9a8_fec6_4f61_9655_b745957991e9` 
  ...
[0m10:48:22.343148 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:48:22.431741 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:48:22.448882 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:48:22.568090 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:48:22.639643 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_385ed9a8_fec6_4f61_9655_b745957991e9`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:48:22.649206 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_385ed9a8_fec6_4f61_9655_b745957991e9`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:48:22.656944 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:48:22.669686 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:48:22.729519 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:48:22.730786 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385ed9a8-fec6-4f61-9655-b745957991e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799650a24820>]}
[0m10:48:22.732687 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:48:22.750152 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.57s]
[0m10:48:22.753695 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_385ed9a8_fec6_4f61_9655_b745957991e9'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:48:22.763089 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_385ed9a8_fec6_4f61_9655_b745957991e9'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:48:22.766250 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:48:22.776319 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:48:22.779058 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:48:22.841628 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:48:22.847194 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:48:22.850323 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_385ed9a8_fec6_4f61_9655_b745957991e9`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:48:22.853062 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_385ed9a8_fec6_4f61_9655_b745957991e9`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:48:22.886340 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:48:22.888887 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:48:22.893266 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_385ed9a8_fec6_4f61_9655_b745957991e9`)
      
    ...
[0m10:48:22.897460 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_385ed9a8_fec6_4f61_9655_b745957991e9`)
      
    ...
[0m10:48:22.932257 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:48:22.942267 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:48:22.948192 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:48:22.959165 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:48:22.968256 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:48:22.976145 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:48:22.974275 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_385ed9a8_fec6_4f61_9655_b745957991e9` 
    ...
[0m10:48:23.029221 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_385ed9a8_fec6_4f61_9655_b745957991e9` 
    ...
[0m10:48:23.044417 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:48:23.046980 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:48:23.060101 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_385ed9a8_fec6_4f61_9655_b745957991e9` 
  ...
[0m10:48:23.072846 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_385ed9a8_fec6_4f61_9655_b745957991e9` 
  ...
[0m10:48:23.079132 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:48:23.130120 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:48:23.148320 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:48:23.151049 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:48:23.157563 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:48:23.165205 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:48:23.166786 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385ed9a8-fec6-4f61-9655-b745957991e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7996508494c0>]}
[0m10:48:23.173064 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385ed9a8-fec6-4f61-9655-b745957991e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799650a24f10>]}
[0m10:48:23.228753 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.00s]
[0m10:48:23.231740 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.01s]
[0m10:48:23.234838 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:48:23.237760 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:48:23.242703 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:48:23.243852 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:48:23.244985 [debug] [MainThread]: On list__clean: Close
[0m10:48:23.246079 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:48:23.247153 [debug] [MainThread]: On list__mart: Close
[0m10:48:23.248209 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:48:23.249330 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:48:23.250418 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:48:23.251558 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:48:23.252601 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:48:23.253674 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:48:23.254700 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:48:23.255816 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:48:23.258103 [info ] [MainThread]: 
[0m10:48:23.259807 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.81 seconds (4.81s).
[0m10:48:23.268103 [debug] [MainThread]: Command end result
[0m10:48:23.528973 [info ] [MainThread]: 
[0m10:48:23.531141 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:48:23.532472 [info ] [MainThread]: 
[0m10:48:23.534145 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:48:23.537223 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.6988306, "process_in_blocks": "0", "process_kernel_time": 0.690562, "process_mem_max_rss": "115276", "process_out_blocks": "9744", "process_user_time": 6.441318}
[0m10:48:23.539823 [debug] [MainThread]: Command `dbt build` succeeded at 10:48:23.539171 after 7.70 seconds
[0m10:48:23.542121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799655a9e310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7996525c59a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7996550393a0>]}
[0m10:48:23.543690 [debug] [MainThread]: Flushing usage events
[0m10:49:15.598332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715989ecde20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715986b33bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715986b33a60>]}


============================== 10:49:15.607587 | f336fc5a-ea61-49cb-81de-ad522e2fb7cc ==============================
[0m10:49:15.607587 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:49:15.608709 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'warn_error': 'None', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'printer_width': '80', 'fail_fast': 'False', 'target_path': 'None', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt build --profiles-dir . --target local', 'cache_selected_only': 'False', 'profiles_dir': '.', 'quiet': 'False', 'write_json': 'True', 'debug': 'False', 'empty': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'introspect': 'True', 'static_parser': 'True', 'indirect_selection': 'eager'}
[0m10:49:16.180874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f336fc5a-ea61-49cb-81de-ad522e2fb7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715986a20b20>]}
[0m10:49:16.378298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f336fc5a-ea61-49cb-81de-ad522e2fb7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715986f9c370>]}
[0m10:49:16.379601 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:49:16.800463 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:49:17.366194 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:49:17.367020 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:49:17.570131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f336fc5a-ea61-49cb-81de-ad522e2fb7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715986299e50>]}
[0m10:49:18.074374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f336fc5a-ea61-49cb-81de-ad522e2fb7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7159862bc2e0>]}
[0m10:49:18.075254 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:49:18.078396 [info ] [MainThread]: 
[0m10:49:18.079463 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:49:18.091008 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:49:18.092480 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:49:18.210171 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:49:18.211801 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:49:19.078418 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:49:19.082686 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:49:19.086940 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:49:19.089714 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:49:19.194730 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:49:19.206553 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:49:19.210780 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:49:19.267299 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:49:19.279258 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:49:19.281485 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:49:19.309657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f336fc5a-ea61-49cb-81de-ad522e2fb7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715986a97970>]}
[0m10:49:19.310986 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:49:19.311876 [info ] [MainThread]: 
[0m10:49:19.380881 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:49:19.382025 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:49:19.383404 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:49:19.384229 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:49:19.401978 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:49:19.403186 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:49:19.591374 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:49:19.666955 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:49:19.668405 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:49:19.686798 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:49:19.806851 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:49:19.810295 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:49:19.812203 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:49:19.815505 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:49:19.868915 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:49:19.872184 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:49:19.874069 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:49:19.876934 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:49:19.972514 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:49:19.975996 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:49:19.982119 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f336fc5a-ea61-49cb-81de-ad522e2fb7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71598560c3a0>]}
[0m10:49:19.983369 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m10:49:19.984704 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:49:19.986358 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:49:19.987249 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:49:19.988315 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:49:19.989318 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:49:19.990379 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:49:19.991394 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:49:19.992713 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:49:19.993934 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:49:19.995015 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:49:19.995984 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:49:19.996970 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:49:19.997866 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:49:20.100935 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:49:20.112424 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:49:20.169977 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:49:20.172995 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:49:20.185198 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:49:20.207795 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:49:20.483059 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:49:20.489800 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:49:20.500058 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:49:20.501812 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:49:20.503461 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:49:20.507064 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:49:20.786521 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:49:20.789254 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:49:20.804876 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:49:20.808880 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:49:20.867801 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:49:20.880941 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:49:20.889909 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.90s]
[0m10:49:20.886900 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.89s]
[0m10:49:20.896585 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.90s]
[0m10:49:20.899995 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:49:20.903003 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:49:20.905762 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:49:20.909623 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:49:20.910663 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:49:20.912160 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:49:20.913378 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:49:20.968364 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:49:20.970081 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:49:20.971937 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:49:20.973780 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:49:20.975352 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:49:20.977048 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:49:20.978745 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:49:20.990804 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:49:21.087718 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:49:21.100031 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:49:21.103636 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:49:21.106407 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:49:21.108182 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:49:21.171785 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:49:21.275397 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:49:21.472082 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:49:21.577797 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:49:21.700058 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:49:21.801071 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:49:21.874222 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:49:21.967652 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:49:22.070934 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f336fc5a_ea61_49cb_81de_ad522e2fb7cc` 
  ...
[0m10:49:22.080560 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:49:22.090570 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f336fc5a_ea61_49cb_81de_ad522e2fb7cc` 
  ...
[0m10:49:22.095430 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:49:22.100127 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:49:22.112970 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:49:22.185180 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:49:22.310363 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:49:22.395860 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:49:22.414957 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_f336fc5a_ea61_49cb_81de_ad522e2fb7cc`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:49:22.467025 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_f336fc5a_ea61_49cb_81de_ad522e2fb7cc`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:49:22.473297 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:49:22.484189 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f336fc5a-ea61-49cb-81de-ad522e2fb7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715984ed0ac0>]}
[0m10:49:22.487388 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.51s]
[0m10:49:22.490191 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:49:22.504264 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:49:22.521211 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:49:22.604550 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_f336fc5a_ea61_49cb_81de_ad522e2fb7cc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:49:22.609520 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_f336fc5a_ea61_49cb_81de_ad522e2fb7cc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:49:22.667695 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:49:22.669861 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:49:22.683130 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:49:22.688570 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:49:22.691682 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_f336fc5a_ea61_49cb_81de_ad522e2fb7cc`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:49:22.695823 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_f336fc5a_ea61_49cb_81de_ad522e2fb7cc`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:49:22.723872 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:49:22.726557 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:49:22.730637 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f336fc5a_ea61_49cb_81de_ad522e2fb7cc`)
      
    ...
[0m10:49:22.734636 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f336fc5a_ea61_49cb_81de_ad522e2fb7cc`)
      
    ...
[0m10:49:22.798289 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:49:22.811769 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:49:22.814580 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:49:22.826679 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:49:22.829565 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:49:22.838110 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f336fc5a_ea61_49cb_81de_ad522e2fb7cc` 
    ...
[0m10:49:22.841075 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:49:22.871353 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f336fc5a_ea61_49cb_81de_ad522e2fb7cc` 
    ...
[0m10:49:22.876194 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:49:22.890201 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f336fc5a_ea61_49cb_81de_ad522e2fb7cc` 
  ...
[0m10:49:22.892719 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:49:22.906845 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f336fc5a_ea61_49cb_81de_ad522e2fb7cc` 
  ...
[0m10:49:22.909311 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:49:22.972809 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:49:22.978874 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:49:22.991781 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:49:22.997870 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:49:23.005002 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f336fc5a-ea61-49cb-81de-ad522e2fb7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715984ed4940>]}
[0m10:49:23.008148 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:49:23.010811 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.03s]
[0m10:49:23.069138 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f336fc5a-ea61-49cb-81de-ad522e2fb7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715987d4ddc0>]}
[0m10:49:23.072152 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:49:23.075192 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.10s]
[0m10:49:23.079078 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:49:23.082978 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:49:23.083979 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:49:23.084684 [debug] [MainThread]: On list__mart: Close
[0m10:49:23.085347 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:49:23.086611 [debug] [MainThread]: On list__clean: Close
[0m10:49:23.087711 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:49:23.088853 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:49:23.089959 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:49:23.091102 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:49:23.092212 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:49:23.093351 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:49:23.094469 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:49:23.095745 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:49:23.098077 [info ] [MainThread]: 
[0m10:49:23.099439 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.02 seconds (5.02s).
[0m10:49:23.107483 [debug] [MainThread]: Command end result
[0m10:49:23.369560 [info ] [MainThread]: 
[0m10:49:23.371205 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:49:23.372450 [info ] [MainThread]: 
[0m10:49:23.373823 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:49:23.376440 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.967946, "process_in_blocks": "0", "process_kernel_time": 0.749628, "process_mem_max_rss": "115044", "process_out_blocks": "9744", "process_user_time": 6.596529}
[0m10:49:23.378008 [debug] [MainThread]: Command `dbt build` succeeded at 10:49:23.377582 after 7.97 seconds
[0m10:49:23.379313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715989ecde20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715987d5e550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71598756e310>]}
[0m10:49:23.380604 [debug] [MainThread]: Flushing usage events
[0m10:50:16.609033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711e2e520310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711e2b18bb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711e2b18ba00>]}


============================== 10:50:16.618260 | fb031fe2-1e10-4e7b-9389-753bfa26becb ==============================
[0m10:50:16.618260 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:50:16.619309 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'profiles_dir': '.', 'invocation_command': 'dbt build --profiles-dir . --target local', 'indirect_selection': 'eager', 'quiet': 'False', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'log_path': '/workdir/transforms/04_btc/logs', 'empty': 'False', 'no_print': 'None', 'version_check': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'static_parser': 'True', 'introspect': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_colors': 'True', 'target_path': 'None', 'fail_fast': 'False'}
[0m10:50:17.204642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fb031fe2-1e10-4e7b-9389-753bfa26becb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711e2b07e490>]}
[0m10:50:17.399946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fb031fe2-1e10-4e7b-9389-753bfa26becb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711e2bc5b3a0>]}
[0m10:50:17.401263 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:50:17.812832 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:50:18.373560 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:50:18.374226 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:50:18.587182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fb031fe2-1e10-4e7b-9389-753bfa26becb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711e2a8e0eb0>]}
[0m10:50:19.110942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fb031fe2-1e10-4e7b-9389-753bfa26becb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711e2a7cedc0>]}
[0m10:50:19.111839 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:50:19.115201 [info ] [MainThread]: 
[0m10:50:19.116261 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:50:19.128754 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:50:19.172946 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:50:19.218774 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:50:19.285836 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:50:20.050920 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:50:20.055287 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:50:20.059556 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:50:20.074307 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:50:20.098837 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:50:20.110122 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:50:20.112726 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:50:20.117620 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:50:20.174240 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:50:20.191160 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:50:20.207669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb031fe2-1e10-4e7b-9389-753bfa26becb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711e2b0ce400>]}
[0m10:50:20.209529 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:50:20.210883 [info ] [MainThread]: 
[0m10:50:20.286239 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:50:20.287479 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:50:20.288677 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:50:20.289515 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:50:20.306623 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:50:20.307915 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:50:20.480339 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:50:20.556178 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:50:20.557845 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:50:20.569100 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:50:20.700107 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:50:20.703927 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:50:20.706063 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:50:20.709197 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:50:20.715115 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:50:20.718053 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:50:20.719881 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:50:20.722741 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:50:20.815045 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:50:20.818545 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:50:20.874542 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb031fe2-1e10-4e7b-9389-753bfa26becb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711e29b7b310>]}
[0m10:50:20.875822 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.58s]
[0m10:50:20.877177 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:50:20.879966 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:50:20.881545 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:50:20.883224 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:50:20.884405 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:50:20.886779 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:50:20.889771 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:50:20.892824 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:50:20.895836 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:50:20.898310 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:50:20.900076 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:50:20.901775 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:50:20.903798 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:50:21.075844 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:50:21.090074 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:50:21.091971 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:50:21.094670 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:50:21.101738 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:50:21.119035 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:50:21.416694 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:50:21.408023 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:50:21.486025 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:50:21.488846 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:50:21.492609 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:50:21.494498 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:50:21.772807 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:50:21.785025 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:50:21.790169 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:50:21.794064 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:50:21.803201 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:50:21.812813 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m10:50:21.819270 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.93s]
[0m10:50:21.874302 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:50:21.877058 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:50:21.879954 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:50:21.886144 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.99s]
[0m10:50:21.890133 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:50:21.892905 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:50:21.894297 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:50:21.895999 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:50:21.897468 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:50:21.899783 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:50:21.901922 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:50:21.904048 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:50:21.905885 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:50:21.907633 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:50:21.909173 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:50:21.910858 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:50:21.983410 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:50:22.010712 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:50:22.073954 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:50:22.088752 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:50:22.091706 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:50:22.093328 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:50:22.110515 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:50:22.217215 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:50:22.304980 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:50:22.399660 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:50:22.515804 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:50:22.591299 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:50:22.606026 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:50:22.698871 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:50:22.808697 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:50:22.901655 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:50:22.975231 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:50:22.994732 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:50:23.094643 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:50:23.090925 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_fb031fe2_1e10_4e7b_9389_753bfa26becb` 
  ...
[0m10:50:23.109300 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_fb031fe2_1e10_4e7b_9389_753bfa26becb` 
  ...
[0m10:50:23.114885 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:50:23.174719 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:50:23.178625 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb031fe2-1e10-4e7b-9389-753bfa26becb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711e29515f40>]}
[0m10:50:23.191178 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:50:23.206375 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.27s]
[0m10:50:23.312472 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:50:23.401015 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_fb031fe2_1e10_4e7b_9389_753bfa26becb`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:50:23.403782 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_fb031fe2_1e10_4e7b_9389_753bfa26becb`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:50:24.009762 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.60 seconds
[0m10:50:24.026180 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.62 seconds
[0m10:50:24.046945 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_fb031fe2_1e10_4e7b_9389_753bfa26becb'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:50:24.057255 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_fb031fe2_1e10_4e7b_9389_753bfa26becb'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:50:24.080181 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:50:24.083035 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:50:24.097243 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:50:24.103809 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:50:24.106959 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_fb031fe2_1e10_4e7b_9389_753bfa26becb`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:50:24.111154 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_fb031fe2_1e10_4e7b_9389_753bfa26becb`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:50:24.147042 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:50:24.173963 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:50:24.176132 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_fb031fe2_1e10_4e7b_9389_753bfa26becb`)
      
    ...
[0m10:50:24.180253 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_fb031fe2_1e10_4e7b_9389_753bfa26becb`)
      
    ...
[0m10:50:24.209524 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:50:24.216637 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:50:24.218032 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:50:24.229109 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:50:24.232125 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:50:24.239993 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_fb031fe2_1e10_4e7b_9389_753bfa26becb` 
    ...
[0m10:50:24.242989 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:50:24.278305 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_fb031fe2_1e10_4e7b_9389_753bfa26becb` 
    ...
[0m10:50:24.287915 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:50:24.291426 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:50:24.306611 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_fb031fe2_1e10_4e7b_9389_753bfa26becb` 
  ...
[0m10:50:24.324090 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_fb031fe2_1e10_4e7b_9389_753bfa26becb` 
  ...
[0m10:50:24.373996 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:50:24.390810 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:50:24.394587 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:50:24.407036 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:50:24.413184 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:50:24.472722 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb031fe2-1e10-4e7b-9389-753bfa26becb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711e29118c70>]}
[0m10:50:24.474577 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:50:24.477026 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.52s]
[0m10:50:24.484216 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb031fe2-1e10-4e7b-9389-753bfa26becb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711e295244c0>]}
[0m10:50:24.486967 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:50:24.489610 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.58s]
[0m10:50:24.492913 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:50:24.496780 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:50:24.497930 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:50:24.499066 [debug] [MainThread]: On list__clean: Close
[0m10:50:24.500120 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:50:24.501200 [debug] [MainThread]: On list__mart: Close
[0m10:50:24.502236 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:50:24.503314 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:50:24.504354 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:50:24.505440 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:50:24.506480 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:50:24.507579 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:50:24.508650 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:50:24.509756 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:50:24.511968 [info ] [MainThread]: 
[0m10:50:24.513317 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.40 seconds (5.40s).
[0m10:50:24.521251 [debug] [MainThread]: Command end result
[0m10:50:24.787310 [info ] [MainThread]: 
[0m10:50:24.789079 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:50:24.790362 [info ] [MainThread]: 
[0m10:50:24.791768 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:50:24.794588 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 8.37659, "process_in_blocks": "0", "process_kernel_time": 0.728679, "process_mem_max_rss": "114968", "process_out_blocks": "9744", "process_user_time": 6.513622}
[0m10:50:24.796142 [debug] [MainThread]: Command `dbt build` succeeded at 10:50:24.795740 after 8.38 seconds
[0m10:50:24.797416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711e2e520310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711e2b1efdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711e2a7a0b20>]}
[0m10:50:24.798693 [debug] [MainThread]: Flushing usage events
[0m10:51:16.153977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b39b212310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b397e5fb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b397e5f9d0>]}


============================== 10:51:16.163452 | eb7059aa-a207-4c4b-a50a-2078c644192e ==============================
[0m10:51:16.163452 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:51:16.215751 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'quiet': 'False', 'debug': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'target_path': 'None', 'write_json': 'True', 'warn_error': 'None', 'cache_selected_only': 'False', 'profiles_dir': '.', 'introspect': 'True', 'partial_parse': 'True', 'empty': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'static_parser': 'True', 'use_colors': 'True', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager'}
[0m10:51:16.749977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eb7059aa-a207-4c4b-a50a-2078c644192e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b39a7993a0>]}
[0m10:51:16.941226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eb7059aa-a207-4c4b-a50a-2078c644192e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b3989423d0>]}
[0m10:51:16.942473 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:51:17.356128 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:51:17.916045 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:51:17.916692 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:51:18.115426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eb7059aa-a207-4c4b-a50a-2078c644192e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b3975c5ee0>]}
[0m10:51:18.557981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eb7059aa-a207-4c4b-a50a-2078c644192e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b3975afb50>]}
[0m10:51:18.558879 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:51:18.562098 [info ] [MainThread]: 
[0m10:51:18.563204 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:51:18.574907 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:51:18.576425 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:51:18.647438 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:51:18.716772 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:51:19.382601 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:51:19.388003 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:51:19.390064 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:51:19.396266 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:51:19.447270 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:51:19.449109 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:51:19.463451 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:51:19.519002 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:51:19.526471 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:51:19.528225 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:51:19.554357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb7059aa-a207-4c4b-a50a-2078c644192e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b39a615970>]}
[0m10:51:19.555991 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:51:19.557222 [info ] [MainThread]: 
[0m10:51:19.626759 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:51:19.627926 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:51:19.629010 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:51:19.629784 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:51:19.647476 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:51:19.648904 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:51:19.828052 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:51:19.892297 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:51:19.893694 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:51:19.908587 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:51:20.039194 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:51:20.043217 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:51:20.045314 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:51:20.048510 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:51:20.054307 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:51:20.057337 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:51:20.059205 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:51:20.062155 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:51:20.155574 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:51:20.159068 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:51:20.165151 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb7059aa-a207-4c4b-a50a-2078c644192e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b39693db80>]}
[0m10:51:20.215622 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m10:51:20.216996 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:51:20.219298 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:51:20.220731 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:51:20.222513 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:51:20.224227 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:51:20.225853 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:51:20.227165 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:51:20.229000 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:51:20.230665 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:51:20.232885 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:51:20.234282 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:51:20.235530 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:51:20.237289 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:51:20.318995 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:51:20.323710 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:51:20.338893 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:51:20.342174 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:51:20.343892 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:51:20.350706 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:51:20.737954 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:51:20.740440 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:51:20.734343 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:51:20.742300 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:51:20.743589 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:51:20.745442 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:51:20.956472 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:51:20.972126 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:51:21.018152 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.76s]
[0m10:51:21.021901 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:51:21.024928 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:51:21.037418 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:51:21.042364 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:51:21.048634 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.82s]
[0m10:51:21.051841 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:51:21.054708 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:51:21.060607 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.83s]
[0m10:51:21.064009 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:51:21.116881 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:51:21.118048 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:51:21.119650 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:51:21.121003 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:51:21.123120 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:51:21.125071 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:51:21.127163 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:51:21.128992 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:51:21.130760 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:51:21.132621 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:51:21.134307 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:51:21.146476 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:51:21.239051 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:51:21.251211 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:51:21.260176 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:51:21.262722 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:51:21.320876 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:51:21.327843 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:51:21.444293 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:51:21.556802 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:51:21.659442 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:51:21.751880 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:51:21.921495 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:51:21.962130 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:51:22.137132 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:51:22.158601 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_eb7059aa_a207_4c4b_a50a_2078c644192e` 
  ...
[0m10:51:22.237292 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:51:22.250949 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_eb7059aa_a207_4c4b_a50a_2078c644192e` 
  ...
[0m10:51:22.256006 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:51:22.260338 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:51:22.321950 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:51:22.331321 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:51:22.448845 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:51:22.623458 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:51:22.653876 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:51:22.660037 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_eb7059aa_a207_4c4b_a50a_2078c644192e`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:51:22.718913 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb7059aa-a207-4c4b-a50a-2078c644192e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b3969848e0>]}
[0m10:51:22.727134 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_eb7059aa_a207_4c4b_a50a_2078c644192e`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:51:22.731658 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.59s]
[0m10:51:22.737780 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:51:22.758752 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:51:22.779586 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:51:22.840755 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_eb7059aa_a207_4c4b_a50a_2078c644192e'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:51:22.839779 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_eb7059aa_a207_4c4b_a50a_2078c644192e'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:51:22.851845 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:51:22.854847 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:51:22.918125 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:51:22.920972 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:51:22.923779 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_eb7059aa_a207_4c4b_a50a_2078c644192e`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:51:22.927907 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_eb7059aa_a207_4c4b_a50a_2078c644192e`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:51:22.950525 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:51:22.954776 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_eb7059aa_a207_4c4b_a50a_2078c644192e`)
      
    ...
[0m10:51:22.959290 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:51:22.963720 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_eb7059aa_a207_4c4b_a50a_2078c644192e`)
      
    ...
[0m10:51:22.983826 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:51:23.016252 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:51:23.020622 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:51:23.031832 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:51:23.042301 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:51:23.044935 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:51:23.050996 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_eb7059aa_a207_4c4b_a50a_2078c644192e` 
    ...
[0m10:51:23.056901 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_eb7059aa_a207_4c4b_a50a_2078c644192e` 
    ...
[0m10:51:23.067817 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:51:23.116094 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:51:23.136115 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_eb7059aa_a207_4c4b_a50a_2078c644192e` 
  ...
[0m10:51:23.137255 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_eb7059aa_a207_4c4b_a50a_2078c644192e` 
  ...
[0m10:51:23.142226 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:51:23.148908 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:51:23.150647 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:51:23.156879 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:51:23.160391 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:51:23.162366 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:51:23.218195 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb7059aa-a207-4c4b-a50a-2078c644192e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b3961996a0>]}
[0m10:51:23.225168 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb7059aa-a207-4c4b-a50a-2078c644192e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b396175b80>]}
[0m10:51:23.227837 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.09s]
[0m10:51:23.230616 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.10s]
[0m10:51:23.233731 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:51:23.236675 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:51:23.241672 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:51:23.242912 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:51:23.244093 [debug] [MainThread]: On list__clean: Close
[0m10:51:23.245166 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:51:23.246246 [debug] [MainThread]: On list__mart: Close
[0m10:51:23.247290 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:51:23.248372 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:51:23.249429 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:51:23.250635 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:51:23.251675 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:51:23.252745 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:51:23.253810 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:51:23.254921 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:51:23.257127 [info ] [MainThread]: 
[0m10:51:23.258469 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.69 seconds (4.69s).
[0m10:51:23.317735 [debug] [MainThread]: Command end result
[0m10:51:23.450976 [info ] [MainThread]: 
[0m10:51:23.451919 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:51:23.452511 [info ] [MainThread]: 
[0m10:51:23.453141 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:51:23.454471 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.4920783, "process_in_blocks": "0", "process_kernel_time": 0.642464, "process_mem_max_rss": "114904", "process_out_blocks": "9752", "process_user_time": 6.37932}
[0m10:51:23.455215 [debug] [MainThread]: Command `dbt build` succeeded at 10:51:23.455028 after 7.49 seconds
[0m10:51:23.455870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b39b212310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b39a7993a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b3989423d0>]}
[0m10:51:23.456455 [debug] [MainThread]: Flushing usage events
[0m10:52:16.523351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796598ba7e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79659581d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79659581d5b0>]}


============================== 10:52:16.532303 | 342e3dd7-90f4-4f7a-b624-58fe124c439d ==============================
[0m10:52:16.532303 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:52:16.533336 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt build --profiles-dir . --target local', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'empty': 'False', 'introspect': 'True', 'fail_fast': 'False', 'quiet': 'False', 'write_json': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'profiles_dir': '.', 'log_format': 'default', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'indirect_selection': 'eager', 'static_parser': 'True', 'version_check': 'True', 'printer_width': '80', 'warn_error': 'None', 'debug': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'use_colors': 'True'}
[0m10:52:17.109384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '342e3dd7-90f4-4f7a-b624-58fe124c439d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7965957c55b0>]}
[0m10:52:17.307069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '342e3dd7-90f4-4f7a-b624-58fe124c439d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7965957dc1f0>]}
[0m10:52:17.308342 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:52:17.719117 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:52:18.223888 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:52:18.224551 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:52:18.424911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '342e3dd7-90f4-4f7a-b624-58fe124c439d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796594f6ee50>]}
[0m10:52:18.901861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '342e3dd7-90f4-4f7a-b624-58fe124c439d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796594efc850>]}
[0m10:52:18.902795 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:52:18.906001 [info ] [MainThread]: 
[0m10:52:18.906989 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:52:18.918749 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:52:18.931191 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:52:19.027020 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:52:19.089660 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:52:19.695889 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:52:19.700827 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:52:19.702599 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:52:19.708813 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:52:19.791920 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:52:19.803793 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:52:19.816868 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:52:19.826644 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:52:19.830764 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:52:19.890886 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:52:19.909886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '342e3dd7-90f4-4f7a-b624-58fe124c439d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7965954e3e80>]}
[0m10:52:19.911825 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:52:19.913121 [info ] [MainThread]: 
[0m10:52:19.938994 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:52:19.990313 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:52:19.991910 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:52:19.992971 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:52:20.017241 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:52:20.018699 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:52:20.214637 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:52:20.296883 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:52:20.298427 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:52:20.311028 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:52:20.435459 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:52:20.438837 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:52:20.489905 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:52:20.493251 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:52:20.499274 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:52:20.502258 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:52:20.504175 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:52:20.507174 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:52:20.623027 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:52:20.632031 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:52:20.643751 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '342e3dd7-90f4-4f7a-b624-58fe124c439d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79659430bb20>]}
[0m10:52:20.646006 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.65s]
[0m10:52:20.648594 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:52:20.651231 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:52:20.657842 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:52:20.658782 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:52:20.689820 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:52:20.691123 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:52:20.692025 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:52:20.693064 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:52:20.693969 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:52:20.694925 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:52:20.696105 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:52:20.696907 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:52:20.697627 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:52:20.798955 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:52:20.804444 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:52:20.822363 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:52:20.825036 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:52:20.831973 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:52:20.905318 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:52:21.198299 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:52:21.209266 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:52:21.204232 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:52:21.212958 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:52:21.214855 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:52:21.219755 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:52:21.465860 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:52:21.474738 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:52:21.476066 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:52:21.491899 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:52:21.498483 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.81s]
[0m10:52:21.500843 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:52:21.504979 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:52:21.509577 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.81s]
[0m10:52:21.512372 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:52:21.515502 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:52:21.521497 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.83s]
[0m10:52:21.524847 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:52:21.527503 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:52:21.528691 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:52:21.530333 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:52:21.531634 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:52:21.533697 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:52:21.535515 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:52:21.589451 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:52:21.591780 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:52:21.593389 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:52:21.595023 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:52:21.596784 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:52:21.614060 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:52:21.698144 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:52:21.722450 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:52:21.724524 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:52:21.726701 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:52:21.728866 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:52:21.795154 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:52:21.818631 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:52:22.010998 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:52:22.106273 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:52:22.215862 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:52:22.301347 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:52:22.333785 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:52:22.506334 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:52:22.690399 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:52:22.704979 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_342e3dd7_90f4_4f7a_b624_58fe124c439d` 
  ...
[0m10:52:22.712448 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_342e3dd7_90f4_4f7a_b624_58fe124c439d` 
  ...
[0m10:52:22.716880 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:52:22.721102 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:52:22.725574 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:52:22.733283 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:52:22.813071 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:52:22.907862 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:52:23.018856 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:52:23.093424 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '342e3dd7-90f4-4f7a-b624-58fe124c439d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7965948b2400>]}
[0m10:52:23.113373 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.50s]
[0m10:52:23.132816 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:52:23.203621 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_342e3dd7_90f4_4f7a_b624_58fe124c439d`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:52:23.210117 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_342e3dd7_90f4_4f7a_b624_58fe124c439d`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:52:23.243214 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:52:23.258782 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:52:23.315770 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_342e3dd7_90f4_4f7a_b624_58fe124c439d'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:52:23.317115 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_342e3dd7_90f4_4f7a_b624_58fe124c439d'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:52:23.324971 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:52:23.331008 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:52:23.333120 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:52:23.338715 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:52:23.391432 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_342e3dd7_90f4_4f7a_b624_58fe124c439d`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:52:23.340973 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_342e3dd7_90f4_4f7a_b624_58fe124c439d`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:52:23.426422 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:52:23.429802 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_342e3dd7_90f4_4f7a_b624_58fe124c439d`)
      
    ...
[0m10:52:23.431668 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:52:23.437128 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_342e3dd7_90f4_4f7a_b624_58fe124c439d`)
      
    ...
[0m10:52:23.457523 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:52:23.459415 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:52:23.465181 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:52:23.473503 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:52:23.479967 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:52:23.481414 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:52:23.490204 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_342e3dd7_90f4_4f7a_b624_58fe124c439d` 
    ...
[0m10:52:23.494898 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_342e3dd7_90f4_4f7a_b624_58fe124c439d` 
    ...
[0m10:52:23.502309 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:52:23.503753 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:52:23.510811 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_342e3dd7_90f4_4f7a_b624_58fe124c439d` 
  ...
[0m10:52:23.517169 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_342e3dd7_90f4_4f7a_b624_58fe124c439d` 
  ...
[0m10:52:23.521338 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:52:23.522597 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:52:23.530547 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:52:23.537697 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:52:23.590907 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:52:23.592737 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:52:23.599230 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '342e3dd7-90f4-4f7a-b624-58fe124c439d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7965948b31c0>]}
[0m10:52:23.604699 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '342e3dd7-90f4-4f7a-b624-58fe124c439d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7965942e80d0>]}
[0m10:52:23.607207 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.01s]
[0m10:52:23.609598 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.07s]
[0m10:52:23.612326 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:52:23.615131 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:52:23.620032 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:52:23.621256 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:52:23.622461 [debug] [MainThread]: On list__clean: Close
[0m10:52:23.623612 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:52:23.624802 [debug] [MainThread]: On list__mart: Close
[0m10:52:23.625859 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:52:23.626987 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:52:23.628098 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:52:23.629263 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:52:23.630334 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:52:23.631492 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:52:23.632569 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:52:23.633690 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:52:23.636131 [info ] [MainThread]: 
[0m10:52:23.689118 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.73 seconds (4.73s).
[0m10:52:23.697338 [debug] [MainThread]: Command end result
[0m10:52:23.913832 [info ] [MainThread]: 
[0m10:52:23.915474 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:52:23.916851 [info ] [MainThread]: 
[0m10:52:23.918280 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:52:23.920930 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.5933843, "process_in_blocks": "0", "process_kernel_time": 0.666098, "process_mem_max_rss": "114620", "process_out_blocks": "9752", "process_user_time": 6.502155}
[0m10:52:23.922431 [debug] [MainThread]: Command `dbt build` succeeded at 10:52:23.922046 after 7.60 seconds
[0m10:52:23.923738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796598ba7e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796597ef3520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79659613eb20>]}
[0m10:52:23.924899 [debug] [MainThread]: Flushing usage events
[0m10:53:15.860810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962d35c1310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962d0234ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962d0234970>]}


============================== 10:53:15.870067 | 97ba7f76-8f42-4c05-b6f5-bfe4e8ee17c7 ==============================
[0m10:53:15.870067 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:53:15.871124 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'profiles_dir': '.', 'fail_fast': 'False', 'debug': 'False', 'write_json': 'True', 'log_cache_events': 'False', 'use_colors': 'True', 'target_path': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'introspect': 'True', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'cache_selected_only': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'version_check': 'True', 'quiet': 'False', 'log_format': 'default', 'warn_error': 'None', 'printer_width': '80', 'no_print': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'indirect_selection': 'eager'}
[0m10:53:16.449842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '97ba7f76-8f42-4c05-b6f5-bfe4e8ee17c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962d0201190>]}
[0m10:53:16.593219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '97ba7f76-8f42-4c05-b6f5-bfe4e8ee17c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962d3803a00>]}
[0m10:53:16.594464 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:53:17.058980 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:53:17.565834 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:53:17.566457 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:53:17.768235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '97ba7f76-8f42-4c05-b6f5-bfe4e8ee17c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962cf988f40>]}
[0m10:53:18.210429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '97ba7f76-8f42-4c05-b6f5-bfe4e8ee17c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962cf9c6400>]}
[0m10:53:18.249198 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:53:18.252553 [info ] [MainThread]: 
[0m10:53:18.253623 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:53:18.265652 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:53:18.277810 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:53:18.356498 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:53:18.357747 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:53:18.948257 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:53:18.956490 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:53:18.959000 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:53:18.969473 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:53:19.067591 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:53:19.069161 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:53:19.084849 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:53:19.090211 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:53:19.098938 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:53:19.153162 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:53:19.177691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '97ba7f76-8f42-4c05-b6f5-bfe4e8ee17c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962d0175ac0>]}
[0m10:53:19.179510 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:53:19.180853 [info ] [MainThread]: 
[0m10:53:19.258470 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:53:19.259743 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:53:19.260821 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:53:19.261545 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:53:19.278141 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:53:19.279375 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:53:19.464987 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:53:19.533277 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:53:19.534693 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:53:19.546270 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:53:19.673574 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:53:19.677413 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:53:19.679386 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:53:19.682329 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:53:19.688085 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:53:19.691085 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:53:19.692903 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:53:19.695769 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:53:19.789844 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:53:19.793251 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:53:19.849381 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '97ba7f76-8f42-4c05-b6f5-bfe4e8ee17c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962d2b60520>]}
[0m10:53:19.850673 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.54s]
[0m10:53:19.852174 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:53:19.854737 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:53:19.856220 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:53:19.857655 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:53:19.858711 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:53:19.860089 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:53:19.861555 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:53:19.863699 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:53:19.866032 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:53:19.867547 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:53:19.868950 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:53:19.870397 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:53:19.871468 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:53:19.963455 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:53:19.969293 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:53:19.976517 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:53:19.978046 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:53:19.979084 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:53:19.995436 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:53:20.076130 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:53:20.080555 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:53:20.085319 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:53:20.086921 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:53:20.088302 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:53:20.090253 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:53:20.274201 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:53:20.281879 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:53:20.288794 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.42s]
[0m10:53:20.293148 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:53:20.299565 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:53:20.301455 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:53:20.310201 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:53:20.312569 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:53:20.317760 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.45s]
[0m10:53:20.353021 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.49s]
[0m10:53:20.354910 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:53:20.356898 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:53:20.359603 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:53:20.360866 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:53:20.361603 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:53:20.362961 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:53:20.364431 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:53:20.365444 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:53:20.366598 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:53:20.367933 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:53:20.368841 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:53:20.369880 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:53:20.371026 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:53:20.371780 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:53:20.451709 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:53:20.460049 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:53:20.467650 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:53:20.469263 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:53:20.470330 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:53:20.471060 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:53:20.591474 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:53:20.791087 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:53:20.896682 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_97ba7f76_8f42_4c05_b6f5_bfe4e8ee17c7` 
  ...
[0m10:53:20.949593 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:53:20.968604 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_97ba7f76_8f42_4c05_b6f5_bfe4e8ee17c7` 
  ...
[0m10:53:20.976161 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:53:20.974800 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:53:20.995200 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:53:21.076207 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:53:21.170244 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:53:21.249282 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_97ba7f76_8f42_4c05_b6f5_bfe4e8ee17c7`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:53:21.198333 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_97ba7f76_8f42_4c05_b6f5_bfe4e8ee17c7`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:53:21.254289 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:53:21.267623 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:53:21.270598 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:53:21.272893 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:53:21.275889 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:53:21.283382 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:53:21.285709 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:53:21.354251 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:53:21.354971 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:53:21.356318 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_97ba7f76_8f42_4c05_b6f5_bfe4e8ee17c7'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:53:21.358950 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '97ba7f76-8f42-4c05-b6f5-bfe4e8ee17c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962ce5c22e0>]}
[0m10:53:21.364330 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_97ba7f76_8f42_4c05_b6f5_bfe4e8ee17c7'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:53:21.367706 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.99s]
[0m10:53:21.371995 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:53:21.373858 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:53:21.376046 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:53:21.387250 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:53:21.390241 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:53:21.391853 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_97ba7f76_8f42_4c05_b6f5_bfe4e8ee17c7`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:53:21.392893 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_97ba7f76_8f42_4c05_b6f5_bfe4e8ee17c7`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:53:21.410955 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:53:21.450107 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_97ba7f76_8f42_4c05_b6f5_bfe4e8ee17c7`)
      
    ...
[0m10:53:21.451527 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:53:21.455101 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_97ba7f76_8f42_4c05_b6f5_bfe4e8ee17c7`)
      
    ...
[0m10:53:21.473164 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:53:21.479844 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:53:21.481838 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:53:21.489753 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:53:21.494309 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:53:21.497711 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_97ba7f76_8f42_4c05_b6f5_bfe4e8ee17c7` 
    ...
[0m10:53:21.499716 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:53:21.505611 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_97ba7f76_8f42_4c05_b6f5_bfe4e8ee17c7` 
    ...
[0m10:53:21.507347 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:53:21.549075 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:53:21.554342 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_97ba7f76_8f42_4c05_b6f5_bfe4e8ee17c7` 
  ...
[0m10:53:21.562034 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_97ba7f76_8f42_4c05_b6f5_bfe4e8ee17c7` 
  ...
[0m10:53:21.567338 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:53:21.568672 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:53:21.575154 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:53:21.581009 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:53:21.584191 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:53:21.587564 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '97ba7f76-8f42-4c05-b6f5-bfe4e8ee17c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962ced3aa60>]}
[0m10:53:21.589169 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.22s]
[0m10:53:21.590485 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:53:21.591966 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:53:21.595223 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '97ba7f76-8f42-4c05-b6f5-bfe4e8ee17c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962cf52a8b0>]}
[0m10:53:21.596791 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.23s]
[0m10:53:21.598151 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:53:21.650346 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:53:21.651429 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:53:21.652340 [debug] [MainThread]: On list__clean: Close
[0m10:53:21.653206 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:53:21.654163 [debug] [MainThread]: On list__mart: Close
[0m10:53:21.655054 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:53:21.655990 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:53:21.656935 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:53:21.657860 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:53:21.658734 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:53:21.659641 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:53:21.660515 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:53:21.661429 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:53:21.663643 [info ] [MainThread]: 
[0m10:53:21.664777 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.41 seconds (3.41s).
[0m10:53:21.671745 [debug] [MainThread]: Command end result
[0m10:53:21.784403 [info ] [MainThread]: 
[0m10:53:21.785319 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:53:21.785966 [info ] [MainThread]: 
[0m10:53:21.786603 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:53:21.787889 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.121109, "process_in_blocks": "0", "process_kernel_time": 0.669001, "process_mem_max_rss": "114568", "process_out_blocks": "9744", "process_user_time": 5.753812}
[0m10:53:21.788618 [debug] [MainThread]: Command `dbt build` succeeded at 10:53:21.788420 after 6.12 seconds
[0m10:53:21.789222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962d35c1310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962d3803a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7962d0b45fa0>]}
[0m10:53:21.789824 [debug] [MainThread]: Flushing usage events
[0m10:54:16.602646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f5cbcb6dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f5c890dc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f5c890dac0>]}


============================== 10:54:16.611743 | 873448bd-2ce9-46b9-8ed4-217faf720a08 ==============================
[0m10:54:16.611743 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:54:16.612806 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'fail_fast': 'False', 'profiles_dir': '.', 'no_print': 'None', 'target_path': 'None', 'use_experimental_parser': 'False', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_path': '/workdir/transforms/04_btc/logs', 'debug': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'version_check': 'True', 'log_format': 'default', 'introspect': 'True', 'cache_selected_only': 'False'}
[0m10:54:17.138199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '873448bd-2ce9-46b9-8ed4-217faf720a08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f5cb12f940>]}
[0m10:54:17.335369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '873448bd-2ce9-46b9-8ed4-217faf720a08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f5c8947550>]}
[0m10:54:17.336609 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:54:17.798756 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:54:18.308666 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:54:18.309306 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:54:18.509959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '873448bd-2ce9-46b9-8ed4-217faf720a08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f5c8060df0>]}
[0m10:54:18.955233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '873448bd-2ce9-46b9-8ed4-217faf720a08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f5c80a47f0>]}
[0m10:54:18.956111 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:54:18.959403 [info ] [MainThread]: 
[0m10:54:18.998360 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:54:19.010548 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:54:19.012459 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:54:19.120842 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:54:19.130923 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:54:19.856933 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:54:19.864424 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:54:19.874754 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:54:19.883438 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:54:19.942190 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:54:19.943858 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:54:20.021207 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:54:20.027022 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:54:20.044691 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:54:20.046394 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:54:20.114116 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '873448bd-2ce9-46b9-8ed4-217faf720a08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f5c7965550>]}
[0m10:54:20.116107 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:54:20.117437 [info ] [MainThread]: 
[0m10:54:20.143419 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:54:20.145082 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:54:20.146584 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:54:20.147649 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:54:20.220936 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:54:20.222507 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:54:20.422884 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:54:20.490722 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:54:20.492116 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:54:20.508315 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:54:20.631407 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:54:20.634980 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:54:20.637019 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:54:20.640069 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:54:20.645701 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:54:20.648747 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:54:20.698655 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:54:20.702047 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:54:20.747316 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:54:20.800240 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:54:20.806522 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '873448bd-2ce9-46b9-8ed4-217faf720a08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f5cb1b5be0>]}
[0m10:54:20.807700 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.66s]
[0m10:54:20.809060 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:54:20.811172 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:54:20.812468 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:54:20.814135 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:54:20.815745 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:54:20.817884 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:54:20.819930 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:54:20.822125 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:54:20.824232 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:54:20.826309 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:54:20.828154 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:54:20.829583 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:54:20.830881 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:54:21.032202 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:54:21.045071 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:54:21.098163 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:54:21.047273 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:54:21.116600 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:54:21.139387 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:54:21.304899 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:54:21.311691 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:54:21.327864 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:54:21.329764 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:54:21.331366 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:54:21.333344 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:54:21.608009 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:54:21.613016 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:54:21.621042 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:54:21.624144 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:54:21.628639 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:54:21.641837 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.82s]
[0m10:54:21.699523 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.87s]
[0m10:54:21.703499 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:54:21.707305 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:54:21.710155 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:54:21.716077 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.89s]
[0m10:54:21.720090 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:54:21.723383 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:54:21.725204 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:54:21.726994 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:54:21.728652 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:54:21.730666 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:54:21.732880 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:54:21.734692 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:54:21.736464 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:54:21.738236 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:54:21.739974 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:54:21.741729 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:54:21.743380 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:54:21.910361 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:54:21.925755 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:54:21.926922 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:54:21.928492 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:54:21.935008 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:54:21.940067 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:54:21.941080 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:54:22.045647 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:54:22.214395 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:54:22.329718 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:54:22.433602 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m10:54:22.502777 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:54:22.544484 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:54:22.723711 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:54:22.736501 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_873448bd_2ce9_46b9_8ed4_217faf720a08` 
  ...
[0m10:54:22.744320 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:54:22.819584 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_873448bd_2ce9_46b9_8ed4_217faf720a08` 
  ...
[0m10:54:22.822388 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:54:22.823798 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:54:22.832794 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:54:22.908155 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:54:23.008618 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:54:23.103787 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:54:23.141847 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '873448bd-2ce9-46b9-8ed4-217faf720a08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f5c73ade50>]}
[0m10:54:23.228791 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_873448bd_2ce9_46b9_8ed4_217faf720a08`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:54:23.237328 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.40s]
[0m10:54:23.239747 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_873448bd_2ce9_46b9_8ed4_217faf720a08`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:54:23.244075 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:54:23.299380 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:54:23.331675 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_873448bd_2ce9_46b9_8ed4_217faf720a08'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:54:23.335955 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:54:23.344586 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_873448bd_2ce9_46b9_8ed4_217faf720a08'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:54:23.400705 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:54:23.415991 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:54:23.419075 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:54:23.424382 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:54:23.426828 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_873448bd_2ce9_46b9_8ed4_217faf720a08`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:54:23.431131 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_873448bd_2ce9_46b9_8ed4_217faf720a08`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:54:23.458950 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:54:23.463114 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_873448bd_2ce9_46b9_8ed4_217faf720a08`)
      
    ...
[0m10:54:23.465864 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:54:23.498339 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:54:23.501156 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_873448bd_2ce9_46b9_8ed4_217faf720a08`)
      
    ...
[0m10:54:23.506771 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:54:23.515165 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:54:23.518021 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_873448bd_2ce9_46b9_8ed4_217faf720a08` 
    ...
[0m10:54:23.526140 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:54:23.532920 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_873448bd_2ce9_46b9_8ed4_217faf720a08` 
  ...
[0m10:54:23.536856 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:54:23.547169 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:54:23.549763 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:54:23.599186 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:54:23.612519 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:54:23.610446 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_873448bd_2ce9_46b9_8ed4_217faf720a08` 
    ...
[0m10:54:23.621308 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:54:23.630661 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '873448bd-2ce9-46b9-8ed4-217faf720a08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f5c7df1190>]}
[0m10:54:23.633673 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:54:23.636850 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.90s]
[0m10:54:23.700633 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_873448bd_2ce9_46b9_8ed4_217faf720a08` 
  ...
[0m10:54:23.702728 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:54:23.706982 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:54:23.713784 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:54:23.716999 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:54:23.720509 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '873448bd-2ce9-46b9-8ed4-217faf720a08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f5c7c98c40>]}
[0m10:54:23.721798 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.98s]
[0m10:54:23.723358 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:54:23.725611 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:54:23.726227 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:54:23.726790 [debug] [MainThread]: On list__clean: Close
[0m10:54:23.727272 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:54:23.727793 [debug] [MainThread]: On list__mart: Close
[0m10:54:23.728286 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:54:23.728820 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:54:23.729307 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:54:23.729864 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:54:23.730677 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:54:23.731913 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:54:23.733078 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:54:23.734287 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:54:23.736858 [info ] [MainThread]: 
[0m10:54:23.738342 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.74 seconds (4.74s).
[0m10:54:23.746758 [debug] [MainThread]: Command end result
[0m10:54:24.008392 [info ] [MainThread]: 
[0m10:54:24.009967 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:54:24.011201 [info ] [MainThread]: 
[0m10:54:24.012518 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:54:24.015134 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.604112, "process_in_blocks": "0", "process_kernel_time": 0.687275, "process_mem_max_rss": "114984", "process_out_blocks": "9744", "process_user_time": 6.46713}
[0m10:54:24.016678 [debug] [MainThread]: Command `dbt build` succeeded at 10:54:24.016236 after 7.61 seconds
[0m10:54:24.018004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f5cbcb6dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f5c80a47f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f5c7f0f340>]}
[0m10:54:24.019311 [debug] [MainThread]: Flushing usage events
[0m10:55:16.166052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76886a044310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768866c9baf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768866c9b9a0>]}


============================== 10:55:16.175201 | cd986e9c-0871-4a28-ac3a-944fcf8a986b ==============================
[0m10:55:16.175201 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:55:16.176286 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'fail_fast': 'False', 'log_format': 'default', 'write_json': 'True', 'static_parser': 'True', 'version_check': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'quiet': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'debug': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'warn_error': 'None', 'introspect': 'True', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'no_print': 'None', 'cache_selected_only': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'target_path': 'None'}
[0m10:55:16.701774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cd986e9c-0871-4a28-ac3a-944fcf8a986b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7688695d63a0>]}
[0m10:55:16.896115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cd986e9c-0871-4a28-ac3a-944fcf8a986b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768866cff3a0>]}
[0m10:55:16.897521 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:55:17.365901 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:55:17.864267 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:55:17.864971 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:55:18.064799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cd986e9c-0871-4a28-ac3a-944fcf8a986b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768866403ee0>]}
[0m10:55:18.509640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cd986e9c-0871-4a28-ac3a-944fcf8a986b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7688663edc70>]}
[0m10:55:18.510594 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:55:18.513799 [info ] [MainThread]: 
[0m10:55:18.514911 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:55:18.564509 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:55:18.574876 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:55:18.589402 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:55:18.593096 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:55:19.086943 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:55:19.091300 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:55:19.162285 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:55:19.168834 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:55:19.175759 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:55:19.177206 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:55:19.193288 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:55:19.199590 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:55:19.211874 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:55:19.262831 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:55:19.282905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cd986e9c-0871-4a28-ac3a-944fcf8a986b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768869453970>]}
[0m10:55:19.284736 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:55:19.285982 [info ] [MainThread]: 
[0m10:55:19.312072 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:55:19.362511 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:55:19.364142 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:55:19.365223 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:55:19.389760 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:55:19.391307 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:55:19.589527 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:55:19.665004 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:55:19.666847 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:55:19.680365 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:55:19.811327 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:55:19.865054 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:55:19.867044 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:55:19.869988 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:55:19.875614 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:55:19.878511 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:55:19.880327 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:55:19.883252 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:55:19.977042 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:55:19.980509 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:55:19.986776 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd986e9c-0871-4a28-ac3a-944fcf8a986b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7688656cb940>]}
[0m10:55:19.988110 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.62s]
[0m10:55:19.989478 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:55:19.991056 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:55:19.991815 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:55:19.992685 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:55:19.993482 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:55:19.994424 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:55:19.995390 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:55:19.996635 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:55:19.997553 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:55:19.998586 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:55:19.999424 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:55:20.000462 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:55:20.001651 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:55:20.170179 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:55:20.172179 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:55:20.186057 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:55:20.188231 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:55:20.190172 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:55:20.267176 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:55:20.485460 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:55:20.506733 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:55:20.569716 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:55:20.571859 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:55:20.574437 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:55:20.576074 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:55:20.849888 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:55:20.863987 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:55:20.871080 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:55:20.885767 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:55:20.887748 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m10:55:20.892390 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:55:20.895323 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:55:20.902513 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.91s]
[0m10:55:20.905714 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:55:20.908977 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:55:20.966897 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.97s]
[0m10:55:20.970407 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:55:20.973349 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:55:20.974569 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:55:20.976357 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:55:20.978137 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:55:20.980225 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:55:20.982684 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:55:20.984609 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:55:20.986112 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:55:20.987659 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:55:20.989301 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:55:20.990975 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:55:20.992580 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:55:21.170305 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:55:21.172371 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:55:21.179873 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:55:21.182366 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:55:21.208234 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:55:21.261786 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:55:21.378436 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:55:21.467318 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:55:21.567938 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:55:21.593415 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:55:21.761990 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:55:21.794957 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:55:21.882713 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_cd986e9c_0871_4a28_ac3a_944fcf8a986b` 
  ...
[0m10:55:21.895364 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_cd986e9c_0871_4a28_ac3a_944fcf8a986b` 
  ...
[0m10:55:21.898479 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:55:21.901531 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:55:21.967878 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:55:21.965748 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:55:22.079819 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:55:22.169316 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:55:22.273256 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:55:22.368194 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_cd986e9c_0871_4a28_ac3a_944fcf8a986b`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:55:22.310072 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_cd986e9c_0871_4a28_ac3a_944fcf8a986b`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:55:22.372183 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:55:22.384216 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:55:22.389785 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd986e9c-0871-4a28-ac3a-944fcf8a986b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768864fc5280>]}
[0m10:55:22.391678 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.40s]
[0m10:55:22.394031 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:55:22.403223 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:55:22.467193 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:55:22.487431 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_cd986e9c_0871_4a28_ac3a_944fcf8a986b'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:55:22.482349 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_cd986e9c_0871_4a28_ac3a_944fcf8a986b'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:55:22.492963 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:55:22.494387 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:55:22.500634 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:55:22.503336 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:55:22.504801 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_cd986e9c_0871_4a28_ac3a_944fcf8a986b`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:55:22.505828 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_cd986e9c_0871_4a28_ac3a_944fcf8a986b`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:55:22.522199 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:55:22.523580 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:55:22.562448 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_cd986e9c_0871_4a28_ac3a_944fcf8a986b`)
      
    ...
[0m10:55:22.564846 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_cd986e9c_0871_4a28_ac3a_944fcf8a986b`)
      
    ...
[0m10:55:22.586726 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:55:22.593644 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:55:22.596044 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:55:22.604212 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:55:22.607583 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:55:22.613157 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_cd986e9c_0871_4a28_ac3a_944fcf8a986b` 
    ...
[0m10:55:22.615199 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:55:22.620958 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_cd986e9c_0871_4a28_ac3a_944fcf8a986b` 
    ...
[0m10:55:22.626204 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:55:22.628137 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:55:22.670467 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_cd986e9c_0871_4a28_ac3a_944fcf8a986b` 
  ...
[0m10:55:22.683692 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_cd986e9c_0871_4a28_ac3a_944fcf8a986b` 
  ...
[0m10:55:22.687580 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:55:22.689385 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:55:22.695978 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:55:22.704023 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:55:22.708589 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:55:22.710439 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:55:22.767992 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd986e9c-0871-4a28-ac3a-944fcf8a986b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768865d30760>]}
[0m10:55:22.773856 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd986e9c-0871-4a28-ac3a-944fcf8a986b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7688656cbd90>]}
[0m10:55:22.776327 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.78s]
[0m10:55:22.778783 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.79s]
[0m10:55:22.781605 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:55:22.784276 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:55:22.788815 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:55:22.790013 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:55:22.791232 [debug] [MainThread]: On list__clean: Close
[0m10:55:22.792453 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:55:22.793686 [debug] [MainThread]: On list__mart: Close
[0m10:55:22.794789 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:55:22.796045 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:55:22.797200 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:55:22.798349 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:55:22.799457 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:55:22.800703 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:55:22.801801 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:55:22.802937 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:55:22.805249 [info ] [MainThread]: 
[0m10:55:22.806675 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.29 seconds (4.29s).
[0m10:55:22.863548 [debug] [MainThread]: Command end result
[0m10:55:23.088159 [info ] [MainThread]: 
[0m10:55:23.090006 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:55:23.091383 [info ] [MainThread]: 
[0m10:55:23.092793 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:55:23.095492 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.1297293, "process_in_blocks": "0", "process_kernel_time": 0.596844, "process_mem_max_rss": "114364", "process_out_blocks": "9744", "process_user_time": 6.318011}
[0m10:55:23.097161 [debug] [MainThread]: Command `dbt build` succeeded at 10:55:23.096773 after 7.13 seconds
[0m10:55:23.098413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76886a044310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768867fce850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x768867fcbd00>]}
[0m10:55:23.099619 [debug] [MainThread]: Flushing usage events
[0m10:56:16.166834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c914b4d9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c914812daf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c914812d9a0>]}


============================== 10:56:16.227593 | 99297b6e-1d91-485c-b3dd-651bd564f6ec ==============================
[0m10:56:16.227593 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:56:16.228856 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '.', 'fail_fast': 'False', 'partial_parse': 'True', 'empty': 'False', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'log_cache_events': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'static_parser': 'True', 'debug': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'log_format': 'default', 'use_colors': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'warn_error': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'printer_width': '80'}
[0m10:56:16.757890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '99297b6e-1d91-485c-b3dd-651bd564f6ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c914aa6a3a0>]}
[0m10:56:16.950154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '99297b6e-1d91-485c-b3dd-651bd564f6ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c914818f3a0>]}
[0m10:56:16.951481 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:56:17.370780 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:56:17.874049 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:56:17.925415 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:56:18.074849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '99297b6e-1d91-485c-b3dd-651bd564f6ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c9147893ee0>]}
[0m10:56:18.568989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '99297b6e-1d91-485c-b3dd-651bd564f6ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c914787dc70>]}
[0m10:56:18.569875 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:56:18.573138 [info ] [MainThread]: 
[0m10:56:18.574195 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:56:18.586414 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:56:18.588287 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:56:18.732336 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:56:18.738095 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:56:19.401776 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:56:19.408630 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:56:19.425582 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:56:19.428696 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:56:19.529860 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:56:19.531739 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:56:19.547731 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:56:19.552385 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:56:19.561439 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:56:19.568374 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:56:19.635113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '99297b6e-1d91-485c-b3dd-651bd564f6ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c9148171e80>]}
[0m10:56:19.637102 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:56:19.638457 [info ] [MainThread]: 
[0m10:56:19.660334 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:56:19.661558 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:56:19.662737 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:56:19.663485 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:56:19.735444 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:56:19.737061 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:56:19.929944 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:56:19.998165 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:56:19.999646 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:56:20.012830 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:56:20.143695 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:56:20.147671 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:56:20.149647 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:56:20.152981 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:56:20.158757 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:56:20.161737 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:56:20.163672 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:56:20.166884 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:56:20.259386 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:56:20.262832 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:56:20.268885 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99297b6e-1d91-485c-b3dd-651bd564f6ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c9146b38a00>]}
[0m10:56:20.270060 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m10:56:20.271421 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:56:20.273723 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:56:20.275133 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:56:20.325977 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:56:20.276264 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:56:20.329068 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:56:20.330591 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:56:20.332714 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:56:20.334339 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:56:20.336301 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:56:20.338108 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:56:20.339901 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:56:20.341604 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:56:20.545752 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:56:20.546833 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:56:20.547518 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:56:20.548814 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:56:20.554863 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:56:20.566340 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:56:20.651275 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:56:20.650108 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:56:20.655767 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:56:20.658159 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:56:20.660458 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:56:20.664414 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:56:20.934497 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:56:20.946189 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:56:20.953461 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:56:20.956492 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:56:20.969360 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.63s]
[0m10:56:20.972374 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:56:21.030958 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:56:21.040302 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.71s]
[0m10:56:21.043853 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:56:21.046585 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:56:21.052277 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.72s]
[0m10:56:21.055714 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:56:21.058615 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:56:21.059891 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:56:21.061633 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:56:21.063129 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:56:21.065291 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:56:21.067172 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:56:21.069190 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:56:21.071099 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:56:21.126617 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:56:21.128374 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:56:21.130085 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:56:21.152517 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:56:21.172580 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:56:21.251714 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:56:21.255887 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:56:21.258139 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:56:21.325786 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:56:21.343031 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:56:21.468157 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:56:21.657064 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:56:21.831861 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.16 seconds
[0m10:56:21.939639 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:56:22.044992 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m10:56:22.061602 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_99297b6e_1d91_485c_b3dd_651bd564f6ec` 
  ...
[0m10:56:22.132828 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:56:22.139307 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_99297b6e_1d91_485c_b3dd_651bd564f6ec` 
  ...
[0m10:56:22.148245 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:56:22.150846 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:56:22.163794 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:56:22.248425 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:56:22.349491 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:56:22.438447 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:56:22.470523 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:56:22.629612 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:56:22.643303 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_99297b6e_1d91_485c_b3dd_651bd564f6ec`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:56:22.653401 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_99297b6e_1d91_485c_b3dd_651bd564f6ec`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:56:22.658749 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:56:22.669656 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99297b6e-1d91-485c-b3dd-651bd564f6ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c91463f4a90>]}
[0m10:56:22.726107 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:56:22.727510 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:56:22.673045 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.54s]
[0m10:56:22.769287 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:56:22.828024 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_99297b6e_1d91_485c_b3dd_651bd564f6ec'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:56:22.839584 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_99297b6e_1d91_485c_b3dd_651bd564f6ec'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:56:22.847314 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:56:22.855653 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:56:22.871757 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:56:22.930381 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:56:22.933384 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_99297b6e_1d91_485c_b3dd_651bd564f6ec`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:56:22.935857 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_99297b6e_1d91_485c_b3dd_651bd564f6ec`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:56:22.966976 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:56:22.969462 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:56:22.973780 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_99297b6e_1d91_485c_b3dd_651bd564f6ec`)
      
    ...
[0m10:56:22.977909 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_99297b6e_1d91_485c_b3dd_651bd564f6ec`)
      
    ...
[0m10:56:23.008957 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:56:23.011529 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:56:23.026383 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:56:23.036339 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:56:23.047967 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:56:23.050794 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:56:23.056624 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_99297b6e_1d91_485c_b3dd_651bd564f6ec` 
    ...
[0m10:56:23.062271 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_99297b6e_1d91_485c_b3dd_651bd564f6ec` 
    ...
[0m10:56:23.075744 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:56:23.078311 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:56:23.141365 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_99297b6e_1d91_485c_b3dd_651bd564f6ec` 
  ...
[0m10:56:23.139968 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_99297b6e_1d91_485c_b3dd_651bd564f6ec` 
  ...
[0m10:56:23.148604 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:56:23.151769 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:56:23.164687 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:56:23.229622 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:56:23.234770 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:56:23.242400 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:56:23.243756 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99297b6e-1d91-485c-b3dd-651bd564f6ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c9146b38580>]}
[0m10:56:23.250353 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99297b6e-1d91-485c-b3dd-651bd564f6ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c91463f4fa0>]}
[0m10:56:23.252766 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.17s]
[0m10:56:23.255459 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.18s]
[0m10:56:23.258405 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:56:23.261881 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:56:23.266764 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:56:23.268037 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:56:23.269328 [debug] [MainThread]: On list__clean: Close
[0m10:56:23.270557 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:56:23.271784 [debug] [MainThread]: On list__mart: Close
[0m10:56:23.272927 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:56:23.274112 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:56:23.326006 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:56:23.327274 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:56:23.328420 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:56:23.329641 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:56:23.330779 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:56:23.331959 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:56:23.334324 [info ] [MainThread]: 
[0m10:56:23.335748 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.76 seconds (4.76s).
[0m10:56:23.344042 [debug] [MainThread]: Command end result
[0m10:56:23.553746 [info ] [MainThread]: 
[0m10:56:23.554606 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:56:23.555316 [info ] [MainThread]: 
[0m10:56:23.556006 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:56:23.557347 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.5315604, "process_in_blocks": "0", "process_kernel_time": 0.668767, "process_mem_max_rss": "114868", "process_out_blocks": "9744", "process_user_time": 6.437887}
[0m10:56:23.558130 [debug] [MainThread]: Command `dbt build` succeeded at 10:56:23.557932 after 7.53 seconds
[0m10:56:23.558760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c914b4d9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c9147ffb9a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c914945bd00>]}
[0m10:56:23.559380 [debug] [MainThread]: Flushing usage events
[0m10:57:16.550472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733532abe310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73352f725b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73352f725a30>]}


============================== 10:57:16.610469 | 2509b9ab-48fc-4525-ac15-03410a5271b0 ==============================
[0m10:57:16.610469 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:57:16.611649 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'use_colors': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'partial_parse': 'True', 'fail_fast': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'target_path': 'None', 'static_parser': 'True', 'no_print': 'None', 'empty': 'False', 'printer_width': '80', 'log_cache_events': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'introspect': 'True', 'debug': 'False', 'quiet': 'False', 'write_json': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'warn_error': 'None', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True'}
[0m10:57:17.135585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2509b9ab-48fc-4525-ac15-03410a5271b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73352f604a00>]}
[0m10:57:17.330334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2509b9ab-48fc-4525-ac15-03410a5271b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733530930670>]}
[0m10:57:17.331633 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:57:17.752704 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:57:18.305775 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:57:18.306473 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:57:18.506883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2509b9ab-48fc-4525-ac15-03410a5271b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73352ee79e80>]}
[0m10:57:18.954309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2509b9ab-48fc-4525-ac15-03410a5271b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73352ee8e8b0>]}
[0m10:57:18.955200 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:57:18.958339 [info ] [MainThread]: 
[0m10:57:18.959367 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:57:19.005795 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:57:19.007596 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:57:19.046930 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:57:19.051484 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:57:19.710990 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:57:19.718308 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:57:19.720764 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:57:19.729163 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:57:19.825486 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:57:19.826866 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:57:19.911290 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:57:19.910115 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:57:19.924123 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:57:19.940950 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:57:19.955703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2509b9ab-48fc-4525-ac15-03410a5271b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73352f67b250>]}
[0m10:57:19.956899 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:57:19.957627 [info ] [MainThread]: 
[0m10:57:20.019773 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:57:20.021211 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:57:20.022563 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:57:20.023516 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:57:20.042955 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:57:20.044132 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:57:20.233179 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:57:20.310374 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:57:20.312111 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:57:20.325103 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:57:20.451005 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:57:20.454707 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:57:20.506596 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:57:20.510029 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:57:20.515597 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:57:20.518476 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:57:20.520256 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:57:20.523034 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:57:20.617105 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:57:20.620572 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:57:20.626674 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2509b9ab-48fc-4525-ac15-03410a5271b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73352e267430>]}
[0m10:57:20.627868 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m10:57:20.629149 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:57:20.631321 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:57:20.632501 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:57:20.633744 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:57:20.635031 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:57:20.636994 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:57:20.638732 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:57:20.640098 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:57:20.642374 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:57:20.643846 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:57:20.645444 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:57:20.647171 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:57:20.716259 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:57:20.813635 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:57:20.815563 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:57:20.822301 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:57:20.823681 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:57:20.824613 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:57:20.835630 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:57:20.912345 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:57:20.922207 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:57:20.935433 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:57:20.937040 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:57:20.938033 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:57:20.939298 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:57:21.141315 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:57:21.147525 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:57:21.150162 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:57:21.157583 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.52s]
[0m10:57:21.160280 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:57:21.161576 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:57:21.164723 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.52s]
[0m10:57:21.167953 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:57:21.171638 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:57:21.206726 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:57:21.213230 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.57s]
[0m10:57:21.216199 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:57:21.219487 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:57:21.220640 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:57:21.222237 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:57:21.223546 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:57:21.225668 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:57:21.227447 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:57:21.229549 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:57:21.231341 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:57:21.233103 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:57:21.234756 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:57:21.236437 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:57:21.305788 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:57:21.353513 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:57:21.418566 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:57:21.422463 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:57:21.425387 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:57:21.426951 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:57:21.511043 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:57:21.615522 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:57:21.706152 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:57:21.751764 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:57:21.837884 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:57:21.922183 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:57:21.951648 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:57:22.106924 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:57:22.222979 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:57:22.305264 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_2509b9ab_48fc_4525_ac15_03410a5271b0` 
  ...
[0m10:57:22.309435 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_2509b9ab_48fc_4525_ac15_03410a5271b0` 
  ...
[0m10:57:22.313026 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:57:22.316099 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:57:22.319244 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:57:22.321285 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:57:22.406926 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:57:22.543398 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:57:22.615793 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_2509b9ab_48fc_4525_ac15_03410a5271b0`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:57:22.619057 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_2509b9ab_48fc_4525_ac15_03410a5271b0`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:57:22.624081 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:57:22.634568 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2509b9ab-48fc-4525-ac15-03410a5271b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73352e9ad370>]}
[0m10:57:22.637106 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.40s]
[0m10:57:22.640394 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:57:22.654591 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:57:22.707066 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:57:22.806494 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_2509b9ab_48fc_4525_ac15_03410a5271b0'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:57:22.808742 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_2509b9ab_48fc_4525_ac15_03410a5271b0'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:57:22.823860 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:57:22.831205 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:57:22.839421 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:57:22.845004 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:57:22.848135 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_2509b9ab_48fc_4525_ac15_03410a5271b0`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:57:22.852412 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_2509b9ab_48fc_4525_ac15_03410a5271b0`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:57:22.906621 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:57:22.908399 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:57:22.912426 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_2509b9ab_48fc_4525_ac15_03410a5271b0`)
      
    ...
[0m10:57:22.916737 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_2509b9ab_48fc_4525_ac15_03410a5271b0`)
      
    ...
[0m10:57:22.949928 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:57:22.951902 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:57:22.957470 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:57:22.966718 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:57:22.973599 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:57:22.975681 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:57:22.979037 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_2509b9ab_48fc_4525_ac15_03410a5271b0` 
    ...
[0m10:57:23.008470 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_2509b9ab_48fc_4525_ac15_03410a5271b0` 
    ...
[0m10:57:23.020159 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:57:23.022740 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:57:23.035771 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_2509b9ab_48fc_4525_ac15_03410a5271b0` 
  ...
[0m10:57:23.047978 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_2509b9ab_48fc_4525_ac15_03410a5271b0` 
  ...
[0m10:57:23.053977 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:57:23.056691 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:57:23.111178 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:57:23.120680 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:57:23.126719 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:57:23.133629 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2509b9ab-48fc-4525-ac15-03410a5271b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73352da1ac40>]}
[0m10:57:23.136172 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:57:23.138677 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.90s]
[0m10:57:23.145498 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2509b9ab-48fc-4525-ac15-03410a5271b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73352da1a6d0>]}
[0m10:57:23.148260 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:57:23.150987 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.92s]
[0m10:57:23.205154 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:57:23.209634 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:57:23.210807 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:57:23.211982 [debug] [MainThread]: On list__mart: Close
[0m10:57:23.213076 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:57:23.214215 [debug] [MainThread]: On list__clean: Close
[0m10:57:23.215290 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:57:23.216438 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:57:23.217620 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m10:57:23.218764 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m10:57:23.219810 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:57:23.220917 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:57:23.221972 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:57:23.223075 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:57:23.225326 [info ] [MainThread]: 
[0m10:57:23.226792 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.27 seconds (4.27s).
[0m10:57:23.235340 [debug] [MainThread]: Command end result
[0m10:57:23.451325 [info ] [MainThread]: 
[0m10:57:23.452590 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:57:23.453493 [info ] [MainThread]: 
[0m10:57:23.454471 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:57:23.506461 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.098554, "process_in_blocks": "0", "process_kernel_time": 0.651849, "process_mem_max_rss": "114220", "process_out_blocks": "9744", "process_user_time": 6.227243}
[0m10:57:23.508247 [debug] [MainThread]: Command `dbt build` succeeded at 10:57:23.507812 after 7.10 seconds
[0m10:57:23.509673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733532abe310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73352f6eb760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73352ede0700>]}
[0m10:57:23.510975 [debug] [MainThread]: Flushing usage events
[0m10:58:17.178985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735ef1496310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735eee101b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735eee1019d0>]}


============================== 10:58:17.188964 | 6a3ccdec-b384-47e8-81cc-cb24cdf5995e ==============================
[0m10:58:17.188964 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:58:17.190061 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'static_parser': 'True', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'target_path': 'None', 'quiet': 'False', 'introspect': 'True', 'debug': 'False', 'no_print': 'None', 'printer_width': '80', 'version_check': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'warn_error': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'fail_fast': 'False', 'use_colors': 'True'}
[0m10:58:17.770148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6a3ccdec-b384-47e8-81cc-cb24cdf5995e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735eedfc62e0>]}
[0m10:58:17.963005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6a3ccdec-b384-47e8-81cc-cb24cdf5995e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735eedfc6a90>]}
[0m10:58:17.964301 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:58:18.378952 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:58:18.885180 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:58:18.885916 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:58:19.085275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6a3ccdec-b384-47e8-81cc-cb24cdf5995e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735eed853eb0>]}
[0m10:58:19.564668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6a3ccdec-b384-47e8-81cc-cb24cdf5995e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735eed891e80>]}
[0m10:58:19.565540 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:58:19.568717 [info ] [MainThread]: 
[0m10:58:19.569720 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:58:19.581415 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:58:19.588362 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:58:19.692129 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:58:19.754780 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:58:20.562127 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:58:20.566481 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:58:20.577878 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:58:20.582581 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:58:20.608382 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:58:20.654746 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:58:20.674901 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:58:20.680021 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:58:20.687792 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:58:20.689203 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:58:20.704352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6a3ccdec-b384-47e8-81cc-cb24cdf5995e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735eee041be0>]}
[0m10:58:20.754936 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:58:20.756289 [info ] [MainThread]: 
[0m10:58:20.783882 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:58:20.785178 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:58:20.786335 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:58:20.787077 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:58:20.803786 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:58:20.853524 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:58:20.996248 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:58:21.113628 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:58:21.115172 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:58:21.127676 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:58:21.253414 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:58:21.257900 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:58:21.259868 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:58:21.263040 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:58:21.268952 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:58:21.271946 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:58:21.273825 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:58:21.276597 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:58:21.368939 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:58:21.372429 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:58:21.378493 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6a3ccdec-b384-47e8-81cc-cb24cdf5995e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735eecaf9a00>]}
[0m10:58:21.379633 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m10:58:21.381012 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:58:21.383245 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:58:21.384276 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:58:21.385400 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:58:21.387070 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:58:21.389153 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:58:21.391149 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:58:21.393593 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:58:21.395825 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:58:21.397843 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:58:21.399498 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:58:21.401099 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:58:21.402813 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:58:21.599277 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:58:21.654148 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:58:21.656067 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:58:21.659025 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:58:21.665822 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:58:21.693702 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:58:21.893584 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:58:21.896298 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:58:21.902486 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:58:21.955238 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:58:21.957516 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:58:21.961282 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:58:22.204935 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:58:22.223962 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:58:22.226863 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:58:22.266275 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.87s]
[0m10:58:22.270241 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:58:22.275822 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:58:22.282281 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.89s]
[0m10:58:22.284978 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:58:22.287737 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:58:22.301639 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:58:22.307546 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m10:58:22.354015 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:58:22.356904 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:58:22.358071 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:58:22.359819 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:58:22.361436 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:58:22.363272 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:58:22.365756 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:58:22.368066 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:58:22.369653 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:58:22.371520 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:58:22.373934 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:58:22.375614 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:58:22.377732 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:58:22.476410 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:58:22.480980 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:58:22.487820 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:58:22.489951 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:58:22.491636 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:58:22.498148 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:58:22.660421 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:58:22.693925 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:58:22.785599 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:58:22.890077 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:58:22.990113 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:58:23.056500 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:58:23.159786 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:58:23.276754 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:58:23.383834 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:58:23.463486 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_6a3ccdec_b384_47e8_81cc_cb24cdf5995e` 
  ...
[0m10:58:23.467875 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:58:23.470216 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_6a3ccdec_b384_47e8_81cc_cb24cdf5995e` 
  ...
[0m10:58:23.474751 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:58:23.478093 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:58:23.490629 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:58:23.582483 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:58:23.676171 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m10:58:23.692176 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6a3ccdec-b384-47e8-81cc-cb24cdf5995e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735eec445e20>]}
[0m10:58:23.783008 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.32s]
[0m10:58:23.859205 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:58:23.868050 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_6a3ccdec_b384_47e8_81cc_cb24cdf5995e`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:58:23.874764 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_6a3ccdec_b384_47e8_81cc_cb24cdf5995e`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:58:24.673122 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.80 seconds
[0m10:58:24.689495 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.81 seconds
[0m10:58:24.704063 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_6a3ccdec_b384_47e8_81cc_cb24cdf5995e'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:58:24.712052 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_6a3ccdec_b384_47e8_81cc_cb24cdf5995e'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:58:24.719602 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:58:24.720827 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:58:24.760500 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:58:24.766291 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:58:24.768893 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_6a3ccdec_b384_47e8_81cc_cb24cdf5995e`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:58:24.771743 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_6a3ccdec_b384_47e8_81cc_cb24cdf5995e`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:58:24.801367 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:58:24.803918 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:58:24.807737 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_6a3ccdec_b384_47e8_81cc_cb24cdf5995e`)
      
    ...
[0m10:58:24.811922 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_6a3ccdec_b384_47e8_81cc_cb24cdf5995e`)
      
    ...
[0m10:58:24.839437 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:58:24.854567 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:58:24.857418 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:58:24.867346 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:58:24.877451 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:58:24.883748 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_6a3ccdec_b384_47e8_81cc_cb24cdf5995e` 
    ...
[0m10:58:24.886778 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:58:24.894327 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_6a3ccdec_b384_47e8_81cc_cb24cdf5995e` 
    ...
[0m10:58:24.898909 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:58:24.954854 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:58:24.970521 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_6a3ccdec_b384_47e8_81cc_cb24cdf5995e` 
  ...
[0m10:58:24.979386 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_6a3ccdec_b384_47e8_81cc_cb24cdf5995e` 
  ...
[0m10:58:24.983945 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:58:24.997948 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:58:25.053854 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:58:25.064314 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:58:25.071410 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:58:25.074001 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:58:25.080703 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6a3ccdec-b384-47e8-81cc-cb24cdf5995e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735eec48b550>]}
[0m10:58:25.086831 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6a3ccdec-b384-47e8-81cc-cb24cdf5995e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735eec48bc40>]}
[0m10:58:25.089603 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.71s]
[0m10:58:25.092366 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.72s]
[0m10:58:25.095404 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:58:25.098435 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:58:25.156866 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:58:25.158050 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:58:25.159227 [debug] [MainThread]: On list__mart: Close
[0m10:58:25.160300 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:58:25.161390 [debug] [MainThread]: On list__clean: Close
[0m10:58:25.162439 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:58:25.163625 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:58:25.164675 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:58:25.165907 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:58:25.166965 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:58:25.168148 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:58:25.169216 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m10:58:25.170364 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m10:58:25.172683 [info ] [MainThread]: 
[0m10:58:25.174028 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.60 seconds (5.60s).
[0m10:58:25.182204 [debug] [MainThread]: Command end result
[0m10:58:25.397442 [info ] [MainThread]: 
[0m10:58:25.398738 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:58:25.399665 [info ] [MainThread]: 
[0m10:58:25.400673 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:58:25.453789 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 8.469054, "process_in_blocks": "0", "process_kernel_time": 0.721404, "process_mem_max_rss": "115428", "process_out_blocks": "9744", "process_user_time": 6.496616}
[0m10:58:25.455662 [debug] [MainThread]: Command `dbt build` succeeded at 10:58:25.455214 after 8.47 seconds
[0m10:58:25.457005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735ef1496310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735eed702c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735eedfc6a90>]}
[0m10:58:25.458294 [debug] [MainThread]: Flushing usage events
[0m10:59:16.900757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ea5f6f7e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ea5c34dbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ea5c34da60>]}


============================== 10:59:16.961280 | c52db066-24e8-4049-b09b-77b3bb9bdcbe ==============================
[0m10:59:16.961280 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:59:16.962441 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'version_check': 'True', 'static_parser': 'True', 'quiet': 'False', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'introspect': 'True', 'use_experimental_parser': 'False', 'printer_width': '80', 'partial_parse': 'True', 'profiles_dir': '.', 'log_format': 'default', 'indirect_selection': 'eager', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error': 'None', 'empty': 'False', 'log_cache_events': 'False', 'use_colors': 'True', 'target_path': 'None', 'no_print': 'None', 'debug': 'False', 'write_json': 'True'}
[0m10:59:17.491634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c52db066-24e8-4049-b09b-77b3bb9bdcbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ea5de3e7c0>]}
[0m10:59:17.683805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c52db066-24e8-4049-b09b-77b3bb9bdcbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ea5c458d90>]}
[0m10:59:17.685202 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m10:59:18.100102 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m10:59:18.602716 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:59:18.603352 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:59:18.804311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c52db066-24e8-4049-b09b-77b3bb9bdcbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ea5bab9e50>]}
[0m10:59:19.304386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c52db066-24e8-4049-b09b-77b3bb9bdcbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ea5baf7250>]}
[0m10:59:19.305263 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m10:59:19.308397 [info ] [MainThread]: 
[0m10:59:19.309372 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m10:59:19.321273 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:59:19.323002 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m10:59:19.408564 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:59:19.473621 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:59:20.144613 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:59:20.161522 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:59:20.162788 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m10:59:20.178801 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:59:20.201679 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m10:59:20.261418 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m10:59:20.281499 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m10:59:20.290051 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m10:59:20.302244 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:59:20.303772 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:59:20.380735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c52db066-24e8-4049-b09b-77b3bb9bdcbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ea5c029e50>]}
[0m10:59:20.382619 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m10:59:20.383915 [info ] [MainThread]: 
[0m10:59:20.411545 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m10:59:20.461106 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m10:59:20.462840 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m10:59:20.463936 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m10:59:20.486362 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:59:20.488184 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m10:59:20.684725 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m10:59:20.756261 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m10:59:20.757755 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:59:20.770178 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:59:20.896357 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:59:20.900066 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:59:20.902079 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m10:59:20.905058 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:59:20.910734 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m10:59:20.960922 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:59:20.963136 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m10:59:20.966075 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:59:21.060960 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m10:59:21.065989 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:59:21.073352 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c52db066-24e8-4049-b09b-77b3bb9bdcbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ea5ae2acd0>]}
[0m10:59:21.074494 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m10:59:21.075826 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m10:59:21.077753 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:59:21.079121 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:59:21.080396 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m10:59:21.081764 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:59:21.083605 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m10:59:21.086007 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m10:59:21.087913 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m10:59:21.090063 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m10:59:21.091728 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:59:21.093783 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m10:59:21.095489 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:59:21.161308 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:59:21.201272 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:59:21.260945 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:59:21.278284 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:59:21.281172 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:59:21.298346 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:59:21.361096 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:59:21.389777 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m10:59:21.402658 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m10:59:21.472291 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m10:59:21.475023 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m10:59:21.477459 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m10:59:21.480226 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m10:59:21.739788 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m10:59:21.763546 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:59:21.781178 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m10:59:21.784729 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.70s]
[0m10:59:21.789482 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m10:59:21.792556 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m10:59:21.801187 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:59:21.809345 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.72s]
[0m10:59:21.861631 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:59:21.864705 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m10:59:21.870720 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.78s]
[0m10:59:21.874313 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m10:59:21.877417 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:59:21.878941 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:59:21.880766 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:59:21.882416 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m10:59:21.884314 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m10:59:21.886614 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m10:59:21.888528 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m10:59:21.890118 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m10:59:21.891778 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m10:59:21.893391 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:59:21.895107 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:59:21.896856 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m10:59:22.074773 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:59:22.095084 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:59:22.104328 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:59:22.105982 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m10:59:22.107916 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:59:22.172402 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:59:22.176507 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m10:59:22.307500 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m10:59:22.394700 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:59:22.490017 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:59:22.584730 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:59:22.599525 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m10:59:22.684991 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:59:22.790047 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:59:22.874520 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c52db066_24e8_4049_b09b_77b3bb9bdcbe` 
  ...
[0m10:59:22.876622 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:59:22.878621 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m10:59:22.893757 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:59:22.905189 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c52db066_24e8_4049_b09b_77b3bb9bdcbe` 
  ...
[0m10:59:22.966543 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:59:23.000560 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:59:23.064037 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m10:59:23.174874 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m10:59:23.272591 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c52db066-24e8-4049-b09b-77b3bb9bdcbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ea5b9c7820>]}
[0m10:59:23.285322 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.38s]
[0m10:59:23.368186 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_c52db066_24e8_4049_b09b_77b3bb9bdcbe`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m10:59:23.371380 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_c52db066_24e8_4049_b09b_77b3bb9bdcbe`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m10:59:23.373519 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m10:59:23.414026 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m10:59:23.428909 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:59:23.494558 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_c52db066_24e8_4049_b09b_77b3bb9bdcbe'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:59:23.496103 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_c52db066_24e8_4049_b09b_77b3bb9bdcbe'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:59:23.507559 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:59:23.562409 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:59:23.579879 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m10:59:23.578316 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m10:59:23.583267 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_c52db066_24e8_4049_b09b_77b3bb9bdcbe`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m10:59:23.585447 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_c52db066_24e8_4049_b09b_77b3bb9bdcbe`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m10:59:23.617878 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:59:23.620482 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:59:23.624821 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c52db066_24e8_4049_b09b_77b3bb9bdcbe`)
      
    ...
[0m10:59:23.629020 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c52db066_24e8_4049_b09b_77b3bb9bdcbe`)
      
    ...
[0m10:59:23.661988 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m10:59:23.673107 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:59:23.682126 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:59:23.688278 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c52db066_24e8_4049_b09b_77b3bb9bdcbe` 
    ...
[0m10:59:23.692419 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m10:59:23.705265 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m10:59:23.708193 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:59:23.762685 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m10:59:23.779357 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c52db066_24e8_4049_b09b_77b3bb9bdcbe` 
  ...
[0m10:59:23.778600 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c52db066_24e8_4049_b09b_77b3bb9bdcbe` 
    ...
[0m10:59:23.788007 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:59:23.802608 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m10:59:23.801087 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m10:59:23.866696 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c52db066_24e8_4049_b09b_77b3bb9bdcbe` 
  ...
[0m10:59:23.869931 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:59:23.879281 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m10:59:23.880696 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c52db066-24e8-4049-b09b-77b3bb9bdcbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ea5a34a790>]}
[0m10:59:23.891230 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m10:59:23.892991 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.99s]
[0m10:59:23.895815 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m10:59:23.898046 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m10:59:23.902004 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c52db066-24e8-4049-b09b-77b3bb9bdcbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ea5cc62df0>]}
[0m10:59:23.903420 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.01s]
[0m10:59:23.905033 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m10:59:23.907417 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:59:23.908142 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m10:59:23.961285 [debug] [MainThread]: On list__clean: Close
[0m10:59:23.962501 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m10:59:23.963613 [debug] [MainThread]: On list__mart: Close
[0m10:59:23.964647 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m10:59:23.965716 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m10:59:23.966772 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m10:59:23.967839 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m10:59:23.968867 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m10:59:23.969959 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m10:59:23.971117 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m10:59:23.972177 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m10:59:23.974411 [info ] [MainThread]: 
[0m10:59:23.975737 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.66 seconds (4.66s).
[0m10:59:23.983759 [debug] [MainThread]: Command end result
[0m10:59:24.102243 [info ] [MainThread]: 
[0m10:59:24.103079 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:59:24.103682 [info ] [MainThread]: 
[0m10:59:24.104313 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:59:24.105594 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.3993387, "process_in_blocks": "0", "process_kernel_time": 0.663561, "process_mem_max_rss": "114748", "process_out_blocks": "9744", "process_user_time": 6.372584}
[0m10:59:24.106329 [debug] [MainThread]: Command `dbt build` succeeded at 10:59:24.106139 after 7.40 seconds
[0m10:59:24.106961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ea5f6f7e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ea5d60e220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ea5d6817c0>]}
[0m10:59:24.107567 [debug] [MainThread]: Flushing usage events
[0m11:00:17.190219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7152e58c0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7152e252cb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7152e252ca00>]}


============================== 11:00:17.232009 | ed50b2e5-b6ae-4604-8564-eff264dadb16 ==============================
[0m11:00:17.232009 [info ] [MainThread]: Running with dbt=1.8.9
[0m11:00:17.233269 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'printer_width': '80', 'log_format': 'default', 'partial_parse': 'True', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'debug': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'warn_error': 'None', 'empty': 'False', 'quiet': 'False', 'log_cache_events': 'False', 'use_colors': 'True', 'no_print': 'None', 'cache_selected_only': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'version_check': 'True'}
[0m11:00:17.781237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ed50b2e5-b6ae-4604-8564-eff264dadb16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7152e2417940>]}
[0m11:00:17.925158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ed50b2e5-b6ae-4604-8564-eff264dadb16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7152e24df310>]}
[0m11:00:17.926459 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m11:00:18.389572 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m11:00:18.891605 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:00:18.892267 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:00:19.092234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ed50b2e5-b6ae-4604-8564-eff264dadb16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7152e1c80eb0>]}
[0m11:00:19.545442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ed50b2e5-b6ae-4604-8564-eff264dadb16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7152e1b754c0>]}
[0m11:00:19.546381 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m11:00:19.582329 [info ] [MainThread]: 
[0m11:00:19.583511 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:00:19.595255 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:00:19.597335 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:00:19.699221 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:00:19.715918 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:00:20.460367 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:00:20.465261 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:00:20.496237 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:00:20.506676 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:00:20.593807 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m11:00:20.595424 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m11:00:20.616745 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m11:00:20.624554 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m11:00:20.681772 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m11:00:20.683487 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m11:00:20.713837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ed50b2e5-b6ae-4604-8564-eff264dadb16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7152e1a14d00>]}
[0m11:00:20.715730 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m11:00:20.717015 [info ] [MainThread]: 
[0m11:00:20.794371 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m11:00:20.795503 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m11:00:20.796612 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m11:00:20.797362 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m11:00:20.814124 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m11:00:20.815319 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m11:00:20.998978 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m11:00:21.065342 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m11:00:21.067129 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m11:00:21.079655 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:00:21.212652 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m11:00:21.216243 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:00:21.218117 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m11:00:21.221061 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:00:21.226830 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m11:00:21.229940 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:00:21.231756 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m11:00:21.282475 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m11:00:21.329370 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m11:00:21.383176 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m11:00:21.390822 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ed50b2e5-b6ae-4604-8564-eff264dadb16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7152e10484f0>]}
[0m11:00:21.391930 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m11:00:21.393376 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m11:00:21.395616 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:00:21.397295 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:00:21.398979 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m11:00:21.400524 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:00:21.401833 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m11:00:21.403890 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m11:00:21.405127 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m11:00:21.407341 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m11:00:21.408797 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:00:21.410329 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m11:00:21.412145 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:00:21.480583 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:00:21.491525 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m11:00:21.511908 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m11:00:21.523111 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m11:00:21.525899 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:00:21.527763 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:00:21.591319 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:00:21.808716 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m11:00:21.826795 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m11:00:21.900728 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m11:00:21.902927 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m11:00:21.905101 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m11:00:21.908404 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m11:00:22.194593 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m11:00:22.212900 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m11:00:22.215822 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:00:22.220257 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m11:00:22.282235 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m11:00:22.288217 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.88s]
[0m11:00:22.296411 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m11:00:22.300485 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:00:22.303492 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:00:22.306285 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:00:22.312560 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.91s]
[0m11:00:22.315819 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:00:22.318315 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:00:22.319476 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:00:22.321848 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m11:00:22.323687 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m11:00:22.325743 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m11:00:22.327435 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m11:00:22.329365 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m11:00:22.382206 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m11:00:22.383880 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:00:22.385365 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m11:00:22.386981 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:00:22.404165 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m11:00:22.490797 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m11:00:22.497855 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m11:00:22.511577 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m11:00:22.514211 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:00:22.516681 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m11:00:22.518412 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:00:22.620802 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m11:00:22.781172 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m11:00:22.891521 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m11:00:22.914377 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m11:00:22.996374 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m11:00:23.091917 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m11:00:23.090262 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_ed50b2e5_b6ae_4604_8564_eff264dadb16` 
  ...
[0m11:00:23.120155 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:00:23.182240 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_ed50b2e5_b6ae_4604_8564_eff264dadb16` 
  ...
[0m11:00:23.189175 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m11:00:23.191669 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m11:00:23.205708 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:00:23.224192 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:00:23.308931 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m11:00:23.398978 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:00:23.501130 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m11:00:23.514226 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_ed50b2e5_b6ae_4604_8564_eff264dadb16`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m11:00:23.517347 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_ed50b2e5_b6ae_4604_8564_eff264dadb16`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m11:00:23.526548 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:00:23.581916 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m11:00:23.585997 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ed50b2e5-b6ae-4604-8564-eff264dadb16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7152e082e820>]}
[0m11:00:23.588304 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m11:00:23.608272 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.20s]
[0m11:00:23.625254 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_ed50b2e5_b6ae_4604_8564_eff264dadb16'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:00:23.687351 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_ed50b2e5_b6ae_4604_8564_eff264dadb16'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:00:23.692783 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m11:00:23.703642 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:00:23.706299 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:00:23.719335 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m11:00:23.724803 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m11:00:23.727643 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_ed50b2e5_b6ae_4604_8564_eff264dadb16`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m11:00:23.729973 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_ed50b2e5_b6ae_4604_8564_eff264dadb16`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m11:00:23.807921 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m11:00:23.810570 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:00:23.814671 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_ed50b2e5_b6ae_4604_8564_eff264dadb16`)
      
    ...
[0m11:00:23.818822 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_ed50b2e5_b6ae_4604_8564_eff264dadb16`)
      
    ...
[0m11:00:23.845773 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:00:23.856364 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:00:23.859030 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:00:23.880611 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:00:23.881886 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:00:23.887776 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_ed50b2e5_b6ae_4604_8564_eff264dadb16` 
    ...
[0m11:00:23.896795 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:00:23.902691 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_ed50b2e5_b6ae_4604_8564_eff264dadb16` 
    ...
[0m11:00:23.906778 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:00:23.919681 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_ed50b2e5_b6ae_4604_8564_eff264dadb16` 
  ...
[0m11:00:23.922341 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:00:23.981698 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m11:00:23.995892 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_ed50b2e5_b6ae_4604_8564_eff264dadb16` 
  ...
[0m11:00:24.005065 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m11:00:24.010212 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:00:24.024040 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:00:24.082075 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m11:00:24.088741 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ed50b2e5-b6ae-4604-8564-eff264dadb16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7152e23688e0>]}
[0m11:00:24.092967 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.71s]
[0m11:00:24.095917 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:00:24.099141 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:00:24.105456 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ed50b2e5-b6ae-4604-8564-eff264dadb16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7152e3748550>]}
[0m11:00:24.107787 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.78s]
[0m11:00:24.110716 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:00:24.114523 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:00:24.115710 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m11:00:24.116841 [debug] [MainThread]: On list__clean: Close
[0m11:00:24.117889 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m11:00:24.119015 [debug] [MainThread]: On list__mart: Close
[0m11:00:24.120043 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m11:00:24.121150 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m11:00:24.122190 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m11:00:24.123301 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m11:00:24.124334 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m11:00:24.125433 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m11:00:24.126478 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m11:00:24.127635 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m11:00:24.181700 [info ] [MainThread]: 
[0m11:00:24.183246 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.60 seconds (4.60s).
[0m11:00:24.191267 [debug] [MainThread]: Command end result
[0m11:00:24.323367 [info ] [MainThread]: 
[0m11:00:24.324363 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:00:24.325086 [info ] [MainThread]: 
[0m11:00:24.325832 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m11:00:24.327365 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.343447, "process_in_blocks": "8", "process_kernel_time": 0.710392, "process_mem_max_rss": "114576", "process_out_blocks": "9744", "process_user_time": 6.349812}
[0m11:00:24.328314 [debug] [MainThread]: Command `dbt build` succeeded at 11:00:24.328058 after 7.34 seconds
[0m11:00:24.329107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7152e58c0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7152e24df310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7152e1b2f400>]}
[0m11:00:24.380859 [debug] [MainThread]: Flushing usage events
[0m11:01:16.612361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7183c4654310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7183c12afb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7183c12afa00>]}


============================== 11:01:16.623256 | 404772e2-5bc5-40b3-b682-e1d0c94024df ==============================
[0m11:01:16.623256 [info ] [MainThread]: Running with dbt=1.8.9
[0m11:01:16.624336 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_path': '/workdir/transforms/04_btc/logs', 'log_cache_events': 'False', 'use_colors': 'True', 'no_print': 'None', 'empty': 'False', 'version_check': 'True', 'target_path': 'None', 'write_json': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'log_format': 'default', 'partial_parse': 'True', 'quiet': 'False', 'fail_fast': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt build --profiles-dir . --target local', 'introspect': 'True', 'warn_error': 'None', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'debug': 'False', 'static_parser': 'True'}
[0m11:01:17.202628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '404772e2-5bc5-40b3-b682-e1d0c94024df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7183c12759a0>]}
[0m11:01:17.403794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '404772e2-5bc5-40b3-b682-e1d0c94024df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7183c1371580>]}
[0m11:01:17.405091 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m11:01:17.814289 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m11:01:18.316009 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:01:18.316682 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:01:18.518386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '404772e2-5bc5-40b3-b682-e1d0c94024df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7183c0a16eb0>]}
[0m11:01:18.996572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '404772e2-5bc5-40b3-b682-e1d0c94024df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7183c090b4c0>]}
[0m11:01:18.997489 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m11:01:19.001332 [info ] [MainThread]: 
[0m11:01:19.002796 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:01:19.014551 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:01:19.015675 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:01:19.103789 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:01:19.104665 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:01:19.640794 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:01:19.649496 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:01:19.651895 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:01:19.661348 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:01:19.720689 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m11:01:19.732559 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m11:01:19.792491 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m11:01:19.801353 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m11:01:19.814835 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:01:19.825483 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:01:19.890050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '404772e2-5bc5-40b3-b682-e1d0c94024df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7183c1175280>]}
[0m11:01:19.892040 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m11:01:19.893390 [info ] [MainThread]: 
[0m11:01:19.919837 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m11:01:19.920962 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m11:01:19.922024 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m11:01:19.922766 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m11:01:19.992453 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m11:01:19.994513 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m11:01:20.186093 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m11:01:20.272860 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m11:01:20.274223 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m11:01:20.292141 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:01:20.415415 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m11:01:20.419140 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:01:20.421177 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m11:01:20.424119 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:01:20.429731 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m11:01:20.432626 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:01:20.434392 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m11:01:20.437176 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:01:20.529506 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m11:01:20.533192 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:01:20.588444 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '404772e2-5bc5-40b3-b682-e1d0c94024df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7183c0616520>]}
[0m11:01:20.589653 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.67s]
[0m11:01:20.590970 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m11:01:20.593096 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:01:20.594851 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:01:20.596590 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m11:01:20.598578 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:01:20.600249 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m11:01:20.602552 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m11:01:20.604361 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m11:01:20.606569 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m11:01:20.608400 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:01:20.610492 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m11:01:20.612161 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:01:20.629689 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:01:20.792322 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m11:01:20.802507 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m11:01:20.804459 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m11:01:20.807264 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:01:20.814413 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:01:20.889764 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:01:21.098065 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m11:01:21.116292 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m11:01:21.130469 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m11:01:21.133097 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m11:01:21.186123 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m11:01:21.189639 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m11:01:21.431629 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m11:01:21.451608 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:01:21.485455 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m11:01:21.496250 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m11:01:21.499034 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.90s]
[0m11:01:21.505670 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:01:21.516843 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:01:21.519648 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:01:21.525440 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.92s]
[0m11:01:21.531249 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.92s]
[0m11:01:21.534338 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:01:21.537335 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:01:21.585294 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:01:21.586341 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m11:01:21.587578 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:01:21.588995 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m11:01:21.590257 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m11:01:21.592339 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m11:01:21.594176 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:01:21.596152 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m11:01:21.597847 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m11:01:21.625254 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m11:01:21.691776 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m11:01:21.693510 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:01:21.695242 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m11:01:21.713121 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:01:21.715995 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m11:01:21.729782 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m11:01:21.810946 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:01:21.889780 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m11:01:21.991247 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m11:01:22.126224 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m11:01:22.316221 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m11:01:22.491173 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m11:01:22.598802 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:01:22.608239 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m11:01:22.626238 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_404772e2_5bc5_40b3_b682_e1d0c94024df` 
  ...
[0m11:01:22.695459 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_404772e2_5bc5_40b3_b682_e1d0c94024df` 
  ...
[0m11:01:22.697664 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m11:01:22.708829 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m11:01:22.710391 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:01:22.712234 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:01:22.725623 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:01:22.820667 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m11:01:22.914583 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:01:23.017998 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m11:01:23.113108 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:01:23.115489 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_404772e2_5bc5_40b3_b682_e1d0c94024df`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m11:01:23.128742 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '404772e2-5bc5-40b3-b682-e1d0c94024df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7183c10fde50>]}
[0m11:01:23.124261 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_404772e2_5bc5_40b3_b682_e1d0c94024df`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m11:01:23.184436 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.50s]
[0m11:01:23.190428 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m11:01:23.217516 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:01:23.232720 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m11:01:23.309465 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_404772e2_5bc5_40b3_b682_e1d0c94024df'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:01:23.311352 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_404772e2_5bc5_40b3_b682_e1d0c94024df'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:01:23.322187 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:01:23.330046 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:01:23.387394 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m11:01:23.391761 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m11:01:23.393481 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_404772e2_5bc5_40b3_b682_e1d0c94024df`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m11:01:23.394970 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_404772e2_5bc5_40b3_b682_e1d0c94024df`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m11:01:23.412147 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:01:23.413821 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:01:23.416181 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_404772e2_5bc5_40b3_b682_e1d0c94024df`)
      
    ...
[0m11:01:23.418972 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_404772e2_5bc5_40b3_b682_e1d0c94024df`)
      
    ...
[0m11:01:23.437752 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:01:23.443937 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:01:23.445411 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:01:23.451780 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:01:23.453349 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:01:23.485493 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:01:23.457410 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_404772e2_5bc5_40b3_b682_e1d0c94024df` 
    ...
[0m11:01:23.491427 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_404772e2_5bc5_40b3_b682_e1d0c94024df` 
    ...
[0m11:01:23.502470 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:01:23.509931 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:01:23.517038 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_404772e2_5bc5_40b3_b682_e1d0c94024df` 
  ...
[0m11:01:23.526749 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_404772e2_5bc5_40b3_b682_e1d0c94024df` 
  ...
[0m11:01:23.532796 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:01:23.535561 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:01:23.604923 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m11:01:23.606333 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m11:01:23.610075 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:01:23.611235 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:01:23.615014 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '404772e2-5bc5-40b3-b682-e1d0c94024df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7183bf60e790>]}
[0m11:01:23.617937 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '404772e2-5bc5-40b3-b682-e1d0c94024df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7183c030c190>]}
[0m11:01:23.619287 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.02s]
[0m11:01:23.620605 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.03s]
[0m11:01:23.622006 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:01:23.623610 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:01:23.625798 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:01:23.626353 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m11:01:23.626966 [debug] [MainThread]: On list__mart: Close
[0m11:01:23.627498 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m11:01:23.628058 [debug] [MainThread]: On list__clean: Close
[0m11:01:23.628597 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m11:01:23.629151 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m11:01:23.629688 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m11:01:23.630266 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m11:01:23.630794 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m11:01:23.631310 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m11:01:23.631867 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m11:01:23.632381 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m11:01:23.686197 [info ] [MainThread]: 
[0m11:01:23.687762 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.68 seconds (4.68s).
[0m11:01:23.696076 [debug] [MainThread]: Command end result
[0m11:01:23.908893 [info ] [MainThread]: 
[0m11:01:23.910709 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:01:23.912118 [info ] [MainThread]: 
[0m11:01:23.913550 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m11:01:23.916175 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.495267, "process_in_blocks": "0", "process_kernel_time": 0.691351, "process_mem_max_rss": "114876", "process_out_blocks": "9744", "process_user_time": 6.408716}
[0m11:01:23.917713 [debug] [MainThread]: Command `dbt build` succeeded at 11:01:23.917293 after 7.50 seconds
[0m11:01:23.918908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7183c4654310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7183c12759a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7183c1371580>]}
[0m11:01:23.920097 [debug] [MainThread]: Flushing usage events
[0m11:02:17.358904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793e37f83310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793e34bd8b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793e34bd89d0>]}


============================== 11:02:17.368032 | 863403ed-49ca-4dcc-8b2c-4691feb7746c ==============================
[0m11:02:17.368032 [info ] [MainThread]: Running with dbt=1.8.9
[0m11:02:17.369121 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'cache_selected_only': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'log_format': 'default', 'debug': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'indirect_selection': 'eager', 'printer_width': '80', 'quiet': 'False', 'empty': 'False', 'write_json': 'True', 'fail_fast': 'False', 'target_path': 'None', 'no_print': 'None', 'use_colors': 'True', 'profiles_dir': '.', 'invocation_command': 'dbt build --profiles-dir . --target local', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'introspect': 'True', 'static_parser': 'True'}
[0m11:02:17.962900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '863403ed-49ca-4dcc-8b2c-4691feb7746c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793e34b9c0a0>]}
[0m11:02:18.154891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '863403ed-49ca-4dcc-8b2c-4691feb7746c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793e34bc5a60>]}
[0m11:02:18.156157 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m11:02:18.569302 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m11:02:19.071444 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:02:19.072124 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:02:19.271890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '863403ed-49ca-4dcc-8b2c-4691feb7746c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793e3433ee80>]}
[0m11:02:19.767991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '863403ed-49ca-4dcc-8b2c-4691feb7746c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793e343549a0>]}
[0m11:02:19.768870 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m11:02:19.772009 [info ] [MainThread]: 
[0m11:02:19.773036 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:02:19.784644 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:02:19.785993 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:02:19.925034 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:02:19.937430 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:02:20.714143 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:02:20.729804 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:02:20.734225 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:02:20.738395 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:02:20.835966 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m11:02:20.837560 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m11:02:20.853062 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m11:02:20.862060 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m11:02:20.872579 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:02:20.926459 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m11:02:20.949521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '863403ed-49ca-4dcc-8b2c-4691feb7746c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793e37ee2790>]}
[0m11:02:20.951484 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m11:02:20.952982 [info ] [MainThread]: 
[0m11:02:21.030347 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m11:02:21.031880 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m11:02:21.033357 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m11:02:21.034393 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m11:02:21.054912 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m11:02:21.056098 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m11:02:21.242136 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m11:02:21.313867 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m11:02:21.315394 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m11:02:21.330014 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:02:21.470620 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m11:02:21.474166 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:02:21.525499 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m11:02:21.528694 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:02:21.534243 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m11:02:21.537133 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:02:21.538929 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m11:02:21.541782 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:02:21.635989 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m11:02:21.639452 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:02:21.645421 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '863403ed-49ca-4dcc-8b2c-4691feb7746c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793e335cd250>]}
[0m11:02:21.646604 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m11:02:21.647960 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m11:02:21.650224 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:02:21.651829 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m11:02:21.653790 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m11:02:21.655246 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:02:21.656837 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:02:21.658560 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:02:21.726310 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m11:02:21.738772 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m11:02:21.756490 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m11:02:21.765005 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m11:02:21.767164 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m11:02:21.768928 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:02:21.770952 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:02:21.825479 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:02:21.849605 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m11:02:21.853549 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m11:02:21.931798 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:02:21.943765 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:02:22.136893 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m11:02:22.144188 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m11:02:22.148136 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m11:02:22.149504 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m11:02:22.150376 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m11:02:22.152033 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m11:02:22.298772 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m11:02:22.307362 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m11:02:22.308998 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:02:22.330732 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:02:22.329639 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.56s]
[0m11:02:22.333917 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.68s]
[0m11:02:22.335846 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:02:22.337281 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m11:02:22.338556 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:02:22.347903 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:02:22.351143 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.60s]
[0m11:02:22.352498 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:02:22.354025 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:02:22.354840 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:02:22.355651 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m11:02:22.356758 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m11:02:22.358279 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m11:02:22.359427 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m11:02:22.360678 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m11:02:22.362145 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m11:02:22.363202 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m11:02:22.364374 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:02:22.365993 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:02:22.367406 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m11:02:22.532778 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m11:02:22.541906 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m11:02:22.546293 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m11:02:22.548997 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:02:22.550499 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m11:02:22.568378 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:02:22.655321 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m11:02:22.744520 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m11:02:22.862557 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m11:02:22.956770 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m11:02:23.041918 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m11:02:23.155752 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m11:02:23.226757 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m11:02:23.336216 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m11:02:23.371862 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:02:23.447972 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m11:02:23.456558 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_863403ed_49ca_4dcc_8b2c_4691feb7746c` 
  ...
[0m11:02:23.457443 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_863403ed_49ca_4dcc_8b2c_4691feb7746c` 
  ...
[0m11:02:23.462552 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:02:23.464107 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:02:23.526597 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m11:02:23.531299 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m11:02:23.644184 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m11:02:23.659862 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '863403ed-49ca-4dcc-8b2c-4691feb7746c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793e340b6280>]}
[0m11:02:23.667651 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.30s]
[0m11:02:23.753878 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m11:02:23.933748 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_863403ed_49ca_4dcc_8b2c_4691feb7746c`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m11:02:23.935375 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_863403ed_49ca_4dcc_8b2c_4691feb7746c`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m11:02:24.910134 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.97 seconds
[0m11:02:24.925591 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.99 seconds
[0m11:02:24.947680 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_863403ed_49ca_4dcc_8b2c_4691feb7746c'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:02:24.951928 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_863403ed_49ca_4dcc_8b2c_4691feb7746c'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:02:24.959755 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:02:24.962594 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:02:25.026760 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m11:02:25.030238 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m11:02:25.033263 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_863403ed_49ca_4dcc_8b2c_4691feb7746c`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m11:02:25.035597 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_863403ed_49ca_4dcc_8b2c_4691feb7746c`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m11:02:25.066977 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:02:25.069462 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:02:25.073722 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_863403ed_49ca_4dcc_8b2c_4691feb7746c`)
      
    ...
[0m11:02:25.077672 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_863403ed_49ca_4dcc_8b2c_4691feb7746c`)
      
    ...
[0m11:02:25.100640 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:02:25.109523 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:02:25.112857 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:02:25.126408 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:02:25.130136 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:02:25.134565 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_863403ed_49ca_4dcc_8b2c_4691feb7746c` 
    ...
[0m11:02:25.141667 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:02:25.144211 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:02:25.149884 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_863403ed_49ca_4dcc_8b2c_4691feb7746c` 
    ...
[0m11:02:25.161063 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_863403ed_49ca_4dcc_8b2c_4691feb7746c` 
  ...
[0m11:02:25.168807 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:02:25.225776 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m11:02:25.228789 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m11:02:25.234914 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_863403ed_49ca_4dcc_8b2c_4691feb7746c` 
  ...
[0m11:02:25.237846 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:02:25.242274 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '863403ed-49ca-4dcc-8b2c-4691feb7746c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793e3376ae20>]}
[0m11:02:25.244430 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.88s]
[0m11:02:25.247229 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:02:25.249963 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:02:25.262484 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m11:02:25.267101 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:02:25.270844 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '863403ed-49ca-4dcc-8b2c-4691feb7746c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793e335cd490>]}
[0m11:02:25.272165 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.91s]
[0m11:02:25.273662 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:02:25.326741 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:02:25.328189 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m11:02:25.329383 [debug] [MainThread]: On list__mart: Close
[0m11:02:25.330513 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m11:02:25.331774 [debug] [MainThread]: On list__clean: Close
[0m11:02:25.332839 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m11:02:25.333955 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m11:02:25.335003 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m11:02:25.336274 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m11:02:25.337399 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m11:02:25.338583 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m11:02:25.339700 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m11:02:25.340856 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m11:02:25.343202 [info ] [MainThread]: 
[0m11:02:25.344605 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.57 seconds (5.57s).
[0m11:02:25.352897 [debug] [MainThread]: Command end result
[0m11:02:25.567687 [info ] [MainThread]: 
[0m11:02:25.568902 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:02:25.569816 [info ] [MainThread]: 
[0m11:02:25.570829 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m11:02:25.572765 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 8.406966, "process_in_blocks": "0", "process_kernel_time": 0.676501, "process_mem_max_rss": "114608", "process_out_blocks": "9752", "process_user_time": 6.493615}
[0m11:02:25.573862 [debug] [MainThread]: Command `dbt build` succeeded at 11:02:25.573588 after 8.41 seconds
[0m11:02:25.625149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793e37f83310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793e342a5640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793e34338f40>]}
[0m11:02:25.626531 [debug] [MainThread]: Flushing usage events
[0m11:03:16.950722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee6587310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee31dea90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee31de940>]}


============================== 11:03:17.011276 | 694e3539-ba3d-46fb-b791-e6283320708b ==============================
[0m11:03:17.011276 [info ] [MainThread]: Running with dbt=1.8.9
[0m11:03:17.012460 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'introspect': 'True', 'printer_width': '80', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'empty': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'version_check': 'True', 'use_colors': 'True', 'static_parser': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'use_experimental_parser': 'False', 'debug': 'False', 'no_print': 'None', 'indirect_selection': 'eager', 'fail_fast': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'write_json': 'True', 'warn_error': 'None', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None'}
[0m11:03:17.539398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '694e3539-ba3d-46fb-b791-e6283320708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee5b19fd0>]}
[0m11:03:17.732394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '694e3539-ba3d-46fb-b791-e6283320708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee3194490>]}
[0m11:03:17.733736 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m11:03:18.147716 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m11:03:18.706214 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:03:18.706974 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:03:18.906015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '694e3539-ba3d-46fb-b791-e6283320708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee2947f10>]}
[0m11:03:19.354233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '694e3539-ba3d-46fb-b791-e6283320708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee57d96a0>]}
[0m11:03:19.355181 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m11:03:19.358613 [info ] [MainThread]: 
[0m11:03:19.359714 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:03:19.406000 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:03:19.407852 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:03:19.452368 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:03:19.518875 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:03:20.216682 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:03:20.222860 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:03:20.239754 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:03:20.252039 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:03:20.336900 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m11:03:20.343663 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__mart'
[0m11:03:20.353658 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m11:03:20.407812 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:03:20.414520 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:03:20.486029 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m11:03:20.504738 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:03:20.520134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '694e3539-ba3d-46fb-b791-e6283320708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee5996940>]}
[0m11:03:20.522012 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m11:03:20.523358 [info ] [MainThread]: 
[0m11:03:20.551022 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m11:03:20.552188 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m11:03:20.553280 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m11:03:20.554047 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m11:03:20.628941 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m11:03:20.630840 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m11:03:20.949362 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m11:03:21.063899 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m11:03:21.065357 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m11:03:21.077947 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:03:21.098936 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m11:03:21.103225 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:03:21.106020 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m11:03:21.109678 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:03:21.117793 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m11:03:21.121421 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:03:21.124068 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m11:03:21.127580 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:03:21.234757 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m11:03:21.238824 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:03:21.244682 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '694e3539-ba3d-46fb-b791-e6283320708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee26017f0>]}
[0m11:03:21.245841 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.69s]
[0m11:03:21.247139 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m11:03:21.248973 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:03:21.250220 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:03:21.251853 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m11:03:21.253140 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:03:21.255004 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m11:03:21.306286 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m11:03:21.308110 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m11:03:21.310364 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m11:03:21.312110 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:03:21.314071 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m11:03:21.315863 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:03:21.328020 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:03:21.446829 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m11:03:21.448680 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m11:03:21.504679 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m11:03:21.507333 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:03:21.508936 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:03:21.526446 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:03:21.741346 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m11:03:21.810198 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m11:03:21.830569 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m11:03:21.833307 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m11:03:21.837616 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m11:03:21.840191 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m11:03:22.124697 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m11:03:22.127703 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m11:03:22.142388 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:03:22.207775 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.90s]
[0m11:03:22.210809 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m11:03:22.213957 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:03:22.221962 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m11:03:22.220000 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.91s]
[0m11:03:22.228439 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:03:22.237190 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:03:22.243126 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.93s]
[0m11:03:22.246332 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:03:22.249573 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:03:22.250676 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:03:22.252176 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m11:03:22.253352 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m11:03:22.255434 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m11:03:22.257331 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m11:03:22.306314 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m11:03:22.308216 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m11:03:22.310009 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:03:22.311758 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m11:03:22.313431 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:03:22.335873 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m11:03:22.406684 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m11:03:22.419259 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m11:03:22.426510 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m11:03:22.428358 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:03:22.430078 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:03:22.510040 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m11:03:22.615221 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m11:03:22.751341 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m11:03:22.922187 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m11:03:23.038051 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m11:03:23.137452 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:03:23.147110 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m11:03:23.229445 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_694e3539_ba3d_46fb_b791_e6283320708b` 
  ...
[0m11:03:23.242662 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:03:23.240726 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_694e3539_ba3d_46fb_b791_e6283320708b` 
  ...
[0m11:03:23.310807 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m11:03:23.308670 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m11:03:23.331350 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:03:23.405825 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m11:03:23.507378 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m11:03:23.549501 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:03:23.645703 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m11:03:23.726131 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_694e3539_ba3d_46fb_b791_e6283320708b`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m11:03:23.729445 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_694e3539_ba3d_46fb_b791_e6283320708b`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m11:03:23.734211 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:03:23.741803 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '694e3539-ba3d-46fb-b791-e6283320708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee3277430>]}
[0m11:03:23.744714 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.43s]
[0m11:03:23.747659 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m11:03:23.763789 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:03:23.810809 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m11:03:23.850927 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_694e3539_ba3d_46fb_b791_e6283320708b'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:03:23.850736 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_694e3539_ba3d_46fb_b791_e6283320708b'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:03:23.912190 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m11:03:23.915063 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:03:23.928044 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m11:03:23.933951 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m11:03:23.937005 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_694e3539_ba3d_46fb_b791_e6283320708b`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m11:03:23.939199 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_694e3539_ba3d_46fb_b791_e6283320708b`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m11:03:23.968634 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:03:23.973007 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_694e3539_ba3d_46fb_b791_e6283320708b`)
      
    ...
[0m11:03:23.975452 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:03:24.010677 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_694e3539_ba3d_46fb_b791_e6283320708b`)
      
    ...
[0m11:03:24.031609 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:03:24.040863 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:03:24.043050 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:03:24.051075 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:03:24.053443 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:03:24.060413 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_694e3539_ba3d_46fb_b791_e6283320708b` 
    ...
[0m11:03:24.062826 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:03:24.067975 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_694e3539_ba3d_46fb_b791_e6283320708b` 
    ...
[0m11:03:24.105699 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:03:24.119215 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_694e3539_ba3d_46fb_b791_e6283320708b` 
  ...
[0m11:03:24.124276 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m11:03:24.131880 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:03:24.137441 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_694e3539_ba3d_46fb_b791_e6283320708b` 
  ...
[0m11:03:24.149953 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m11:03:24.205946 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m11:03:24.220582 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m11:03:24.222146 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m11:03:24.228727 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '694e3539-ba3d-46fb-b791-e6283320708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee25eb700>]}
[0m11:03:24.233447 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.97s]
[0m11:03:24.236111 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:03:24.238924 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:03:24.249625 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '694e3539-ba3d-46fb-b791-e6283320708b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee25ebb50>]}
[0m11:03:24.304249 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.94s]
[0m11:03:24.307427 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:03:24.311438 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:03:24.312616 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m11:03:24.313781 [debug] [MainThread]: On list__clean: Close
[0m11:03:24.314889 [debug] [MainThread]: Connection 'list_' was left open.
[0m11:03:24.316081 [debug] [MainThread]: On list_: Close
[0m11:03:24.317213 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m11:03:24.318390 [debug] [MainThread]: On list__mart: Close
[0m11:03:24.319554 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m11:03:24.320699 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m11:03:24.321843 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m11:03:24.322975 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m11:03:24.324065 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m11:03:24.325250 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m11:03:24.326335 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m11:03:24.327543 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m11:03:24.330047 [info ] [MainThread]: 
[0m11:03:24.331465 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.97 seconds (4.97s).
[0m11:03:24.340604 [debug] [MainThread]: Command end result
[0m11:03:24.453040 [info ] [MainThread]: 
[0m11:03:24.504652 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:03:24.505335 [info ] [MainThread]: 
[0m11:03:24.506007 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m11:03:24.507319 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.6989846, "process_in_blocks": "0", "process_kernel_time": 0.710352, "process_mem_max_rss": "114928", "process_out_blocks": "9744", "process_user_time": 6.478371}
[0m11:03:24.508109 [debug] [MainThread]: Command `dbt build` succeeded at 11:03:24.507901 after 7.70 seconds
[0m11:03:24.508781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee6587310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee3d130a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee122e910>]}
[0m11:03:24.509370 [debug] [MainThread]: Flushing usage events
[0m11:04:16.492903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd9b61c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd9828ebe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd9828ea90>]}


============================== 11:04:16.552441 | 4f63e7af-7ff6-449a-a3f7-f8e7b1b8ff20 ==============================
[0m11:04:16.552441 [info ] [MainThread]: Running with dbt=1.8.9
[0m11:04:16.553485 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'empty': 'False', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'use_experimental_parser': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'indirect_selection': 'eager', 'log_path': '/workdir/transforms/04_btc/logs', 'write_json': 'True', 'no_print': 'None', 'version_check': 'True', 'printer_width': '80', 'profiles_dir': '.', 'partial_parse': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False', 'log_cache_events': 'False', 'quiet': 'False', 'debug': 'False', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m11:04:17.083036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4f63e7af-7ff6-449a-a3f7-f8e7b1b8ff20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd9aba9b80>]}
[0m11:04:17.280944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4f63e7af-7ff6-449a-a3f7-f8e7b1b8ff20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd98172610>]}
[0m11:04:17.282274 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m11:04:17.751499 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m11:04:18.258418 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:04:18.259096 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:04:18.459832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4f63e7af-7ff6-449a-a3f7-f8e7b1b8ff20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd979e0e80>]}
[0m11:04:19.364039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4f63e7af-7ff6-449a-a3f7-f8e7b1b8ff20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd979f58b0>]}
[0m11:04:19.364963 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m11:04:19.368171 [info ] [MainThread]: 
[0m11:04:19.369331 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:04:19.384791 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:04:19.391890 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:04:19.473333 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:04:19.493098 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:04:20.003767 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:04:20.009204 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:04:20.010323 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:04:20.014914 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:04:20.051953 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m11:04:20.058792 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m11:04:20.071373 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m11:04:20.078395 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m11:04:20.087481 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:20.089329 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:20.152906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f63e7af-7ff6-449a-a3f7-f8e7b1b8ff20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd97f52c70>]}
[0m11:04:20.153952 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m11:04:20.154576 [info ] [MainThread]: 
[0m11:04:20.167205 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m11:04:20.168368 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m11:04:20.169505 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m11:04:20.170289 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m11:04:20.186981 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m11:04:20.188268 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m11:04:20.358091 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m11:04:20.416073 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m11:04:20.417526 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m11:04:20.427338 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:20.563456 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m11:04:20.566341 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:04:20.568319 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m11:04:20.570936 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:04:20.576790 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m11:04:20.579412 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:04:20.581343 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m11:04:20.583913 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:04:20.679913 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m11:04:20.682982 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:04:20.689174 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f63e7af-7ff6-449a-a3f7-f8e7b1b8ff20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd96d96a90>]}
[0m11:04:20.690406 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.52s]
[0m11:04:20.691845 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m11:04:20.693487 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:04:20.694368 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m11:04:20.695247 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:04:20.700402 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:04:20.744809 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m11:04:20.745877 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m11:04:20.746798 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m11:04:20.747709 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:04:20.748779 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m11:04:20.749834 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m11:04:20.771232 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:04:20.774324 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m11:04:20.775262 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:04:20.782637 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m11:04:20.790245 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m11:04:20.791637 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:04:20.849716 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:04:20.855875 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:04:20.961825 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m11:04:20.963224 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m11:04:20.961074 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m11:04:20.964969 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m11:04:20.965762 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m11:04:20.967409 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m11:04:21.133780 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m11:04:21.141230 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:21.150062 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.40s]
[0m11:04:21.153830 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m11:04:21.155202 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m11:04:21.161332 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m11:04:21.164015 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:21.167080 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.42s]
[0m11:04:21.168708 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m11:04:21.170664 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:21.173599 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.42s]
[0m11:04:21.175757 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m11:04:21.177902 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:04:21.178744 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:04:21.179790 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m11:04:21.180653 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m11:04:21.181702 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m11:04:21.182614 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m11:04:21.183710 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m11:04:21.184675 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m11:04:21.185553 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:04:21.186462 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m11:04:21.187277 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:04:21.254943 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m11:04:21.259514 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m11:04:21.267975 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m11:04:21.274700 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m11:04:21.276381 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:04:21.277273 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:04:21.277993 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m11:04:21.448804 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m11:04:21.566771 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m11:04:21.669529 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_4f63e7af_7ff6_449a_a3f7_f8e7b1b8ff20` 
  ...
[0m11:04:21.671522 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:04:21.746102 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_4f63e7af_7ff6_449a_a3f7_f8e7b1b8ff20` 
  ...
[0m11:04:21.753039 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m11:04:21.754771 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:21.763425 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:21.770143 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:21.787720 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m11:04:21.882301 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:04:21.959438 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_4f63e7af_7ff6_449a_a3f7_f8e7b1b8ff20`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m11:04:21.974042 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m11:04:21.981869 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_4f63e7af_7ff6_449a_a3f7_f8e7b1b8ff20`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m11:04:21.987560 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:22.045758 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m11:04:21.992467 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m11:04:22.049507 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m11:04:22.087214 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_4f63e7af_7ff6_449a_a3f7_f8e7b1b8ff20'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:04:22.145648 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m11:04:22.152424 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_4f63e7af_7ff6_449a_a3f7_f8e7b1b8ff20'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:04:22.164174 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:22.174106 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m11:04:22.191320 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:04:22.248495 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m11:04:22.254596 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m11:04:22.257456 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:22.260581 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_4f63e7af_7ff6_449a_a3f7_f8e7b1b8ff20`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m11:04:22.265848 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f63e7af-7ff6-449a-a3f7-f8e7b1b8ff20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd96d9e070>]}
[0m11:04:22.267989 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_4f63e7af_7ff6_449a_a3f7_f8e7b1b8ff20`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m11:04:22.272515 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.08s]
[0m11:04:22.277283 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m11:04:22.299486 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:04:22.304292 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_4f63e7af_7ff6_449a_a3f7_f8e7b1b8ff20`)
      
    ...
[0m11:04:22.309289 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:04:22.348266 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_4f63e7af_7ff6_449a_a3f7_f8e7b1b8ff20`)
      
    ...
[0m11:04:22.373800 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m11:04:22.376616 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:04:22.386497 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:04:22.400486 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m11:04:22.409444 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:22.411490 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:22.445795 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_4f63e7af_7ff6_449a_a3f7_f8e7b1b8ff20` 
    ...
[0m11:04:22.451417 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_4f63e7af_7ff6_449a_a3f7_f8e7b1b8ff20` 
    ...
[0m11:04:22.462630 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:22.465181 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:22.477149 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_4f63e7af_7ff6_449a_a3f7_f8e7b1b8ff20` 
  ...
[0m11:04:22.489507 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_4f63e7af_7ff6_449a_a3f7_f8e7b1b8ff20` 
  ...
[0m11:04:22.545633 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m11:04:22.547616 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m11:04:22.559753 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m11:04:22.572414 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m11:04:22.578341 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:04:22.585325 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f63e7af-7ff6-449a-a3f7-f8e7b1b8ff20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd975b0a30>]}
[0m11:04:22.587807 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:04:22.590294 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.40s]
[0m11:04:22.648577 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f63e7af-7ff6-449a-a3f7-f8e7b1b8ff20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd96d8d850>]}
[0m11:04:22.651451 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m11:04:22.654140 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.47s]
[0m11:04:22.657679 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m11:04:22.661607 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:04:22.662740 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m11:04:22.663924 [debug] [MainThread]: On list__clean: Close
[0m11:04:22.664999 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m11:04:22.666111 [debug] [MainThread]: On list__mart: Close
[0m11:04:22.667186 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m11:04:22.668293 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m11:04:22.669360 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m11:04:22.670475 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m11:04:22.671579 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m11:04:22.672765 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m11:04:22.673805 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m11:04:22.674974 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m11:04:22.677180 [info ] [MainThread]: 
[0m11:04:22.678565 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.31 seconds (3.31s).
[0m11:04:22.686529 [debug] [MainThread]: Command end result
[0m11:04:22.889680 [info ] [MainThread]: 
[0m11:04:22.890896 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:04:22.891744 [info ] [MainThread]: 
[0m11:04:22.892641 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m11:04:22.946047 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.5941143, "process_in_blocks": "0", "process_kernel_time": 0.602753, "process_mem_max_rss": "114592", "process_out_blocks": "9744", "process_user_time": 5.800752}
[0m11:04:22.948519 [debug] [MainThread]: Command `dbt build` succeeded at 11:04:22.947940 after 6.60 seconds
[0m11:04:22.950429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd9b61c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd9a96b8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71dd97947700>]}
[0m11:04:22.952252 [debug] [MainThread]: Flushing usage events
