[0m08:12:25.675608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16213f0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f161e051af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f161e0519a0>]}


============================== 08:12:25.685682 | e061b0be-5b36-4441-8234-6cda140ba967 ==============================
[0m08:12:25.685682 [info ] [MainThread]: Running with dbt=1.8.9
[0m08:12:25.686740 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'empty': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'fail_fast': 'False', 'introspect': 'True', 'debug': 'False', 'log_path': '/workdir/transforms/02_chinook/logs', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_experimental_parser': 'False', 'warn_error': 'None', 'use_colors': 'True', 'quiet': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '.', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'version_check': 'True', 'printer_width': '80', 'log_format': 'default'}
[0m08:12:26.225884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e061b0be-5b36-4441-8234-6cda140ba967', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1620997fd0>]}
[0m08:12:26.414257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e061b0be-5b36-4441-8234-6cda140ba967', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f161e01abe0>]}
[0m08:12:26.416010 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m08:12:26.886038 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m08:12:26.887403 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m08:12:26.888099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e061b0be-5b36-4441-8234-6cda140ba967', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f161dcf31c0>]}
[0m08:12:31.808527 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.ex_01_mpg.stg_chinook__album.sql' (models/clean/stg_chinook__album.sql.sql) depends on a source named 'chinook.albums' which was not found
[0m08:12:31.810992 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 6.3323393, "process_in_blocks": "2816", "process_kernel_time": 0.545969, "process_mem_max_rss": "100432", "process_out_blocks": "6616", "process_user_time": 5.998663}
[0m08:12:31.811740 [debug] [MainThread]: Command `dbt build` failed at 08:12:31.811528 after 6.33 seconds
[0m08:12:31.812370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16213f0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f161df36580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f161df369a0>]}
[0m08:12:31.812979 [debug] [MainThread]: Flushing usage events
[0m08:15:44.751396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09ff80310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09cbdea90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09cbde940>]}


============================== 08:15:44.760627 | 9a85211f-b6ad-4538-81e1-ca33b1791f09 ==============================
[0m08:15:44.760627 [info ] [MainThread]: Running with dbt=1.8.9
[0m08:15:44.761801 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'empty': 'False', 'static_parser': 'True', 'warn_error': 'None', 'profiles_dir': '.', 'partial_parse': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'write_json': 'True', 'indirect_selection': 'eager', 'version_check': 'True', 'introspect': 'True', 'no_print': 'None', 'log_format': 'default', 'target_path': 'None', 'debug': 'False', 'log_path': '/workdir/transforms/02_chinook/logs', 'fail_fast': 'False', 'quiet': 'False', 'use_colors': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'send_anonymous_usage_stats': 'True'}
[0m08:15:45.373139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9a85211f-b6ad-4538-81e1-ca33b1791f09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09cae1a30>]}
[0m08:15:45.566646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9a85211f-b6ad-4538-81e1-ca33b1791f09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09d02f250>]}
[0m08:15:45.567889 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m08:15:46.026707 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m08:15:46.028122 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m08:15:46.028830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '9a85211f-b6ad-4538-81e1-ca33b1791f09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09c8807c0>]}
[0m08:15:50.341294 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.ex_02_chinook.dim_album' (models/mart/dim_album.sql) depends on a node named 'stg_chinook__album' which was not found
[0m08:15:50.342913 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 5.7825723, "process_in_blocks": "26968", "process_kernel_time": 0.616956, "process_mem_max_rss": "100444", "process_out_blocks": "6624", "process_user_time": 5.770411}
[0m08:15:50.343652 [debug] [MainThread]: Command `dbt build` failed at 08:15:50.343432 after 5.78 seconds
[0m08:15:50.344297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09ff80310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09bf64220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c09c5d3880>]}
[0m08:15:50.344888 [debug] [MainThread]: Flushing usage events
[0m08:16:16.719791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a69ab310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a360ba90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a360b940>]}


============================== 08:16:16.729086 | 44b6ec08-02b4-422e-b9e6-aaeb9fd15429 ==============================
[0m08:16:16.729086 [info ] [MainThread]: Running with dbt=1.8.9
[0m08:16:16.730200 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'indirect_selection': 'eager', 'version_check': 'True', 'log_format': 'default', 'write_json': 'True', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'warn_error': 'None', 'empty': 'False', 'use_colors': 'True', 'log_path': '/workdir/transforms/02_chinook/logs', 'no_print': 'None', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'quiet': 'False', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:16:17.317044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '44b6ec08-02b4-422e-b9e6-aaeb9fd15429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a5f53fd0>]}
[0m08:16:17.508771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '44b6ec08-02b4-422e-b9e6-aaeb9fd15429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a40f1430>]}
[0m08:16:17.510035 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m08:16:17.931558 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m08:16:17.933094 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m08:16:17.933798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '44b6ec08-02b4-422e-b9e6-aaeb9fd15429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a32a0ee0>]}
[0m08:16:22.613563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '44b6ec08-02b4-422e-b9e6-aaeb9fd15429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a32a0100>]}
[0m08:16:23.020605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '44b6ec08-02b4-422e-b9e6-aaeb9fd15429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a28df430>]}
[0m08:16:23.021460 [info ] [MainThread]: Found 4 models, 2 sources, 471 macros
[0m08:16:23.024414 [info ] [MainThread]: 
[0m08:16:23.025440 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m08:16:23.038138 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m08:16:23.045093 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m08:16:23.201277 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:16:23.202900 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:16:23.768465 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m08:16:23.796168 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m08:16:23.799628 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m08:16:23.807309 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:16:23.905579 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now create__staging)
[0m08:16:23.907226 [debug] [ThreadPool]: Creating schema "schema: "staging"
"
[0m08:16:23.922357 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create__staging, now list__mart)
[0m08:16:23.923981 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__staging)
[0m08:16:23.940565 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m08:16:24.002063 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__staging: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__staging"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'staging'
      

  ...
[0m08:16:24.013872 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:16:24.016045 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:16:24.024554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '44b6ec08-02b4-422e-b9e6-aaeb9fd15429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a5dc8940>]}
[0m08:16:24.026317 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m08:16:24.027394 [info ] [MainThread]: 
[0m08:16:24.099001 [debug] [Thread-1  ]: Began running node model.ex_02_chinook.stg_chinook__album
[0m08:16:24.100323 [info ] [Thread-1  ]: 1 of 4 START sql view model `staging`.`stg_chinook__album` ..................... [RUN]
[0m08:16:24.101329 [debug] [Thread-2  ]: Began running node model.ex_02_chinook.stg_chinook__artist
[0m08:16:24.102199 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_02_chinook.stg_chinook__album)
[0m08:16:24.103314 [info ] [Thread-2  ]: 2 of 4 START sql view model `staging`.`stg_chinook__artist` .................... [RUN]
[0m08:16:24.104282 [debug] [Thread-1  ]: Began compiling node model.ex_02_chinook.stg_chinook__album
[0m08:16:24.105385 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.stg_chinook__artist'
[0m08:16:24.125324 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_02_chinook.stg_chinook__album"
[0m08:16:24.126224 [debug] [Thread-2  ]: Began compiling node model.ex_02_chinook.stg_chinook__artist
[0m08:16:24.132324 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_02_chinook.stg_chinook__artist"
[0m08:16:24.133370 [debug] [Thread-1  ]: Began executing node model.ex_02_chinook.stg_chinook__album
[0m08:16:24.199793 [debug] [Thread-2  ]: Began executing node model.ex_02_chinook.stg_chinook__artist
[0m08:16:24.308784 [debug] [Thread-1  ]: Creating new relation stg_chinook__album
[0m08:16:24.422360 [debug] [Thread-2  ]: Creating new relation stg_chinook__artist
[0m08:16:24.512026 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_02_chinook.stg_chinook__album"
[0m08:16:24.514001 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m08:16:24.517250 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */


  create view `staging`.`stg_chinook__album` 
  
    
    
  as (
    

-- Keep album grain; standardize names/types.
select
  cast(album_id  as Nullable(Int64))      as album_id,
  cast(title     as Nullable(String))     as album_title,
  cast(artist_id as Nullable(Int64))      as artist_id
from `raw`.`albums`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:16:24.522964 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */


  create view `staging`.`stg_chinook__album` 
  
    
    
  as (
    

-- Keep album grain; standardize names/types.
select
  cast(album_id  as Nullable(Int64))      as album_id,
  cast(title     as Nullable(String))     as album_title,
  cast(artist_id as Nullable(Int64))      as artist_id
from `raw`.`albums`
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m08:16:24.604943 [debug] [Thread-1  ]: Database Error in model stg_chinook__album (models/clean/stg_chinook__album.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 497
   Code: 497. DB::Exception: ftw_user: Not enough privileges. To execute this query, it's necessary to have the grant CREATE VIEW ON staging.stg_chinook__album. (ACCESS_DENIED) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_02_chinook/models/clean/stg_chinook__album.sql
[0m08:16:24.610776 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44b6ec08-02b4-422e-b9e6-aaeb9fd15429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a24903d0>]}
[0m08:16:24.613244 [error] [Thread-1  ]: 1 of 4 ERROR creating sql view model `staging`.`stg_chinook__album` ............ [[31mERROR[0m in 0.50s]
[0m08:16:24.616098 [debug] [Thread-1  ]: Finished running node model.ex_02_chinook.stg_chinook__album
[0m08:16:24.646038 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_02_chinook.stg_chinook__artist"
[0m08:16:24.648376 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */


  create view `staging`.`stg_chinook__artist` 
  
    
    
  as (
    

-- Standardize column names/types per table; no business logic.
select
  cast(artist_id as Nullable(Int64))      as artist_id,
  cast(name      as Nullable(String))     as artist_name
from `raw`.`artists`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:16:24.654667 [debug] [Thread-2  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */


  create view `staging`.`stg_chinook__artist` 
  
    
    
  as (
    

-- Standardize column names/types per table; no business logic.
select
  cast(artist_id as Nullable(Int64))      as artist_id,
  cast(name      as Nullable(String))     as artist_name
from `raw`.`artists`
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m08:16:24.658343 [debug] [Thread-2  ]: Database Error in model stg_chinook__artist (models/clean/stg_chinook__artist.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 497
   Code: 497. DB::Exception: ftw_user: Not enough privileges. To execute this query, it's necessary to have the grant CREATE VIEW ON staging.stg_chinook__artist. (ACCESS_DENIED) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_02_chinook/models/clean/stg_chinook__artist.sql
[0m08:16:24.659818 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44b6ec08-02b4-422e-b9e6-aaeb9fd15429', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a263a940>]}
[0m08:16:24.695519 [error] [Thread-2  ]: 2 of 4 ERROR creating sql view model `staging`.`stg_chinook__artist` ........... [[31mERROR[0m in 0.55s]
[0m08:16:24.697804 [debug] [Thread-2  ]: Finished running node model.ex_02_chinook.stg_chinook__artist
[0m08:16:24.699813 [debug] [Thread-4  ]: Began running node model.ex_02_chinook.dim_album
[0m08:16:24.700799 [debug] [Thread-3  ]: Began running node model.ex_02_chinook.dim_artist
[0m08:16:24.701963 [info ] [Thread-4  ]: 3 of 4 SKIP relation mart.dim_album ............................................ [[33mSKIP[0m]
[0m08:16:24.703164 [info ] [Thread-3  ]: 4 of 4 SKIP relation mart.dim_artist ........................................... [[33mSKIP[0m]
[0m08:16:24.704378 [debug] [Thread-4  ]: Finished running node model.ex_02_chinook.dim_album
[0m08:16:24.705496 [debug] [Thread-3  ]: Finished running node model.ex_02_chinook.dim_artist
[0m08:16:24.708055 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:16:24.708740 [debug] [MainThread]: Connection 'model.ex_02_chinook.stg_chinook__album' was left open.
[0m08:16:24.709328 [debug] [MainThread]: On model.ex_02_chinook.stg_chinook__album: Close
[0m08:16:24.709903 [debug] [MainThread]: Connection 'list__staging' was left open.
[0m08:16:24.710452 [debug] [MainThread]: On list__staging: Close
[0m08:16:24.711003 [debug] [MainThread]: Connection 'model.ex_02_chinook.stg_chinook__artist' was left open.
[0m08:16:24.711564 [debug] [MainThread]: On model.ex_02_chinook.stg_chinook__artist: Close
[0m08:16:24.712589 [info ] [MainThread]: 
[0m08:16:24.713298 [info ] [MainThread]: Finished running 2 view models, 2 table models in 0 hours 0 minutes and 1.69 seconds (1.69s).
[0m08:16:24.715524 [debug] [MainThread]: Command end result
[0m08:16:24.819373 [info ] [MainThread]: 
[0m08:16:24.820694 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m08:16:24.821676 [info ] [MainThread]: 
[0m08:16:24.823115 [error] [MainThread]:   Database Error in model stg_chinook__album (models/clean/stg_chinook__album.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 497
   Code: 497. DB::Exception: ftw_user: Not enough privileges. To execute this query, it's necessary to have the grant CREATE VIEW ON staging.stg_chinook__album. (ACCESS_DENIED) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_02_chinook/models/clean/stg_chinook__album.sql
[0m08:16:24.823874 [info ] [MainThread]: 
[0m08:16:24.824828 [error] [MainThread]:   Database Error in model stg_chinook__artist (models/clean/stg_chinook__artist.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 497
   Code: 497. DB::Exception: ftw_user: Not enough privileges. To execute this query, it's necessary to have the grant CREATE VIEW ON staging.stg_chinook__artist. (ACCESS_DENIED) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_02_chinook/models/clean/stg_chinook__artist.sql
[0m08:16:24.825654 [info ] [MainThread]: 
[0m08:16:24.826506 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=2 TOTAL=4
[0m08:16:24.828071 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 8.303202, "process_in_blocks": "6024", "process_kernel_time": 0.663966, "process_mem_max_rss": "114932", "process_out_blocks": "10536", "process_user_time": 6.875945}
[0m08:16:24.829117 [debug] [MainThread]: Command `dbt build` failed at 08:16:24.828903 after 8.30 seconds
[0m08:16:24.829810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a69ab310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a2834100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7090a5f53fd0>]}
[0m08:16:24.830395 [debug] [MainThread]: Flushing usage events
[0m08:19:17.613903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4f428310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4c087b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4c087a00>]}


============================== 08:19:17.673658 | 8c4bdebb-67b8-46b6-8115-8773f345dd57 ==============================
[0m08:19:17.673658 [info ] [MainThread]: Running with dbt=1.8.9
[0m08:19:17.674815 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True', 'profiles_dir': '.', 'version_check': 'True', 'partial_parse': 'True', 'log_path': '/workdir/transforms/02_chinook/logs', 'log_format': 'default', 'static_parser': 'True', 'fail_fast': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'no_print': 'None', 'warn_error': 'None', 'quiet': 'False', 'introspect': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'use_colors': 'True'}
[0m08:19:18.204478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8c4bdebb-67b8-46b6-8115-8773f345dd57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4f62a160>]}
[0m08:19:18.397593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8c4bdebb-67b8-46b6-8115-8773f345dd57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4c0788e0>]}
[0m08:19:18.398815 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m08:19:18.877796 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m08:19:19.294009 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m08:19:19.294981 [debug] [MainThread]: Partial parsing: updated file: ex_02_chinook://models/clean/stg_chinook__artist.sql
[0m08:19:19.295653 [debug] [MainThread]: Partial parsing: updated file: ex_02_chinook://models/clean/stg_chinook__album.sql
[0m08:19:20.170846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8c4bdebb-67b8-46b6-8115-8773f345dd57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4b458130>]}
[0m08:19:20.526413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8c4bdebb-67b8-46b6-8115-8773f345dd57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4b27d0a0>]}
[0m08:19:20.527278 [info ] [MainThread]: Found 4 models, 2 sources, 471 macros
[0m08:19:20.530252 [info ] [MainThread]: 
[0m08:19:20.531431 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m08:19:20.578367 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m08:19:20.590124 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m08:19:20.682830 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:19:20.681822 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:19:21.357610 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m08:19:21.375724 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m08:19:21.379754 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:19:21.384022 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:19:21.618177 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m08:19:21.624581 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m08:19:21.683940 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m08:19:21.689562 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m08:19:21.698422 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:19:21.703874 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:19:21.709753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c4bdebb-67b8-46b6-8115-8773f345dd57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4e842970>]}
[0m08:19:21.711492 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m08:19:21.712890 [info ] [MainThread]: 
[0m08:19:21.787891 [debug] [Thread-1  ]: Began running node model.ex_02_chinook.stg_chinook__album
[0m08:19:21.788764 [debug] [Thread-2  ]: Began running node model.ex_02_chinook.stg_chinook__artist
[0m08:19:21.789846 [info ] [Thread-1  ]: 1 of 4 START sql view model `clean`.`stg_chinook__album` ....................... [RUN]
[0m08:19:21.790964 [info ] [Thread-2  ]: 2 of 4 START sql view model `clean`.`stg_chinook__artist` ...................... [RUN]
[0m08:19:21.792128 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.stg_chinook__album'
[0m08:19:21.793096 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.stg_chinook__artist'
[0m08:19:21.793885 [debug] [Thread-1  ]: Began compiling node model.ex_02_chinook.stg_chinook__album
[0m08:19:21.794648 [debug] [Thread-2  ]: Began compiling node model.ex_02_chinook.stg_chinook__artist
[0m08:19:21.812780 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_02_chinook.stg_chinook__album"
[0m08:19:21.872382 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_02_chinook.stg_chinook__artist"
[0m08:19:21.874762 [debug] [Thread-1  ]: Began executing node model.ex_02_chinook.stg_chinook__album
[0m08:19:21.876600 [debug] [Thread-2  ]: Began executing node model.ex_02_chinook.stg_chinook__artist
[0m08:19:22.203849 [debug] [Thread-2  ]: Creating new relation stg_chinook__artist
[0m08:19:22.206353 [debug] [Thread-1  ]: Creating new relation stg_chinook__album
[0m08:19:22.374089 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m08:19:22.379606 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m08:19:22.547804 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_02_chinook.stg_chinook__album"
[0m08:19:22.571480 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_02_chinook.stg_chinook__artist"
[0m08:19:22.573197 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */


  create view `clean`.`stg_chinook__album` 
  
    
    
  as (
    

-- Keep album grain; standardize names/types.
select
  cast(album_id  as Nullable(Int64))      as album_id,
  cast(title     as Nullable(String))     as album_title,
  cast(artist_id as Nullable(Int64))      as artist_id
from `raw`.`albums`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:19:22.577101 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */


  create view `clean`.`stg_chinook__artist` 
  
    
    
  as (
    

-- Standardize column names/types per table; no business logic.
select
  cast(artist_id as Nullable(Int64))      as artist_id,
  cast(name      as Nullable(String))     as artist_name
from `raw`.`artists`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:19:22.581635 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */


  create view `clean`.`stg_chinook__album` 
  
    
    
  as (
    

-- Keep album grain; standardize names/types.
select
  cast(album_id  as Nullable(Int64))      as album_id,
  cast(title     as Nullable(String))     as album_title,
  cast(artist_id as Nullable(Int64))      as artist_id
from `raw`.`albums`
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m08:19:22.585706 [debug] [Thread-2  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */


  create view `clean`.`stg_chinook__artist` 
  
    
    
  as (
    

-- Standardize column names/types per table; no business logic.
select
  cast(artist_id as Nullable(Int64))      as artist_id,
  cast(name      as Nullable(String))     as artist_name
from `raw`.`artists`
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m08:19:22.595861 [debug] [Thread-2  ]: Database Error in model stg_chinook__artist (models/clean/stg_chinook__artist.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 60
   Code: 60. DB::Exception: Table raw.artists does not exist. (UNKNOWN_TABLE) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_02_chinook/models/clean/stg_chinook__artist.sql
[0m08:19:22.597171 [debug] [Thread-1  ]: Database Error in model stg_chinook__album (models/clean/stg_chinook__album.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 60
   Code: 60. DB::Exception: Table raw.albums does not exist. (UNKNOWN_TABLE) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_02_chinook/models/clean/stg_chinook__album.sql
[0m08:19:22.600523 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c4bdebb-67b8-46b6-8115-8773f345dd57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4c140550>]}
[0m08:19:22.601424 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c4bdebb-67b8-46b6-8115-8773f345dd57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4b82ae20>]}
[0m08:19:22.602824 [error] [Thread-2  ]: 2 of 4 ERROR creating sql view model `clean`.`stg_chinook__artist` ............. [[31mERROR[0m in 0.81s]
[0m08:19:22.604166 [error] [Thread-1  ]: 1 of 4 ERROR creating sql view model `clean`.`stg_chinook__album` .............. [[31mERROR[0m in 0.81s]
[0m08:19:22.605662 [debug] [Thread-2  ]: Finished running node model.ex_02_chinook.stg_chinook__artist
[0m08:19:22.607050 [debug] [Thread-1  ]: Finished running node model.ex_02_chinook.stg_chinook__album
[0m08:19:22.608443 [debug] [Thread-4  ]: Began running node model.ex_02_chinook.dim_artist
[0m08:19:22.609445 [debug] [Thread-2  ]: Began running node model.ex_02_chinook.dim_album
[0m08:19:22.610411 [info ] [Thread-4  ]: 3 of 4 SKIP relation mart.dim_artist ........................................... [[33mSKIP[0m]
[0m08:19:22.611459 [info ] [Thread-2  ]: 4 of 4 SKIP relation mart.dim_album ............................................ [[33mSKIP[0m]
[0m08:19:22.612578 [debug] [Thread-4  ]: Finished running node model.ex_02_chinook.dim_artist
[0m08:19:22.613736 [debug] [Thread-2  ]: Finished running node model.ex_02_chinook.dim_album
[0m08:19:22.616107 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:19:22.670286 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m08:19:22.671608 [debug] [MainThread]: On list__mart: Close
[0m08:19:22.672673 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m08:19:22.673820 [debug] [MainThread]: On list__clean: Close
[0m08:19:22.674868 [debug] [MainThread]: Connection 'model.ex_02_chinook.stg_chinook__album' was left open.
[0m08:19:22.675944 [debug] [MainThread]: On model.ex_02_chinook.stg_chinook__album: Close
[0m08:19:22.676987 [debug] [MainThread]: Connection 'model.ex_02_chinook.stg_chinook__artist' was left open.
[0m08:19:22.678103 [debug] [MainThread]: On model.ex_02_chinook.stg_chinook__artist: Close
[0m08:19:22.680196 [info ] [MainThread]: 
[0m08:19:22.681584 [info ] [MainThread]: Finished running 2 view models, 2 table models in 0 hours 0 minutes and 2.15 seconds (2.15s).
[0m08:19:22.685633 [debug] [MainThread]: Command end result
[0m08:19:22.890051 [info ] [MainThread]: 
[0m08:19:22.890909 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m08:19:22.891488 [info ] [MainThread]: 
[0m08:19:22.892299 [error] [MainThread]:   Database Error in model stg_chinook__artist (models/clean/stg_chinook__artist.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 60
   Code: 60. DB::Exception: Table raw.artists does not exist. (UNKNOWN_TABLE) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_02_chinook/models/clean/stg_chinook__artist.sql
[0m08:19:22.892913 [info ] [MainThread]: 
[0m08:19:22.893672 [error] [MainThread]:   Database Error in model stg_chinook__album (models/clean/stg_chinook__album.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 60
   Code: 60. DB::Exception: Table raw.albums does not exist. (UNKNOWN_TABLE) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_02_chinook/models/clean/stg_chinook__album.sql
[0m08:19:22.894285 [info ] [MainThread]: 
[0m08:19:22.894915 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=2 TOTAL=4
[0m08:19:22.896186 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 5.477993, "process_in_blocks": "0", "process_kernel_time": 0.673751, "process_mem_max_rss": "113764", "process_out_blocks": "10528", "process_user_time": 5.503464}
[0m08:19:22.896924 [debug] [MainThread]: Command `dbt build` failed at 08:19:22.896735 after 5.48 seconds
[0m08:19:22.897572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4f428310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4a5edb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7def4a5ed070>]}
[0m08:19:22.898169 [debug] [MainThread]: Flushing usage events
[0m08:20:40.300161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00e2f4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00af54a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00af54940>]}


============================== 08:20:40.309940 | ca3928e3-8b26-4980-8ffd-f2756d224eb2 ==============================
[0m08:20:40.309940 [info ] [MainThread]: Running with dbt=1.8.9
[0m08:20:40.311269 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'warn_error': 'None', 'profiles_dir': '.', 'use_experimental_parser': 'False', 'use_colors': 'True', 'write_json': 'True', 'log_format': 'default', 'version_check': 'True', 'indirect_selection': 'eager', 'empty': 'False', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'quiet': 'False', 'debug': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'partial_parse': 'True', 'target_path': 'None', 'log_path': '/workdir/transforms/02_chinook/logs', 'no_print': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'static_parser': 'True'}
[0m08:20:40.891663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00af311f0>]}
[0m08:20:41.085867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00b052d00>]}
[0m08:20:41.087119 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m08:20:41.502856 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m08:20:41.972868 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m08:20:41.974362 [debug] [MainThread]: Partial parsing: updated file: ex_02_chinook://models/sources.yml
[0m08:20:41.974964 [debug] [MainThread]: Partial parsing: updated file: ex_02_chinook://models/clean/stg_chinook__artist.sql
[0m08:20:41.975523 [debug] [MainThread]: Partial parsing: updated file: ex_02_chinook://models/clean/stg_chinook__album.sql
[0m08:20:43.096278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00a01cee0>]}
[0m08:20:43.491702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c009f18220>]}
[0m08:20:43.492543 [info ] [MainThread]: Found 4 models, 2 sources, 471 macros
[0m08:20:43.495455 [info ] [MainThread]: 
[0m08:20:43.496522 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m08:20:43.509564 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m08:20:43.510757 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m08:20:43.586583 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:20:43.588045 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:20:44.239470 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m08:20:44.244323 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m08:20:44.245862 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:20:44.249381 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m08:20:44.288974 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m08:20:44.290020 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m08:20:44.301653 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m08:20:44.306180 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m08:20:44.312351 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:20:44.315750 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:20:44.320164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c009b1f130>]}
[0m08:20:44.371669 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m08:20:44.373138 [info ] [MainThread]: 
[0m08:20:44.400074 [debug] [Thread-1  ]: Began running node model.ex_02_chinook.stg_chinook__album
[0m08:20:44.400982 [debug] [Thread-2  ]: Began running node model.ex_02_chinook.stg_chinook__artist
[0m08:20:44.402006 [info ] [Thread-1  ]: 1 of 4 START sql view model `clean`.`stg_chinook__album` ....................... [RUN]
[0m08:20:44.403070 [info ] [Thread-2  ]: 2 of 4 START sql view model `clean`.`stg_chinook__artist` ...................... [RUN]
[0m08:20:44.404009 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__clean, now model.ex_02_chinook.stg_chinook__album)
[0m08:20:44.405038 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.stg_chinook__artist'
[0m08:20:44.405809 [debug] [Thread-1  ]: Began compiling node model.ex_02_chinook.stg_chinook__album
[0m08:20:44.406684 [debug] [Thread-2  ]: Began compiling node model.ex_02_chinook.stg_chinook__artist
[0m08:20:44.474089 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_02_chinook.stg_chinook__album"
[0m08:20:44.486579 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_02_chinook.stg_chinook__artist"
[0m08:20:44.488377 [debug] [Thread-1  ]: Began executing node model.ex_02_chinook.stg_chinook__album
[0m08:20:44.510160 [debug] [Thread-2  ]: Began executing node model.ex_02_chinook.stg_chinook__artist
[0m08:20:44.609845 [debug] [Thread-1  ]: Creating new relation stg_chinook__album
[0m08:20:44.619888 [debug] [Thread-2  ]: Creating new relation stg_chinook__artist
[0m08:20:44.776702 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m08:20:44.775373 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_02_chinook.stg_chinook__album"
[0m08:20:44.781578 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */


  create view `clean`.`stg_chinook__album` 
  
    
    
  as (
    

-- Keep album grain; standardize names/types.
select
  cast(album_id  as Nullable(Int64))      as album_id,
  cast(title     as Nullable(String))     as album_title,
  cast(artist_id as Nullable(Int64))      as artist_id
from `raw`.`chinook___albums`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:20:44.806984 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m08:20:44.988754 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00d8a1520>]}
[0m08:20:44.993420 [info ] [Thread-1  ]: 1 of 4 OK created sql view model `clean`.`stg_chinook__album` .................. [[32mOK[0m in 0.58s]
[0m08:20:44.995895 [debug] [Thread-1  ]: Finished running node model.ex_02_chinook.stg_chinook__album
[0m08:20:45.031615 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_02_chinook.stg_chinook__artist"
[0m08:20:45.033472 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */


  create view `clean`.`stg_chinook__artist` 
  
    
    
  as (
    

-- Standardize column names/types per table; no business logic.
select
  cast(artist_id as Nullable(Int64))      as artist_id,
  cast(name      as Nullable(String))     as artist_name
from `raw`.`chinook___artists`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:20:45.044272 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:20:45.048808 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c009ba17c0>]}
[0m08:20:45.050842 [info ] [Thread-2  ]: 2 of 4 OK created sql view model `clean`.`stg_chinook__artist` ................. [[32mOK[0m in 0.64s]
[0m08:20:45.052970 [debug] [Thread-2  ]: Finished running node model.ex_02_chinook.stg_chinook__artist
[0m08:20:45.073006 [debug] [Thread-4  ]: Began running node model.ex_02_chinook.dim_album
[0m08:20:45.075013 [debug] [Thread-3  ]: Began running node model.ex_02_chinook.dim_artist
[0m08:20:45.077652 [info ] [Thread-4  ]: 3 of 4 START sql table model `mart`.`dim_album` ................................ [RUN]
[0m08:20:45.080652 [info ] [Thread-3  ]: 4 of 4 START sql table model `mart`.`dim_artist` ............................... [RUN]
[0m08:20:45.083585 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.dim_album'
[0m08:20:45.086025 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.dim_artist'
[0m08:20:45.087841 [debug] [Thread-4  ]: Began compiling node model.ex_02_chinook.dim_album
[0m08:20:45.089661 [debug] [Thread-3  ]: Began compiling node model.ex_02_chinook.dim_artist
[0m08:20:45.109191 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_02_chinook.dim_album"
[0m08:20:45.116625 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_02_chinook.dim_artist"
[0m08:20:45.119019 [debug] [Thread-3  ]: Began executing node model.ex_02_chinook.dim_artist
[0m08:20:45.171312 [debug] [Thread-4  ]: Began executing node model.ex_02_chinook.dim_album
[0m08:20:45.312238 [debug] [Thread-3  ]: Creating new relation dim_artist
[0m08:20:45.390231 [debug] [Thread-4  ]: Creating new relation dim_album
[0m08:20:45.781614 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m08:20:45.783578 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m08:20:45.971749 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_album"} */

            

    
        create table `mart`.`dim_album`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Album dimension, denormalized with artist_name (common convenience).
with album as (
  select * from `clean`.`stg_chinook__album`
),
artist as (
  select * from `clean`.`stg_chinook__artist`
)
select
  a.album_id,
  a.album_title,
  a.artist_id,
  ar.artist_name
from album a
left join artist ar
  on ar.artist_id = a.artist_id
          )
        
        ...
[0m08:20:45.980550 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_artist"} */

            

    
        create table `mart`.`dim_artist`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Simple conformed dimension for artists.
select
  artist_id,
  artist_name
from `clean`.`stg_chinook__artist`
          )
        
        ...
[0m08:20:46.002438 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m08:20:46.016636 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m08:20:46.026945 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_album"} */

    select name, type from system.columns where table = 'dim_album'
    
      and database = 'mart'
    
    order by position
  ...
[0m08:20:46.030458 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_artist"} */

    select name, type from system.columns where table = 'dim_artist'
    
      and database = 'mart'
    
    order by position
  ...
[0m08:20:46.037405 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:20:46.073191 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m08:20:46.085919 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_02_chinook.dim_album"
[0m08:20:46.091066 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_02_chinook.dim_artist"
[0m08:20:46.094010 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_album"} */

  
    
    
    
        
         


        insert into `mart`.`dim_album`
        ("album_id", "album_title", "artist_id", "artist_name")

-- Album dimension, denormalized with artist_name (common convenience).
with album as (
  select * from `clean`.`stg_chinook__album`
),
artist as (
  select * from `clean`.`stg_chinook__artist`
)
select
  a.album_id,
  a.album_title,
  a.artist_id,
  ar.artist_name
from album a
left join artist ar
  on ar.artist_id = a.artist_id
  ...
[0m08:20:46.096223 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_artist"} */

  
    
    
    
        
         


        insert into `mart`.`dim_artist`
        ("artist_id", "artist_name")

-- Simple conformed dimension for artists.
select
  artist_id,
  artist_name
from `clean`.`stg_chinook__artist`
  ...
[0m08:20:46.107633 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:20:46.115448 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00ac3bd90>]}
[0m08:20:46.117992 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m08:20:46.120417 [info ] [Thread-3  ]: 4 of 4 OK created sql table model `mart`.`dim_artist` .......................... [[32mOK[0m in 1.03s]
[0m08:20:46.174041 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca3928e3-8b26-4980-8ffd-f2756d224eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c009ba66a0>]}
[0m08:20:46.176895 [debug] [Thread-3  ]: Finished running node model.ex_02_chinook.dim_artist
[0m08:20:46.179987 [info ] [Thread-4  ]: 3 of 4 OK created sql table model `mart`.`dim_album` ........................... [[32mOK[0m in 1.09s]
[0m08:20:46.183405 [debug] [Thread-4  ]: Finished running node model.ex_02_chinook.dim_album
[0m08:20:46.187441 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:20:46.188674 [debug] [MainThread]: Connection 'model.ex_02_chinook.stg_chinook__album' was left open.
[0m08:20:46.190007 [debug] [MainThread]: On model.ex_02_chinook.stg_chinook__album: Close
[0m08:20:46.191091 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m08:20:46.192166 [debug] [MainThread]: On list__mart: Close
[0m08:20:46.193209 [debug] [MainThread]: Connection 'model.ex_02_chinook.stg_chinook__artist' was left open.
[0m08:20:46.194288 [debug] [MainThread]: On model.ex_02_chinook.stg_chinook__artist: Close
[0m08:20:46.195328 [debug] [MainThread]: Connection 'model.ex_02_chinook.dim_album' was left open.
[0m08:20:46.196486 [debug] [MainThread]: On model.ex_02_chinook.dim_album: Close
[0m08:20:46.197686 [debug] [MainThread]: Connection 'model.ex_02_chinook.dim_artist' was left open.
[0m08:20:46.198776 [debug] [MainThread]: On model.ex_02_chinook.dim_artist: Close
[0m08:20:46.200978 [info ] [MainThread]: 
[0m08:20:46.202340 [info ] [MainThread]: Finished running 2 view models, 2 table models in 0 hours 0 minutes and 2.70 seconds (2.70s).
[0m08:20:46.208280 [debug] [MainThread]: Command end result
[0m08:20:46.420286 [info ] [MainThread]: 
[0m08:20:46.472005 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:20:46.473300 [info ] [MainThread]: 
[0m08:20:46.474755 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m08:20:46.477595 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.3897505, "process_in_blocks": "0", "process_kernel_time": 0.586422, "process_mem_max_rss": "115652", "process_out_blocks": "10568", "process_user_time": 5.894728}
[0m08:20:46.479436 [debug] [MainThread]: Command `dbt build` succeeded at 08:20:46.478977 after 6.39 seconds
[0m08:20:46.480768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00e2f4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c009f18220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c00b880670>]}
[0m08:20:46.482013 [debug] [MainThread]: Flushing usage events
[0m08:29:04.884448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a617ef40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a2e21a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a2e21940>]}


============================== 08:29:04.893949 | 4384ba45-b63c-4062-8002-7b173b60ec7c ==============================
[0m08:29:04.893949 [info ] [MainThread]: Running with dbt=1.8.9
[0m08:29:04.895002 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'profiles_dir': '.', 'version_check': 'True', 'empty': 'False', 'target_path': 'None', 'fail_fast': 'False', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'debug': 'False', 'introspect': 'True', 'quiet': 'False', 'use_colors': 'True', 'cache_selected_only': 'False', 'write_json': 'True', 'log_format': 'default', 'warn_error': 'None', 'no_print': 'None', 'log_path': '/workdir/transforms/02_chinook/logs'}
[0m08:29:05.474738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a56d9fd0>]}
[0m08:29:05.667716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a63db400>]}
[0m08:29:05.669033 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m08:29:06.088998 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m08:29:06.554063 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m08:29:06.554967 [debug] [MainThread]: Partial parsing: added file: ex_02_chinook://models/mart/vw_artist_album_counts.sql
[0m08:29:07.371371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a21cf130>]}
[0m08:29:07.764539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a205d6a0>]}
[0m08:29:07.765382 [info ] [MainThread]: Found 5 models, 2 sources, 471 macros
[0m08:29:07.768386 [info ] [MainThread]: 
[0m08:29:07.769624 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m08:29:07.783911 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m08:29:07.796159 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m08:29:07.870164 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:29:07.882215 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:29:08.511403 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m08:29:08.521000 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:08.552199 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m08:29:08.564515 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:08.766254 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m08:29:08.767306 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m08:29:08.778619 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m08:29:08.782568 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m08:29:08.788466 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:08.791711 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:08.796711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a1e31430>]}
[0m08:29:08.797632 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m08:29:08.798260 [info ] [MainThread]: 
[0m08:29:08.860547 [debug] [Thread-1  ]: Began running node model.ex_02_chinook.stg_chinook__album
[0m08:29:08.861499 [debug] [Thread-2  ]: Began running node model.ex_02_chinook.stg_chinook__artist
[0m08:29:08.862464 [info ] [Thread-1  ]: 1 of 5 START sql view model `clean`.`stg_chinook__album` ....................... [RUN]
[0m08:29:08.863681 [info ] [Thread-2  ]: 2 of 5 START sql view model `clean`.`stg_chinook__artist` ...................... [RUN]
[0m08:29:08.865198 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.stg_chinook__album'
[0m08:29:08.866478 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.stg_chinook__artist'
[0m08:29:08.867530 [debug] [Thread-1  ]: Began compiling node model.ex_02_chinook.stg_chinook__album
[0m08:29:08.868590 [debug] [Thread-2  ]: Began compiling node model.ex_02_chinook.stg_chinook__artist
[0m08:29:08.950326 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_02_chinook.stg_chinook__artist"
[0m08:29:08.897265 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_02_chinook.stg_chinook__album"
[0m08:29:08.953417 [debug] [Thread-2  ]: Began executing node model.ex_02_chinook.stg_chinook__artist
[0m08:29:08.954780 [debug] [Thread-1  ]: Began executing node model.ex_02_chinook.stg_chinook__album
[0m08:29:09.368932 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m08:29:09.375131 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m08:29:09.516324 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_02_chinook.stg_chinook__album"
[0m08:29:09.521274 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */


  create view `clean`.`stg_chinook__album__dbt_tmp` 
  
    
    
  as (
    

-- Keep album grain; standardize names/types.
select
  cast(album_id  as Nullable(Int64))      as album_id,
  cast(title     as Nullable(String))     as album_title,
  cast(artist_id as Nullable(Int64))      as artist_id
from `raw`.`chinook___albums`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:29:09.525436 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_02_chinook.stg_chinook__artist"
[0m08:29:09.528871 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */


  create view `clean`.`stg_chinook__artist__dbt_tmp` 
  
    
    
  as (
    

-- Standardize column names/types per table; no business logic.
select
  cast(artist_id as Nullable(Int64))      as artist_id,
  cast(name      as Nullable(String))     as artist_name
from `raw`.`chinook___artists`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:29:09.549228 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m08:29:09.575867 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m08:29:09.581631 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */

    drop table if exists `clean`.`stg_chinook__album__dbt_backup` 
  
  ...
[0m08:29:09.596067 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */

    drop table if exists `clean`.`stg_chinook__artist__dbt_backup` 
  
  ...
[0m08:29:09.652306 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m08:29:09.656807 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */

    rename table `clean`.`stg_chinook__album` to `clean`.`stg_chinook__album__dbt_backup` 
  
  ...
[0m08:29:09.661130 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:09.665373 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */

    rename table `clean`.`stg_chinook__artist` to `clean`.`stg_chinook__artist__dbt_backup` 
  
  ...
[0m08:29:09.670050 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:09.673004 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:09.687710 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */

    drop table if exists `clean`.`stg_chinook__album` 
  
  ...
[0m08:29:09.753242 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */

    drop table if exists `clean`.`stg_chinook__artist` 
  
  ...
[0m08:29:09.759510 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m08:29:09.763687 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */

    rename table `clean`.`stg_chinook__album__dbt_tmp` to `clean`.`stg_chinook__album` 
  
  ...
[0m08:29:09.768317 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:09.773381 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */

    rename table `clean`.`stg_chinook__artist__dbt_tmp` to `clean`.`stg_chinook__artist` 
  
  ...
[0m08:29:09.776030 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:09.793783 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m08:29:10.191901 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__artist"} */

    drop table if exists `clean`.`stg_chinook__artist__dbt_backup` 
  ...
[0m08:29:10.194981 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.stg_chinook__album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.stg_chinook__album"} */

    drop table if exists `clean`.`stg_chinook__album__dbt_backup` 
  ...
[0m08:29:10.252372 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m08:29:10.265487 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m08:29:10.269481 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a1d18fa0>]}
[0m08:29:10.274239 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a1d18880>]}
[0m08:29:10.276858 [info ] [Thread-2  ]: 2 of 5 OK created sql view model `clean`.`stg_chinook__artist` ................. [[32mOK[0m in 1.40s]
[0m08:29:10.279697 [info ] [Thread-1  ]: 1 of 5 OK created sql view model `clean`.`stg_chinook__album` .................. [[32mOK[0m in 1.41s]
[0m08:29:10.282717 [debug] [Thread-2  ]: Finished running node model.ex_02_chinook.stg_chinook__artist
[0m08:29:10.286087 [debug] [Thread-1  ]: Finished running node model.ex_02_chinook.stg_chinook__album
[0m08:29:10.289381 [debug] [Thread-4  ]: Began running node model.ex_02_chinook.dim_artist
[0m08:29:10.292889 [debug] [Thread-2  ]: Began running node model.ex_02_chinook.dim_album
[0m08:29:10.291621 [info ] [Thread-4  ]: 3 of 5 START sql table model `mart`.`dim_artist` ............................... [RUN]
[0m08:29:10.294748 [debug] [Thread-1  ]: Began running node model.ex_02_chinook.vw_artist_album_counts
[0m08:29:10.296845 [info ] [Thread-2  ]: 4 of 5 START sql table model `mart`.`dim_album` ................................ [RUN]
[0m08:29:10.349723 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.ex_02_chinook.dim_artist'
[0m08:29:10.352126 [info ] [Thread-1  ]: 5 of 5 START sql view model `mart`.`vw_artist_album_counts` .................... [RUN]
[0m08:29:10.353973 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.ex_02_chinook.stg_chinook__artist, now model.ex_02_chinook.dim_album)
[0m08:29:10.355660 [debug] [Thread-4  ]: Began compiling node model.ex_02_chinook.dim_artist
[0m08:29:10.357363 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_02_chinook.stg_chinook__album, now model.ex_02_chinook.vw_artist_album_counts)
[0m08:29:10.359107 [debug] [Thread-2  ]: Began compiling node model.ex_02_chinook.dim_album
[0m08:29:10.372208 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_02_chinook.dim_artist"
[0m08:29:10.374072 [debug] [Thread-1  ]: Began compiling node model.ex_02_chinook.vw_artist_album_counts
[0m08:29:10.387749 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_02_chinook.dim_album"
[0m08:29:10.454093 [debug] [Thread-4  ]: Began executing node model.ex_02_chinook.dim_artist
[0m08:29:10.458263 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_02_chinook.vw_artist_album_counts"
[0m08:29:10.476086 [debug] [Thread-1  ]: Began executing node model.ex_02_chinook.vw_artist_album_counts
[0m08:29:10.486111 [debug] [Thread-2  ]: Began executing node model.ex_02_chinook.dim_album
[0m08:29:10.551239 [debug] [Thread-1  ]: Creating new relation vw_artist_album_counts
[0m08:29:10.585560 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_02_chinook.vw_artist_album_counts"
[0m08:29:10.748916 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_02_chinook.vw_artist_album_counts: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.vw_artist_album_counts"} */


  create view `mart`.`vw_artist_album_counts` 
  
    
    
  as (
    

with album as (
  select album_id, artist_id
  from `clean`.`stg_chinook__album`
),
artist as (
  select artist_id, artist_name
  from `clean`.`stg_chinook__artist`
)

select
  ar.artist_id,
  ar.artist_name,
  substring(ar.artist_name, 1, 1)             as artist_initial,
  count(a.album_id)                            as album_count,
  case when count(a.album_id) >= 3 then 1 else 0 end as is_prolific -- handy filter in dashboards
from artist ar
left join album a
  on a.artist_id = ar.artist_id
group by
  ar.artist_id,
  ar.artist_name
order by album_count desc, ar.artist_name asc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m08:29:10.854604 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m08:29:10.879815 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a1c356d0>]}
[0m08:29:10.892821 [info ] [Thread-1  ]: 5 of 5 OK created sql view model `mart`.`vw_artist_album_counts` ............... [[32mOK[0m in 0.52s]
[0m08:29:10.959919 [debug] [Thread-1  ]: Finished running node model.ex_02_chinook.vw_artist_album_counts
[0m08:29:11.161858 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m08:29:11.163053 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_album"} */

            

    
        create table `mart`.`dim_album__dbt_backup`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Album dimension, denormalized with artist_name (common convenience).
with album as (
  select * from `clean`.`stg_chinook__album`
),
artist as (
  select * from `clean`.`stg_chinook__artist`
)
select
  a.album_id,
  a.album_title,
  a.artist_id,
  ar.artist_name
from album a
left join artist ar
  on ar.artist_id = a.artist_id
          )
        
        ...
[0m08:29:11.182232 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m08:29:11.254546 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_album"} */

    select name, type from system.columns where table = 'dim_album__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m08:29:11.266164 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:11.277826 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_02_chinook.dim_album"
[0m08:29:11.279901 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_album"} */

  
    
    
    
        
         


        insert into `mart`.`dim_album__dbt_backup`
        ("album_id", "album_title", "artist_id", "artist_name")

-- Album dimension, denormalized with artist_name (common convenience).
with album as (
  select * from `clean`.`stg_chinook__album`
),
artist as (
  select * from `clean`.`stg_chinook__artist`
)
select
  a.album_id,
  a.album_title,
  a.artist_id,
  ar.artist_name
from album a
left join artist ar
  on ar.artist_id = a.artist_id
  ...
[0m08:29:11.296476 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m08:29:11.353461 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_album"} */
EXCHANGE TABLES `mart`.`dim_album__dbt_backup` AND `mart`.`dim_album` 
  
  ...
[0m08:29:11.359249 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m08:29:11.370403 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_album: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_album"} */

    drop table if exists `mart`.`dim_album__dbt_backup` 
  ...
[0m08:29:11.377652 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_artist"} */

            

    
        create table `mart`.`dim_artist__dbt_backup`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Simple conformed dimension for artists.
select
  artist_id,
  artist_name
from `clean`.`stg_chinook__artist`
          )
        
        ...
[0m08:29:11.384022 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:11.388177 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a1d13f10>]}
[0m08:29:11.390091 [info ] [Thread-2  ]: 4 of 5 OK created sql table model `mart`.`dim_album` ........................... [[32mOK[0m in 1.03s]
[0m08:29:11.392394 [debug] [Thread-2  ]: Finished running node model.ex_02_chinook.dim_album
[0m08:29:11.396771 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m08:29:11.456339 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_artist"} */

    select name, type from system.columns where table = 'dim_artist__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m08:29:11.465204 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:11.470372 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_02_chinook.dim_artist"
[0m08:29:11.472610 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_artist"} */

  
    
    
    
        
         


        insert into `mart`.`dim_artist__dbt_backup`
        ("artist_id", "artist_name")

-- Simple conformed dimension for artists.
select
  artist_id,
  artist_name
from `clean`.`stg_chinook__artist`
  ...
[0m08:29:11.481914 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m08:29:11.486200 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_artist"} */
EXCHANGE TABLES `mart`.`dim_artist__dbt_backup` AND `mart`.`dim_artist` 
  
  ...
[0m08:29:11.491731 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m08:29:11.505390 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_02_chinook.dim_artist: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_02_chinook.dim_artist"} */

    drop table if exists `mart`.`dim_artist__dbt_backup` 
  ...
[0m08:29:11.551816 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m08:29:11.556363 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4384ba45-b63c-4062-8002-7b173b60ec7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a1d1e3d0>]}
[0m08:29:11.558389 [info ] [Thread-4  ]: 3 of 5 OK created sql table model `mart`.`dim_artist` .......................... [[32mOK[0m in 1.21s]
[0m08:29:11.560828 [debug] [Thread-4  ]: Finished running node model.ex_02_chinook.dim_artist
[0m08:29:11.564671 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:29:11.565761 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m08:29:11.566928 [debug] [MainThread]: On list__mart: Close
[0m08:29:11.567997 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m08:29:11.569092 [debug] [MainThread]: On list__clean: Close
[0m08:29:11.570168 [debug] [MainThread]: Connection 'model.ex_02_chinook.vw_artist_album_counts' was left open.
[0m08:29:11.571280 [debug] [MainThread]: On model.ex_02_chinook.vw_artist_album_counts: Close
[0m08:29:11.572339 [debug] [MainThread]: Connection 'model.ex_02_chinook.dim_album' was left open.
[0m08:29:11.573438 [debug] [MainThread]: On model.ex_02_chinook.dim_album: Close
[0m08:29:11.574477 [debug] [MainThread]: Connection 'model.ex_02_chinook.dim_artist' was left open.
[0m08:29:11.575597 [debug] [MainThread]: On model.ex_02_chinook.dim_artist: Close
[0m08:29:11.577708 [info ] [MainThread]: 
[0m08:29:11.579081 [info ] [MainThread]: Finished running 3 view models, 2 table models in 0 hours 0 minutes and 3.81 seconds (3.81s).
[0m08:29:11.585423 [debug] [MainThread]: Command end result
[0m08:29:11.865823 [info ] [MainThread]: 
[0m08:29:11.867586 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:29:11.869096 [info ] [MainThread]: 
[0m08:29:11.870767 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m08:29:11.873679 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.1826053, "process_in_blocks": "0", "process_kernel_time": 0.659697, "process_mem_max_rss": "114800", "process_out_blocks": "10624", "process_user_time": 6.298559}
[0m08:29:11.875446 [debug] [MainThread]: Command `dbt build` succeeded at 08:29:11.874943 after 7.18 seconds
[0m08:29:11.876819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a617ef40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a1ceb7f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7080a40e3580>]}
[0m08:29:11.877962 [debug] [MainThread]: Flushing usage events
[0m14:29:11.568730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c870148310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c86cda7a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c86cda7940>]}


============================== 14:29:11.628368 | be521379-d80d-4499-8089-a6aabe140f57 ==============================
[0m14:29:11.628368 [info ] [MainThread]: Running with dbt=1.8.9
[0m14:29:11.629467 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'log_format': 'default', 'target_path': 'None', 'version_check': 'True', 'static_parser': 'True', 'profiles_dir': '.', 'partial_parse': 'True', 'log_path': '/workdir/transforms/03_meteo/logs', 'use_colors': 'True', 'warn_error': 'None', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'introspect': 'True', 'printer_width': '80', 'no_print': 'None', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'debug': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'empty': 'False'}
[0m14:29:12.168304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'be521379-d80d-4499-8089-a6aabe140f57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c86ccc0a30>]}
[0m14:29:12.364386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'be521379-d80d-4499-8089-a6aabe140f57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c86d1e4250>]}
[0m14:29:12.366235 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m14:29:12.833954 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m14:29:13.163994 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m14:29:13.164963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'be521379-d80d-4499-8089-a6aabe140f57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c86e0dc9a0>]}
[0m14:29:17.661911 [error] [MainThread]: Encountered an error:
Compilation Error in model mart_meteo__manila_daily (models/mart/mart_meteo__manila_daily.sql)
  invalid syntax for function call expression
    line 1
      {{ config(
[0m14:29:17.664317 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 6.236668, "process_in_blocks": "43312", "process_kernel_time": 0.631717, "process_mem_max_rss": "99900", "process_out_blocks": "6624", "process_user_time": 6.095277}
[0m14:29:17.665105 [debug] [MainThread]: Command `dbt build` failed at 14:29:17.664895 after 6.24 seconds
[0m14:29:17.665757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c870148310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c86c549dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c86c5fd8e0>]}
[0m14:29:17.666357 [debug] [MainThread]: Flushing usage events
[0m14:38:09.411212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f6bcb9e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f6891eb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f6891ea30>]}


============================== 14:38:09.422767 | 12f6f99d-a3c3-469b-861a-900627540855 ==============================
[0m14:38:09.422767 [info ] [MainThread]: Running with dbt=1.8.9
[0m14:38:09.423913 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt build --profiles-dir . --target local', 'log_cache_events': 'False', 'no_print': 'None', 'log_path': '/workdir/transforms/03_meteo/logs', 'profiles_dir': '.', 'use_experimental_parser': 'False', 'write_json': 'True', 'version_check': 'True', 'static_parser': 'True', 'indirect_selection': 'eager', 'debug': 'False', 'introspect': 'True', 'printer_width': '80', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'warn_error': 'None', 'log_format': 'default', 'fail_fast': 'False', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'quiet': 'False', 'empty': 'False', 'partial_parse': 'True'}
[0m14:38:10.013378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '12f6f99d-a3c3-469b-861a-900627540855', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f6b154910>]}
[0m14:38:10.206951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '12f6f99d-a3c3-469b-861a-900627540855', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f689740d0>]}
[0m14:38:10.208266 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m14:38:10.622188 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m14:38:11.003216 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m14:38:11.004080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '12f6f99d-a3c3-469b-861a-900627540855', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f69bd6700>]}
[0m14:38:15.406939 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m14:38:15.407822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '12f6f99d-a3c3-469b-861a-900627540855', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f67d01850>]}
[0m14:38:16.224974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '12f6f99d-a3c3-469b-861a-900627540855', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f679d7130>]}
[0m14:38:16.738809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '12f6f99d-a3c3-469b-861a-900627540855', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f67a10b20>]}
[0m14:38:16.739698 [info ] [MainThread]: Found 3 models, 4 data tests, 1 source, 471 macros
[0m14:38:16.742899 [info ] [MainThread]: 
[0m14:38:16.743899 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:38:16.782307 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:38:16.756623 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:38:16.818323 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:38:16.822243 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:38:17.418699 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:38:17.425041 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:38:17.484133 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:38:17.491081 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:38:17.529614 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m14:38:17.531513 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m14:38:17.604754 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m14:38:17.614529 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m14:38:17.622596 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:38:17.627279 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:38:17.686453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12f6f99d-a3c3-469b-861a-900627540855', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f6707d9a0>]}
[0m14:38:17.688301 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m14:38:17.689654 [info ] [MainThread]: 
[0m14:38:17.717016 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_meteo__manila
[0m14:38:17.718582 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_meteo__manila` ........................ [RUN]
[0m14:38:17.719988 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_meteo__manila'
[0m14:38:17.720989 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_meteo__manila
[0m14:38:17.791592 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_meteo__manila"
[0m14:38:17.793215 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_meteo__manila
[0m14:38:17.896865 [debug] [Thread-1  ]: Creating new relation stg_meteo__manila
[0m14:38:17.922576 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m14:38:18.032768 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_meteo__manila"
[0m14:38:18.034230 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */


  create view `clean`.`stg_meteo__manila` 
  
    
    
  as (
    

-- Normalize types & naming; no business logic here.
select
  toDate(date)                         as dte,
  toFloat64(temp_min)                  as temp_min_c,
  toFloat64(temp_max)                  as temp_max_c,
  toFloat64(precipitation)             as precip_mm,
  toInt32(weather_code)                as weather_code
from `raw`.`meteo__manila`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m14:38:18.039065 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */


  create view `clean`.`stg_meteo__manila` 
  
    
    
  as (
    

-- Normalize types & naming; no business logic here.
select
  toDate(date)                         as dte,
  toFloat64(temp_min)                  as temp_min_c,
  toFloat64(temp_max)                  as temp_max_c,
  toFloat64(precipitation)             as precip_mm,
  toInt32(weather_code)                as weather_code
from `raw`.`meteo__manila`
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m14:38:18.047978 [debug] [Thread-1  ]: Database Error in model stg_meteo__manila (models/clean/stg_meteo__manila.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 60
   Code: 60. DB::Exception: Table raw.meteo__manila does not exist. Maybe you meant raw.meteo___manila?. (UNKNOWN_TABLE) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/clean/stg_meteo__manila.sql
[0m14:38:18.050517 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12f6f99d-a3c3-469b-861a-900627540855', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f675e5eb0>]}
[0m14:38:18.051835 [error] [Thread-1  ]: 1 of 7 ERROR creating sql view model `clean`.`stg_meteo__manila` ............... [[31mERROR[0m in 0.33s]
[0m14:38:18.053236 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_meteo__manila
[0m14:38:18.055498 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m14:38:18.056843 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m14:38:18.058582 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m14:38:18.059702 [debug] [Thread-1  ]: Began running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m14:38:18.061064 [info ] [Thread-3  ]: 2 of 7 SKIP test not_null_stg_meteo__manila_dte ................................ [[33mSKIP[0m]
[0m14:38:18.063729 [info ] [Thread-4  ]: 3 of 7 SKIP test not_null_stg_meteo__manila_temp_max_c ......................... [[33mSKIP[0m]
[0m14:38:18.066046 [info ] [Thread-2  ]: 4 of 7 SKIP test not_null_stg_meteo__manila_temp_min_c ......................... [[33mSKIP[0m]
[0m14:38:18.068001 [info ] [Thread-1  ]: 5 of 7 SKIP test unique_stg_meteo__manila_dte .................................. [[33mSKIP[0m]
[0m14:38:18.070213 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m14:38:18.072007 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m14:38:18.073760 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m14:38:18.082477 [debug] [Thread-1  ]: Finished running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m14:38:18.086673 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_meteo__manila_daily
[0m14:38:18.088210 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m14:38:18.089971 [info ] [Thread-3  ]: 6 of 7 SKIP relation mart.mart_meteo__manila_daily ............................. [[33mSKIP[0m]
[0m14:38:18.091908 [info ] [Thread-4  ]: 7 of 7 SKIP relation mart.mart_meteo__manila_monthly ........................... [[33mSKIP[0m]
[0m14:38:18.093943 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_daily
[0m14:38:18.095757 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m14:38:18.100043 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:38:18.101328 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m14:38:18.102721 [debug] [MainThread]: On list__mart: Close
[0m14:38:18.103873 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m14:38:18.105050 [debug] [MainThread]: On list__clean: Close
[0m14:38:18.106175 [debug] [MainThread]: Connection 'model.ex_03_meteo.stg_meteo__manila' was left open.
[0m14:38:18.107445 [debug] [MainThread]: On model.ex_03_meteo.stg_meteo__manila: Close
[0m14:38:18.109331 [info ] [MainThread]: 
[0m14:38:18.110748 [info ] [MainThread]: Finished running 1 view model, 4 data tests, 2 table models in 0 hours 0 minutes and 1.37 seconds (1.37s).
[0m14:38:18.115648 [debug] [MainThread]: Command end result
[0m14:38:18.329127 [info ] [MainThread]: 
[0m14:38:18.330292 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:38:18.331189 [info ] [MainThread]: 
[0m14:38:18.383025 [error] [MainThread]:   Database Error in model stg_meteo__manila (models/clean/stg_meteo__manila.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 60
   Code: 60. DB::Exception: Table raw.meteo__manila does not exist. Maybe you meant raw.meteo___manila?. (UNKNOWN_TABLE) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/clean/stg_meteo__manila.sql
[0m14:38:18.384496 [info ] [MainThread]: 
[0m14:38:18.385917 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=6 TOTAL=7
[0m14:38:18.388873 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 9.179361, "process_in_blocks": "7128", "process_kernel_time": 0.633699, "process_mem_max_rss": "117360", "process_out_blocks": "10544", "process_user_time": 7.380388}
[0m14:38:18.390414 [debug] [MainThread]: Command `dbt build` failed at 14:38:18.390012 after 9.18 seconds
[0m14:38:18.391736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f6bcb9e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f6b154910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f67894ac0>]}
[0m14:38:18.393012 [debug] [MainThread]: Flushing usage events
[0m14:51:33.802297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73252b47a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7325280dab50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7325280daa00>]}


============================== 14:51:33.863448 | 1a0f6246-5ab4-4dec-a443-c98a3a79ad87 ==============================
[0m14:51:33.863448 [info ] [MainThread]: Running with dbt=1.8.9
[0m14:51:33.864697 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'empty': 'False', 'partial_parse': 'True', 'profiles_dir': '.', 'use_colors': 'True', 'target_path': 'None', 'write_json': 'True', 'debug': 'False', 'introspect': 'True', 'quiet': 'False', 'static_parser': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'version_check': 'True', 'log_path': '/workdir/transforms/03_meteo/logs', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'log_format': 'default', 'fail_fast': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_experimental_parser': 'False'}
[0m14:51:34.396121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1a0f6246-5ab4-4dec-a443-c98a3a79ad87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732527ff5520>]}
[0m14:51:34.589278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1a0f6246-5ab4-4dec-a443-c98a3a79ad87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732527f49e20>]}
[0m14:51:34.590583 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m14:51:35.003942 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m14:51:35.575029 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:51:35.576421 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/sources.yml
[0m14:51:36.300152 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m14:51:36.301077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '1a0f6246-5ab4-4dec-a443-c98a3a79ad87', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732527718a90>]}
[0m14:51:36.967203 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.ex_03_meteo.stg_meteo__manila' (models/clean/stg_meteo__manila.sql) depends on a source named 'raw.meteo__manila' which was not found
[0m14:51:36.968816 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 3.3599393, "process_in_blocks": "0", "process_kernel_time": 0.519098, "process_mem_max_rss": "104420", "process_out_blocks": "6616", "process_user_time": 4.472154}
[0m14:51:36.969596 [debug] [MainThread]: Command `dbt build` failed at 14:51:36.969356 after 3.36 seconds
[0m14:51:36.970245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73252b47a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7325278581f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7325278047f0>]}
[0m14:51:36.970949 [debug] [MainThread]: Flushing usage events
[0m14:59:29.413824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee4809b7310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47d618b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47d6189d0>]}


============================== 14:59:29.423069 | 75dad68a-9f02-4bab-81b2-0f5442514c1a ==============================
[0m14:59:29.423069 [info ] [MainThread]: Running with dbt=1.8.9
[0m14:59:29.424198 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'target_path': 'None', 'version_check': 'True', 'warn_error': 'None', 'profiles_dir': '.', 'static_parser': 'True', 'printer_width': '80', 'cache_selected_only': 'False', 'use_colors': 'True', 'debug': 'False', 'introspect': 'True', 'write_json': 'True', 'log_path': '/workdir/transforms/03_meteo/logs', 'invocation_command': 'dbt build --profiles-dir . --target local', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'quiet': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'use_experimental_parser': 'False'}
[0m14:59:29.949296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47d5319d0>]}
[0m14:59:30.146509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47d5cf5b0>]}
[0m14:59:30.147931 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m14:59:30.617222 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m14:59:31.121368 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m14:59:31.122819 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/sources.yml
[0m14:59:31.123412 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/clean/stg_meteo__manila.sql
[0m14:59:31.854865 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m14:59:31.855871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47c867eb0>]}
[0m14:59:32.834831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47c496ee0>]}
[0m14:59:33.273387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47d2ae580>]}
[0m14:59:33.274378 [info ] [MainThread]: Found 3 models, 4 data tests, 1 source, 471 macros
[0m14:59:33.316114 [info ] [MainThread]: 
[0m14:59:33.317629 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:59:33.330511 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:59:33.332088 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:59:33.549140 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:59:33.560945 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:59:34.122160 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:59:34.127053 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:59:34.152914 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:59:34.160030 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:59:34.229873 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m14:59:34.231000 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m14:59:34.243699 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m14:59:34.249049 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m14:59:34.255987 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:59:34.257344 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:59:34.316943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee4809177c0>]}
[0m14:59:34.319026 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m14:59:34.320416 [info ] [MainThread]: 
[0m14:59:34.348173 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_meteo__manila
[0m14:59:34.349422 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_meteo__manila` ........................ [RUN]
[0m14:59:34.350488 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_03_meteo.stg_meteo__manila)
[0m14:59:34.351416 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_meteo__manila
[0m14:59:34.422371 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_meteo__manila"
[0m14:59:34.424241 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_meteo__manila
[0m14:59:34.515604 [debug] [Thread-1  ]: Creating new relation stg_meteo__manila
[0m14:59:34.535141 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_meteo__manila"
[0m14:59:34.536496 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */


  create view `clean`.`stg_meteo__manila` 
  
    
    
  as (
    

-- Normalize types & naming; no business logic here.
select
  toDate(date)                         as dte,
  toFloat64(temp_min)                  as temp_min_c,
  toFloat64(temp_max)                  as temp_max_c,
  toFloat64(precipitation)             as precip_mm,
  toInt32(weather_code)                as weather_code
from `raw`.`meteo___manila`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m14:59:34.547350 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:59:34.626476 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47bab02b0>]}
[0m14:59:34.627664 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_meteo__manila` ................... [[32mOK[0m in 0.27s]
[0m14:59:34.629070 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_meteo__manila
[0m14:59:34.631428 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m14:59:34.632984 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m14:59:34.634191 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_meteo__manila_dte ............................... [RUN]
[0m14:59:34.635903 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m14:59:34.637651 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_meteo__manila_temp_max_c ........................ [RUN]
[0m14:59:34.639351 [debug] [Thread-1  ]: Began running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m14:59:34.641193 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f'
[0m14:59:34.642948 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_meteo__manila_temp_min_c ........................ [RUN]
[0m14:59:34.644651 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339'
[0m14:59:34.645994 [info ] [Thread-1  ]: 5 of 7 START test unique_stg_meteo__manila_dte ................................. [RUN]
[0m14:59:34.647312 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m14:59:34.648866 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9'
[0m14:59:34.650111 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m14:59:34.651442 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_meteo__manila, now test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc)
[0m14:59:34.724260 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m14:59:34.758890 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m14:59:34.813960 [debug] [Thread-1  ]: Began compiling node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m14:59:34.824963 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m14:59:34.841030 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m14:59:34.853341 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m14:59:34.918912 [debug] [Thread-1  ]: Writing injected SQL for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m14:59:34.921044 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m14:59:34.927854 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m14:59:35.048284 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m14:59:35.060381 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m14:59:35.115071 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m14:59:35.116916 [debug] [Thread-1  ]: Began executing node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m14:59:35.119639 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m14:59:35.121247 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m14:59:35.123051 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m14:59:35.134515 [debug] [Thread-1  ]: Writing runtime sql for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m14:59:35.145813 [debug] [Thread-1  ]: dbt_clickhouse adapter: On test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    dte as unique_field,
    count(*) as n_records

from `clean`.`stg_meteo__manila`
where dte is not null
group by dte
having count(*) > 1



    ) dbt_internal_test...
[0m14:59:35.254205 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m14:59:35.326604 [info ] [Thread-1  ]: 5 of 7 PASS unique_stg_meteo__manila_dte ....................................... [[32mPASS[0m in 0.67s]
[0m14:59:35.338480 [debug] [Thread-1  ]: Finished running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m14:59:35.431022 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_max_c
from `clean`.`stg_meteo__manila`
where temp_max_c is null



    ) dbt_internal_test...
[0m14:59:35.442663 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:59:35.448956 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_meteo__manila_temp_max_c .............................. [[32mPASS[0m in 0.80s]
[0m14:59:35.457580 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m14:59:35.515101 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_min_c
from `clean`.`stg_meteo__manila`
where temp_min_c is null



    ) dbt_internal_test...
[0m14:59:35.471139 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select dte
from `clean`.`stg_meteo__manila`
where dte is null



    ) dbt_internal_test...
[0m14:59:35.573091 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m14:59:35.575729 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m14:59:35.582180 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_meteo__manila_dte ..................................... [[32mPASS[0m in 0.94s]
[0m14:59:35.588400 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_meteo__manila_temp_min_c .............................. [[32mPASS[0m in 0.94s]
[0m14:59:35.592009 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m14:59:35.595265 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m14:59:35.598943 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_meteo__manila_daily
[0m14:59:35.600714 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m14:59:35.602974 [info ] [Thread-1  ]: 6 of 7 START sql table model `mart`.`mart_meteo__manila_daily` ................. [RUN]
[0m14:59:35.605338 [info ] [Thread-4  ]: 7 of 7 START sql table model `mart`.`mart_meteo__manila_monthly` ............... [RUN]
[0m14:59:35.607405 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc, now model.ex_03_meteo.mart_meteo__manila_daily)
[0m14:59:35.609274 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339, now model.ex_03_meteo.mart_meteo__manila_monthly)
[0m14:59:35.610878 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_daily
[0m14:59:35.612433 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_monthly
[0m14:59:35.626052 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m14:59:35.639608 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m14:59:35.642200 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_monthly
[0m14:59:35.659330 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_daily
[0m14:59:35.845632 [debug] [Thread-4  ]: Creating new relation mart_meteo__manila_monthly
[0m14:59:35.918861 [debug] [Thread-1  ]: Creating new relation mart_meteo__manila_daily
[0m14:59:36.258041 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

            

    
        create table `mart`.`mart_meteo__manila_daily`
        
  
        
  engine = MergeTree()
        order by (dte)
        
        partition by (toYYYYMM(dte))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Daily meteo mart (persisted)
select
  dte,
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0 as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
          )
        
        ...
[0m14:59:36.260888 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

            

    
        create table `mart`.`mart_meteo__manila_monthly`
        
  
        
  engine = MergeTree()
        order by (month)
        
        partition by (toYYYYMM(month))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    dte,
    temp_min_c,
    temp_max_c,
    (temp_min_c + temp_max_c)/2.0 as temp_avg_c,
    precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte)           as month,
  avg(temp_min_c)               as avg_min_c,
  avg(temp_max_c)               as avg_max_c,
  avg(temp_avg_c)               as avg_temp_c,
  sum(precip_mm)                as total_precip_mm,
  countIf(precip_mm > 0)        as rainy_days
from base
group by month
order by month
          )
        
        ...
[0m14:59:36.326599 [debug] [Thread-4  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

            

    
        create table `mart`.`mart_meteo__manila_monthly`
        
  
        
  engine = MergeTree()
        order by (month)
        
        partition by (toYYYYMM(month))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    dte,
    temp_min_c,
    temp_max_c,
    (temp_min_c + temp_max_c)/2.0 as temp_avg_c,
    precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte)           as month,
  avg(temp_min_c)               as avg_min_c,
  avg(temp_max_c)               as avg_max_c,
  avg(temp_avg_c)               as avg_temp_c,
  sum(precip_mm)                as total_precip_mm,
  countIf(precip_mm > 0)        as rainy_days
from base
group by month
order by month
          )
        
        
[0m14:59:36.329683 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

            

    
        create table `mart`.`mart_meteo__manila_daily`
        
  
        
  engine = MergeTree()
        order by (dte)
        
        partition by (toYYYYMM(dte))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Daily meteo mart (persisted)
select
  dte,
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0 as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
          )
        
        
[0m14:59:36.342921 [debug] [Thread-1  ]: Database Error in model mart_meteo__manila_daily (models/mart/mart_meteo__manila_daily.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 44
   Code: 44. DB::Exception: Partition key contains nullable columns, but merge tree setting `allow_nullable_key` is disabled. (ILLEGAL_COLUMN) (version 23.12.6.19 (official build))
[0m14:59:36.346732 [debug] [Thread-4  ]: Database Error in model mart_meteo__manila_monthly (models/mart/mart_meteo__manila_monthly.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 44
   Code: 44. DB::Exception: Partition key contains nullable columns, but merge tree setting `allow_nullable_key` is disabled. (ILLEGAL_COLUMN) (version 23.12.6.19 (official build))
[0m14:59:36.348260 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47b3755e0>]}
[0m14:59:36.349917 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75dad68a-9f02-4bab-81b2-0f5442514c1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47b2d6c10>]}
[0m14:59:36.352438 [error] [Thread-1  ]: 6 of 7 ERROR creating sql table model `mart`.`mart_meteo__manila_daily` ........ [[31mERROR[0m in 0.74s]
[0m14:59:36.355149 [error] [Thread-4  ]: 7 of 7 ERROR creating sql table model `mart`.`mart_meteo__manila_monthly` ...... [[31mERROR[0m in 0.74s]
[0m14:59:36.358402 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_daily
[0m14:59:36.361339 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m14:59:36.365897 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:59:36.367125 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_daily' was left open.
[0m14:59:36.368413 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_daily: Close
[0m14:59:36.414384 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m14:59:36.415488 [debug] [MainThread]: On list__clean: Close
[0m14:59:36.416554 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f' was left open.
[0m14:59:36.417642 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f: Close
[0m14:59:36.418685 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_monthly' was left open.
[0m14:59:36.419809 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_monthly: Close
[0m14:59:36.420987 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9' was left open.
[0m14:59:36.422070 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9: Close
[0m14:59:36.424201 [info ] [MainThread]: 
[0m14:59:36.425979 [info ] [MainThread]: Finished running 1 view model, 4 data tests, 2 table models in 0 hours 0 minutes and 3.11 seconds (3.11s).
[0m14:59:36.435201 [debug] [MainThread]: Command end result
[0m14:59:36.650219 [info ] [MainThread]: 
[0m14:59:36.651758 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m14:59:36.652945 [info ] [MainThread]: 
[0m14:59:36.654400 [error] [MainThread]:   Database Error in model mart_meteo__manila_daily (models/mart/mart_meteo__manila_daily.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 44
   Code: 44. DB::Exception: Partition key contains nullable columns, but merge tree setting `allow_nullable_key` is disabled. (ILLEGAL_COLUMN) (version 23.12.6.19 (official build))
[0m14:59:36.655607 [info ] [MainThread]: 
[0m14:59:36.656986 [error] [MainThread]:   Database Error in model mart_meteo__manila_monthly (models/mart/mart_meteo__manila_monthly.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 44
   Code: 44. DB::Exception: Partition key contains nullable columns, but merge tree setting `allow_nullable_key` is disabled. (ILLEGAL_COLUMN) (version 23.12.6.19 (official build))
[0m14:59:36.658045 [info ] [MainThread]: 
[0m14:59:36.659165 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=2 SKIP=0 TOTAL=7
[0m14:59:36.661270 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 7.4437466, "process_in_blocks": "0", "process_kernel_time": 0.646847, "process_mem_max_rss": "118136", "process_out_blocks": "10648", "process_user_time": 6.436773}
[0m14:59:36.662473 [debug] [MainThread]: Command `dbt build` failed at 14:59:36.662166 after 7.45 seconds
[0m14:59:36.714836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee4809b7310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47b305d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ee47b305b50>]}
[0m14:59:36.716169 [debug] [MainThread]: Flushing usage events
[0m15:04:44.505438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f4634310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f1299ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f1299970>]}


============================== 15:04:44.564881 | 385c2017-b0b4-4ca4-a91f-2950b472bd73 ==============================
[0m15:04:44.564881 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:04:44.566142 [debug] [MainThread]: running dbt with arguments {'log_path': '/workdir/transforms/03_meteo/logs', 'empty': 'False', 'profiles_dir': '.', 'version_check': 'True', 'fail_fast': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'target_path': 'None', 'write_json': 'True', 'printer_width': '80', 'indirect_selection': 'eager', 'introspect': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'use_experimental_parser': 'False', 'debug': 'False', 'warn_error': 'None'}
[0m15:04:45.176846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '385c2017-b0b4-4ca4-a91f-2950b472bd73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f3be1b50>]}
[0m15:04:45.372681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '385c2017-b0b4-4ca4-a91f-2950b472bd73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f4888a30>]}
[0m15:04:45.373934 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m15:04:45.788617 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m15:04:46.292842 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m15:04:46.293943 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/mart/mart_meteo__manila_monthly.sql
[0m15:04:46.294648 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/mart/mart_meteo__manila_daily.sql
[0m15:04:47.201353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '385c2017-b0b4-4ca4-a91f-2950b472bd73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f0576e20>]}
[0m15:04:47.678238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '385c2017-b0b4-4ca4-a91f-2950b472bd73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f05df1f0>]}
[0m15:04:47.679216 [info ] [MainThread]: Found 3 models, 4 data tests, 1 source, 471 macros
[0m15:04:47.683177 [info ] [MainThread]: 
[0m15:04:47.684431 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m15:04:47.697731 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:04:47.699283 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:04:47.778654 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:04:47.783378 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:04:48.367062 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:04:48.371504 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:04:48.375641 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:04:48.379646 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:04:48.607067 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m15:04:48.608342 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m15:04:48.673648 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m15:04:48.681707 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m15:04:48.691211 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:04:48.700522 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m15:04:48.707356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '385c2017-b0b4-4ca4-a91f-2950b472bd73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f0489970>]}
[0m15:04:48.708631 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m15:04:48.709714 [info ] [MainThread]: 
[0m15:04:48.783327 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_meteo__manila
[0m15:04:48.784436 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_meteo__manila` ........................ [RUN]
[0m15:04:48.785591 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_meteo__manila'
[0m15:04:48.786308 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_meteo__manila
[0m15:04:48.804179 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_meteo__manila"
[0m15:04:48.805477 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_meteo__manila
[0m15:04:48.996627 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m15:04:49.106229 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_meteo__manila"
[0m15:04:49.107620 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */


  create view `clean`.`stg_meteo__manila__dbt_tmp` 
  
    
    
  as (
    

-- Normalize types & naming; no business logic here.
select
  toDate(date)                         as dte,
  toFloat64(temp_min)                  as temp_min_c,
  toFloat64(temp_max)                  as temp_max_c,
  toFloat64(precipitation)             as precip_mm,
  toInt32(weather_code)                as weather_code
from `raw`.`meteo___manila`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m15:04:49.121957 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:04:49.136266 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila__dbt_backup` 
  
  ...
[0m15:04:49.139677 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:04:49.141727 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    rename table `clean`.`stg_meteo__manila` to `clean`.`stg_meteo__manila__dbt_backup` 
  
  ...
[0m15:04:49.144740 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:04:49.150880 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila` 
  
  ...
[0m15:04:49.153883 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:04:49.156367 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    rename table `clean`.`stg_meteo__manila__dbt_tmp` to `clean`.`stg_meteo__manila` 
  
  ...
[0m15:04:49.159732 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:04:49.210361 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila__dbt_backup` 
  ...
[0m15:04:49.213787 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:04:49.267252 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385c2017-b0b4-4ca4-a91f-2950b472bd73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f00818e0>]}
[0m15:04:49.268449 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_meteo__manila` ................... [[32mOK[0m in 0.48s]
[0m15:04:49.269815 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_meteo__manila
[0m15:04:49.271970 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:04:49.273067 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:04:49.274407 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_meteo__manila_dte ............................... [RUN]
[0m15:04:49.275477 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:04:49.277152 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_meteo__manila_temp_max_c ........................ [RUN]
[0m15:04:49.278648 [debug] [Thread-1  ]: Began running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:04:49.280261 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f'
[0m15:04:49.282074 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_meteo__manila_temp_min_c ........................ [RUN]
[0m15:04:49.284653 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339'
[0m15:04:49.286118 [info ] [Thread-1  ]: 5 of 7 START test unique_stg_meteo__manila_dte ................................. [RUN]
[0m15:04:49.287453 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:04:49.289710 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9'
[0m15:04:49.291642 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:04:49.293002 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_meteo__manila, now test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc)
[0m15:04:49.365391 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:04:49.401566 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m15:04:49.403125 [debug] [Thread-1  ]: Began compiling node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:04:49.407850 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m15:04:49.474009 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m15:04:49.492021 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:04:49.501256 [debug] [Thread-1  ]: Writing injected SQL for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m15:04:49.503455 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:04:49.582012 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:04:49.593989 [debug] [Thread-1  ]: Began executing node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:04:49.901523 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m15:04:49.903157 [debug] [Thread-1  ]: Writing runtime sql for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m15:04:49.911613 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m15:04:49.969014 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m15:04:49.971668 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m15:04:49.973771 [debug] [Thread-1  ]: dbt_clickhouse adapter: On test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    dte as unique_field,
    count(*) as n_records

from `clean`.`stg_meteo__manila`
where dte is not null
group by dte
having count(*) > 1



    ) dbt_internal_test...
[0m15:04:49.976108 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m15:04:49.979893 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m15:04:50.067686 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m15:04:50.172874 [info ] [Thread-1  ]: 5 of 7 PASS unique_stg_meteo__manila_dte ....................................... [[32mPASS[0m in 0.88s]
[0m15:04:50.178361 [debug] [Thread-1  ]: Finished running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:04:50.279969 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select dte
from `clean`.`stg_meteo__manila`
where dte is null



    ) dbt_internal_test...
[0m15:04:50.294976 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_min_c
from `clean`.`stg_meteo__manila`
where temp_min_c is null



    ) dbt_internal_test...
[0m15:04:50.297825 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m15:04:50.302595 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_max_c
from `clean`.`stg_meteo__manila`
where temp_max_c is null



    ) dbt_internal_test...
[0m15:04:50.308879 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_meteo__manila_dte ..................................... [[32mPASS[0m in 1.03s]
[0m15:04:50.366625 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m15:04:50.370424 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:04:50.377776 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_meteo__manila_temp_min_c .............................. [[32mPASS[0m in 1.09s]
[0m15:04:50.381224 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m15:04:50.384860 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:04:50.390849 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_meteo__manila_temp_max_c .............................. [[32mPASS[0m in 1.11s]
[0m15:04:50.394840 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:04:50.397972 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:04:50.399855 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:04:50.402252 [info ] [Thread-1  ]: 6 of 7 START sql table model `mart`.`mart_meteo__manila_daily` ................. [RUN]
[0m15:04:50.404813 [info ] [Thread-3  ]: 7 of 7 START sql table model `mart`.`mart_meteo__manila_monthly` ............... [RUN]
[0m15:04:50.406664 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc, now model.ex_03_meteo.mart_meteo__manila_daily)
[0m15:04:50.408132 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f, now model.ex_03_meteo.mart_meteo__manila_monthly)
[0m15:04:50.409707 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:04:50.411273 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:04:50.486385 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m15:04:50.490321 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m15:04:50.492891 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:04:50.494460 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:04:50.691775 [debug] [Thread-1  ]: Creating new relation mart_meteo__manila_daily
[0m15:04:50.786092 [debug] [Thread-3  ]: Creating new relation mart_meteo__manila_monthly
[0m15:04:51.164767 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

            

    
        create table `mart`.`mart_meteo__manila_monthly`
        
  
        
  engine = MergeTree()
        order by (month)
        
        partition by (toYYYYMM(month))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(dte)                            as dte_nn,   -- 👈 non-nullable
    toFloat64(temp_min_c)                         as temp_min_c,
    toFloat64(temp_max_c)                         as temp_max_c,
    (toFloat64(temp_min_c) + toFloat64(temp_max_c))/2.0 as temp_avg_c,
    toFloat64(precip_mm)                          as precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte_nn)                as month,             -- 👈 computed from non-null date
  avg(temp_min_c)                       as avg_min_c,
  avg(temp_max_c)                       as avg_max_c,
  avg(temp_avg_c)                       as avg_temp_c,
  sum(precip_mm)                        as total_precip_mm,
  countIf(precip_mm > 0)                as rainy_days
from base
group by month
order by month
          )
        
        ...
[0m15:04:51.166469 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

            

    
        create table `mart`.`mart_meteo__manila_daily`
        
  
        
  engine = MergeTree()
        order by (dte)
        
        partition by (toYYYYMM(dte))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Force non-nullable key for MergeTree
select
  assumeNotNull(dte)                         as dte,          -- 👈 non-nullable
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0              as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
          )
        
        ...
[0m15:04:51.195273 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m15:04:51.211659 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m15:04:51.221341 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

    select name, type from system.columns where table = 'mart_meteo__manila_daily'
    
      and database = 'mart'
    
    order by position
  ...
[0m15:04:51.231621 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

    select name, type from system.columns where table = 'mart_meteo__manila_monthly'
    
      and database = 'mart'
    
    order by position
  ...
[0m15:04:51.267039 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m15:04:51.283066 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m15:04:51.280478 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m15:04:51.288793 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m15:04:51.291608 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

  
    
    
    
        
         


        insert into `mart`.`mart_meteo__manila_daily`
        ("dte", "temp_min_c", "temp_max_c", "temp_avg_c", "precip_mm", "weather_code")

-- Force non-nullable key for MergeTree
select
  assumeNotNull(dte)                         as dte,          -- 👈 non-nullable
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0              as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
  ...
[0m15:04:51.293884 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

  
    
    
    
        
         


        insert into `mart`.`mart_meteo__manila_monthly`
        ("month", "avg_min_c", "avg_max_c", "avg_temp_c", "total_precip_mm", "rainy_days")

with base as (
  select
    assumeNotNull(dte)                            as dte_nn,   -- 👈 non-nullable
    toFloat64(temp_min_c)                         as temp_min_c,
    toFloat64(temp_max_c)                         as temp_max_c,
    (toFloat64(temp_min_c) + toFloat64(temp_max_c))/2.0 as temp_avg_c,
    toFloat64(precip_mm)                          as precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte_nn)                as month,             -- 👈 computed from non-null date
  avg(temp_min_c)                       as avg_min_c,
  avg(temp_max_c)                       as avg_max_c,
  avg(temp_avg_c)                       as avg_temp_c,
  sum(precip_mm)                        as total_precip_mm,
  countIf(precip_mm > 0)                as rainy_days
from base
group by month
order by month
  ...
[0m15:04:51.339656 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m15:04:51.346193 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385c2017-b0b4-4ca4-a91f-2950b472bd73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f006f5e0>]}
[0m15:04:51.348723 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m15:04:51.351375 [info ] [Thread-1  ]: 6 of 7 OK created sql table model `mart`.`mart_meteo__manila_daily` ............ [[32mOK[0m in 0.94s]
[0m15:04:51.371206 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '385c2017-b0b4-4ca4-a91f-2950b472bd73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0eff47c10>]}
[0m15:04:51.374167 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:04:51.376869 [info ] [Thread-3  ]: 7 of 7 OK created sql table model `mart`.`mart_meteo__manila_monthly` .......... [[32mOK[0m in 0.96s]
[0m15:04:51.380182 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:04:51.384005 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:04:51.385226 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m15:04:51.386724 [debug] [MainThread]: On list__mart: Close
[0m15:04:51.388000 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m15:04:51.389175 [debug] [MainThread]: On list__clean: Close
[0m15:04:51.390294 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_daily' was left open.
[0m15:04:51.391475 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_daily: Close
[0m15:04:51.392611 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_monthly' was left open.
[0m15:04:51.393813 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_monthly: Close
[0m15:04:51.394998 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339' was left open.
[0m15:04:51.396180 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339: Close
[0m15:04:51.397340 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9' was left open.
[0m15:04:51.398514 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9: Close
[0m15:04:51.400777 [info ] [MainThread]: 
[0m15:04:51.402246 [info ] [MainThread]: Finished running 1 view model, 4 data tests, 2 table models in 0 hours 0 minutes and 3.72 seconds (3.72s).
[0m15:04:51.410813 [debug] [MainThread]: Command end result
[0m15:04:51.675852 [info ] [MainThread]: 
[0m15:04:51.677491 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:04:51.678817 [info ] [MainThread]: 
[0m15:04:51.680157 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:04:51.682789 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.371369, "process_in_blocks": "0", "process_kernel_time": 0.653605, "process_mem_max_rss": "116544", "process_out_blocks": "10696", "process_user_time": 6.386916}
[0m15:04:51.684390 [debug] [MainThread]: Command `dbt build` succeeded at 15:04:51.683984 after 7.37 seconds
[0m15:04:51.685757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f4634310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f1bc2f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf0f04ce790>]}
[0m15:04:51.687002 [debug] [MainThread]: Flushing usage events
[0m15:36:36.990440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63af6ec310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63ac34a4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63ac34a610>]}


============================== 15:36:37.000651 | 883e48ce-5627-46b3-a880-4911742117d5 ==============================
[0m15:36:37.000651 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:36:37.001876 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'log_path': '/workdir/transforms/03_meteo/logs', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'profiles_dir': '.', 'no_print': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'version_check': 'True', 'target_path': 'None', 'printer_width': '80', 'empty': 'False', 'debug': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'partial_parse': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'write_json': 'True', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m15:36:37.578295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63ac449460>]}
[0m15:36:37.773481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63ac422dc0>]}
[0m15:36:37.774737 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m15:36:38.192036 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m15:36:38.704485 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m15:36:38.705453 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/mart/vw_meteo__manila_night_weather.sql
[0m15:36:38.706650 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/sources.yml
[0m15:36:39.492792 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m15:36:39.493771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63abacaeb0>]}
[0m15:36:40.508757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63ab1bde50>]}
[0m15:36:41.007924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63abb08a60>]}
[0m15:36:41.008815 [info ] [MainThread]: Found 4 models, 4 data tests, 2 sources, 471 macros
[0m15:36:41.012155 [info ] [MainThread]: 
[0m15:36:41.013186 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m15:36:41.025644 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:36:41.067232 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:36:41.310982 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:36:41.368962 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:36:42.172584 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:36:42.181213 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:36:42.183599 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:36:42.191776 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:36:42.289628 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m15:36:42.301607 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m15:36:42.306696 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m15:36:42.312501 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m15:36:42.368663 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m15:36:42.385592 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m15:36:42.393808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63ac433190>]}
[0m15:36:42.395643 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m15:36:42.397001 [info ] [MainThread]: 
[0m15:36:42.469729 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_meteo__manila
[0m15:36:42.471133 [info ] [Thread-1  ]: 1 of 8 START sql view model `clean`.`stg_meteo__manila` ........................ [RUN]
[0m15:36:42.472188 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_03_meteo.stg_meteo__manila)
[0m15:36:42.473077 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_meteo__manila
[0m15:36:42.494072 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_meteo__manila"
[0m15:36:42.495427 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_meteo__manila
[0m15:36:42.694318 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_meteo__manila"
[0m15:36:42.696109 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */


  create view `clean`.`stg_meteo__manila__dbt_tmp` 
  
    
    
  as (
    

-- Normalize types & naming; no business logic here.
select
  toDate(date)                         as dte,
  toFloat64(temp_min)                  as temp_min_c,
  toFloat64(temp_max)                  as temp_max_c,
  toFloat64(precipitation)             as precip_mm,
  toInt32(weather_code)                as weather_code
from `raw`.`meteo___manila`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m15:36:42.708187 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:36:42.720803 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila__dbt_backup` 
  
  ...
[0m15:36:42.724203 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:42.767625 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    rename table `clean`.`stg_meteo__manila` to `clean`.`stg_meteo__manila__dbt_backup` 
  
  ...
[0m15:36:42.770834 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:42.777318 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila` 
  
  ...
[0m15:36:42.780241 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:42.782064 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    rename table `clean`.`stg_meteo__manila__dbt_tmp` to `clean`.`stg_meteo__manila` 
  
  ...
[0m15:36:42.784907 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:42.878303 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila__dbt_backup` 
  ...
[0m15:36:42.881659 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:42.888044 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63aad592b0>]}
[0m15:36:42.889231 [info ] [Thread-1  ]: 1 of 8 OK created sql view model `clean`.`stg_meteo__manila` ................... [[32mOK[0m in 0.41s]
[0m15:36:42.890616 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_meteo__manila
[0m15:36:42.893258 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:36:42.894625 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:36:42.895793 [info ] [Thread-3  ]: 2 of 8 START test not_null_stg_meteo__manila_dte ............................... [RUN]
[0m15:36:42.897161 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:36:42.898699 [debug] [Thread-1  ]: Began running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:36:42.899801 [info ] [Thread-4  ]: 3 of 8 START test not_null_stg_meteo__manila_temp_max_c ........................ [RUN]
[0m15:36:42.902138 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f'
[0m15:36:42.903577 [info ] [Thread-2  ]: 4 of 8 START test not_null_stg_meteo__manila_temp_min_c ........................ [RUN]
[0m15:36:42.904578 [info ] [Thread-1  ]: 5 of 8 START test unique_stg_meteo__manila_dte ................................. [RUN]
[0m15:36:42.906092 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339'
[0m15:36:42.907861 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:36:42.909362 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9'
[0m15:36:42.910551 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_meteo__manila, now test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc)
[0m15:36:42.911886 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:36:42.982917 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:36:42.998189 [debug] [Thread-1  ]: Began compiling node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:36:43.011586 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m15:36:43.073458 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m15:36:43.080523 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m15:36:43.093206 [debug] [Thread-1  ]: Writing injected SQL for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m15:36:43.094864 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:36:43.095554 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:36:43.096407 [debug] [Thread-1  ]: Began executing node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:36:43.097127 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:36:43.302800 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m15:36:43.304692 [debug] [Thread-1  ]: Writing runtime sql for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m15:36:43.369340 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m15:36:43.377943 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m15:36:43.379836 [debug] [Thread-1  ]: dbt_clickhouse adapter: On test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    dte as unique_field,
    count(*) as n_records

from `clean`.`stg_meteo__manila`
where dte is not null
group by dte
having count(*) > 1



    ) dbt_internal_test...
[0m15:36:43.380963 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m15:36:43.383885 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m15:36:43.385262 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m15:36:43.394542 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:36:43.479570 [info ] [Thread-1  ]: 5 of 8 PASS unique_stg_meteo__manila_dte ....................................... [[32mPASS[0m in 0.57s]
[0m15:36:43.502870 [debug] [Thread-1  ]: Finished running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:36:43.631487 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select dte
from `clean`.`stg_meteo__manila`
where dte is null



    ) dbt_internal_test...
[0m15:36:43.670960 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m15:36:43.676992 [info ] [Thread-3  ]: 2 of 8 PASS not_null_stg_meteo__manila_dte ..................................... [[32mPASS[0m in 0.78s]
[0m15:36:43.680745 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_min_c
from `clean`.`stg_meteo__manila`
where temp_min_c is null



    ) dbt_internal_test...
[0m15:36:43.683804 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:36:43.695375 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_max_c
from `clean`.`stg_meteo__manila`
where temp_max_c is null



    ) dbt_internal_test...
[0m15:36:43.705893 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m15:36:43.712120 [info ] [Thread-2  ]: 4 of 8 PASS not_null_stg_meteo__manila_temp_min_c .............................. [[32mPASS[0m in 0.80s]
[0m15:36:43.715292 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:36:43.718634 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m15:36:43.769904 [info ] [Thread-4  ]: 3 of 8 PASS not_null_stg_meteo__manila_temp_max_c .............................. [[32mPASS[0m in 0.86s]
[0m15:36:43.772712 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:36:43.775974 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:36:43.777802 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:36:43.779896 [info ] [Thread-1  ]: 6 of 8 START sql table model `mart`.`mart_meteo__manila_daily` ................. [RUN]
[0m15:36:43.781790 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_meteo__manila_night_weather
[0m15:36:43.783944 [info ] [Thread-3  ]: 7 of 8 START sql table model `mart`.`mart_meteo__manila_monthly` ............... [RUN]
[0m15:36:43.785802 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc, now model.ex_03_meteo.mart_meteo__manila_daily)
[0m15:36:43.787947 [info ] [Thread-2  ]: 8 of 8 START sql view model `mart`.`vw_meteo__manila_night_weather` ............ [RUN]
[0m15:36:43.789836 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f, now model.ex_03_meteo.mart_meteo__manila_monthly)
[0m15:36:43.791494 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:36:43.793184 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9, now model.ex_03_meteo.vw_meteo__manila_night_weather)
[0m15:36:43.794903 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:36:43.809033 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m15:36:43.810715 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_meteo__manila_night_weather
[0m15:36:43.877692 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m15:36:43.892388 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_meteo__manila_night_weather"
[0m15:36:43.894476 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:36:43.907067 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:36:43.908828 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_meteo__manila_night_weather
[0m15:36:44.067421 [debug] [Thread-2  ]: Creating new relation vw_meteo__manila_night_weather
[0m15:36:44.076634 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_meteo__manila_night_weather"
[0m15:36:44.172866 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_meteo__manila_night_weather: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_meteo__manila_night_weather"} */


  create view `mart`.`vw_meteo__manila_night_weather` 
  
    
    
  as (
    

with daily as (
  select
    dte,
    temp_min_c,
    temp_max_c,
    (temp_min_c + temp_max_c)/2.0 as temp_avg_c,
    precip_mm,
    weather_code
  from `clean`.`stg_meteo__manila`
),
codes as (
  select
    toInt32(weather_code)                as weather_code,
    cast(night_description as String)    as condition_night,
    cast(night_icon_url as String)       as icon_url_night
  from `raw`.`meteo___wmo_codes`
)

select
  d.dte,
  d.temp_min_c,
  d.temp_max_c,
  d.temp_avg_c,
  d.precip_mm,
  d.weather_code,
  c.condition_night,
  c.icon_url_night
from daily d
left join codes c
  on c.weather_code = d.weather_code
order by d.dte
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m15:36:44.291419 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m15:36:44.379312 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63aaccd220>]}
[0m15:36:44.412002 [info ] [Thread-2  ]: 8 of 8 OK created sql view model `mart`.`vw_meteo__manila_night_weather` ....... [[32mOK[0m in 0.59s]
[0m15:36:44.484388 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

            

    
        create table `mart`.`mart_meteo__manila_daily__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (dte)
        
        partition by (toYYYYMM(dte))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Force non-nullable key for MergeTree
select
  assumeNotNull(dte)                         as dte,          -- 👈 non-nullable
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0              as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
          )
        
        ...
[0m15:36:44.488450 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

            

    
        create table `mart`.`mart_meteo__manila_monthly__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (month)
        
        partition by (toYYYYMM(month))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(dte)                            as dte_nn,   -- 👈 non-nullable
    toFloat64(temp_min_c)                         as temp_min_c,
    toFloat64(temp_max_c)                         as temp_max_c,
    (toFloat64(temp_min_c) + toFloat64(temp_max_c))/2.0 as temp_avg_c,
    toFloat64(precip_mm)                          as precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte_nn)                as month,             -- 👈 computed from non-null date
  avg(temp_min_c)                       as avg_min_c,
  avg(temp_max_c)                       as avg_max_c,
  avg(temp_avg_c)                       as avg_temp_c,
  sum(precip_mm)                        as total_precip_mm,
  countIf(precip_mm > 0)                as rainy_days
from base
group by month
order by month
          )
        
        ...
[0m15:36:44.492151 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_meteo__manila_night_weather
[0m15:36:44.513963 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m15:36:44.528933 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m15:36:44.572365 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

    select name, type from system.columns where table = 'mart_meteo__manila_daily__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m15:36:44.578867 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

    select name, type from system.columns where table = 'mart_meteo__manila_monthly__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m15:36:44.584445 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:44.586065 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:44.593233 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m15:36:44.596079 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m15:36:44.597540 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

  
    
    
    
        
         


        insert into `mart`.`mart_meteo__manila_monthly__dbt_backup`
        ("month", "avg_min_c", "avg_max_c", "avg_temp_c", "total_precip_mm", "rainy_days")

with base as (
  select
    assumeNotNull(dte)                            as dte_nn,   -- 👈 non-nullable
    toFloat64(temp_min_c)                         as temp_min_c,
    toFloat64(temp_max_c)                         as temp_max_c,
    (toFloat64(temp_min_c) + toFloat64(temp_max_c))/2.0 as temp_avg_c,
    toFloat64(precip_mm)                          as precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte_nn)                as month,             -- 👈 computed from non-null date
  avg(temp_min_c)                       as avg_min_c,
  avg(temp_max_c)                       as avg_max_c,
  avg(temp_avg_c)                       as avg_temp_c,
  sum(precip_mm)                        as total_precip_mm,
  countIf(precip_mm > 0)                as rainy_days
from base
group by month
order by month
  ...
[0m15:36:44.598574 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

  
    
    
    
        
         


        insert into `mart`.`mart_meteo__manila_daily__dbt_backup`
        ("dte", "temp_min_c", "temp_max_c", "temp_avg_c", "precip_mm", "weather_code")

-- Force non-nullable key for MergeTree
select
  assumeNotNull(dte)                         as dte,          -- 👈 non-nullable
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0              as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
  ...
[0m15:36:44.627315 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m15:36:44.668058 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m15:36:44.669436 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */
EXCHANGE TABLES `mart`.`mart_meteo__manila_daily__dbt_backup` AND `mart`.`mart_meteo__manila_daily` 
  
  ...
[0m15:36:44.671496 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */
EXCHANGE TABLES `mart`.`mart_meteo__manila_monthly__dbt_backup` AND `mart`.`mart_meteo__manila_monthly` 
  
  ...
[0m15:36:44.674712 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:44.681160 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:36:44.682645 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

    drop table if exists `mart`.`mart_meteo__manila_daily__dbt_backup` 
  ...
[0m15:36:44.690259 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

    drop table if exists `mart`.`mart_meteo__manila_monthly__dbt_backup` 
  ...
[0m15:36:44.694098 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:44.695790 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:36:44.698658 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63a9eb6f70>]}
[0m15:36:44.702869 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '883e48ce-5627-46b3-a880-4911742117d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63a9edceb0>]}
[0m15:36:44.704945 [info ] [Thread-1  ]: 6 of 8 OK created sql table model `mart`.`mart_meteo__manila_daily` ............ [[32mOK[0m in 0.91s]
[0m15:36:44.706956 [info ] [Thread-3  ]: 7 of 8 OK created sql table model `mart`.`mart_meteo__manila_monthly` .......... [[32mOK[0m in 0.91s]
[0m15:36:44.709015 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:36:44.710559 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:36:44.713206 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:36:44.714292 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_daily' was left open.
[0m15:36:44.715350 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_daily: Close
[0m15:36:44.716225 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m15:36:44.768035 [debug] [MainThread]: On list__clean: Close
[0m15:36:44.769199 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_monthly' was left open.
[0m15:36:44.770554 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_monthly: Close
[0m15:36:44.771334 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339' was left open.
[0m15:36:44.772484 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339: Close
[0m15:36:44.773552 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_meteo__manila_night_weather' was left open.
[0m15:36:44.775188 [debug] [MainThread]: On model.ex_03_meteo.vw_meteo__manila_night_weather: Close
[0m15:36:44.777508 [info ] [MainThread]: 
[0m15:36:44.779234 [info ] [MainThread]: Finished running 2 view models, 4 data tests, 2 table models in 0 hours 0 minutes and 3.76 seconds (3.76s).
[0m15:36:44.789826 [debug] [MainThread]: Command end result
[0m15:36:44.971153 [info ] [MainThread]: 
[0m15:36:44.972515 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:36:44.973807 [info ] [MainThread]: 
[0m15:36:44.975387 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
[0m15:36:44.977910 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 8.180407, "process_in_blocks": "0", "process_kernel_time": 0.708007, "process_mem_max_rss": "118564", "process_out_blocks": "10760", "process_user_time": 6.789074}
[0m15:36:44.979271 [debug] [MainThread]: Command `dbt build` succeeded at 15:36:44.978939 after 8.18 seconds
[0m15:36:44.980345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63af6ec310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63ad5fda60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d63ab506e50>]}
[0m15:36:44.981234 [debug] [MainThread]: Flushing usage events
[0m15:37:28.896480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639d1fd8310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cec2eb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cec2ea00>]}


============================== 15:37:28.906035 | 44d80b62-f5de-47ad-9490-491a483a09f7 ==============================
[0m15:37:28.906035 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:37:28.907109 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'log_cache_events': 'False', 'use_colors': 'True', 'warn_error': 'None', 'version_check': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'introspect': 'True', 'empty': 'False', 'write_json': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'debug': 'False', 'cache_selected_only': 'False', 'printer_width': '80', 'static_parser': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': '/workdir/transforms/03_meteo/logs', 'profiles_dir': '.', 'target_path': 'None', 'no_print': 'None', 'partial_parse': 'True'}
[0m15:37:29.493081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639d1565ca0>]}
[0m15:37:29.688691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639ceb48dc0>]}
[0m15:37:29.689984 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m15:37:30.110461 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m15:37:30.616822 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:37:30.617812 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/mart/vw_meteo__manila_night_weather.sql
[0m15:37:31.509433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cdf07fa0>]}
[0m15:37:31.991337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cddafc10>]}
[0m15:37:31.992201 [info ] [MainThread]: Found 4 models, 4 data tests, 2 sources, 471 macros
[0m15:37:31.995846 [info ] [MainThread]: 
[0m15:37:31.996913 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m15:37:32.009780 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:37:32.011312 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:37:32.104425 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:37:32.111227 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:37:32.778964 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:37:32.787451 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:37:32.791820 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:32.794473 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:33.089731 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m15:37:33.091218 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m15:37:33.106398 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m15:37:33.111922 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m15:37:33.123904 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:33.125898 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:33.186921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639d1f2a7c0>]}
[0m15:37:33.189185 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m15:37:33.190697 [info ] [MainThread]: 
[0m15:37:33.218352 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_meteo__manila
[0m15:37:33.219919 [info ] [Thread-1  ]: 1 of 8 START sql view model `clean`.`stg_meteo__manila` ........................ [RUN]
[0m15:37:33.221164 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_03_meteo.stg_meteo__manila)
[0m15:37:33.272686 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_meteo__manila
[0m15:37:33.298602 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_meteo__manila"
[0m15:37:33.300128 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_meteo__manila
[0m15:37:33.499034 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_meteo__manila"
[0m15:37:33.500835 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */


  create view `clean`.`stg_meteo__manila__dbt_tmp` 
  
    
    
  as (
    

-- Normalize types & naming; no business logic here.
select
  toDate(date)                         as dte,
  toFloat64(temp_min)                  as temp_min_c,
  toFloat64(temp_max)                  as temp_max_c,
  toFloat64(precipitation)             as precip_mm,
  toInt32(weather_code)                as weather_code
from `raw`.`meteo___manila`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m15:37:33.512327 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:33.526744 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila__dbt_backup` 
  
  ...
[0m15:37:33.529798 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:37:33.573227 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    rename table `clean`.`stg_meteo__manila` to `clean`.`stg_meteo__manila__dbt_backup` 
  
  ...
[0m15:37:33.576427 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:37:33.582771 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila` 
  
  ...
[0m15:37:33.586033 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:37:33.588164 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    rename table `clean`.`stg_meteo__manila__dbt_tmp` to `clean`.`stg_meteo__manila` 
  
  ...
[0m15:37:33.590880 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:37:33.690577 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila__dbt_backup` 
  ...
[0m15:37:33.695070 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:37:33.701277 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cebf4d30>]}
[0m15:37:33.702631 [info ] [Thread-1  ]: 1 of 8 OK created sql view model `clean`.`stg_meteo__manila` ................... [[32mOK[0m in 0.48s]
[0m15:37:33.704050 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_meteo__manila
[0m15:37:33.706308 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:37:33.707426 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:37:33.708468 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:37:33.709772 [info ] [Thread-3  ]: 2 of 8 START test not_null_stg_meteo__manila_dte ............................... [RUN]
[0m15:37:33.711197 [debug] [Thread-1  ]: Began running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:37:33.711994 [info ] [Thread-4  ]: 3 of 8 START test not_null_stg_meteo__manila_temp_max_c ........................ [RUN]
[0m15:37:33.713054 [info ] [Thread-2  ]: 4 of 8 START test not_null_stg_meteo__manila_temp_min_c ........................ [RUN]
[0m15:37:33.714858 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f'
[0m15:37:33.716254 [info ] [Thread-1  ]: 5 of 8 START test unique_stg_meteo__manila_dte ................................. [RUN]
[0m15:37:33.717886 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339'
[0m15:37:33.720006 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9'
[0m15:37:33.721742 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:37:33.772606 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_meteo__manila, now test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc)
[0m15:37:33.774234 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:37:33.775906 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:37:33.799311 [debug] [Thread-1  ]: Began compiling node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:37:33.892933 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m15:37:33.897311 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m15:37:33.906741 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m15:37:33.982066 [debug] [Thread-1  ]: Writing injected SQL for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m15:37:33.984210 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:37:34.004766 [debug] [Thread-1  ]: Began executing node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:37:34.006387 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:37:34.093087 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:37:34.200186 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m15:37:34.211464 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m15:37:34.303277 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m15:37:34.306520 [debug] [Thread-1  ]: Writing runtime sql for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m15:37:34.314319 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m15:37:34.379999 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m15:37:34.388199 [debug] [Thread-1  ]: dbt_clickhouse adapter: On test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    dte as unique_field,
    count(*) as n_records

from `clean`.`stg_meteo__manila`
where dte is not null
group by dte
having count(*) > 1



    ) dbt_internal_test...
[0m15:37:34.393297 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m15:37:34.476009 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m15:37:34.499416 [info ] [Thread-1  ]: 5 of 8 PASS unique_stg_meteo__manila_dte ....................................... [[32mPASS[0m in 0.73s]
[0m15:37:34.573640 [debug] [Thread-1  ]: Finished running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:37:34.680742 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_min_c
from `clean`.`stg_meteo__manila`
where temp_min_c is null



    ) dbt_internal_test...
[0m15:37:34.695739 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:34.705083 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_max_c
from `clean`.`stg_meteo__manila`
where temp_max_c is null



    ) dbt_internal_test...
[0m15:37:34.710047 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select dte
from `clean`.`stg_meteo__manila`
where dte is null



    ) dbt_internal_test...
[0m15:37:34.702730 [info ] [Thread-2  ]: 4 of 8 PASS not_null_stg_meteo__manila_temp_min_c .............................. [[32mPASS[0m in 0.98s]
[0m15:37:34.715505 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:37:34.772287 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:34.775779 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m15:37:34.783067 [info ] [Thread-4  ]: 3 of 8 PASS not_null_stg_meteo__manila_temp_max_c .............................. [[32mPASS[0m in 1.07s]
[0m15:37:34.789641 [info ] [Thread-3  ]: 2 of 8 PASS not_null_stg_meteo__manila_dte ..................................... [[32mPASS[0m in 1.07s]
[0m15:37:34.792721 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:37:34.795613 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:37:34.799393 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:37:34.801155 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:37:34.803311 [info ] [Thread-1  ]: 6 of 8 START sql table model `mart`.`mart_meteo__manila_daily` ................. [RUN]
[0m15:37:34.805269 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_meteo__manila_night_weather
[0m15:37:34.807506 [info ] [Thread-2  ]: 7 of 8 START sql table model `mart`.`mart_meteo__manila_monthly` ............... [RUN]
[0m15:37:34.809437 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc, now model.ex_03_meteo.mart_meteo__manila_daily)
[0m15:37:34.811573 [info ] [Thread-4  ]: 8 of 8 START sql view model `mart`.`vw_meteo__manila_night_weather` ............ [RUN]
[0m15:37:34.813611 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9, now model.ex_03_meteo.mart_meteo__manila_monthly)
[0m15:37:34.815324 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:37:34.816967 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339, now model.ex_03_meteo.vw_meteo__manila_night_weather)
[0m15:37:34.818618 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:37:34.886250 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m15:37:34.887647 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_meteo__manila_night_weather
[0m15:37:34.895530 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m15:37:34.903477 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_meteo__manila_night_weather"
[0m15:37:34.904740 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:37:34.905771 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:37:34.916973 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_meteo__manila_night_weather
[0m15:37:35.097158 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_meteo__manila_night_weather"
[0m15:37:35.207865 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_meteo__manila_night_weather: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_meteo__manila_night_weather"} */


  create view `mart`.`vw_meteo__manila_night_weather__dbt_tmp` 
  
    
    
  as (
    

with daily as (
  select
    dte,
    temp_min_c,
    temp_max_c,
    (temp_min_c + temp_max_c)/2.0 as temp_avg_c,
    precip_mm,
    weather_code
  from `clean`.`stg_meteo__manila`
),
codes as (
  select
    toInt32(weather_code)                as weather_code,
    cast(night_description as String)    as condition
  from `raw`.`meteo___wmo_codes`
)

select
  d.dte,
  d.temp_min_c,
  d.temp_max_c,
  d.temp_avg_c,
  d.precip_mm,
  d.weather_code,
  c.condition
from daily d
left join codes c
  on c.weather_code = d.weather_code
order by d.dte
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m15:37:35.373415 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.15 seconds
[0m15:37:35.408166 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

            

    
        create table `mart`.`mart_meteo__manila_daily__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (dte)
        
        partition by (toYYYYMM(dte))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Force non-nullable key for MergeTree
select
  assumeNotNull(dte)                         as dte,          -- 👈 non-nullable
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0              as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
          )
        
        ...
[0m15:37:35.409680 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_meteo__manila_night_weather: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_meteo__manila_night_weather"} */

    drop table if exists `mart`.`vw_meteo__manila_night_weather__dbt_backup` 
  
  ...
[0m15:37:35.415451 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

            

    
        create table `mart`.`mart_meteo__manila_monthly__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (month)
        
        partition by (toYYYYMM(month))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(dte)                            as dte_nn,   -- 👈 non-nullable
    toFloat64(temp_min_c)                         as temp_min_c,
    toFloat64(temp_max_c)                         as temp_max_c,
    (toFloat64(temp_min_c) + toFloat64(temp_max_c))/2.0 as temp_avg_c,
    toFloat64(precip_mm)                          as precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte_nn)                as month,             -- 👈 computed from non-null date
  avg(temp_min_c)                       as avg_min_c,
  avg(temp_max_c)                       as avg_max_c,
  avg(temp_avg_c)                       as avg_temp_c,
  sum(precip_mm)                        as total_precip_mm,
  countIf(precip_mm > 0)                as rainy_days
from base
group by month
order by month
          )
        
        ...
[0m15:37:35.473963 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m15:37:35.492219 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m15:37:35.505118 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m15:37:35.509253 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_meteo__manila_night_weather: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_meteo__manila_night_weather"} */

    rename table `mart`.`vw_meteo__manila_night_weather` to `mart`.`vw_meteo__manila_night_weather__dbt_backup` 
  
  ...
[0m15:37:35.518984 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

    select name, type from system.columns where table = 'mart_meteo__manila_daily__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m15:37:35.581955 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

    select name, type from system.columns where table = 'mart_meteo__manila_monthly__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m15:37:35.588820 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:35.594009 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:35.602399 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:35.609920 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_meteo__manila_night_weather: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_meteo__manila_night_weather"} */

    drop table if exists `mart`.`vw_meteo__manila_night_weather` 
  
  ...
[0m15:37:35.674369 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m15:37:35.679874 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m15:37:35.684874 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

  
    
    
    
        
         


        insert into `mart`.`mart_meteo__manila_daily__dbt_backup`
        ("dte", "temp_min_c", "temp_max_c", "temp_avg_c", "precip_mm", "weather_code")

-- Force non-nullable key for MergeTree
select
  assumeNotNull(dte)                         as dte,          -- 👈 non-nullable
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0              as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
  ...
[0m15:37:35.687508 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:35.693426 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_meteo__manila_night_weather: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_meteo__manila_night_weather"} */

    rename table `mart`.`vw_meteo__manila_night_weather__dbt_tmp` to `mart`.`vw_meteo__manila_night_weather` 
  
  ...
[0m15:37:35.697830 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

  
    
    
    
        
         


        insert into `mart`.`mart_meteo__manila_monthly__dbt_backup`
        ("month", "avg_min_c", "avg_max_c", "avg_temp_c", "total_precip_mm", "rainy_days")

with base as (
  select
    assumeNotNull(dte)                            as dte_nn,   -- 👈 non-nullable
    toFloat64(temp_min_c)                         as temp_min_c,
    toFloat64(temp_max_c)                         as temp_max_c,
    (toFloat64(temp_min_c) + toFloat64(temp_max_c))/2.0 as temp_avg_c,
    toFloat64(precip_mm)                          as precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte_nn)                as month,             -- 👈 computed from non-null date
  avg(temp_min_c)                       as avg_min_c,
  avg(temp_max_c)                       as avg_max_c,
  avg(temp_avg_c)                       as avg_temp_c,
  sum(precip_mm)                        as total_precip_mm,
  countIf(precip_mm > 0)                as rainy_days
from base
group by month
order by month
  ...
[0m15:37:35.705284 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:35.777770 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_meteo__manila_night_weather: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_meteo__manila_night_weather"} */

    drop table if exists `mart`.`vw_meteo__manila_night_weather__dbt_backup` 
  ...
[0m15:37:35.780522 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m15:37:35.773444 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m15:37:35.795759 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:35.804191 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */
EXCHANGE TABLES `mart`.`mart_meteo__manila_daily__dbt_backup` AND `mart`.`mart_meteo__manila_daily` 
  
  ...
[0m15:37:35.808623 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */
EXCHANGE TABLES `mart`.`mart_meteo__manila_monthly__dbt_backup` AND `mart`.`mart_meteo__manila_monthly` 
  
  ...
[0m15:37:35.813670 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cda59c10>]}
[0m15:37:35.872394 [info ] [Thread-4  ]: 8 of 8 OK created sql view model `mart`.`vw_meteo__manila_night_weather` ....... [[32mOK[0m in 1.00s]
[0m15:37:35.875852 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m15:37:35.878931 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_meteo__manila_night_weather
[0m15:37:35.892569 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m15:37:35.896712 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

    drop table if exists `mart`.`mart_meteo__manila_daily__dbt_backup` 
  ...
[0m15:37:35.911408 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

    drop table if exists `mart`.`mart_meteo__manila_monthly__dbt_backup` 
  ...
[0m15:37:35.918512 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:37:35.973354 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m15:37:35.978651 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cda4e880>]}
[0m15:37:35.984026 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44d80b62-f5de-47ad-9490-491a483a09f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cda57e50>]}
[0m15:37:35.986567 [info ] [Thread-1  ]: 6 of 8 OK created sql table model `mart`.`mart_meteo__manila_daily` ............ [[32mOK[0m in 1.17s]
[0m15:37:35.989289 [info ] [Thread-2  ]: 7 of 8 OK created sql table model `mart`.`mart_meteo__manila_monthly` .......... [[32mOK[0m in 1.17s]
[0m15:37:35.992644 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:37:35.996111 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:37:36.000601 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:37:36.001926 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_daily' was left open.
[0m15:37:36.003177 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_daily: Close
[0m15:37:36.004334 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m15:37:36.005568 [debug] [MainThread]: On list__clean: Close
[0m15:37:36.006822 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f' was left open.
[0m15:37:36.007998 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f: Close
[0m15:37:36.009195 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_meteo__manila_night_weather' was left open.
[0m15:37:36.010370 [debug] [MainThread]: On model.ex_03_meteo.vw_meteo__manila_night_weather: Close
[0m15:37:36.011545 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_monthly' was left open.
[0m15:37:36.012714 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_monthly: Close
[0m15:37:36.014894 [info ] [MainThread]: 
[0m15:37:36.016365 [info ] [MainThread]: Finished running 2 view models, 4 data tests, 2 table models in 0 hours 0 minutes and 4.02 seconds (4.02s).
[0m15:37:36.073959 [debug] [MainThread]: Command end result
[0m15:37:36.280883 [info ] [MainThread]: 
[0m15:37:36.281831 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:37:36.282460 [info ] [MainThread]: 
[0m15:37:36.283151 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
[0m15:37:36.284552 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.578497, "process_in_blocks": "0", "process_kernel_time": 0.682573, "process_mem_max_rss": "115960", "process_out_blocks": "10768", "process_user_time": 6.469437}
[0m15:37:36.285359 [debug] [MainThread]: Command `dbt build` succeeded at 15:37:36.285162 after 7.58 seconds
[0m15:37:36.286050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639d1fd8310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cfef6940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7639cfe63f70>]}
[0m15:37:36.286674 [debug] [MainThread]: Flushing usage events
[0m15:39:29.299563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70899b86d310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7089984d1ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7089984d1970>]}


============================== 15:39:29.359802 | 01efb72d-0201-4d73-8e52-98a582b86a5e ==============================
[0m15:39:29.359802 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:39:29.360954 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'profiles_dir': '.', 'cache_selected_only': 'False', 'log_path': '/workdir/transforms/03_meteo/logs', 'invocation_command': 'dbt build --profiles-dir . --target local', 'static_parser': 'True', 'no_print': 'None', 'debug': 'False', 'partial_parse': 'True', 'write_json': 'True', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'empty': 'False', 'target_path': 'None', 'quiet': 'False', 'printer_width': '80'}
[0m15:39:29.887807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70899856bd90>]}
[0m15:39:30.080446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708998488250>]}
[0m15:39:30.081732 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m15:39:30.493868 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m15:39:30.996960 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m15:39:30.997856 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/mart/vw_meteo__manila_weather.sql
[0m15:39:30.998436 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/mart/vw_meteo__manila_night_weather.sql
[0m15:39:31.894840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7089977a5f10>]}
[0m15:39:32.371571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708997718af0>]}
[0m15:39:32.372469 [info ] [MainThread]: Found 4 models, 4 data tests, 2 sources, 471 macros
[0m15:39:32.376086 [info ] [MainThread]: 
[0m15:39:32.377315 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m15:39:32.389504 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:39:32.395838 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:39:32.409839 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:39:32.464902 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:39:33.010452 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:39:33.016514 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:39:33.020155 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:39:33.023149 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:39:33.263444 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m15:39:33.275599 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m15:39:33.280503 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m15:39:33.288047 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m15:39:33.297266 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:39:33.307068 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m15:39:33.362790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70899726da60>]}
[0m15:39:33.364742 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m15:39:33.366027 [info ] [MainThread]: 
[0m15:39:33.390815 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_meteo__manila
[0m15:39:33.391951 [info ] [Thread-1  ]: 1 of 8 START sql view model `clean`.`stg_meteo__manila` ........................ [RUN]
[0m15:39:33.392804 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_03_meteo.stg_meteo__manila)
[0m15:39:33.393549 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_meteo__manila
[0m15:39:33.462213 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_meteo__manila"
[0m15:39:33.463359 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_meteo__manila
[0m15:39:33.587734 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_meteo__manila"
[0m15:39:33.589336 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */


  create view `clean`.`stg_meteo__manila__dbt_tmp` 
  
    
    
  as (
    

-- Normalize types & naming; no business logic here.
select
  toDate(date)                         as dte,
  toFloat64(temp_min)                  as temp_min_c,
  toFloat64(temp_max)                  as temp_max_c,
  toFloat64(precipitation)             as precip_mm,
  toInt32(weather_code)                as weather_code
from `raw`.`meteo___manila`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m15:39:33.600957 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:39:33.614339 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila__dbt_backup` 
  
  ...
[0m15:39:33.617355 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:33.660484 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    rename table `clean`.`stg_meteo__manila` to `clean`.`stg_meteo__manila__dbt_backup` 
  
  ...
[0m15:39:33.663409 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:33.668741 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila` 
  
  ...
[0m15:39:33.671389 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:33.673114 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    rename table `clean`.`stg_meteo__manila__dbt_tmp` to `clean`.`stg_meteo__manila` 
  
  ...
[0m15:39:33.675795 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:33.770228 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_meteo__manila: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_meteo__manila"} */

    drop table if exists `clean`.`stg_meteo__manila__dbt_backup` 
  ...
[0m15:39:33.773961 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:33.779993 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708997304f70>]}
[0m15:39:33.781143 [info ] [Thread-1  ]: 1 of 8 OK created sql view model `clean`.`stg_meteo__manila` ................... [[32mOK[0m in 0.39s]
[0m15:39:33.782555 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_meteo__manila
[0m15:39:33.784797 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:39:33.785674 [info ] [Thread-3  ]: 2 of 8 START test not_null_stg_meteo__manila_dte ............................... [RUN]
[0m15:39:33.786908 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:39:33.788490 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f'
[0m15:39:33.789500 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:39:33.791286 [info ] [Thread-4  ]: 3 of 8 START test not_null_stg_meteo__manila_temp_max_c ........................ [RUN]
[0m15:39:33.792823 [debug] [Thread-1  ]: Began running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:39:33.793957 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:39:33.795350 [info ] [Thread-2  ]: 4 of 8 START test not_null_stg_meteo__manila_temp_min_c ........................ [RUN]
[0m15:39:33.796959 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339'
[0m15:39:33.798419 [info ] [Thread-1  ]: 5 of 8 START test unique_stg_meteo__manila_dte ................................. [RUN]
[0m15:39:33.866121 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9'
[0m15:39:33.896456 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:39:33.902097 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m15:39:33.903799 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_meteo__manila, now test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc)
[0m15:39:33.905312 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:39:33.971364 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m15:39:33.974098 [debug] [Thread-1  ]: Began compiling node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:39:33.976032 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:39:33.991420 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m15:39:34.065033 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:39:34.085363 [debug] [Thread-1  ]: Writing injected SQL for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m15:39:34.108315 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:39:34.271979 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"
[0m15:39:34.283930 [debug] [Thread-1  ]: Began executing node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:39:34.295963 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"
[0m15:39:34.305489 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"
[0m15:39:34.365725 [debug] [Thread-1  ]: Writing runtime sql for node "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"
[0m15:39:34.368207 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m15:39:34.424128 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m15:39:34.425340 [debug] [Thread-1  ]: dbt_clickhouse adapter: On test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    dte as unique_field,
    count(*) as n_records

from `clean`.`stg_meteo__manila`
where dte is not null
group by dte
having count(*) > 1



    ) dbt_internal_test...
[0m15:39:34.426590 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m15:39:34.484397 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select dte
from `clean`.`stg_meteo__manila`
where dte is null



    ) dbt_internal_test...
[0m15:39:34.491802 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m15:39:34.571818 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m15:39:34.581107 [info ] [Thread-1  ]: 5 of 8 PASS unique_stg_meteo__manila_dte ....................................... [[32mPASS[0m in 0.68s]
[0m15:39:34.586973 [info ] [Thread-3  ]: 2 of 8 PASS not_null_stg_meteo__manila_dte ..................................... [[32mPASS[0m in 0.80s]
[0m15:39:34.599292 [debug] [Thread-1  ]: Finished running node test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc
[0m15:39:34.660160 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f
[0m15:39:34.684662 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_min_c
from `clean`.`stg_meteo__manila`
where temp_min_c is null



    ) dbt_internal_test...
[0m15:39:34.693079 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:39:34.697968 [info ] [Thread-2  ]: 4 of 8 PASS not_null_stg_meteo__manila_temp_min_c .............................. [[32mPASS[0m in 0.83s]
[0m15:39:34.700066 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9
[0m15:39:34.712189 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select temp_max_c
from `clean`.`stg_meteo__manila`
where temp_max_c is null



    ) dbt_internal_test...
[0m15:39:34.718881 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:39:34.722845 [info ] [Thread-4  ]: 3 of 8 PASS not_null_stg_meteo__manila_temp_max_c .............................. [[32mPASS[0m in 0.93s]
[0m15:39:34.724634 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339
[0m15:39:34.726976 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:39:34.727874 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:39:34.728981 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_meteo__manila_weather
[0m15:39:34.730643 [info ] [Thread-1  ]: 6 of 8 START sql table model `mart`.`mart_meteo__manila_daily` ................. [RUN]
[0m15:39:34.732336 [info ] [Thread-3  ]: 7 of 8 START sql table model `mart`.`mart_meteo__manila_monthly` ............... [RUN]
[0m15:39:34.762179 [info ] [Thread-2  ]: 8 of 8 START sql view model `mart`.`vw_meteo__manila_weather` .................. [RUN]
[0m15:39:34.764202 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.unique_stg_meteo__manila_dte.65d5c5a8bc, now model.ex_03_meteo.mart_meteo__manila_daily)
[0m15:39:34.765870 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_meteo__manila_dte.513a28a12f, now model.ex_03_meteo.mart_meteo__manila_monthly)
[0m15:39:34.767401 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_meteo__manila_temp_min_c.f577a564e9, now model.ex_03_meteo.vw_meteo__manila_weather)
[0m15:39:34.769267 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:39:34.771640 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:39:34.773338 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_meteo__manila_weather
[0m15:39:34.790099 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m15:39:34.860270 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m15:39:34.877309 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_meteo__manila_weather"
[0m15:39:34.879876 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:39:34.892592 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:39:34.899490 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_meteo__manila_weather
[0m15:39:35.005508 [debug] [Thread-2  ]: Creating new relation vw_meteo__manila_weather
[0m15:39:35.085595 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_meteo__manila_weather"
[0m15:39:35.204452 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_meteo__manila_weather: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_meteo__manila_weather"} */


  create view `mart`.`vw_meteo__manila_weather` 
  
    
    
  as (
    

with daily as (
  select
    dte,
    temp_min_c,
    temp_max_c,
    (temp_min_c + temp_max_c)/2.0 as temp_avg_c,
    precip_mm,
    weather_code
  from `clean`.`stg_meteo__manila`
),
codes as (
  select
    toInt32(weather_code)                as weather_code,
    cast(night_description as String)    as condition
  from `raw`.`meteo___wmo_codes`
)

select
  d.dte,
  d.temp_min_c,
  d.temp_max_c,
  d.temp_avg_c,
  d.precip_mm,
  d.weather_code,
  c.condition
from daily d
left join codes c
  on c.weather_code = d.weather_code
order by d.dte
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m15:39:35.382418 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m15:39:35.468202 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7089972f96d0>]}
[0m15:39:35.475761 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

            

    
        create table `mart`.`mart_meteo__manila_monthly__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (month)
        
        partition by (toYYYYMM(month))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(dte)                            as dte_nn,   -- 👈 non-nullable
    toFloat64(temp_min_c)                         as temp_min_c,
    toFloat64(temp_max_c)                         as temp_max_c,
    (toFloat64(temp_min_c) + toFloat64(temp_max_c))/2.0 as temp_avg_c,
    toFloat64(precip_mm)                          as precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte_nn)                as month,             -- 👈 computed from non-null date
  avg(temp_min_c)                       as avg_min_c,
  avg(temp_max_c)                       as avg_max_c,
  avg(temp_avg_c)                       as avg_temp_c,
  sum(precip_mm)                        as total_precip_mm,
  countIf(precip_mm > 0)                as rainy_days
from base
group by month
order by month
          )
        
        ...
[0m15:39:35.480170 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

            

    
        create table `mart`.`mart_meteo__manila_daily__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (dte)
        
        partition by (toYYYYMM(dte))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

-- Force non-nullable key for MergeTree
select
  assumeNotNull(dte)                         as dte,          -- 👈 non-nullable
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0              as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
          )
        
        ...
[0m15:39:35.481895 [info ] [Thread-2  ]: 8 of 8 OK created sql view model `mart`.`vw_meteo__manila_weather` ............. [[32mOK[0m in 0.70s]
[0m15:39:35.485960 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_meteo__manila_weather
[0m15:39:35.502959 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m15:39:35.519786 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m15:39:35.521120 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

    select name, type from system.columns where table = 'mart_meteo__manila_daily__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m15:39:35.562202 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

    select name, type from system.columns where table = 'mart_meteo__manila_monthly__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m15:39:35.567363 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:35.568793 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:35.575027 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_meteo__manila_daily"
[0m15:39:35.577663 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_meteo__manila_monthly"
[0m15:39:35.579091 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

  
    
    
    
        
         


        insert into `mart`.`mart_meteo__manila_monthly__dbt_backup`
        ("month", "avg_min_c", "avg_max_c", "avg_temp_c", "total_precip_mm", "rainy_days")

with base as (
  select
    assumeNotNull(dte)                            as dte_nn,   -- 👈 non-nullable
    toFloat64(temp_min_c)                         as temp_min_c,
    toFloat64(temp_max_c)                         as temp_max_c,
    (toFloat64(temp_min_c) + toFloat64(temp_max_c))/2.0 as temp_avg_c,
    toFloat64(precip_mm)                          as precip_mm
  from `clean`.`stg_meteo__manila`
)
select
  toStartOfMonth(dte_nn)                as month,             -- 👈 computed from non-null date
  avg(temp_min_c)                       as avg_min_c,
  avg(temp_max_c)                       as avg_max_c,
  avg(temp_avg_c)                       as avg_temp_c,
  sum(precip_mm)                        as total_precip_mm,
  countIf(precip_mm > 0)                as rainy_days
from base
group by month
order by month
  ...
[0m15:39:35.580139 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

  
    
    
    
        
         


        insert into `mart`.`mart_meteo__manila_daily__dbt_backup`
        ("dte", "temp_min_c", "temp_max_c", "temp_avg_c", "precip_mm", "weather_code")

-- Force non-nullable key for MergeTree
select
  assumeNotNull(dte)                         as dte,          -- 👈 non-nullable
  temp_min_c,
  temp_max_c,
  (temp_min_c + temp_max_c)/2.0              as temp_avg_c,
  precip_mm,
  weather_code
from `clean`.`stg_meteo__manila`
  ...
[0m15:39:35.595675 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:39:35.604694 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */
EXCHANGE TABLES `mart`.`mart_meteo__manila_daily__dbt_backup` AND `mart`.`mart_meteo__manila_daily` 
  
  ...
[0m15:39:35.608105 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:35.615219 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_daily: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_daily"} */

    drop table if exists `mart`.`mart_meteo__manila_daily__dbt_backup` 
  ...
[0m15:39:35.618739 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:35.621474 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7089985c7d30>]}
[0m15:39:35.660564 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m15:39:35.661438 [info ] [Thread-1  ]: 6 of 8 OK created sql table model `mart`.`mart_meteo__manila_daily` ............ [[32mOK[0m in 0.86s]
[0m15:39:35.663792 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */
EXCHANGE TABLES `mart`.`mart_meteo__manila_monthly__dbt_backup` AND `mart`.`mart_meteo__manila_monthly` 
  
  ...
[0m15:39:35.665180 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_daily
[0m15:39:35.668356 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:35.675162 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_meteo__manila_monthly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_meteo__manila_monthly"} */

    drop table if exists `mart`.`mart_meteo__manila_monthly__dbt_backup` 
  ...
[0m15:39:35.678322 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:39:35.681187 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01efb72d-0201-4d73-8e52-98a582b86a5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7089972e7cd0>]}
[0m15:39:35.682949 [info ] [Thread-3  ]: 7 of 8 OK created sql table model `mart`.`mart_meteo__manila_monthly` .......... [[32mOK[0m in 0.92s]
[0m15:39:35.684565 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_meteo__manila_monthly
[0m15:39:35.686614 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:39:35.687168 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_daily' was left open.
[0m15:39:35.687761 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_daily: Close
[0m15:39:35.688240 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m15:39:35.688774 [debug] [MainThread]: On list__clean: Close
[0m15:39:35.689292 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_meteo__manila_monthly' was left open.
[0m15:39:35.689808 [debug] [MainThread]: On model.ex_03_meteo.mart_meteo__manila_monthly: Close
[0m15:39:35.690328 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339' was left open.
[0m15:39:35.690895 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_meteo__manila_temp_max_c.a5e6f8c339: Close
[0m15:39:35.691395 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_meteo__manila_weather' was left open.
[0m15:39:35.691985 [debug] [MainThread]: On model.ex_03_meteo.vw_meteo__manila_weather: Close
[0m15:39:35.693132 [info ] [MainThread]: 
[0m15:39:35.693854 [info ] [MainThread]: Finished running 2 view models, 4 data tests, 2 table models in 0 hours 0 minutes and 3.32 seconds (3.32s).
[0m15:39:35.698175 [debug] [MainThread]: Command end result
[0m15:39:35.804969 [info ] [MainThread]: 
[0m15:39:35.805916 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:39:35.806569 [info ] [MainThread]: 
[0m15:39:35.807288 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
[0m15:39:35.859996 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.754122, "process_in_blocks": "0", "process_kernel_time": 0.677149, "process_mem_max_rss": "115812", "process_out_blocks": "10752", "process_user_time": 5.994761}
[0m15:39:35.860933 [debug] [MainThread]: Command `dbt build` succeeded at 15:39:35.860735 after 6.76 seconds
[0m15:39:35.861599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70899b86d310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708997cb5790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708997655c40>]}
[0m15:39:35.862189 [debug] [MainThread]: Flushing usage events
[0m16:22:12.446886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d7ce9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d494ca90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d494c940>]}


============================== 16:22:12.456134 | bdcd5668-b02c-477e-935e-bcac2aaca4d0 ==============================
[0m16:22:12.456134 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:22:12.457243 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'warn_error': 'None', 'debug': 'False', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'use_colors': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'introspect': 'True', 'indirect_selection': 'eager', 'log_path': '/workdir/transforms/04_btc/logs', 'cache_selected_only': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'static_parser': 'True', 'log_format': 'default', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'fail_fast': 'False', 'target_path': 'None', 'printer_width': '80', 'log_cache_events': 'False'}
[0m16:22:13.047463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bdcd5668-b02c-477e-935e-bcac2aaca4d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d4864a30>]}
[0m16:22:13.244015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bdcd5668-b02c-477e-935e-bcac2aaca4d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d4d86250>]}
[0m16:22:13.245335 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:22:13.667692 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:22:14.185189 [debug] [MainThread]: Partial parsing enabled: 5 files deleted, 5 files added, 1 files changed.
[0m16:22:14.186255 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/clean/stg_btc__market_price.sql
[0m16:22:14.186927 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/mart/mart_btc__market_price_intraday.sql
[0m16:22:14.187493 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/mart/vw_btc__latest_24h.sql
[0m16:22:14.188138 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/clean/btc_schema.yml
[0m16:22:14.239108 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/mart/mart_btc__daily_ohlc.sql
[0m16:22:14.240036 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/sources.yml
[0m16:22:14.240635 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/mart/vw_meteo__manila_weather.sql
[0m16:22:14.241127 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/clean/stg_meteo__manila.sql
[0m16:22:14.241612 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/mart/mart_meteo__manila_monthly.sql
[0m16:22:14.242090 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/mart/mart_meteo__manila_daily.sql
[0m16:22:14.968100 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m16:22:14.969095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'bdcd5668-b02c-477e-935e-bcac2aaca4d0', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d40f8c40>]}
[0m16:22:15.944859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bdcd5668-b02c-477e-935e-bcac2aaca4d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d37ad130>]}
[0m16:22:16.392697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bdcd5668-b02c-477e-935e-bcac2aaca4d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d4140640>]}
[0m16:22:16.393589 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:22:16.396822 [info ] [MainThread]: 
[0m16:22:16.397981 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:22:16.445735 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:22:16.457291 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:22:16.652550 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:22:16.649956 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:22:17.117679 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:22:17.123238 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:22:17.125422 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:22:17.153642 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:22:17.243474 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:22:17.244856 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:22:17.265852 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:22:17.268256 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:22:17.280487 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:22:17.282408 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:22:17.349336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bdcd5668-b02c-477e-935e-bcac2aaca4d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d3bb1340>]}
[0m16:22:17.351216 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:22:17.352489 [info ] [MainThread]: 
[0m16:22:17.371020 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:22:17.372147 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:22:17.373052 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__clean, now model.ex_03_meteo.stg_btc__market_price)
[0m16:22:17.373755 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:22:17.441438 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:22:17.443435 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:22:17.542771 [debug] [Thread-1  ]: Creating new relation stg_btc__market_price
[0m16:22:17.568799 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:22:17.570414 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price` 
  
    
    
  as (
    

select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,
  parseDateTimeBestEffortOrNull(last_updated)                                        as last_updated_utc,
  toTimeZone(parseDateTimeBestEffortOrNull(last_updated), 'Asia/Manila')             as last_updated_manila
from `raw`.`btc__market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:22:17.576103 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price` 
  
    
    
  as (
    

select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,
  parseDateTimeBestEffortOrNull(last_updated)                                        as last_updated_utc,
  toTimeZone(parseDateTimeBestEffortOrNull(last_updated), 'Asia/Manila')             as last_updated_manila
from `raw`.`btc__market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m16:22:17.579214 [debug] [Thread-1  ]: Database Error in model stg_btc__market_price (models/clean/stg_btc__market_price.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 60
   Code: 60. DB::Exception: Table raw.btc__market_price does not exist. Maybe you meant raw.btc___market_price?. (UNKNOWN_TABLE) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/clean/stg_btc__market_price.sql
[0m16:22:17.581635 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bdcd5668-b02c-477e-935e-bcac2aaca4d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d336c4c0>]}
[0m16:22:17.582708 [error] [Thread-1  ]: 1 of 7 ERROR creating sql view model `clean`.`stg_btc__market_price` ........... [[31mERROR[0m in 0.21s]
[0m16:22:17.584064 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:22:17.586047 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:22:17.587084 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:22:17.588442 [info ] [Thread-3  ]: 2 of 7 SKIP test not_null_stg_btc__market_price_coin_id ........................ [[33mSKIP[0m]
[0m16:22:17.589815 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:22:17.640340 [info ] [Thread-4  ]: 3 of 7 SKIP test not_null_stg_btc__market_price_last_updated_utc ............... [[33mSKIP[0m]
[0m16:22:17.642605 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:22:17.644609 [info ] [Thread-2  ]: 4 of 7 SKIP test not_null_stg_btc__market_price_price_usd ...................... [[33mSKIP[0m]
[0m16:22:17.646977 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:22:17.649616 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:22:17.653071 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:22:17.654663 [info ] [Thread-1  ]: 5 of 7 SKIP relation mart.mart_btc__daily_ohlc ................................. [[33mSKIP[0m]
[0m16:22:17.656356 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:22:17.658144 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:22:17.659811 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:22:17.661652 [info ] [Thread-3  ]: 6 of 7 SKIP relation mart.mart_btc__market_price_intraday ...................... [[33mSKIP[0m]
[0m16:22:17.663647 [info ] [Thread-4  ]: 7 of 7 SKIP relation mart.vw_btc__latest_24h ................................... [[33mSKIP[0m]
[0m16:22:17.666109 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:22:17.668135 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:22:17.672377 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:22:17.673570 [debug] [MainThread]: Connection 'model.ex_03_meteo.stg_btc__market_price' was left open.
[0m16:22:17.674747 [debug] [MainThread]: On model.ex_03_meteo.stg_btc__market_price: Close
[0m16:22:17.675844 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m16:22:17.676962 [debug] [MainThread]: On list__mart: Close
[0m16:22:17.678885 [info ] [MainThread]: 
[0m16:22:17.680427 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 table models in 0 hours 0 minutes and 1.28 seconds (1.28s).
[0m16:22:17.684652 [debug] [MainThread]: Command end result
[0m16:22:17.948695 [info ] [MainThread]: 
[0m16:22:17.950408 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:22:17.951682 [info ] [MainThread]: 
[0m16:22:17.953572 [error] [MainThread]:   Database Error in model stg_btc__market_price (models/clean/stg_btc__market_price.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 60
   Code: 60. DB::Exception: Table raw.btc__market_price does not exist. Maybe you meant raw.btc___market_price?. (UNKNOWN_TABLE) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/clean/stg_btc__market_price.sql
[0m16:22:17.955109 [info ] [MainThread]: 
[0m16:22:17.956651 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=6 TOTAL=7
[0m16:22:17.959388 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 5.7099857, "process_in_blocks": "8", "process_kernel_time": 0.60013, "process_mem_max_rss": "116472", "process_out_blocks": "10568", "process_user_time": 5.672333}
[0m16:22:17.961009 [debug] [MainThread]: Command `dbt build` failed at 16:22:17.960581 after 5.71 seconds
[0m16:22:17.962444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d7ce9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d35211c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7875d3514a30>]}
[0m16:22:17.963781 [debug] [MainThread]: Flushing usage events
[0m16:24:03.281045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a7e58310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a4abdaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a4abd9a0>]}


============================== 16:24:03.290278 | c25140db-cadc-4bc3-a5dc-f65d5ccc1779 ==============================
[0m16:24:03.290278 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:24:03.291423 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'profiles_dir': '.', 'static_parser': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'quiet': 'False', 'warn_error': 'None', 'printer_width': '80', 'use_colors': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'debug': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'write_json': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False', 'version_check': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m16:24:03.817981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c25140db-cadc-4bc3-a5dc-f65d5ccc1779', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a73fefd0>]}
[0m16:24:04.011107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c25140db-cadc-4bc3-a5dc-f65d5ccc1779', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a4a87be0>]}
[0m16:24:04.012403 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:24:04.424172 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:24:04.929371 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:24:04.980528 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/sources.yml
[0m16:24:05.783841 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m16:24:05.784876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'c25140db-cadc-4bc3-a5dc-f65d5ccc1779', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a4258d90>]}
[0m16:24:06.412478 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.ex_03_meteo.stg_btc__market_price' (models/clean/stg_btc__market_price.sql) depends on a source named 'raw.btc__market_price' which was not found
[0m16:24:06.414194 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 3.3313663, "process_in_blocks": "0", "process_kernel_time": 0.570179, "process_mem_max_rss": "104232", "process_out_blocks": "6616", "process_user_time": 4.62776}
[0m16:24:06.414995 [debug] [MainThread]: Command `dbt build` failed at 16:24:06.414787 after 3.33 seconds
[0m16:24:06.415666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a7e58310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a4752b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bf6a3c8a310>]}
[0m16:24:06.416282 [debug] [MainThread]: Flushing usage events
[0m16:24:30.195523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc29a1ac310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc296e11b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc296e11a00>]}


============================== 16:24:30.256621 | acede589-de07-4ae3-a9cb-9a7cba32a6f4 ==============================
[0m16:24:30.256621 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:24:30.257742 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_format': 'default', 'use_colors': 'True', 'static_parser': 'True', 'quiet': 'False', 'profiles_dir': '.', 'partial_parse': 'True', 'debug': 'False', 'empty': 'False', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True', 'fail_fast': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'printer_width': '80', 'introspect': 'True', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'cache_selected_only': 'False'}
[0m16:24:30.847145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'acede589-de07-4ae3-a9cb-9a7cba32a6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc29974aca0>]}
[0m16:24:30.991702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'acede589-de07-4ae3-a9cb-9a7cba32a6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc296d0ddc0>]}
[0m16:24:30.993010 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:24:31.457368 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:24:31.971294 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m16:24:31.973065 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/sources.yml
[0m16:24:31.973716 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/clean/stg_btc__market_price.sql
[0m16:24:32.850674 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m16:24:32.851575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'acede589-de07-4ae3-a9cb-9a7cba32a6f4', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc296593d30>]}
[0m16:24:33.777584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'acede589-de07-4ae3-a9cb-9a7cba32a6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc295c8dee0>]}
[0m16:24:34.261017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'acede589-de07-4ae3-a9cb-9a7cba32a6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc295c76640>]}
[0m16:24:34.261951 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:24:34.265447 [info ] [MainThread]: 
[0m16:24:34.266641 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:24:34.278928 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:24:34.280017 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:24:34.480805 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:24:34.491481 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:24:35.314004 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:24:35.347994 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:24:35.350512 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:24:35.360904 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:24:35.457049 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:24:35.458692 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:24:35.479326 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:24:35.489442 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:24:35.548614 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:24:35.549678 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:24:35.567694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'acede589-de07-4ae3-a9cb-9a7cba32a6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc29725a070>]}
[0m16:24:35.569494 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:24:35.571023 [info ] [MainThread]: 
[0m16:24:35.650426 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:24:35.652046 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:24:35.653585 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m16:24:35.654647 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:24:35.675335 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:24:35.676644 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:24:35.773788 [debug] [Thread-1  ]: Creating new relation stg_btc__market_price
[0m16:24:35.796798 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m16:24:35.909603 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:24:35.910950 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price` 
  
    
    
  as (
    

select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,
  parseDateTimeBestEffortOrNull(last_updated)                                        as last_updated_utc,
  toTimeZone(parseDateTimeBestEffortOrNull(last_updated), 'Asia/Manila')             as last_updated_manila
from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:24:35.917388 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price` 
  
    
    
  as (
    

select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,
  parseDateTimeBestEffortOrNull(last_updated)                                        as last_updated_utc,
  toTimeZone(parseDateTimeBestEffortOrNull(last_updated), 'Asia/Manila')             as last_updated_manila
from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m16:24:35.920785 [debug] [Thread-1  ]: Database Error in model stg_btc__market_price (models/clean/stg_btc__market_price.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 43
   Code: 43. DB::Exception: Illegal type DateTime64(6, 'UTC') of first argument of function parseDateTimeBestEffortOrNull. Conversion functions with postfix 'OrZero' or 'OrNull' should take String argument: While processing CAST(id, 'String') AS coin_id, CAST(symbol, 'String') AS symbol, CAST(name, 'String') AS name, CAST(image, 'String') AS image_url, toFloat64(current_price) AS price_usd, toFloat64(market_cap) AS market_cap_usd, toInt32(market_cap_rank) AS market_cap_rank, toFloat64(total_volume) AS total_volume_usd, toFloat64(high_24h) AS high_24h_usd, toFloat64(low_24h) AS low_24h_usd, toFloat64(price_change_24h) AS price_change_24h_usd, toFloat64(price_change_percentage_24h) AS price_change_pct_24h, parseDateTimeBestEffortOrNull(last_updated) AS last_updated_utc, toTimeZone(parseDateTimeBestEffortOrNull(last_updated), 'Asia/Manila') AS last_updated_manila. (ILLEGAL_TYPE_OF_ARGUMENT) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/clean/stg_btc__market_price.sql
[0m16:24:35.923397 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acede589-de07-4ae3-a9cb-9a7cba32a6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc295f4b700>]}
[0m16:24:35.924802 [error] [Thread-1  ]: 1 of 7 ERROR creating sql view model `clean`.`stg_btc__market_price` ........... [[31mERROR[0m in 0.27s]
[0m16:24:35.926192 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:24:35.928447 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:24:35.929606 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:24:35.930988 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:24:35.932983 [info ] [Thread-3  ]: 2 of 7 SKIP test not_null_stg_btc__market_price_coin_id ........................ [[33mSKIP[0m]
[0m16:24:35.935017 [info ] [Thread-4  ]: 3 of 7 SKIP test not_null_stg_btc__market_price_last_updated_utc ............... [[33mSKIP[0m]
[0m16:24:35.937160 [info ] [Thread-2  ]: 4 of 7 SKIP test not_null_stg_btc__market_price_price_usd ...................... [[33mSKIP[0m]
[0m16:24:35.939355 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:24:35.947180 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:24:35.949163 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:24:35.952736 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:24:35.954224 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:24:35.956024 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:24:35.957694 [info ] [Thread-1  ]: 5 of 7 SKIP relation mart.mart_btc__daily_ohlc ................................. [[33mSKIP[0m]
[0m16:24:35.959478 [info ] [Thread-3  ]: 6 of 7 SKIP relation mart.mart_btc__market_price_intraday ...................... [[33mSKIP[0m]
[0m16:24:35.961602 [info ] [Thread-4  ]: 7 of 7 SKIP relation mart.vw_btc__latest_24h ................................... [[33mSKIP[0m]
[0m16:24:35.963664 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:24:35.965727 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:24:35.967451 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:24:35.970268 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:24:35.971033 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m16:24:35.971742 [debug] [MainThread]: On list__mart: Close
[0m16:24:35.972375 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m16:24:35.973046 [debug] [MainThread]: On list__clean: Close
[0m16:24:35.973729 [debug] [MainThread]: Connection 'model.ex_03_meteo.stg_btc__market_price' was left open.
[0m16:24:35.974374 [debug] [MainThread]: On model.ex_03_meteo.stg_btc__market_price: Close
[0m16:24:35.975597 [info ] [MainThread]: 
[0m16:24:35.976472 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 table models in 0 hours 0 minutes and 1.71 seconds (1.71s).
[0m16:24:35.978921 [debug] [MainThread]: Command end result
[0m16:24:36.148412 [info ] [MainThread]: 
[0m16:24:36.149389 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:24:36.150057 [info ] [MainThread]: 
[0m16:24:36.150998 [error] [MainThread]:   Database Error in model stg_btc__market_price (models/clean/stg_btc__market_price.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 43
   Code: 43. DB::Exception: Illegal type DateTime64(6, 'UTC') of first argument of function parseDateTimeBestEffortOrNull. Conversion functions with postfix 'OrZero' or 'OrNull' should take String argument: While processing CAST(id, 'String') AS coin_id, CAST(symbol, 'String') AS symbol, CAST(name, 'String') AS name, CAST(image, 'String') AS image_url, toFloat64(current_price) AS price_usd, toFloat64(market_cap) AS market_cap_usd, toInt32(market_cap_rank) AS market_cap_rank, toFloat64(total_volume) AS total_volume_usd, toFloat64(high_24h) AS high_24h_usd, toFloat64(low_24h) AS low_24h_usd, toFloat64(price_change_24h) AS price_change_24h_usd, toFloat64(price_change_percentage_24h) AS price_change_pct_24h, parseDateTimeBestEffortOrNull(last_updated) AS last_updated_utc, toTimeZone(parseDateTimeBestEffortOrNull(last_updated), 'Asia/Manila') AS last_updated_manila. (ILLEGAL_TYPE_OF_ARGUMENT) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/clean/stg_btc__market_price.sql
[0m16:24:36.151789 [info ] [MainThread]: 
[0m16:24:36.152491 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=6 TOTAL=7
[0m16:24:36.153896 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 6.164327, "process_in_blocks": "0", "process_kernel_time": 0.660405, "process_mem_max_rss": "116624", "process_out_blocks": "10576", "process_user_time": 5.83358}
[0m16:24:36.154686 [debug] [MainThread]: Command `dbt build` failed at 16:24:36.154464 after 6.17 seconds
[0m16:24:36.155317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc29a1ac310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc295b35040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc29974aca0>]}
[0m16:24:36.155979 [debug] [MainThread]: Flushing usage events
[0m16:26:34.626480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed16394310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed12ff6af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed12ff69a0>]}


============================== 16:26:34.635773 | be8a199c-2502-4e48-92e8-e36124022031 ==============================
[0m16:26:34.635773 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:26:34.636840 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'debug': 'False', 'target_path': 'None', 'version_check': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'write_json': 'True', 'static_parser': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'log_format': 'default', 'use_experimental_parser': 'False', 'empty': 'False', 'no_print': 'None', 'profiles_dir': '.', 'indirect_selection': 'eager', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'printer_width': '80', 'fail_fast': 'False', 'use_colors': 'True'}
[0m16:26:35.220946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed12fb8d90>]}
[0m16:26:35.415707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed130dbbe0>]}
[0m16:26:35.416958 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:26:35.833034 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:26:36.341470 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:26:36.342485 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/clean/stg_btc__market_price.sql
[0m16:26:37.113133 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m16:26:37.114018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed12793370>]}
[0m16:26:37.793359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed11fc5130>]}
[0m16:26:38.237985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed11fd3eb0>]}
[0m16:26:38.238848 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:26:38.242085 [info ] [MainThread]: 
[0m16:26:38.243156 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:26:38.293747 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:26:38.256682 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:26:38.329793 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:26:38.340014 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:26:39.101080 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:26:39.103959 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:26:39.107403 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:26:39.108816 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:26:39.136108 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:26:39.137452 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:26:39.208126 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:26:39.216726 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:26:39.226511 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:26:39.231163 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:26:39.294135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed157b3940>]}
[0m16:26:39.296091 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:26:39.297414 [info ] [MainThread]: 
[0m16:26:39.325663 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:26:39.326778 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:26:39.327669 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__clean, now model.ex_03_meteo.stg_btc__market_price)
[0m16:26:39.328368 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:26:39.398028 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:26:39.399732 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:26:39.497035 [debug] [Thread-1  ]: Creating new relation stg_btc__market_price
[0m16:26:39.526652 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:26:39.528468 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:26:39.566859 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m16:26:39.623177 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed15936820>]}
[0m16:26:39.624542 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.29s]
[0m16:26:39.625934 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:26:39.627845 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:26:39.628637 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:26:39.629503 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:26:39.630710 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m16:26:39.631806 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m16:26:39.632987 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m16:26:39.634744 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m16:26:39.636047 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m16:26:39.637892 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list__mart, now test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6)
[0m16:26:39.639689 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:26:39.641521 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:26:39.693859 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:26:39.822970 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:26:39.827818 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:26:39.830378 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:26:39.831835 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:26:39.837844 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:26:39.893234 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:26:39.913106 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:26:39.918256 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:26:39.923046 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:26:39.924680 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m16:26:39.925410 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m16:26:39.926262 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m16:26:39.993961 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:26:40.004817 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.37s]
[0m16:26:40.009231 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:26:40.062191 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m16:26:40.067836 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m16:26:40.071119 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:26:40.074170 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.44s]
[0m16:26:40.075728 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:26:40.077224 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:26:40.095886 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.46s]
[0m16:26:40.097308 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:26:40.098787 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:26:40.099492 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:26:40.100331 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:26:40.101360 [info ] [Thread-1  ]: 5 of 7 START sql table model `mart`.`mart_btc__daily_ohlc` ..................... [RUN]
[0m16:26:40.102423 [info ] [Thread-2  ]: 6 of 7 START sql table model `mart`.`mart_btc__market_price_intraday` .......... [RUN]
[0m16:26:40.103539 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m16:26:40.104468 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m16:26:40.105273 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_intraday)
[0m16:26:40.105999 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m16:26:40.106725 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:26:40.107476 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:26:40.108236 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m16:26:40.115464 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:26:40.122321 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_intraday"
[0m16:26:40.129229 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:26:40.130702 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:26:40.131385 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:26:40.132137 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m16:26:40.240361 [debug] [Thread-2  ]: Creating new relation mart_btc__market_price_intraday
[0m16:26:40.302796 [debug] [Thread-4  ]: Creating new relation vw_btc__latest_24h
[0m16:26:40.314837 [debug] [Thread-1  ]: Creating new relation mart_btc__daily_ohlc
[0m16:26:40.333845 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:26:40.508434 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_intraday: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_intraday"} */

            

    
        create table `mart`.`mart_btc__market_price_intraday`
        
  
        
  engine = MergeTree()
        order by (last_updated_utc)
        
        partition by (toYYYYMM(last_updated_utc))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

select
  assumeNotNull(last_updated_utc) as last_updated_utc,   -- non-null for CH MergeTree keys
  last_updated_manila,
  coin_id,
  symbol,
  name,
  image_url,
  price_usd,
  market_cap_usd,
  market_cap_rank,
  total_volume_usd,
  high_24h_usd,
  low_24h_usd,
  price_change_24h_usd,
  price_change_pct_24h
from `clean`.`stg_btc__market_price`
          )
        
        ...
[0m16:26:40.512103 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    coin_id,
    assumeNotNull(toDate(toTimeZone(last_updated_utc, 'Asia/Manila'))) as day_local,
    last_updated_utc,
    toFloat64(price_usd) as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null
)
select
  day_local,
  coin_id,
  min(price_usd)                              as low_usd,
  max(price_usd)                              as high_usd,
  argMin(price_usd, last_updated_utc)         as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc)         as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m16:26:40.513049 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h` 
  
    
    
  as (
    

with max_ts as (
  select max(last_updated_utc) as ts_max
  from `clean`.`stg_btc__market_price`
)
select
  s.*
from `clean`.`stg_btc__market_price` s
join max_ts m
  on s.last_updated_utc >= m.ts_max - INTERVAL 24 HOUR
order by s.last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:26:40.518478 [debug] [Thread-4  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h` 
  
    
    
  as (
    

with max_ts as (
  select max(last_updated_utc) as ts_max
  from `clean`.`stg_btc__market_price`
)
select
  s.*
from `clean`.`stg_btc__market_price` s
join max_ts m
  on s.last_updated_utc >= m.ts_max - INTERVAL 24 HOUR
order by s.last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m16:26:40.522281 [debug] [Thread-4  ]: Database Error in model vw_btc__latest_24h (models/mart/vw_btc__latest_24h.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 403
   Code: 403. DB::Exception: Unsupported JOIN ON conditions. Unexpected 'last_updated_utc >= (ts_max - toIntervalHour(24))': While processing last_updated_utc >= (ts_max - toIntervalHour(24)). (INVALID_JOIN_ON_EXPRESSION) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/mart/vw_btc__latest_24h.sql
[0m16:26:40.523176 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed10de4c70>]}
[0m16:26:40.524363 [error] [Thread-4  ]: 7 of 7 ERROR creating sql view model `mart`.`vw_btc__latest_24h` ............... [[31mERROR[0m in 0.42s]
[0m16:26:40.526070 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:26:40.540834 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:26:40.594341 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m16:26:40.595959 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_intraday: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_intraday"} */

    select name, type from system.columns where table = 'mart_btc__market_price_intraday'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:26:40.602546 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:26:40.610585 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:26:40.617926 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:26:40.621725 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_intraday"
[0m16:26:40.626152 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:26:40.628051 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_intraday: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_intraday"} */

  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_intraday`
        ("last_updated_utc", "last_updated_manila", "coin_id", "symbol", "name", "image_url", "price_usd", "market_cap_usd", "market_cap_rank", "total_volume_usd", "high_24h_usd", "low_24h_usd", "price_change_24h_usd", "price_change_pct_24h")

select
  assumeNotNull(last_updated_utc) as last_updated_utc,   -- non-null for CH MergeTree keys
  last_updated_manila,
  coin_id,
  symbol,
  name,
  image_url,
  price_usd,
  market_cap_usd,
  market_cap_rank,
  total_volume_usd,
  high_24h_usd,
  low_24h_usd,
  price_change_24h_usd,
  price_change_pct_24h
from `clean`.`stg_btc__market_price`
  ...
[0m16:26:40.631352 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    coin_id,
    assumeNotNull(toDate(toTimeZone(last_updated_utc, 'Asia/Manila'))) as day_local,
    last_updated_utc,
    toFloat64(price_usd) as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null
)
select
  day_local,
  coin_id,
  min(price_usd)                              as low_usd,
  max(price_usd)                              as high_usd,
  argMin(price_usd, last_updated_utc)         as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc)         as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  ...
[0m16:26:40.643619 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:26:40.648851 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed10dc7c70>]}
[0m16:26:40.694423 [info ] [Thread-2  ]: 6 of 7 OK created sql table model `mart`.`mart_btc__market_price_intraday` ..... [[32mOK[0m in 0.54s]
[0m16:26:40.696363 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:26:40.699576 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:26:40.704773 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be8a199c-2502-4e48-92e8-e36124022031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed11a71700>]}
[0m16:26:40.706760 [info ] [Thread-1  ]: 5 of 7 OK created sql table model `mart`.`mart_btc__daily_ohlc` ................ [[32mOK[0m in 0.60s]
[0m16:26:40.708543 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:26:40.710900 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:26:40.711517 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m16:26:40.712130 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m16:26:40.712691 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_intraday' was left open.
[0m16:26:40.713287 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_intraday: Close
[0m16:26:40.713820 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m16:26:40.714437 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m16:26:40.714986 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m16:26:40.715493 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m16:26:40.717543 [info ] [MainThread]: 
[0m16:26:40.719060 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 table models in 0 hours 0 minutes and 2.47 seconds (2.47s).
[0m16:26:40.727006 [debug] [MainThread]: Command end result
[0m16:26:40.939378 [info ] [MainThread]: 
[0m16:26:40.940607 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:26:40.941515 [info ] [MainThread]: 
[0m16:26:40.993181 [error] [MainThread]:   Database Error in model vw_btc__latest_24h (models/mart/vw_btc__latest_24h.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 403
   Code: 403. DB::Exception: Unsupported JOIN ON conditions. Unexpected 'last_updated_utc >= (ts_max - toIntervalHour(24))': While processing last_updated_utc >= (ts_max - toIntervalHour(24)). (INVALID_JOIN_ON_EXPRESSION) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/mart/vw_btc__latest_24h.sql
[0m16:26:40.994936 [info ] [MainThread]: 
[0m16:26:40.996453 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m16:26:40.999215 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 6.5647326, "process_in_blocks": "0", "process_kernel_time": 0.679949, "process_mem_max_rss": "116776", "process_out_blocks": "10712", "process_user_time": 5.993113}
[0m16:26:41.000864 [debug] [MainThread]: Command `dbt build` failed at 16:26:41.000408 after 6.57 seconds
[0m16:26:41.002574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed16394310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed142ba760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed12e5be80>]}
[0m16:26:41.004008 [debug] [MainThread]: Flushing usage events
[0m16:27:48.475918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2526b5b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e25237bdac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e25237bd970>]}


============================== 16:27:48.485476 | 7cf0df94-cc1c-41ba-bac0-5e25d368109b ==============================
[0m16:27:48.485476 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:27:48.486750 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'write_json': 'True', 'no_print': 'None', 'empty': 'False', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'warn_error': 'None', 'indirect_selection': 'eager', 'use_colors': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_format': 'default', 'profiles_dir': '.', 'target_path': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'fail_fast': 'False', 'log_cache_events': 'False'}
[0m16:27:49.070508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2523783040>]}
[0m16:27:49.267044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2523783190>]}
[0m16:27:49.268311 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:27:49.692699 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:27:50.259496 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:27:50.260590 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/mart/vw_btc__latest_24h.sql
[0m16:27:51.171678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2522a9ae50>]}
[0m16:27:51.654911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2522b00250>]}
[0m16:27:51.655852 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:27:51.659083 [info ] [MainThread]: 
[0m16:27:51.660081 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:27:51.673373 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:27:51.685025 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:27:51.752774 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:27:51.755665 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:27:52.258572 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:27:52.260641 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:27:52.267406 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:52.269520 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:52.556753 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:27:52.557878 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:27:52.573319 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:27:52.575526 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:27:52.583852 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:52.585869 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:52.650306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2522545670>]}
[0m16:27:52.652351 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:27:52.653701 [info ] [MainThread]: 
[0m16:27:52.681379 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:27:52.682996 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:27:52.684459 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m16:27:52.685518 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:27:52.761781 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:27:52.763500 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:27:52.891926 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m16:27:53.002286 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:27:53.003651 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:27:53.015529 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:53.030347 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:27:53.033559 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:27:53.035517 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:27:53.038338 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:27:53.047125 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m16:27:53.050203 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:27:53.052036 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m16:27:53.054879 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:27:53.149916 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m16:27:53.153448 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:27:53.159365 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2522750c70>]}
[0m16:27:53.160496 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.47s]
[0m16:27:53.161918 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:27:53.164155 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:27:53.165080 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:27:53.166172 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m16:27:53.167611 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:27:53.169634 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m16:27:53.171871 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m16:27:53.173725 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m16:27:53.175357 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m16:27:53.176590 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:27:53.178614 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m16:27:53.179983 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:27:53.191708 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:27:53.372093 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:27:53.377801 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:27:53.385318 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:27:53.387354 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:27:53.389642 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:27:53.460028 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:27:53.785293 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:27:53.779589 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:27:53.784852 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:27:53.789969 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m16:27:53.844525 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m16:27:53.846459 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m16:27:54.092185 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m16:27:54.111160 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m16:27:54.112943 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:27:54.156894 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m16:27:54.160688 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.98s]
[0m16:27:54.162360 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m16:27:54.165134 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:27:54.169413 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.99s]
[0m16:27:54.171613 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:27:54.174262 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:54.180431 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.01s]
[0m16:27:54.183174 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:27:54.185746 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:27:54.186918 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:27:54.188529 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:27:54.190131 [info ] [Thread-1  ]: 5 of 7 START sql table model `mart`.`mart_btc__daily_ohlc` ..................... [RUN]
[0m16:27:54.191835 [info ] [Thread-2  ]: 6 of 7 START sql table model `mart`.`mart_btc__market_price_intraday` .......... [RUN]
[0m16:27:54.245468 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m16:27:54.247404 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m16:27:54.248745 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_intraday)
[0m16:27:54.249845 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m16:27:54.251571 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:27:54.252945 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:27:54.254097 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m16:27:54.268382 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:27:54.278464 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_intraday"
[0m16:27:54.291458 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:27:54.293775 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:27:54.345278 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:27:54.368119 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m16:27:54.478717 [debug] [Thread-4  ]: Creating new relation vw_btc__latest_24h
[0m16:27:54.545962 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:27:54.676313 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h` 
  
    
    
  as (
    

WITH
  (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:27:54.777817 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m16:27:54.855946 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2521563d30>]}
[0m16:27:54.876051 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.61s]
[0m16:27:54.957805 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:27:54.983270 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_intraday: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_intraday"} */

            

    
        create table `mart`.`mart_btc__market_price_intraday__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (last_updated_utc)
        
        partition by (toYYYYMM(last_updated_utc))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

select
  assumeNotNull(last_updated_utc) as last_updated_utc,   -- non-null for CH MergeTree keys
  last_updated_manila,
  coin_id,
  symbol,
  name,
  image_url,
  price_usd,
  market_cap_usd,
  market_cap_rank,
  total_volume_usd,
  high_24h_usd,
  low_24h_usd,
  price_change_24h_usd,
  price_change_pct_24h
from `clean`.`stg_btc__market_price`
          )
        
        ...
[0m16:27:54.986061 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    coin_id,
    assumeNotNull(toDate(toTimeZone(last_updated_utc, 'Asia/Manila'))) as day_local,
    last_updated_utc,
    toFloat64(price_usd) as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null
)
select
  day_local,
  coin_id,
  min(price_usd)                              as low_usd,
  max(price_usd)                              as high_usd,
  argMin(price_usd, last_updated_utc)         as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc)         as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m16:27:55.045290 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:27:55.046557 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:27:55.157682 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_intraday: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_intraday"} */

    select name, type from system.columns where table = 'mart_btc__market_price_intraday__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:27:55.153489 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_backup'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:27:55.167686 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:55.175622 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:55.185238 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_intraday"
[0m16:27:55.189836 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:27:55.191942 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_intraday: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_intraday"} */

  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_intraday__dbt_backup`
        ("last_updated_utc", "last_updated_manila", "coin_id", "symbol", "name", "image_url", "price_usd", "market_cap_usd", "market_cap_rank", "total_volume_usd", "high_24h_usd", "low_24h_usd", "price_change_24h_usd", "price_change_pct_24h")

select
  assumeNotNull(last_updated_utc) as last_updated_utc,   -- non-null for CH MergeTree keys
  last_updated_manila,
  coin_id,
  symbol,
  name,
  image_url,
  price_usd,
  market_cap_usd,
  market_cap_rank,
  total_volume_usd,
  high_24h_usd,
  low_24h_usd,
  price_change_24h_usd,
  price_change_pct_24h
from `clean`.`stg_btc__market_price`
  ...
[0m16:27:55.193945 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_backup`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    coin_id,
    assumeNotNull(toDate(toTimeZone(last_updated_utc, 'Asia/Manila'))) as day_local,
    last_updated_utc,
    toFloat64(price_usd) as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null
)
select
  day_local,
  coin_id,
  min(price_usd)                              as low_usd,
  max(price_usd)                              as high_usd,
  argMin(price_usd, last_updated_utc)         as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc)         as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  ...
[0m16:27:55.259122 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:55.273347 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:27:55.274821 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_intraday: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_intraday"} */
EXCHANGE TABLES `mart`.`mart_btc__market_price_intraday__dbt_backup` AND `mart`.`mart_btc__market_price_intraday` 
  
  ...
[0m16:27:55.277524 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */
EXCHANGE TABLES `mart`.`mart_btc__daily_ohlc__dbt_backup` AND `mart`.`mart_btc__daily_ohlc` 
  
  ...
[0m16:27:55.281856 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:27:55.283906 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:27:55.293090 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_intraday: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_intraday"} */

    drop table if exists `mart`.`mart_btc__market_price_intraday__dbt_backup` 
  ...
[0m16:27:55.353388 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_backup` 
  ...
[0m16:27:55.361347 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:27:55.363787 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:27:55.368451 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2522750940>]}
[0m16:27:55.373664 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7cf0df94-cc1c-41ba-bac0-5e25d368109b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e25216e2670>]}
[0m16:27:55.376006 [info ] [Thread-2  ]: 6 of 7 OK created sql table model `mart`.`mart_btc__market_price_intraday` ..... [[32mOK[0m in 1.12s]
[0m16:27:55.378855 [info ] [Thread-1  ]: 5 of 7 OK created sql table model `mart`.`mart_btc__daily_ohlc` ................ [[32mOK[0m in 1.12s]
[0m16:27:55.384322 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:27:55.381689 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_intraday
[0m16:27:55.391255 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:27:55.392407 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m16:27:55.393922 [debug] [MainThread]: On list__mart: Close
[0m16:27:55.395030 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m16:27:55.396053 [debug] [MainThread]: On list__clean: Close
[0m16:27:55.397358 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m16:27:55.398732 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m16:27:55.399866 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m16:27:55.444033 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m16:27:55.444722 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m16:27:55.445234 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m16:27:55.445732 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_intraday' was left open.
[0m16:27:55.446232 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_intraday: Close
[0m16:27:55.447394 [info ] [MainThread]: 
[0m16:27:55.448125 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 table models in 0 hours 0 minutes and 3.79 seconds (3.79s).
[0m16:27:55.452183 [debug] [MainThread]: Command end result
[0m16:27:55.568224 [info ] [MainThread]: 
[0m16:27:55.569521 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:27:55.570473 [info ] [MainThread]: 
[0m16:27:55.571438 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m16:27:55.573337 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.2935686, "process_in_blocks": "0", "process_kernel_time": 0.664014, "process_mem_max_rss": "116128", "process_out_blocks": "10712", "process_user_time": 6.363974}
[0m16:27:55.574386 [debug] [MainThread]: Command `dbt build` succeeded at 16:27:55.574112 after 7.29 seconds
[0m16:27:55.575282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2526b5b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e25229938b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e25229c8430>]}
[0m16:27:55.576145 [debug] [MainThread]: Flushing usage events
[0m16:45:20.955322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1fd82a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1fa48baf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1fa48b9a0>]}


============================== 16:45:20.964907 | dd072486-d07e-4dd8-ba05-1b4fabe10928 ==============================
[0m16:45:20.964907 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:45:20.966071 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'static_parser': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'indirect_selection': 'eager', 'introspect': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'printer_width': '80', 'quiet': 'False', 'write_json': 'True', 'warn_error': 'None', 'cache_selected_only': 'False', 'target_path': 'None', 'use_colors': 'True', 'log_cache_events': 'False', 'no_print': 'None', 'use_experimental_parser': 'False', 'debug': 'False', 'partial_parse': 'True', 'log_format': 'default', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '.'}
[0m16:45:21.564247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1fcdd5fd0>]}
[0m16:45:21.772866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1fa58b970>]}
[0m16:45:21.774187 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:45:22.258573 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:45:22.765933 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 2 files changed.
[0m16:45:22.766877 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/mart/mart_btc__market_price_hourly.sql
[0m16:45:22.767434 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/mart/mart_btc__market_price_intraday.sql
[0m16:45:22.768137 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/mart/mart_btc__daily_ohlc.sql
[0m16:45:22.768816 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/mart/vw_btc__latest_24h.sql
[0m16:45:23.742214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1f99e3fa0>]}
[0m16:45:24.181005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1f9c3e220>]}
[0m16:45:24.181874 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:45:24.185180 [info ] [MainThread]: 
[0m16:45:24.186250 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:45:24.235893 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:45:24.237421 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:45:24.328327 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:45:24.337680 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:45:25.061867 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:45:25.067261 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:25.269000 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:45:25.275687 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:25.359656 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:45:25.366458 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:45:25.434216 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:45:25.436897 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:45:25.446120 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:25.451051 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:25.469089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1fa12fee0>]}
[0m16:45:25.470916 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:45:25.472242 [info ] [MainThread]: 
[0m16:45:25.547716 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:45:25.548828 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:45:25.549705 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_03_meteo.stg_btc__market_price)
[0m16:45:25.550384 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:45:25.567509 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:45:25.569009 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:45:25.756668 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:45:25.758573 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:45:25.771864 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:25.784057 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:45:25.787137 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:25.829220 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:45:25.832480 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:25.837900 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m16:45:25.840777 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:25.842574 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m16:45:25.845530 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:25.939604 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m16:45:25.943126 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:25.948951 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1f8a7c2e0>]}
[0m16:45:25.950049 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.40s]
[0m16:45:25.951491 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:45:25.953820 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:45:25.956263 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:45:25.958012 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:45:25.954946 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m16:45:25.960081 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m16:45:25.962030 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m16:45:25.964278 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m16:45:25.966468 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m16:45:25.968453 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m16:45:25.970156 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:45:25.971646 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:45:25.972887 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:45:26.233467 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:45:26.174991 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:45:26.231945 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:45:26.237598 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:45:26.239154 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:45:26.256418 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:45:26.466102 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:45:26.468986 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:45:26.550640 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:45:26.553023 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m16:45:26.555413 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m16:45:26.558005 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m16:45:26.809029 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m16:45:26.837924 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m16:45:26.846021 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:26.849769 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m16:45:26.863636 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:45:26.866057 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.90s]
[0m16:45:26.874347 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m16:45:26.932238 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:45:26.936855 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:45:26.940553 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:45:26.946591 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.98s]
[0m16:45:26.949510 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:45:26.952711 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:45:26.953789 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:45:26.955494 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:45:26.957305 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m16:45:26.959183 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m16:45:26.961405 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m16:45:26.963460 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m16:45:26.965056 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m16:45:26.966723 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m16:45:26.968488 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:45:26.970095 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:45:26.971774 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m16:45:27.065145 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:45:27.072065 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:45:27.132130 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:45:27.133883 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:45:27.156357 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m16:45:27.163375 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:45:27.247530 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:45:27.354368 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:45:27.529313 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m16:45:27.565516 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:45:27.639583 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:45:27.669599 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:45:27.842735 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m16:45:27.851476 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_dd072486_d07e_4dd8_ba05_1b4fabe10928` 
  ...
[0m16:45:27.876239 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:45:27.955099 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:45:27.957841 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:45:28.050418 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:45:28.070645 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:28.165639 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m16:45:28.169591 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m16:45:28.171025 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_dd072486_d07e_4dd8_ba05_1b4fabe10928`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m16:45:28.174272 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:28.228663 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1f83a52e0>]}
[0m16:45:28.231294 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:45:28.232461 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:45:28.230074 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.26s]
[0m16:45:28.253856 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:45:28.254736 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_dd072486_d07e_4dd8_ba05_1b4fabe10928'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:45:28.256141 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:45:28.261019 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:28.267430 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:45:28.269418 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:28.272362 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:45:28.273549 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
    ...
[0m16:45:28.274594 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_dd072486_d07e_4dd8_ba05_1b4fabe10928`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m16:45:28.327698 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:28.338255 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1f8293a30>]}
[0m16:45:28.339500 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.37s]
[0m16:45:28.340993 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:45:28.375091 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m16:45:28.377436 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_dd072486_d07e_4dd8_ba05_1b4fabe10928`)
      
    ...
[0m16:45:28.392809 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:45:28.397965 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:45:28.402850 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:28.405689 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_dd072486_d07e_4dd8_ba05_1b4fabe10928` 
    ...
[0m16:45:28.411169 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:28.417282 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_dd072486_d07e_4dd8_ba05_1b4fabe10928` 
  ...
[0m16:45:28.420786 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:28.429166 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m16:45:28.432020 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:45:28.435038 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd072486-d07e-4dd8-ba05-1b4fabe10928', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1f92d71c0>]}
[0m16:45:28.436176 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.47s]
[0m16:45:28.437481 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:45:28.439361 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:45:28.439922 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m16:45:28.440439 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m16:45:28.440949 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m16:45:28.441437 [debug] [MainThread]: On list__clean: Close
[0m16:45:28.441940 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m16:45:28.442460 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m16:45:28.442983 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m16:45:28.443503 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m16:45:28.444042 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m16:45:28.444611 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m16:45:28.445712 [info ] [MainThread]: 
[0m16:45:28.446459 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.26 seconds (4.26s).
[0m16:45:28.450160 [debug] [MainThread]: Command end result
[0m16:45:28.559424 [info ] [MainThread]: 
[0m16:45:28.560347 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:45:28.561019 [info ] [MainThread]: 
[0m16:45:28.561715 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m16:45:28.563174 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.8001084, "process_in_blocks": "0", "process_kernel_time": 0.697758, "process_mem_max_rss": "117816", "process_out_blocks": "10744", "process_user_time": 6.533377}
[0m16:45:28.564031 [debug] [MainThread]: Command `dbt build` succeeded at 16:45:28.563824 after 7.80 seconds
[0m16:45:28.564729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1fd82a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1f9c3e220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f1fb6b49d0>]}
[0m16:45:28.565317 [debug] [MainThread]: Flushing usage events
[0m16:57:16.947837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e35770e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e323dcb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e323dca30>]}


============================== 16:57:16.957596 | bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271 ==============================
[0m16:57:16.957596 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:57:16.958688 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'quiet': 'False', 'write_json': 'True', 'use_colors': 'True', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'debug': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'cache_selected_only': 'False', 'partial_parse': 'True', 'fail_fast': 'False', 'indirect_selection': 'eager', 'introspect': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'profiles_dir': '.', 'invocation_command': 'dbt build --profiles-dir . --target local', 'no_print': 'None', 'warn_error': 'None'}
[0m16:57:17.541951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e34251790>]}
[0m16:57:17.736856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e321a2d30>]}
[0m16:57:17.738151 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:57:18.128185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705fae0bf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f7ab1a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f7ab1910>]}


============================== 16:57:18.138196 | 9c68956d-2b7a-4031-89e2-e89c4df76724 ==============================
[0m16:57:18.138196 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:57:18.139412 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'use_colors': 'True', 'target_path': 'None', 'log_format': 'default', 'indirect_selection': 'eager', 'quiet': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'printer_width': '80', 'log_path': '/workdir/transforms/04_btc/logs', 'static_parser': 'True', 'write_json': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'profiles_dir': '.', 'cache_selected_only': 'False', 'debug': 'False', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local'}
[0m16:57:18.155341 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:57:18.666776 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:57:18.667419 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:57:18.735039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705fa35bfd0>]}
[0m16:57:18.871069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e31b42e50>]}
[0m16:57:18.933450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f7efeb50>]}
[0m16:57:18.934756 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:57:19.356783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e31ad07c0>]}
[0m16:57:19.357732 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:57:19.361009 [info ] [MainThread]: 
[0m16:57:19.362059 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:57:19.374283 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:57:19.406425 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:57:19.436442 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:57:19.451203 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:57:19.458575 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:57:19.913049 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:57:19.913752 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:57:19.984075 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:57:19.989930 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:57:19.992176 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:19.997055 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:20.058767 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:57:20.060119 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:57:20.074875 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:57:20.080198 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:57:20.088731 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:20.126709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f721ef70>]}
[0m16:57:20.135993 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:20.146996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e356c8430>]}
[0m16:57:20.148068 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:57:20.149129 [info ] [MainThread]: 
[0m16:57:20.166910 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:57:20.168042 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:57:20.169113 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m16:57:20.169856 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:57:20.237579 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:57:20.238834 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:57:20.363729 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m16:57:20.421670 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:57:20.423014 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:57:20.436399 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:20.572270 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:57:20.575948 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:20.577978 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:57:20.580919 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:20.586705 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m16:57:20.633354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f725c940>]}
[0m16:57:20.634226 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:57:20.636815 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m16:57:20.637404 [info ] [MainThread]: 
[0m16:57:20.638410 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:57:20.638938 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m16:57:20.641911 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:20.650799 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:57:20.698486 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:57:20.722846 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:57:20.724825 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:57:20.738394 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m16:57:20.741464 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:20.747598 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e31725f10>]}
[0m16:57:20.748921 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.58s]
[0m16:57:20.750317 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:57:20.751996 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:57:20.752857 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:57:20.753698 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m16:57:20.754631 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:57:20.755521 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m16:57:20.756659 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m16:57:20.757609 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m16:57:20.759842 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m16:57:20.761360 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:57:20.763195 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m16:57:20.764849 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:57:20.836398 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:57:20.858505 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:57:20.860963 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:57:20.874750 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:57:20.877329 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:57:20.952059 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:57:20.883980 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:57:21.045410 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:57:21.052022 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:57:21.055103 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:57:21.057985 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m16:57:21.060071 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m16:57:21.063565 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m16:57:21.250828 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:57:21.254473 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:57:21.256607 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:21.258611 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:21.299898 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:57:21.302582 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m16:57:21.311868 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m16:57:21.313443 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:21.301493 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:57:21.315703 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:57:21.320159 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:57:21.326971 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:21.314575 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m16:57:21.322481 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.56s]
[0m16:57:21.328617 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:21.324181 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:21.339611 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:57:21.344951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705fa26a040>]}
[0m16:57:21.343212 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.58s]
[0m16:57:21.346714 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:57:21.347439 [info ] [MainThread]: 
[0m16:57:21.345239 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:21.347230 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:57:21.350758 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.59s]
[0m16:57:21.352571 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:57:21.354076 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:57:21.355055 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:57:21.356078 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:57:21.357303 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m16:57:21.358452 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m16:57:21.359883 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m16:57:21.360838 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m16:57:21.361609 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m16:57:21.362625 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m16:57:21.363722 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:57:21.365243 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:57:21.424658 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:57:21.425766 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:57:21.426881 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m16:57:21.427602 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:57:21.444266 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:57:21.445473 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:57:21.366659 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m16:57:21.441933 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:57:21.446933 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:57:21.460818 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:57:21.463001 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:57:21.463815 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:57:21.469810 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m16:57:21.571650 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:57:21.630811 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m16:57:21.668108 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:57:21.723046 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:57:21.724919 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:57:21.737617 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:21.767811 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m16:57:21.910438 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:57:21.915222 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:21.918904 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:57:21.923097 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:21.933975 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m16:57:21.938460 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:21.942154 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:57:21.943901 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m16:57:21.948846 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:21.972557 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:22.052990 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:57:22.050821 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271` 
  ...
[0m16:57:22.066705 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271` 
  ...
[0m16:57:22.070592 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:22.073247 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:22.100366 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m16:57:22.103473 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:22.109415 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f6de4b20>]}
[0m16:57:22.110752 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.68s]
[0m16:57:22.112121 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:57:22.113664 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:57:22.114407 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:57:22.115283 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:57:22.116039 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m16:57:22.117010 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m16:57:22.118192 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m16:57:22.119668 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m16:57:22.120619 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m16:57:22.121846 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m16:57:22.122972 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:57:22.123756 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:57:22.074892 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:22.081207 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:57:22.124781 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:57:22.211486 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:57:22.217679 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:57:22.219391 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:57:22.221177 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:57:22.227229 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:57:22.253250 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:22.233500 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:57:22.338398 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:57:22.372586 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m16:57:22.378091 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m16:57:22.380615 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.401437 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:57:22.407691 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:57:22.417017 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:57:22.418465 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m16:57:22.419336 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m16:57:22.420761 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m16:57:22.439958 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m16:57:22.441328 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:57:22.443007 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:57:22.457693 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.464267 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:57:22.469481 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:57:22.472044 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e3075d2e0>]}
[0m16:57:22.476243 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.11s]
[0m16:57:22.477775 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:57:22.479455 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.481522 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.539991 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:57:22.544888 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:57:22.547179 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m16:57:22.548706 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m16:57:22.567871 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:22.570253 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271`)
      
    ...
[0m16:57:22.571589 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:22.574544 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271`)
      
    ...
[0m16:57:22.582276 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m16:57:22.596258 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:22.598310 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m16:57:22.600207 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:22.604635 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:57:22.606221 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:57:22.604850 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m16:57:22.615181 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.49s]
[0m16:57:22.617448 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.619930 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:57:22.623113 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.50s]
[0m16:57:22.625132 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:57:22.626788 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.629613 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.51s]
[0m16:57:22.630982 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:57:22.632527 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:57:22.633524 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m16:57:22.634447 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m16:57:22.616717 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:57:22.618169 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.635211 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:57:22.636057 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:57:22.637014 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:57:22.641573 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271` 
    ...
[0m16:57:22.643204 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.647066 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271` 
    ...
[0m16:57:22.648655 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:22.655802 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271` 
  ...
[0m16:57:22.657177 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.663727 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_bcaf11b3_f76a_40f6_9cb0_a4d1bd7d1271` 
  ...
[0m16:57:22.665213 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.672814 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m16:57:22.674943 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.681028 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m16:57:22.682290 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:22.638358 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m16:57:22.639779 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m16:57:22.703722 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m16:57:22.710872 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:57:22.711814 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m16:57:22.712911 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:57:22.714246 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m16:57:22.723235 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:57:22.724294 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:57:22.739317 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e3075d7f0>]}
[0m16:57:22.731273 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:57:22.741434 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:57:22.743181 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.38s]
[0m16:57:22.748179 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bcaf11b3-f76a-40f6-9cb0-a4d1bd7d1271', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e3166b640>]}
[0m16:57:22.749503 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:57:22.751261 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.39s]
[0m16:57:22.753841 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:57:22.756311 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:57:22.756862 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m16:57:22.757379 [debug] [MainThread]: On list__clean: Close
[0m16:57:22.757862 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m16:57:22.758332 [debug] [MainThread]: On list__mart: Close
[0m16:57:22.758843 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m16:57:22.759312 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m16:57:22.759790 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m16:57:22.760287 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m16:57:22.760906 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m16:57:22.761389 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m16:57:22.761897 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m16:57:22.762386 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m16:57:22.763579 [info ] [MainThread]: 
[0m16:57:22.764248 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.40 seconds (3.40s).
[0m16:57:22.768007 [debug] [MainThread]: Command end result
[0m16:57:22.798416 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:57:22.898466 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m16:57:22.936382 [info ] [MainThread]: 
[0m16:57:22.937781 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:57:22.938768 [info ] [MainThread]: 
[0m16:57:22.939808 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m16:57:22.941411 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.1873994, "process_in_blocks": "0", "process_kernel_time": 0.65995, "process_mem_max_rss": "114244", "process_out_blocks": "9752", "process_user_time": 5.919675}
[0m16:57:22.942207 [debug] [MainThread]: Command `dbt build` succeeded at 16:57:22.942009 after 6.19 seconds
[0m16:57:22.942891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e35770e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e3369dc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e34251790>]}
[0m16:57:22.943509 [debug] [MainThread]: Flushing usage events
[0m16:57:23.010329 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:57:23.139405 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:57:23.132922 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724` 
  ...
[0m16:57:23.224942 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724` 
  ...
[0m16:57:23.229553 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:23.236236 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:23.298349 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:57:23.409721 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:57:23.509100 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m16:57:23.510515 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m16:57:23.512372 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:57:23.519038 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:57:23.522681 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:23.528878 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:57:23.532040 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:23.534113 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:57:23.536021 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:23.604741 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m16:57:23.613587 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:57:23.620184 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m16:57:23.618896 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:57:23.629496 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m16:57:23.632977 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:23.698497 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:57:23.647224 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:23.700624 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:57:23.703530 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:57:23.706365 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f5d77fd0>]}
[0m16:57:23.707406 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m16:57:23.709064 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.99s]
[0m16:57:23.711895 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:57:23.713072 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m16:57:23.730795 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:23.733057 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724`)
      
    ...
[0m16:57:23.736094 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:23.738427 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724`)
      
    ...
[0m16:57:23.753406 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:23.758716 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:57:23.760204 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:57:23.798949 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m16:57:23.800110 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:57:23.803372 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724` 
    ...
[0m16:57:23.809623 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:23.816447 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:23.815006 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724` 
    ...
[0m16:57:23.822654 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724` 
  ...
[0m16:57:23.827771 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:23.829466 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:57:23.838072 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m16:57:23.845564 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9c68956d_2b7a_4031_89e2_e89c4df76724` 
  ...
[0m16:57:23.848736 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:23.899188 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m16:57:23.903021 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f65d5b80>]}
[0m16:57:23.909286 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m16:57:23.910708 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.27s]
[0m16:57:23.913021 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:57:23.914442 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:57:23.917877 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c68956d-2b7a-4031-89e2-e89c4df76724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f65434c0>]}
[0m16:57:23.919079 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.21s]
[0m16:57:23.920385 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:57:23.922424 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:57:23.922990 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m16:57:23.923481 [debug] [MainThread]: On list__mart: Close
[0m16:57:23.924001 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m16:57:23.924481 [debug] [MainThread]: On list__clean: Close
[0m16:57:23.924963 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m16:57:23.925511 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m16:57:23.926103 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m16:57:23.926665 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m16:57:23.927192 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m16:57:23.927713 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m16:57:23.928261 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m16:57:23.928822 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m16:57:23.930037 [info ] [MainThread]: 
[0m16:57:23.930830 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.29 seconds (3.29s).
[0m16:57:23.934721 [debug] [MainThread]: Command end result
[0m16:57:24.043458 [info ] [MainThread]: 
[0m16:57:24.044434 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:57:24.045072 [info ] [MainThread]: 
[0m16:57:24.045746 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m16:57:24.047089 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.1124334, "process_in_blocks": "0", "process_kernel_time": 0.63649, "process_mem_max_rss": "114244", "process_out_blocks": "9736", "process_user_time": 5.848934}
[0m16:57:24.098844 [debug] [MainThread]: Command `dbt build` succeeded at 16:57:24.098464 after 6.16 seconds
[0m16:57:24.099609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705fae0bf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f65b96a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7705f65b9640>]}
[0m16:57:24.100198 [debug] [MainThread]: Flushing usage events
[0m16:58:16.120727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d675f1310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d6424eb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d6424ea30>]}


============================== 16:58:16.129871 | 99b47ca8-b836-41e7-9646-2256976ace30 ==============================
[0m16:58:16.129871 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:58:16.131018 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'empty': 'False', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'printer_width': '80', 'debug': 'False', 'write_json': 'True', 'fail_fast': 'False', 'quiet': 'False', 'static_parser': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'log_format': 'default', 'partial_parse': 'True', 'use_colors': 'True', 'version_check': 'True', 'no_print': 'None', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True'}
[0m16:58:16.712661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d64219cd0>]}
[0m16:58:16.907751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d64b7dd30>]}
[0m16:58:16.909100 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:58:17.331178 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:58:17.835285 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:58:17.835950 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:58:18.037234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d639bcee0>]}
[0m16:58:18.528054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d639a6e80>]}
[0m16:58:18.528908 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:58:18.532064 [info ] [MainThread]: 
[0m16:58:18.533069 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:58:18.545223 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:58:18.546958 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:58:18.695955 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:58:18.701841 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:58:19.276163 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:58:19.281133 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:19.291810 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:58:19.296468 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:19.319633 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:58:19.320613 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:58:19.332234 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:58:19.336032 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:58:19.394728 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:58:19.400202 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:19.406980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d6374fdf0>]}
[0m16:58:19.407941 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:58:19.408561 [info ] [MainThread]: 
[0m16:58:19.421628 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:58:19.422888 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:58:19.424029 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m16:58:19.424950 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:58:19.493002 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:58:19.494186 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:58:19.612205 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m16:58:19.668241 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:58:19.669644 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:58:19.679239 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:19.817231 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:58:19.820123 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:19.822078 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:58:19.824687 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:19.830513 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m16:58:19.833178 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:19.835058 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m16:58:19.837628 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:19.932180 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m16:58:19.935576 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:19.941415 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d63583dc0>]}
[0m16:58:19.991739 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.52s]
[0m16:58:19.993114 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:58:19.995156 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:58:19.996300 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:58:19.997794 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m16:58:19.999206 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:58:20.001145 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m16:58:20.003207 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m16:58:20.005437 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m16:58:20.007833 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m16:58:20.009271 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:58:20.010802 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m16:58:20.012478 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:58:20.019347 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:58:20.036496 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:58:20.107986 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:58:20.119493 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:58:20.122085 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:58:20.123682 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:58:20.191265 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:58:20.395165 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:58:20.432263 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:58:20.498335 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:58:20.500674 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m16:58:20.502384 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m16:58:20.506934 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m16:58:20.759421 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m16:58:20.772352 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:20.774966 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m16:58:20.800426 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.80s]
[0m16:58:20.805346 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m16:58:20.807570 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:58:20.812077 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:20.815609 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.81s]
[0m16:58:20.818025 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:20.820090 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:58:20.825274 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.81s]
[0m16:58:20.828582 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:58:20.831589 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:58:20.833047 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:58:20.834361 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m16:58:20.835813 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:58:20.837754 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m16:58:20.891740 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m16:58:20.894160 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m16:58:20.895952 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m16:58:20.897655 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:58:20.899320 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m16:58:20.901031 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:58:20.918283 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m16:58:21.012991 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:58:21.014586 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:58:21.016331 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:58:21.017796 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m16:58:21.018519 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:58:21.024773 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:58:21.032828 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:58:21.191282 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:58:21.297290 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m16:58:21.396789 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:58:21.497488 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:58:21.520777 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:58:21.712115 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30` 
  ...
[0m16:58:21.714949 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m16:58:21.812813 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m16:58:21.827242 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:58:21.832501 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30` 
  ...
[0m16:58:21.918824 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:58:21.999310 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:58:22.028077 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:58:22.111301 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m16:58:22.126964 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m16:58:22.131231 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:22.191998 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:58:22.194441 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:58:22.210259 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m16:58:22.298494 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:58:22.296053 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:58:22.307513 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:58:22.312943 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d6414a730>]}
[0m16:58:22.320011 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.41s]
[0m16:58:22.323027 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:58:22.326417 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:22.329106 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:22.393798 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:58:22.399588 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:58:22.402769 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m16:58:22.405100 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m16:58:22.435874 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:58:22.440496 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30`)
      
    ...
[0m16:58:22.471303 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:58:22.480668 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:58:22.483355 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m16:58:22.491478 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30`)
      
    ...
[0m16:58:22.494052 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:22.500895 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30` 
    ...
[0m16:58:22.510899 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:22.520062 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30` 
  ...
[0m16:58:22.522161 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:58:22.531902 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:58:22.533702 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:22.592180 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m16:58:22.545489 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m16:58:22.598974 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30` 
    ...
[0m16:58:22.605786 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:22.612437 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d6412d040>]}
[0m16:58:22.614838 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.72s]
[0m16:58:22.617392 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:58:22.620081 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:58:22.632475 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_99b47ca8_b836_41e7_9646_2256976ace30` 
  ...
[0m16:58:22.639400 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:22.701228 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m16:58:22.706665 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:58:22.713132 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99b47ca8-b836-41e7-9646-2256976ace30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d63892910>]}
[0m16:58:22.715448 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.82s]
[0m16:58:22.718305 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:58:22.722569 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:58:22.723731 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m16:58:22.724858 [debug] [MainThread]: On list__clean: Close
[0m16:58:22.725912 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m16:58:22.727020 [debug] [MainThread]: On list__mart: Close
[0m16:58:22.728054 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m16:58:22.729120 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m16:58:22.730148 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m16:58:22.731229 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m16:58:22.732251 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m16:58:22.733307 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m16:58:22.734331 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m16:58:22.735405 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m16:58:22.737597 [info ] [MainThread]: 
[0m16:58:22.738910 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.20 seconds (4.20s).
[0m16:58:22.797087 [debug] [MainThread]: Command end result
[0m16:58:23.010497 [info ] [MainThread]: 
[0m16:58:23.011837 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:58:23.012953 [info ] [MainThread]: 
[0m16:58:23.014371 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m16:58:23.017166 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.0901556, "process_in_blocks": "0", "process_kernel_time": 0.711479, "process_mem_max_rss": "114696", "process_out_blocks": "9744", "process_user_time": 6.289164}
[0m16:58:23.018764 [debug] [MainThread]: Command `dbt build` succeeded at 16:58:23.018333 after 7.09 seconds
[0m16:58:23.020090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d675f1310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d639a6e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732d661fb6a0>]}
[0m16:58:23.021481 [debug] [MainThread]: Flushing usage events
[0m16:59:15.836826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f670ee310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f63d54b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f63d549d0>]}


============================== 16:59:15.846583 | bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab ==============================
[0m16:59:15.846583 [info ] [MainThread]: Running with dbt=1.8.9
[0m16:59:15.847666 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'debug': 'False', 'warn_error': 'None', 'log_cache_events': 'False', 'fail_fast': 'False', 'log_format': 'default', 'quiet': 'False', 'cache_selected_only': 'False', 'introspect': 'True', 'no_print': 'None', 'static_parser': 'True', 'empty': 'False', 'target_path': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'profiles_dir': '.', 'indirect_selection': 'eager', 'printer_width': '80', 'use_experimental_parser': 'False', 'use_colors': 'True', 'write_json': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m16:59:16.428269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f63d0c5b0>]}
[0m16:59:16.569306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f63db6070>]}
[0m16:59:16.621141 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m16:59:17.042348 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m16:59:17.543755 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:59:17.544380 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:59:17.743832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f634a8eb0>]}
[0m16:59:18.181334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f633688e0>]}
[0m16:59:18.182207 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m16:59:18.223793 [info ] [MainThread]: 
[0m16:59:18.224837 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m16:59:18.236784 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:59:18.243126 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m16:59:18.339716 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:59:18.354930 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:59:19.128144 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:59:19.135783 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m16:59:19.139569 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:19.141657 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:19.245948 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m16:59:19.247453 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m16:59:19.263647 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m16:59:19.268838 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m16:59:19.321434 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m16:59:19.333134 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:19.346990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f62fccdc0>]}
[0m16:59:19.348901 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m16:59:19.350242 [info ] [MainThread]: 
[0m16:59:19.427746 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m16:59:19.428880 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m16:59:19.429929 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m16:59:19.430697 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m16:59:19.446961 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:59:19.448113 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m16:59:19.566772 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m16:59:19.677346 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m16:59:19.678760 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:59:19.691722 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:19.767763 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:59:19.771059 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:19.822786 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m16:59:19.826323 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:19.832110 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m16:59:19.834993 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:19.836822 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m16:59:19.839577 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:19.933385 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m16:59:19.936855 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:19.943061 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f63079fd0>]}
[0m16:59:19.944242 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.51s]
[0m16:59:19.945678 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m16:59:19.948191 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:59:19.949671 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:59:19.951167 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:59:19.953096 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m16:59:19.955068 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m16:59:19.957076 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m16:59:19.959380 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m16:59:19.961461 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m16:59:19.963615 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m16:59:19.965314 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:59:19.967005 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:59:19.968749 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:59:20.224781 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:59:20.235822 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:59:20.239942 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:59:20.242607 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:59:20.244085 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:59:20.245606 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:59:20.535081 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m16:59:20.558237 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m16:59:20.568223 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m16:59:20.621898 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m16:59:20.623523 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m16:59:20.624619 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m16:59:20.875057 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m16:59:20.883385 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m16:59:20.893264 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:59:20.922812 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m16:59:20.930865 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m16:59:20.937236 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.98s]
[0m16:59:20.942748 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.98s]
[0m16:59:20.948235 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m16:59:20.951187 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m16:59:20.955986 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:20.961712 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 1.00s]
[0m16:59:20.964438 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m16:59:20.967565 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:59:20.968800 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:59:20.970299 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m16:59:20.971508 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:59:21.023593 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m16:59:21.025348 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m16:59:21.027366 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m16:59:21.029512 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m16:59:21.031196 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:59:21.032833 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m16:59:21.034496 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:59:21.051857 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m16:59:21.138087 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:59:21.150249 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:59:21.158998 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:59:21.161874 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:59:21.168762 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:59:21.237929 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m16:59:21.338069 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m16:59:21.356049 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m16:59:21.522674 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m16:59:21.566070 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:59:21.747656 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m16:59:21.767044 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m16:59:21.861336 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:59:21.923658 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab` 
  ...
[0m16:59:21.962304 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:59:22.048031 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab` 
  ...
[0m16:59:22.050374 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m16:59:22.053971 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:22.061776 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:22.127807 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m16:59:22.229327 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m16:59:22.236420 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m16:59:22.238047 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:59:22.247288 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m16:59:22.250367 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:22.252967 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f63064f70>]}
[0m16:59:22.254111 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.22s]
[0m16:59:22.255472 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m16:59:22.265258 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m16:59:22.321979 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m16:59:22.326213 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:59:22.332280 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:59:22.337738 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:22.344290 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:22.345499 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m16:59:22.348604 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m16:59:22.350181 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m16:59:22.351969 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m16:59:22.365879 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:22.368079 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab`)
      
    ...
[0m16:59:22.385160 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:59:22.390505 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:59:22.395892 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:22.398984 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab` 
    ...
[0m16:59:22.400264 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m16:59:22.423851 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab`)
      
    ...
[0m16:59:22.426386 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:22.432353 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab` 
  ...
[0m16:59:22.435830 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:22.443745 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m16:59:22.445206 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m16:59:22.451084 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m16:59:22.452431 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:22.456759 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f62dc0610>]}
[0m16:59:22.458094 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.43s]
[0m16:59:22.459586 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m16:59:22.460945 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m16:59:22.463959 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab` 
    ...
[0m16:59:22.469530 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:22.524227 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_bd5a4c1a_bf14_41c1_a5f7_3a6bb160ccab` 
  ...
[0m16:59:22.527522 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:22.533520 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m16:59:22.536248 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m16:59:22.539387 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd5a4c1a-bf14-41c1-a5f7-3a6bb160ccab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f62d04820>]}
[0m16:59:22.540503 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.51s]
[0m16:59:22.541814 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m16:59:22.543862 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:59:22.544389 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m16:59:22.544946 [debug] [MainThread]: On list__clean: Close
[0m16:59:22.545427 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m16:59:22.545970 [debug] [MainThread]: On list__mart: Close
[0m16:59:22.546424 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m16:59:22.546943 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m16:59:22.547407 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m16:59:22.547940 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m16:59:22.548413 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m16:59:22.548978 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m16:59:22.549435 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m16:59:22.549961 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m16:59:22.551093 [info ] [MainThread]: 
[0m16:59:22.551766 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.33 seconds (4.33s).
[0m16:59:22.555611 [debug] [MainThread]: Command end result
[0m16:59:22.657984 [info ] [MainThread]: 
[0m16:59:22.658843 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:59:22.659424 [info ] [MainThread]: 
[0m16:59:22.660081 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m16:59:22.661373 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.0253043, "process_in_blocks": "0", "process_kernel_time": 0.709722, "process_mem_max_rss": "115232", "process_out_blocks": "9744", "process_user_time": 6.173493}
[0m16:59:22.662112 [debug] [MainThread]: Command `dbt build` succeeded at 16:59:22.661919 after 7.03 seconds
[0m16:59:22.662739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f670ee310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f64868460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701f61d00430>]}
[0m16:59:22.663322 [debug] [MainThread]: Flushing usage events
[0m17:00:16.792052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7203051db310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720301e43b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720301e43a00>]}


============================== 17:00:16.801489 | d3ff1786-6849-41ab-99ff-7c90cc996a3c ==============================
[0m17:00:16.801489 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:00:16.802573 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'fail_fast': 'False', 'cache_selected_only': 'False', 'profiles_dir': '.', 'no_print': 'None', 'introspect': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'debug': 'False', 'warn_error': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'use_colors': 'True', 'quiet': 'False', 'log_format': 'default', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'empty': 'False', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'version_check': 'True', 'printer_width': '80'}
[0m17:00:17.386489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720301d30b20>]}
[0m17:00:17.529231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7203029267c0>]}
[0m17:00:17.530472 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:00:17.992852 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:00:18.509103 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:00:18.509785 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:00:18.713564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7203015a9e80>]}
[0m17:00:19.198702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7203015bfa90>]}
[0m17:00:19.199617 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:00:19.202954 [info ] [MainThread]: 
[0m17:00:19.204001 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:00:19.215963 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:00:19.222441 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:00:19.391416 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:00:19.392657 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:00:20.068323 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:00:20.087660 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:20.089044 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:00:20.093076 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:20.120019 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:00:20.126275 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:00:20.190362 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:00:20.197994 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:00:20.204575 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:20.208574 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:20.224476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720301b1bb80>]}
[0m17:00:20.225956 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:00:20.226964 [info ] [MainThread]: 
[0m17:00:20.301521 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:00:20.302760 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:00:20.303903 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:00:20.305031 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:00:20.328958 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:00:20.330956 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:00:20.604231 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:00:20.674804 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:00:20.684662 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:00:20.701094 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:20.892001 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:00:20.894827 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:20.896768 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:00:20.899424 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:20.905274 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:00:20.907872 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:20.909720 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:00:20.912117 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:21.007552 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:00:21.010854 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:21.017443 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720300836c10>]}
[0m17:00:21.018806 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.71s]
[0m17:00:21.020110 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:00:21.022453 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:00:21.024266 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:00:21.026023 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:00:21.027588 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:00:21.029521 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:00:21.031330 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:00:21.084628 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:00:21.086736 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:00:21.088847 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:00:21.090881 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:00:21.092582 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:00:21.094244 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:00:21.287091 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:00:21.289500 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:00:21.293937 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:00:21.296315 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:00:21.297862 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:00:21.304820 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:00:21.601161 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:00:21.606517 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:00:21.623697 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:00:21.626827 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:00:21.627946 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:00:21.683724 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:00:21.898998 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:00:21.917148 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:00:21.932977 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.84s]
[0m17:00:21.988376 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:00:21.938490 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:00:21.995027 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:00:22.008334 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:22.011699 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:00:22.019277 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.93s]
[0m17:00:22.026378 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.94s]
[0m17:00:22.030351 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:00:22.033856 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:00:22.037807 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:00:22.082953 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:00:22.039111 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:00:22.084560 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:00:22.086033 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:00:22.087466 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:00:22.089029 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:00:22.090049 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:00:22.090812 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:00:22.091859 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:00:22.092846 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:00:22.093736 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:00:22.115970 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:00:22.197032 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:00:22.198973 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:00:22.200817 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:00:22.201871 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:00:22.293272 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:00:22.305871 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:00:22.493034 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:00:22.583428 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:00:22.613591 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:00:22.713120 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m17:00:22.728673 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c` 
  ...
[0m17:00:22.785872 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:00:22.830153 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c` 
  ...
[0m17:00:22.885023 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:00:22.891023 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:22.904122 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:00:22.993458 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:00:23.089038 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:00:23.098607 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:00:23.184114 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:00:23.285866 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:00:23.311457 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:00:23.330829 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:00:23.386457 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7203001a9ac0>]}
[0m17:00:23.396872 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:00:23.401473 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.30s]
[0m17:00:23.407837 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:00:23.428187 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:00:23.443339 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:00:23.513064 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:00:23.524990 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:00:23.582651 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:23.585438 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:00:23.600630 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:00:23.606903 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:00:23.609913 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:00:23.612225 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:00:23.640909 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:00:23.643523 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:00:23.647784 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c`)
      
    ...
[0m17:00:23.683929 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c`)
      
    ...
[0m17:00:23.705595 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:00:23.711274 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:00:23.713849 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:00:23.721003 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:00:23.722599 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:23.726519 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c` 
    ...
[0m17:00:23.727969 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:23.733430 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c` 
    ...
[0m17:00:23.735706 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:23.744667 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c` 
  ...
[0m17:00:23.746314 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:23.794398 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_d3ff1786_6849_41ab_99ff_7c90cc996a3c` 
  ...
[0m17:00:23.797411 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:00:23.803806 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:23.805229 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:00:23.811042 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:00:23.815299 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:00:23.818750 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720300e48d30>]}
[0m17:00:23.820030 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.73s]
[0m17:00:23.821421 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:00:23.822849 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:00:23.826309 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd3ff1786-6849-41ab-99ff-7c90cc996a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7203001a9940>]}
[0m17:00:23.827799 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.74s]
[0m17:00:23.829029 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:00:23.830884 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:00:23.831387 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:00:23.831965 [debug] [MainThread]: On list__clean: Close
[0m17:00:23.832429 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:00:23.882949 [debug] [MainThread]: On list__mart: Close
[0m17:00:23.883442 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:00:23.884051 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:00:23.886945 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:00:23.888790 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:00:23.890722 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:00:23.892112 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:00:23.893568 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:00:23.894781 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:00:23.896937 [info ] [MainThread]: 
[0m17:00:23.897947 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.69 seconds (4.69s).
[0m17:00:23.902662 [debug] [MainThread]: Command end result
[0m17:00:24.016013 [info ] [MainThread]: 
[0m17:00:24.016915 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:00:24.017576 [info ] [MainThread]: 
[0m17:00:24.018305 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:00:24.020005 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.422599, "process_in_blocks": "0", "process_kernel_time": 0.717289, "process_mem_max_rss": "115064", "process_out_blocks": "9744", "process_user_time": 6.381509}
[0m17:00:24.020923 [debug] [MainThread]: Command `dbt build` succeeded at 17:00:24.020698 after 7.42 seconds
[0m17:00:24.021643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7203051db310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720303101100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x720303104220>]}
[0m17:00:24.022324 [debug] [MainThread]: Flushing usage events
[0m17:01:17.965834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31587a0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31553fcb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31553fca00>]}


============================== 17:01:17.975189 | 5d245175-53df-4cbe-9ddd-6b4e300647b2 ==============================
[0m17:01:17.975189 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:01:17.976270 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'quiet': 'False', 'version_check': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'partial_parse': 'True', 'debug': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'use_colors': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'empty': 'False', 'write_json': 'True', 'static_parser': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error': 'None'}
[0m17:01:18.511974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31552f4940>]}
[0m17:01:18.705166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31553c5310>]}
[0m17:01:18.706493 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:01:19.173921 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:01:19.683152 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:01:19.683869 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:01:19.884260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a3154b63eb0>]}
[0m17:01:20.371816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a3154a584c0>]}
[0m17:01:20.372714 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:01:20.376036 [info ] [MainThread]: 
[0m17:01:20.377065 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:01:20.389049 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:01:20.390528 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:01:20.507053 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:01:20.505987 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:01:21.196631 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:01:21.201421 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:21.202825 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:01:21.209817 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:21.265678 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:01:21.266744 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:01:21.278747 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:01:21.282836 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:01:21.292739 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:21.303226 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:01:21.308324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31552daf70>]}
[0m17:01:21.309329 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:01:21.309990 [info ] [MainThread]: 
[0m17:01:21.368032 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:01:21.369208 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:01:21.370313 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:01:21.371092 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:01:21.388762 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:01:21.390017 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:01:21.511711 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:01:21.617081 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:01:21.618466 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:01:21.628640 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:21.769391 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:01:21.772491 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:21.774611 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:01:21.777494 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:21.783773 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:01:21.786647 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:21.788655 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:01:21.791413 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:21.887952 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:01:21.891356 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:21.901649 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a3154731fa0>]}
[0m17:01:21.903798 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m17:01:21.906011 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:01:21.908263 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:01:21.909528 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:01:21.910499 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:01:21.911522 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:01:21.912526 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:01:21.913448 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:01:21.914644 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:01:21.915628 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:01:21.965320 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:01:21.966498 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:01:21.967343 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:01:21.968090 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:01:21.995634 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:01:21.998298 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:01:22.007105 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:01:22.008705 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:01:22.014773 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:01:22.071059 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:01:22.308883 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:01:22.377884 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:01:22.380753 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:01:22.383774 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:01:22.385950 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:01:22.387801 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:01:22.567178 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:01:22.584080 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:01:22.588587 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:01:22.593199 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:01:22.610508 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.70s]
[0m17:01:22.666831 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:01:22.668531 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:01:22.671395 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:01:22.677330 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.76s]
[0m17:01:22.682806 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.77s]
[0m17:01:22.685896 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:01:22.688970 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:01:22.692223 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:01:22.693281 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:01:22.694616 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:01:22.695603 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:01:22.697843 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:01:22.700156 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:01:22.702086 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:01:22.703715 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:01:22.705254 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:01:22.706980 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:01:22.708729 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:01:22.710387 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:01:22.868401 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:01:22.898829 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:01:22.900882 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:01:22.903520 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:01:22.905161 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:01:22.906841 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:01:22.989051 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:01:23.096606 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:01:23.204983 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:01:23.308305 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:01:23.399572 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:01:23.414436 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:01:23.582517 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:01:23.693591 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2` 
  ...
[0m17:01:23.703199 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:01:23.787090 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:01:23.785216 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2` 
  ...
[0m17:01:23.802908 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:23.891505 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:01:23.896041 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:01:24.072070 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:01:24.175077 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:01:24.201011 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:01:24.202891 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:01:24.208562 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:24.266804 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a3153f941f0>]}
[0m17:01:24.269776 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.56s]
[0m17:01:24.272422 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:01:24.275166 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:01:24.294067 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:01:24.380098 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:01:24.388240 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:01:24.398184 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:24.411753 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:01:24.414687 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:01:24.470456 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:01:24.473670 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:01:24.477978 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:01:24.508173 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:01:24.510916 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:01:24.515232 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2`)
      
    ...
[0m17:01:24.520940 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2`)
      
    ...
[0m17:01:24.547752 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:01:24.569039 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:01:24.571711 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:01:24.583939 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:01:24.586619 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:24.594243 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2` 
    ...
[0m17:01:24.597143 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:24.604498 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2` 
    ...
[0m17:01:24.607216 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:24.671945 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:01:24.675687 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2` 
  ...
[0m17:01:24.687617 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5d245175_53df_4cbe_9ddd_6b4e300647b2` 
  ...
[0m17:01:24.693401 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:24.696019 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:24.708621 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:01:24.771764 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:01:24.777924 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:01:24.785923 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:01:24.787100 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31548ca4c0>]}
[0m17:01:24.793324 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d245175-53df-4cbe-9ddd-6b4e300647b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a3153f98970>]}
[0m17:01:24.795744 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.08s]
[0m17:01:24.798233 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.09s]
[0m17:01:24.801371 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:01:24.804274 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:01:24.808662 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:01:24.809813 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:01:24.810934 [debug] [MainThread]: On list__mart: Close
[0m17:01:24.812026 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:01:24.813106 [debug] [MainThread]: On list__clean: Close
[0m17:01:24.814149 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:01:24.815227 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:01:24.866328 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:01:24.867477 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:01:24.868594 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:01:24.869677 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:01:24.870719 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:01:24.871783 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:01:24.874042 [info ] [MainThread]: 
[0m17:01:24.875371 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.50 seconds (4.50s).
[0m17:01:24.883700 [debug] [MainThread]: Command end result
[0m17:01:25.084281 [info ] [MainThread]: 
[0m17:01:25.085159 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:01:25.085764 [info ] [MainThread]: 
[0m17:01:25.086358 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:01:25.087677 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.315574, "process_in_blocks": "0", "process_kernel_time": 0.68319, "process_mem_max_rss": "114868", "process_out_blocks": "9744", "process_user_time": 6.377105}
[0m17:01:25.088385 [debug] [MainThread]: Command `dbt build` succeeded at 17:01:25.088197 after 7.32 seconds
[0m17:01:25.088995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31587a0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31566bf4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a31553c5310>]}
[0m17:01:25.089573 [debug] [MainThread]: Flushing usage events
[0m17:02:15.975660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea174e0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea1414bb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea1414b9d0>]}


============================== 17:02:15.985240 | 5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9 ==============================
[0m17:02:15.985240 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:02:15.986315 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'quiet': 'False', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'target_path': 'None', 'debug': 'False', 'log_format': 'default', 'log_path': '/workdir/transforms/04_btc/logs', 'indirect_selection': 'eager', 'invocation_command': 'dbt build --profiles-dir . --target local', 'empty': 'False', 'version_check': 'True', 'warn_error': 'None', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'write_json': 'True', 'use_colors': 'True', 'printer_width': '80', 'static_parser': 'True', 'cache_selected_only': 'False'}
[0m17:02:16.574767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea14019bb0>]}
[0m17:02:16.768412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea14222dc0>]}
[0m17:02:16.769741 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:02:17.182166 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:02:17.746440 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:02:17.747144 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:02:17.960682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea138b1e80>]}
[0m17:02:18.448572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea138c61f0>]}
[0m17:02:18.449418 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:02:18.452712 [info ] [MainThread]: 
[0m17:02:18.453728 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:02:18.465455 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:02:18.467024 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:02:18.573438 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:02:18.574929 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:02:19.246820 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:02:19.254988 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:19.257494 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:02:19.266152 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:19.364474 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:02:19.366004 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:02:19.381485 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:02:19.438721 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:02:19.449082 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:19.461274 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:19.473256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea1380f2b0>]}
[0m17:02:19.475193 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:02:19.476607 [info ] [MainThread]: 
[0m17:02:19.547776 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:02:19.548990 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:02:19.550129 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:02:19.550944 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:02:19.567953 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:02:19.569090 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:02:19.751351 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:02:19.816529 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:02:19.817913 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:02:19.830075 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:19.958592 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:02:19.962289 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:19.964231 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:02:19.967342 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:19.972969 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:02:19.975817 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:19.977689 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:02:19.980455 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:20.072198 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:02:20.075744 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:20.081654 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea12b4a310>]}
[0m17:02:20.082771 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m17:02:20.084132 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:02:20.086377 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:02:20.138469 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:02:20.088026 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:02:20.140820 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:02:20.142876 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:02:20.144929 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:02:20.147202 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:02:20.149401 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:02:20.151504 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:02:20.153338 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:02:20.155162 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:02:20.156454 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:02:20.275513 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:02:20.280641 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:02:20.282365 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:02:20.285134 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:02:20.338647 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:02:20.286683 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:02:20.557425 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:02:20.569673 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:02:20.580356 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:02:20.582197 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:02:20.583379 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:02:20.586822 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:02:20.815478 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:02:20.824148 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:02:20.839236 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:02:20.832068 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:20.842847 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:20.860798 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.71s]
[0m17:02:20.863935 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:20.869673 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.72s]
[0m17:02:20.872770 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:02:20.878625 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.73s]
[0m17:02:20.881496 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:02:20.884854 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:02:20.938828 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:02:20.940526 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:02:20.942375 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:02:20.944300 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:02:20.946464 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:02:20.948820 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:02:20.950729 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:02:20.952266 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:02:20.953862 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:02:20.955462 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:02:20.957104 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:02:20.958857 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:02:21.077181 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:02:21.138699 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:02:21.140382 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:02:21.143011 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:02:21.150266 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:02:21.243351 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:02:21.345262 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:02:21.373426 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:02:21.470464 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:02:21.568270 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:02:21.685860 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m17:02:21.750053 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:02:21.779624 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:21.869478 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:02:21.962136 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9` 
  ...
[0m17:02:21.969216 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9` 
  ...
[0m17:02:21.973414 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:21.981173 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:02:21.984196 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:22.045681 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:02:22.058792 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:02:22.162909 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:02:22.255235 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:02:22.279219 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea13629850>]}
[0m17:02:22.356218 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.31s]
[0m17:02:22.379889 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:02:22.546012 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:02:22.549028 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:02:22.779728 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.23 seconds
[0m17:02:22.794814 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.24 seconds
[0m17:02:22.819415 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:02:22.824305 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:02:22.837796 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:22.839302 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:22.845732 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:02:22.848570 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:02:22.850093 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:02:22.852056 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:02:22.867244 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:22.868512 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:22.871426 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9`)
      
    ...
[0m17:02:22.873799 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9`)
      
    ...
[0m17:02:22.895139 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:22.903461 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:02:22.906854 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:02:22.914327 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:02:22.939733 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:02:22.944003 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9` 
    ...
[0m17:02:22.948261 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:22.951385 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9` 
    ...
[0m17:02:22.953106 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:02:22.961430 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9` 
  ...
[0m17:02:22.965934 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:22.972918 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:02:22.976064 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:02:22.983519 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5dfc5877_22d8_4dd0_8c8d_e210cb1ff3c9` 
  ...
[0m17:02:22.987942 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:22.990131 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:23.040893 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea12b4a490>]}
[0m17:02:23.048555 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:02:23.050037 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.09s]
[0m17:02:23.053445 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:02:23.056096 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:02:23.059855 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5dfc5877-22d8-4dd0-8c8d-e210cb1ff3c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea120f2a30>]}
[0m17:02:23.061023 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.11s]
[0m17:02:23.062311 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:02:23.064377 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:02:23.065057 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:02:23.065625 [debug] [MainThread]: On list__mart: Close
[0m17:02:23.066123 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:02:23.066648 [debug] [MainThread]: On list__clean: Close
[0m17:02:23.067142 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:02:23.067684 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:02:23.068168 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m17:02:23.068786 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m17:02:23.069271 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:02:23.069860 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:02:23.070341 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:02:23.070908 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:02:23.072132 [info ] [MainThread]: 
[0m17:02:23.072897 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.62 seconds (4.62s).
[0m17:02:23.076791 [debug] [MainThread]: Command end result
[0m17:02:23.238610 [info ] [MainThread]: 
[0m17:02:23.239584 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:02:23.240209 [info ] [MainThread]: 
[0m17:02:23.240867 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:02:23.242281 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.4588833, "process_in_blocks": "0", "process_kernel_time": 0.7261, "process_mem_max_rss": "115044", "process_out_blocks": "9752", "process_user_time": 6.320871}
[0m17:02:23.243089 [debug] [MainThread]: Command `dbt build` succeeded at 17:02:23.242893 after 7.46 seconds
[0m17:02:23.243753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea174e0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea137603d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71ea1236a5e0>]}
[0m17:02:23.244365 [debug] [MainThread]: Flushing usage events
[0m17:03:16.559467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7550517ee310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75504e434b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75504e434a00>]}


============================== 17:03:16.619124 | 6cb7b094-4732-4b8c-ab10-03240c8efd19 ==============================
[0m17:03:16.619124 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:03:16.620173 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'version_check': 'True', 'target_path': 'None', 'no_print': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_colors': 'True', 'profiles_dir': '.', 'write_json': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'partial_parse': 'True', 'log_cache_events': 'False', 'quiet': 'False', 'empty': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'debug': 'False', 'log_format': 'default', 'warn_error': 'None', 'indirect_selection': 'eager'}
[0m17:03:17.147749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6cb7b094-4732-4b8c-ab10-03240c8efd19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75504e419580>]}
[0m17:03:17.339724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6cb7b094-4732-4b8c-ab10-03240c8efd19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75504e8abb20>]}
[0m17:03:17.340939 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:03:17.754871 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:03:18.264384 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:03:18.315513 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:03:18.516605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6cb7b094-4732-4b8c-ab10-03240c8efd19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75504db9deb0>]}
[0m17:03:18.959472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6cb7b094-4732-4b8c-ab10-03240c8efd19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75504da924c0>]}
[0m17:03:18.960376 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:03:18.963567 [info ] [MainThread]: 
[0m17:03:18.964600 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:03:18.976070 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:03:18.977612 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:03:19.046676 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:03:19.062436 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:03:19.689987 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:03:19.698449 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:03:19.725666 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:03:19.735137 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:03:19.829184 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:03:19.835911 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:03:19.851275 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:03:19.857985 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:03:19.916442 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:03:19.917716 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:03:19.939583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6cb7b094-4732-4b8c-ab10-03240c8efd19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7550517367c0>]}
[0m17:03:19.941416 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:03:19.942739 [info ] [MainThread]: 
[0m17:03:20.019682 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:03:20.020784 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:03:20.021835 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:03:20.022547 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:03:20.038997 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:03:20.040246 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:03:20.218782 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:03:20.288291 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:03:20.290574 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:03:20.303158 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:03:20.460636 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:03:20.463694 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:03:20.516219 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:03:20.519254 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:03:20.525159 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:03:20.527884 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:03:20.529849 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:03:20.533139 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:03:20.628244 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:03:20.631469 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:03:20.637609 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6cb7b094-4732-4b8c-ab10-03240c8efd19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75504cea7a30>]}
[0m17:03:20.638806 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m17:03:20.640155 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:03:20.641696 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:03:20.642672 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:03:20.643542 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:03:20.644417 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:03:20.645290 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:03:20.646335 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:03:20.647207 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:03:20.648255 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:03:20.649055 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:03:20.649978 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:03:20.650728 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:03:20.667471 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:03:20.726051 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:03:20.726707 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:03:20.733441 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:03:20.735010 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:03:20.735836 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:03:20.741795 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:03:20.858471 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:03:20.917114 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:03:20.918657 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:03:20.919859 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:03:20.921404 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:03:20.922151 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:03:21.086998 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:03:21.095265 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:03:21.096968 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:03:21.107470 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.46s]
[0m17:03:21.109363 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:03:21.110505 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:03:21.116137 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:03:21.119261 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.47s]
[0m17:03:21.122784 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:03:21.127357 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:03:21.130418 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.48s]
[0m17:03:21.131880 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:03:21.133515 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:03:21.134300 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:03:21.135092 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:03:21.136015 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:03:21.136998 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:03:21.138003 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:03:21.138813 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:03:21.139527 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:03:21.140284 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:03:21.140997 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:03:21.141806 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:03:21.142643 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:03:21.161618 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:03:21.217442 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:03:21.222912 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:03:21.224348 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:03:21.225273 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:03:21.236620 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:03:21.352946 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:03:21.520903 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:03:21.616497 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:03:21.723455 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:03:21.757575 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:03:21.818049 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:03:21.921786 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:03:21.924508 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_6cb7b094_4732_4b8c_ab10_03240c8efd19` 
  ...
[0m17:03:22.016548 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:03:22.024868 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_6cb7b094_4732_4b8c_ab10_03240c8efd19` 
  ...
[0m17:03:22.027659 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:03:22.042211 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:03:22.050525 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:03:22.054601 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:03:22.228152 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:03:22.338103 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:03:22.428262 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:03:22.452484 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_6cb7b094_4732_4b8c_ab10_03240c8efd19`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:03:22.453632 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_6cb7b094_4732_4b8c_ab10_03240c8efd19`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:03:22.456384 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6cb7b094-4732-4b8c-ab10-03240c8efd19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75504d6e1340>]}
[0m17:03:22.459806 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.32s]
[0m17:03:22.461359 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:03:22.483531 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:03:22.517627 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:03:22.623506 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_6cb7b094_4732_4b8c_ab10_03240c8efd19'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:03:22.626011 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_6cb7b094_4732_4b8c_ab10_03240c8efd19'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:03:22.635548 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:03:22.638333 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:03:22.717279 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:03:22.665748 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:03:22.719020 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_6cb7b094_4732_4b8c_ab10_03240c8efd19`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:03:22.720198 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_6cb7b094_4732_4b8c_ab10_03240c8efd19`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:03:22.740945 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:03:22.743000 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:03:22.745843 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_6cb7b094_4732_4b8c_ab10_03240c8efd19`)
      
    ...
[0m17:03:22.749500 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_6cb7b094_4732_4b8c_ab10_03240c8efd19`)
      
    ...
[0m17:03:22.778604 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:03:22.789292 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:03:22.791981 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:03:22.821620 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:03:22.818769 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:03:22.827607 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_6cb7b094_4732_4b8c_ab10_03240c8efd19` 
    ...
[0m17:03:22.836556 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:03:22.842376 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_6cb7b094_4732_4b8c_ab10_03240c8efd19` 
    ...
[0m17:03:22.844945 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:03:22.858525 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_6cb7b094_4732_4b8c_ab10_03240c8efd19` 
  ...
[0m17:03:22.860459 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:03:22.921714 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:03:22.926716 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_6cb7b094_4732_4b8c_ab10_03240c8efd19` 
  ...
[0m17:03:22.939117 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:03:22.945343 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:03:22.958769 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:03:22.961387 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:03:23.019641 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6cb7b094-4732-4b8c-ab10-03240c8efd19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75504d45af10>]}
[0m17:03:23.025075 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.88s]
[0m17:03:23.027833 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:03:23.030732 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:03:23.038027 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6cb7b094-4732-4b8c-ab10-03240c8efd19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75504d386cd0>]}
[0m17:03:23.040657 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.90s]
[0m17:03:23.044087 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:03:23.048470 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:03:23.049729 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:03:23.051003 [debug] [MainThread]: On list__mart: Close
[0m17:03:23.052310 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:03:23.053494 [debug] [MainThread]: On list__clean: Close
[0m17:03:23.054628 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:03:23.055807 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:03:23.056935 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:03:23.058095 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:03:23.059219 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:03:23.060377 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:03:23.061487 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:03:23.062645 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:03:23.115376 [info ] [MainThread]: 
[0m17:03:23.117177 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.15 seconds (4.15s).
[0m17:03:23.125827 [debug] [MainThread]: Command end result
[0m17:03:23.255068 [info ] [MainThread]: 
[0m17:03:23.256392 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:03:23.257374 [info ] [MainThread]: 
[0m17:03:23.258413 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:03:23.260610 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.8995237, "process_in_blocks": "0", "process_kernel_time": 0.68154, "process_mem_max_rss": "114196", "process_out_blocks": "9744", "process_user_time": 6.13985}
[0m17:03:23.261876 [debug] [MainThread]: Command `dbt build` succeeded at 17:03:23.261556 after 6.90 seconds
[0m17:03:23.262990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7550517ee310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75504e419580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75504e332910>]}
[0m17:03:23.264140 [debug] [MainThread]: Flushing usage events
[0m17:04:16.109891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747ccf18d310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747ccbdebb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747ccbdeba00>]}


============================== 17:04:16.118946 | 42f11d66-8cec-4d28-b0f7-027b93a923cb ==============================
[0m17:04:16.118946 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:04:16.120040 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'warn_error': 'None', 'introspect': 'True', 'empty': 'False', 'target_path': 'None', 'printer_width': '80', 'log_cache_events': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager', 'invocation_command': 'dbt build --profiles-dir . --target local', 'cache_selected_only': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'quiet': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'log_format': 'default', 'fail_fast': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'send_anonymous_usage_stats': 'True', 'debug': 'False'}
[0m17:04:16.705866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '42f11d66-8cec-4d28-b0f7-027b93a923cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747ccbce4490>]}
[0m17:04:16.906133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '42f11d66-8cec-4d28-b0f7-027b93a923cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747ccc8cc3a0>]}
[0m17:04:16.907458 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:04:17.328250 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:04:17.829681 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:04:17.830341 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:04:18.029639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '42f11d66-8cec-4d28-b0f7-027b93a923cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747ccb551eb0>]}
[0m17:04:18.506353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '42f11d66-8cec-4d28-b0f7-027b93a923cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747ccb43e4c0>]}
[0m17:04:18.507213 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:04:18.510326 [info ] [MainThread]: 
[0m17:04:18.511365 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:04:18.522866 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:04:18.524415 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:04:18.620173 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:04:18.634434 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:04:19.394800 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:04:19.401870 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:04:19.405961 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:04:19.410608 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:04:19.507591 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:04:19.509022 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:04:19.530529 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:04:19.537999 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:04:19.599842 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:04:19.611731 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:04:19.624280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '42f11d66-8cec-4d28-b0f7-027b93a923cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747ccbd34400>]}
[0m17:04:19.626170 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:04:19.627525 [info ] [MainThread]: 
[0m17:04:19.702609 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:04:19.703833 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:04:19.704873 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:04:19.705605 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:04:19.722450 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:04:19.723638 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:04:19.910210 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:04:19.986198 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:04:19.987828 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:04:20.000429 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:04:20.127112 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:04:20.130738 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:04:20.132701 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:04:20.135460 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:04:20.189707 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:04:20.193010 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:04:20.194842 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:04:20.197794 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:04:20.293790 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:04:20.297216 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:04:20.303360 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42f11d66-8cec-4d28-b0f7-027b93a923cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747cce699a60>]}
[0m17:04:20.304494 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m17:04:20.305884 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:04:20.308068 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:04:20.309430 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:04:20.311002 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:04:20.312306 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:04:20.313904 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:04:20.315643 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:04:20.317946 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:04:20.320042 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:04:20.322908 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:04:20.324774 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:04:20.326402 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:04:20.327768 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:04:20.517427 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:04:20.524856 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:04:20.527026 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:04:20.529204 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:04:20.589963 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:04:20.592077 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:04:20.808476 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:04:20.890973 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:04:20.906028 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:04:20.908943 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:04:20.912800 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:04:20.918994 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:04:21.624214 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:04:21.636130 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:04:21.638336 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:04:21.645220 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:04:21.690840 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:04:21.693709 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:04:21.698017 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.38s]
[0m17:04:21.704313 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.38s]
[0m17:04:21.711182 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 1.39s]
[0m17:04:21.714083 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:04:21.716906 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:04:21.719891 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:04:21.723995 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:04:21.725474 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:04:21.727034 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:04:21.728220 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:04:21.730277 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:04:21.732144 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:04:21.734219 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:04:21.736022 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:04:21.737680 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:04:21.789840 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:04:21.791686 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:04:21.819177 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:04:21.833128 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:04:21.913232 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:04:21.915933 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:04:21.918121 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:04:21.920202 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:04:21.927934 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:04:22.099971 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:04:22.123351 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:04:22.216667 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:04:22.292085 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:04:22.335744 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:04:22.402555 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:04:22.427482 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:04:22.517241 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:04:22.609347 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:04:22.613812 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:04:22.690705 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_42f11d66_8cec_4d28_b0f7_027b93a923cb` 
  ...
[0m17:04:22.728485 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:04:22.731023 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:04:22.726239 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_42f11d66_8cec_4d28_b0f7_027b93a923cb` 
  ...
[0m17:04:22.818499 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:04:22.895080 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:04:22.896554 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:04:22.925666 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42f11d66-8cec-4d28-b0f7-027b93a923cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747ccd008340>]}
[0m17:04:22.999575 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.14s]
[0m17:04:23.013963 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_42f11d66_8cec_4d28_b0f7_027b93a923cb`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:04:23.005554 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_42f11d66_8cec_4d28_b0f7_027b93a923cb`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:04:23.017772 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:04:23.052950 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:04:23.092258 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:04:23.132316 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_42f11d66_8cec_4d28_b0f7_027b93a923cb'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:04:23.134832 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_42f11d66_8cec_4d28_b0f7_027b93a923cb'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:04:23.196178 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:04:23.199381 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:04:23.212685 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:04:23.218496 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:04:23.221613 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_42f11d66_8cec_4d28_b0f7_027b93a923cb`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:04:23.223840 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_42f11d66_8cec_4d28_b0f7_027b93a923cb`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:04:23.262422 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:04:23.265508 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:04:23.289382 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_42f11d66_8cec_4d28_b0f7_027b93a923cb`)
      
    ...
[0m17:04:23.293706 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_42f11d66_8cec_4d28_b0f7_027b93a923cb`)
      
    ...
[0m17:04:23.321616 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:04:23.329625 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:04:23.330954 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:04:23.338283 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:04:23.340764 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:04:23.343690 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_42f11d66_8cec_4d28_b0f7_027b93a923cb` 
    ...
[0m17:04:23.345220 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:04:23.348849 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_42f11d66_8cec_4d28_b0f7_027b93a923cb` 
    ...
[0m17:04:23.351234 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:04:23.357520 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_42f11d66_8cec_4d28_b0f7_027b93a923cb` 
  ...
[0m17:04:23.359740 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:04:23.361005 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:04:23.394490 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_42f11d66_8cec_4d28_b0f7_027b93a923cb` 
  ...
[0m17:04:23.400282 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:04:23.403732 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:04:23.404957 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:04:23.408073 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42f11d66-8cec-4d28-b0f7-027b93a923cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747cca850820>]}
[0m17:04:23.414103 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:04:23.415451 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.67s]
[0m17:04:23.417821 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:04:23.419452 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:04:23.422556 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42f11d66-8cec-4d28-b0f7-027b93a923cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747ccbceb070>]}
[0m17:04:23.423693 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.69s]
[0m17:04:23.424981 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:04:23.426884 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:04:23.427448 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:04:23.428015 [debug] [MainThread]: On list__mart: Close
[0m17:04:23.428517 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:04:23.429066 [debug] [MainThread]: On list__clean: Close
[0m17:04:23.429573 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:04:23.430120 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:04:23.430623 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:04:23.431131 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:04:23.431620 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:04:23.432122 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:04:23.432629 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m17:04:23.433137 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m17:04:23.434341 [info ] [MainThread]: 
[0m17:04:23.435085 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.92 seconds (4.92s).
[0m17:04:23.492608 [debug] [MainThread]: Command end result
[0m17:04:23.602442 [info ] [MainThread]: 
[0m17:04:23.603311 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:04:23.603961 [info ] [MainThread]: 
[0m17:04:23.604625 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:04:23.606269 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.6922097, "process_in_blocks": "0", "process_kernel_time": 0.731893, "process_mem_max_rss": "115012", "process_out_blocks": "9744", "process_user_time": 6.280184}
[0m17:04:23.607186 [debug] [MainThread]: Command `dbt build` succeeded at 17:04:23.606947 after 7.69 seconds
[0m17:04:23.607972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747ccf18d310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747ccd09ddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x747ccbce4490>]}
[0m17:04:23.608713 [debug] [MainThread]: Flushing usage events
[0m17:05:16.431059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735c9057d310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735c8d1ccaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735c8d1cc9a0>]}


============================== 17:05:16.441080 | 2adf99ed-009a-48ca-ae5f-e232a9d7f0ef ==============================
[0m17:05:16.441080 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:05:16.442170 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'cache_selected_only': 'False', 'no_print': 'None', 'use_colors': 'True', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'debug': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'fail_fast': 'False', 'target_path': 'None', 'static_parser': 'True', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'write_json': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'indirect_selection': 'eager', 'version_check': 'True', 'log_cache_events': 'False', 'quiet': 'False', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m17:05:16.973256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2adf99ed-009a-48ca-ae5f-e232a9d7f0ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735c8d0e7490>]}
[0m17:05:17.167843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2adf99ed-009a-48ca-ae5f-e232a9d7f0ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735c8e406520>]}
[0m17:05:17.169143 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:05:17.637291 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:05:18.139849 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:05:18.140482 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:05:18.341491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2adf99ed-009a-48ca-ae5f-e232a9d7f0ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735c8c935f10>]}
[0m17:05:18.780888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2adf99ed-009a-48ca-ae5f-e232a9d7f0ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735c8c973b20>]}
[0m17:05:18.781882 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:05:18.785074 [info ] [MainThread]: 
[0m17:05:18.786087 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:05:18.833693 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:05:18.835383 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:05:18.938666 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:05:18.943708 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:05:19.653376 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:05:19.658181 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:05:19.659615 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:05:19.663017 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:05:19.689807 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:05:19.690839 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:05:19.734173 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:05:19.738152 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:05:19.745020 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:05:19.750660 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:05:19.757224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2adf99ed-009a-48ca-ae5f-e232a9d7f0ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735c8d1a8910>]}
[0m17:05:19.758185 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:05:19.758881 [info ] [MainThread]: 
[0m17:05:19.771619 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:05:19.772838 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:05:19.773722 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__clean, now model.ex_03_meteo.stg_btc__market_price)
[0m17:05:19.774459 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:05:19.840030 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:05:19.841260 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:05:19.960488 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:05:19.962273 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:05:19.973455 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:05:20.030084 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:05:20.032933 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:05:20.034987 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:05:20.037631 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:05:20.159014 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:05:20.161893 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:05:20.163870 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:05:20.166558 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:05:20.264887 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:05:20.267922 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:05:20.274104 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2adf99ed-009a-48ca-ae5f-e232a9d7f0ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735c8fb09820>]}
[0m17:05:20.324709 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.50s]
[0m17:05:20.326190 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:05:20.328598 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:05:20.330097 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:05:20.330927 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:05:20.331790 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:05:20.332662 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:05:20.333764 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:05:20.334726 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:05:20.335857 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:05:20.336630 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:05:20.337673 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:05:20.339019 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:05:20.356547 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:05:20.361070 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:05:20.430928 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:05:20.437404 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:05:20.440211 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:05:20.441907 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:05:20.458945 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:05:20.737414 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:05:20.738318 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:05:20.739367 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:05:20.740790 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:05:20.741538 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:05:20.742248 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:05:20.901110 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:05:20.938954 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:05:20.955373 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.62s]
[0m17:05:20.958562 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:05:20.961280 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:05:20.964209 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:05:21.023755 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:05:21.026744 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:05:21.033154 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.70s]
[0m17:05:21.038953 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.70s]
[0m17:05:21.041902 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:05:21.044792 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:05:21.048354 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:05:21.049476 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:05:21.051057 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:05:21.052442 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:05:21.054409 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:05:21.056297 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:05:21.058436 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:05:21.060371 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:05:21.062078 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:05:21.063699 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:05:21.065292 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:05:21.124473 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:05:21.227763 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:05:21.246433 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:05:21.250281 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:05:21.253082 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:05:21.254783 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:05:21.266815 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:05:21.349169 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:05:21.424245 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:05:21.469888 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:05:21.555789 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:05:21.642964 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:05:21.657680 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:05:21.742289 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:05:21.846887 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:05:22.025414 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:05:22.035266 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:05:22.065048 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:05:22.162918 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_2adf99ed_009a_48ca_ae5f_e232a9d7f0ef` 
  ...
[0m17:05:22.232033 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:05:22.234771 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_2adf99ed_009a_48ca_ae5f_e232a9d7f0ef` 
  ...
[0m17:05:22.241373 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:05:22.244073 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:05:22.254625 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:05:22.268085 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2adf99ed-009a-48ca-ae5f-e232a9d7f0ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735c8bc2e310>]}
[0m17:05:22.359022 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.20s]
[0m17:05:22.425757 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:05:22.646256 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_2adf99ed_009a_48ca_ae5f_e232a9d7f0ef`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:05:22.655837 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_2adf99ed_009a_48ca_ae5f_e232a9d7f0ef`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:05:23.398682 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.74 seconds
[0m17:05:23.415481 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.76 seconds
[0m17:05:23.446490 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_2adf99ed_009a_48ca_ae5f_e232a9d7f0ef'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:05:23.457698 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_2adf99ed_009a_48ca_ae5f_e232a9d7f0ef'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:05:23.468934 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:05:23.476808 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:05:23.532192 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:05:23.540181 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:05:23.543038 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_2adf99ed_009a_48ca_ae5f_e232a9d7f0ef`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:05:23.545290 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_2adf99ed_009a_48ca_ae5f_e232a9d7f0ef`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:05:23.569605 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:05:23.572137 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:05:23.576192 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_2adf99ed_009a_48ca_ae5f_e232a9d7f0ef`)
      
    ...
[0m17:05:23.580303 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_2adf99ed_009a_48ca_ae5f_e232a9d7f0ef`)
      
    ...
[0m17:05:23.609824 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:05:23.625518 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:05:23.630848 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:05:23.640904 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:05:23.650000 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:05:23.657948 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:05:23.655996 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_2adf99ed_009a_48ca_ae5f_e232a9d7f0ef` 
    ...
[0m17:05:23.664473 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_2adf99ed_009a_48ca_ae5f_e232a9d7f0ef` 
    ...
[0m17:05:23.674898 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:05:23.677379 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:05:23.736339 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_2adf99ed_009a_48ca_ae5f_e232a9d7f0ef` 
  ...
[0m17:05:23.748914 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_2adf99ed_009a_48ca_ae5f_e232a9d7f0ef` 
  ...
[0m17:05:23.755002 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:05:23.768087 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:05:23.771085 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:05:23.831160 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:05:23.835195 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:05:23.839569 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2adf99ed-009a-48ca-ae5f-e232a9d7f0ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735c8c456d90>]}
[0m17:05:23.841567 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:05:23.843459 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.78s]
[0m17:05:23.850026 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2adf99ed-009a-48ca-ae5f-e232a9d7f0ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735c8bc41e20>]}
[0m17:05:23.852679 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:05:23.855199 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.79s]
[0m17:05:23.858527 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:05:23.862689 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:05:23.863962 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:05:23.865183 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:05:23.866264 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:05:23.867380 [debug] [MainThread]: On list__mart: Close
[0m17:05:23.868502 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:05:23.869759 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:05:23.871530 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:05:23.924010 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:05:23.925356 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:05:23.926481 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:05:23.928821 [info ] [MainThread]: 
[0m17:05:23.930278 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.14 seconds (5.14s).
[0m17:05:23.938554 [debug] [MainThread]: Command end result
[0m17:05:24.144241 [info ] [MainThread]: 
[0m17:05:24.145219 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:05:24.145931 [info ] [MainThread]: 
[0m17:05:24.146608 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:05:24.148067 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.914871, "process_in_blocks": "0", "process_kernel_time": 0.668164, "process_mem_max_rss": "114636", "process_out_blocks": "9744", "process_user_time": 6.327553}
[0m17:05:24.148854 [debug] [MainThread]: Command `dbt build` succeeded at 17:05:24.148634 after 7.92 seconds
[0m17:05:24.149744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735c9057d310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735c8c973b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735c8c8f4760>]}
[0m17:05:24.150717 [debug] [MainThread]: Flushing usage events
[0m17:06:17.263555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdd12a8b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdd0f6e7af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdd0f6e79a0>]}


============================== 17:06:17.272663 | baeb008a-1cdb-4ca2-81d3-54f027892582 ==============================
[0m17:06:17.272663 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:06:17.273771 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'debug': 'False', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'quiet': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'static_parser': 'True', 'empty': 'False', 'printer_width': '80', 'use_colors': 'True', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'log_format': 'default', 'warn_error': 'None', 'target_path': 'None', 'partial_parse': 'True', 'version_check': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'introspect': 'True'}
[0m17:06:17.854968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'baeb008a-1cdb-4ca2-81d3-54f027892582', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdd0f61f160>]}
[0m17:06:18.046931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'baeb008a-1cdb-4ca2-81d3-54f027892582', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdd0f630f70>]}
[0m17:06:18.048241 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:06:18.463884 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:06:18.969187 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:06:18.969836 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:06:19.170960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'baeb008a-1cdb-4ca2-81d3-54f027892582', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdd0ee50ee0>]}
[0m17:06:19.654244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'baeb008a-1cdb-4ca2-81d3-54f027892582', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdd0ee3a130>]}
[0m17:06:19.655109 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:06:19.658427 [info ] [MainThread]: 
[0m17:06:19.659412 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:06:19.671501 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:06:19.678106 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:06:19.783412 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:06:19.789159 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:06:20.557166 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:06:20.563780 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:06:20.584660 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:06:20.596450 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:06:20.678353 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:06:20.679836 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:06:20.750441 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:06:20.753436 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:06:20.764273 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:06:20.773909 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:06:20.787949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'baeb008a-1cdb-4ca2-81d3-54f027892582', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdd0e7ac7c0>]}
[0m17:06:20.789770 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:06:20.791226 [info ] [MainThread]: 
[0m17:06:20.864523 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:06:20.865760 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:06:20.866837 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:06:20.867581 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:06:20.884689 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:06:20.885844 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:06:21.063437 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:06:21.122082 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:06:21.123565 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:06:21.134541 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:06:21.270131 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:06:21.273220 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:06:21.275271 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:06:21.278116 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:06:21.284104 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:06:21.287094 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:06:21.289335 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:06:21.292359 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:06:21.390228 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:06:21.393652 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:06:21.450972 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'baeb008a-1cdb-4ca2-81d3-54f027892582', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdd0ea21dc0>]}
[0m17:06:21.452400 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.58s]
[0m17:06:21.453783 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:06:21.455446 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:06:21.456226 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:06:21.457098 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:06:21.457959 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:06:21.458847 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:06:21.459939 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:06:21.460847 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:06:21.461884 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:06:21.462680 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:06:21.463707 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:06:21.464500 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:06:21.486003 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:06:21.488531 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:06:21.546668 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:06:21.555179 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:06:21.556747 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:06:21.557497 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:06:21.584217 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:06:21.679523 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:06:21.677232 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:06:21.689601 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:06:21.691001 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:06:21.693019 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:06:21.694321 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:06:21.854345 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:06:21.863132 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:06:21.869411 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.41s]
[0m17:06:21.875317 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:06:21.880974 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:06:21.883549 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:06:21.889954 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:06:21.891351 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:06:21.894293 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.43s]
[0m17:06:21.897164 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.44s]
[0m17:06:21.898606 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:06:21.900195 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:06:21.902328 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:06:21.903169 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:06:21.904314 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:06:21.945282 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:06:21.946422 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:06:21.947508 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:06:21.948461 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:06:21.949124 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:06:21.949877 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:06:21.950692 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:06:21.951385 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:06:21.952149 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:06:21.978327 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:06:21.982528 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:06:21.989728 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:06:21.991317 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:06:21.992019 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:06:21.992739 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:06:22.091453 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:06:22.255182 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:06:22.365472 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:06:22.387520 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_baeb008a_1cdb_4ca2_81d3_54f027892582` 
  ...
[0m17:06:22.452263 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_baeb008a_1cdb_4ca2_81d3_54f027892582` 
  ...
[0m17:06:22.454719 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:06:22.459178 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:06:22.460689 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:06:22.472357 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:06:22.550964 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:06:22.655890 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_baeb008a_1cdb_4ca2_81d3_54f027892582`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:06:22.657727 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_baeb008a_1cdb_4ca2_81d3_54f027892582`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:06:22.659573 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:06:22.673582 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:06:22.678160 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:06:22.681331 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:06:22.684897 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:06:22.692787 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:06:22.745180 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:06:22.694281 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:06:22.764136 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:06:22.763197 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_baeb008a_1cdb_4ca2_81d3_54f027892582'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:06:22.769292 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_baeb008a_1cdb_4ca2_81d3_54f027892582'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:06:22.772616 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'baeb008a-1cdb-4ca2-81d3-54f027892582', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdd0ebdc6d0>]}
[0m17:06:22.776146 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.82s]
[0m17:06:22.777681 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:06:22.779529 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:06:22.786116 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:06:22.787255 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:06:22.790072 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:06:22.791665 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_baeb008a_1cdb_4ca2_81d3_54f027892582`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:06:22.792716 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_baeb008a_1cdb_4ca2_81d3_54f027892582`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:06:22.844608 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:06:22.847895 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_baeb008a_1cdb_4ca2_81d3_54f027892582`)
      
    ...
[0m17:06:22.866660 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:06:22.868054 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:06:22.874376 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:06:22.876644 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_baeb008a_1cdb_4ca2_81d3_54f027892582`)
      
    ...
[0m17:06:22.883049 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:06:22.886236 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_baeb008a_1cdb_4ca2_81d3_54f027892582` 
    ...
[0m17:06:22.893516 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:06:22.900610 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_baeb008a_1cdb_4ca2_81d3_54f027892582` 
  ...
[0m17:06:22.902102 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:06:22.908290 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:06:22.911385 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:06:22.947970 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:06:22.949422 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:06:22.953337 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_baeb008a_1cdb_4ca2_81d3_54f027892582` 
    ...
[0m17:06:22.954876 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:06:22.959564 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'baeb008a-1cdb-4ca2-81d3-54f027892582', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdd0e18e250>]}
[0m17:06:22.960995 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.01s]
[0m17:06:22.962439 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:06:22.964093 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:06:22.971071 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_baeb008a_1cdb_4ca2_81d3_54f027892582` 
  ...
[0m17:06:22.974925 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:06:22.981454 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:06:22.984338 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:06:22.987927 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'baeb008a-1cdb-4ca2-81d3-54f027892582', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdd0e7da850>]}
[0m17:06:22.989214 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.04s]
[0m17:06:22.990702 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:06:22.992817 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:06:22.993405 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:06:22.993976 [debug] [MainThread]: On list__clean: Close
[0m17:06:22.994553 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:06:22.995061 [debug] [MainThread]: On list__mart: Close
[0m17:06:23.044288 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:06:23.045508 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:06:23.046128 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:06:23.046686 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:06:23.047163 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:06:23.047677 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:06:23.048160 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:06:23.048686 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:06:23.049920 [info ] [MainThread]: 
[0m17:06:23.050739 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.39 seconds (3.39s).
[0m17:06:23.057777 [debug] [MainThread]: Command end result
[0m17:06:23.176083 [info ] [MainThread]: 
[0m17:06:23.177261 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:06:23.177998 [info ] [MainThread]: 
[0m17:06:23.178695 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:06:23.180202 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.11116, "process_in_blocks": "0", "process_kernel_time": 0.700595, "process_mem_max_rss": "114620", "process_out_blocks": "9744", "process_user_time": 5.807332}
[0m17:06:23.181166 [debug] [MainThread]: Command `dbt build` succeeded at 17:06:23.180951 after 6.11 seconds
[0m17:06:23.181926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdd12a8b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdd11d50cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdd0d7d2700>]}
[0m17:06:23.182574 [debug] [MainThread]: Flushing usage events
[0m17:07:16.138047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753a48f92e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753a45be7bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753a45be7a60>]}


============================== 17:07:16.198261 | 413bb4f8-9d30-48d5-aa28-32150c401cbe ==============================
[0m17:07:16.198261 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:07:16.199337 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'static_parser': 'True', 'printer_width': '80', 'warn_error': 'None', 'empty': 'False', 'log_format': 'default', 'log_path': '/workdir/transforms/04_btc/logs', 'debug': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'version_check': 'True', 'profiles_dir': '.', 'invocation_command': 'dbt build --profiles-dir . --target local', 'target_path': 'None', 'no_print': 'None', 'log_cache_events': 'False', 'use_colors': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'introspect': 'True', 'use_experimental_parser': 'False'}
[0m17:07:16.727811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '413bb4f8-9d30-48d5-aa28-32150c401cbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753a4841e910>]}
[0m17:07:16.922134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '413bb4f8-9d30-48d5-aa28-32150c401cbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753a45b023d0>]}
[0m17:07:16.923440 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:07:17.339234 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:07:17.844308 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:07:17.844936 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:07:18.044384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '413bb4f8-9d30-48d5-aa28-32150c401cbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753a4534fe50>]}
[0m17:07:19.282102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '413bb4f8-9d30-48d5-aa28-32150c401cbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753a45364610>]}
[0m17:07:19.283001 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:07:19.286292 [info ] [MainThread]: 
[0m17:07:19.287359 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:07:19.299812 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:07:19.301009 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:07:19.325185 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:07:19.328846 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:07:20.568713 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:07:20.576659 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:07:20.579095 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:07:20.589730 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:07:20.631059 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:07:20.633026 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:07:20.648031 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:07:20.706787 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:07:20.716581 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:07:20.718703 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:07:20.739470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '413bb4f8-9d30-48d5-aa28-32150c401cbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753a45b4c6a0>]}
[0m17:07:20.741330 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:07:20.742621 [info ] [MainThread]: 
[0m17:07:20.817620 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:07:20.818819 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:07:20.819886 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:07:20.820632 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:07:20.837142 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:07:20.838184 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:07:21.018277 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:07:21.082330 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:07:21.083694 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:07:21.094937 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:07:21.107823 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:07:21.110923 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:07:21.112780 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:07:21.115648 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:07:21.233462 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:07:21.236880 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:07:21.238761 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:07:21.241719 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:07:21.337090 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:07:21.340484 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:07:21.346477 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '413bb4f8-9d30-48d5-aa28-32150c401cbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753a44f05cd0>]}
[0m17:07:21.347783 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m17:07:21.349134 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:07:21.400491 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:07:21.402061 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:07:21.403395 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:07:21.405051 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:07:21.406694 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:07:21.408132 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:07:21.408999 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:07:21.410375 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:07:21.412892 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:07:21.430891 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:07:21.436321 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:07:21.438052 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:07:21.440382 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:07:21.506557 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:07:21.508130 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:07:21.522891 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:07:21.545823 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:07:21.624917 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:07:21.722364 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:07:21.740130 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:07:21.812250 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:07:21.814839 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:07:21.817025 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:07:21.818642 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:07:22.072810 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:07:22.109285 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:07:22.115954 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:07:22.117712 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:07:22.119292 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.71s]
[0m17:07:22.123484 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:07:22.126140 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:07:22.129388 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.70s]
[0m17:07:22.131299 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:07:22.132760 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:07:22.135862 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.72s]
[0m17:07:22.137429 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:07:22.139506 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:07:22.140287 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:07:22.141095 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:07:22.142092 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:07:22.143448 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:07:22.144944 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:07:22.145943 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:07:22.146905 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:07:22.199012 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:07:22.201028 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:07:22.202827 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:07:22.204464 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:07:22.328473 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:07:22.333091 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:07:22.344022 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:07:22.398580 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:07:22.400507 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:07:22.412580 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:07:22.415481 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:07:22.535812 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:07:22.704098 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.16 seconds
[0m17:07:22.799310 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:07:22.909455 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m17:07:22.939438 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:07:23.011805 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:07:23.098983 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:07:23.200247 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:07:23.206734 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_413bb4f8_9d30_48d5_aa28_32150c401cbe` 
  ...
[0m17:07:23.212729 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_413bb4f8_9d30_48d5_aa28_32150c401cbe` 
  ...
[0m17:07:23.218802 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:07:23.228977 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:07:23.237499 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:07:23.245253 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:07:23.405081 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:07:23.505116 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:07:23.534620 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '413bb4f8-9d30-48d5-aa28-32150c401cbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753a45c96fd0>]}
[0m17:07:23.606087 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.34s]
[0m17:07:23.639946 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:07:23.711030 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_413bb4f8_9d30_48d5_aa28_32150c401cbe`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:07:23.714373 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_413bb4f8_9d30_48d5_aa28_32150c401cbe`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:07:24.618387 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.90 seconds
[0m17:07:24.633422 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.92 seconds
[0m17:07:24.711409 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_413bb4f8_9d30_48d5_aa28_32150c401cbe'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:07:24.709277 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_413bb4f8_9d30_48d5_aa28_32150c401cbe'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:07:24.721813 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:07:24.725107 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:07:24.738304 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:07:24.743965 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:07:24.746888 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_413bb4f8_9d30_48d5_aa28_32150c401cbe`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:07:24.800754 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_413bb4f8_9d30_48d5_aa28_32150c401cbe`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:07:24.828793 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:07:24.833089 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_413bb4f8_9d30_48d5_aa28_32150c401cbe`)
      
    ...
[0m17:07:24.835623 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:07:24.841605 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_413bb4f8_9d30_48d5_aa28_32150c401cbe`)
      
    ...
[0m17:07:24.861464 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:07:24.871309 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:07:24.872764 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:07:24.878856 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:07:24.881324 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:07:24.906463 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_413bb4f8_9d30_48d5_aa28_32150c401cbe` 
    ...
[0m17:07:24.909204 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:07:24.917056 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_413bb4f8_9d30_48d5_aa28_32150c401cbe` 
    ...
[0m17:07:24.921327 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:07:24.933782 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_413bb4f8_9d30_48d5_aa28_32150c401cbe` 
  ...
[0m17:07:24.936718 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:07:25.005353 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:07:25.007070 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_413bb4f8_9d30_48d5_aa28_32150c401cbe` 
  ...
[0m17:07:25.019368 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:07:25.025872 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:07:25.038712 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:07:25.041139 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:07:25.099380 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '413bb4f8-9d30-48d5-aa28-32150c401cbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753a44f05790>]}
[0m17:07:25.104373 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.95s]
[0m17:07:25.107201 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:07:25.109925 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:07:25.116811 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '413bb4f8-9d30-48d5-aa28-32150c401cbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753a44727f10>]}
[0m17:07:25.119737 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.97s]
[0m17:07:25.122601 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:07:25.126684 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:07:25.127836 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:07:25.129010 [debug] [MainThread]: On list__mart: Close
[0m17:07:25.130092 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:07:25.131269 [debug] [MainThread]: On list__clean: Close
[0m17:07:25.132420 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:07:25.133592 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:07:25.134701 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:07:25.135819 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:07:25.136926 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:07:25.138030 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:07:25.139124 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:07:25.140259 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:07:25.142578 [info ] [MainThread]: 
[0m17:07:25.144072 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.86 seconds (5.86s).
[0m17:07:25.201968 [debug] [MainThread]: Command end result
[0m17:07:25.339372 [info ] [MainThread]: 
[0m17:07:25.340204 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:07:25.340773 [info ] [MainThread]: 
[0m17:07:25.341340 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:07:25.342622 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 9.397018, "process_in_blocks": "0", "process_kernel_time": 0.642986, "process_mem_max_rss": "114672", "process_out_blocks": "9744", "process_user_time": 6.299878}
[0m17:07:25.343327 [debug] [MainThread]: Command `dbt build` succeeded at 17:07:25.343141 after 9.40 seconds
[0m17:07:25.343947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753a48f92e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753a46ea79a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753a46e06bb0>]}
[0m17:07:25.344515 [debug] [MainThread]: Flushing usage events
[0m17:08:16.588151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c2be5a1310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c2bb1fbb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c2bb1fb9d0>]}


============================== 17:08:16.648503 | f29d5d12-429b-45b5-841a-ba4395d37bea ==============================
[0m17:08:16.648503 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:08:16.649709 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'indirect_selection': 'eager', 'log_format': 'default', 'static_parser': 'True', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'introspect': 'True', 'printer_width': '80', 'log_path': '/workdir/transforms/04_btc/logs', 'write_json': 'True', 'cache_selected_only': 'False', 'empty': 'False', 'target_path': 'None', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'no_print': 'None', 'debug': 'False'}
[0m17:08:17.179153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f29d5d12-429b-45b5-841a-ba4395d37bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c2bdb32ca0>]}
[0m17:08:17.373556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f29d5d12-429b-45b5-841a-ba4395d37bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c2bb30a4f0>]}
[0m17:08:17.374820 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:08:17.785854 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:08:18.357681 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:08:18.358313 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:08:18.559882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f29d5d12-429b-45b5-841a-ba4395d37bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c2ba967eb0>]}
[0m17:08:19.007650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f29d5d12-429b-45b5-841a-ba4395d37bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c2ba9a5760>]}
[0m17:08:19.008653 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:08:19.011971 [info ] [MainThread]: 
[0m17:08:19.013010 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:08:19.058198 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:08:19.059263 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:08:19.158879 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:08:19.157934 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:08:19.960110 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:08:19.964189 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:08:19.968592 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:08:19.970937 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:08:20.073921 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:08:20.075475 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:08:20.094035 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:08:20.151067 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:08:20.165965 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:08:20.178763 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:08:20.192711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f29d5d12-429b-45b5-841a-ba4395d37bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c2bb146af0>]}
[0m17:08:20.194563 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:08:20.195862 [info ] [MainThread]: 
[0m17:08:20.266588 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:08:20.267735 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:08:20.268599 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_03_meteo.stg_btc__market_price)
[0m17:08:20.269313 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:08:20.286490 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:08:20.288080 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:08:20.475133 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:08:20.477012 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:08:20.492149 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:08:20.505100 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:08:20.508252 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:08:20.510089 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:08:20.550092 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:08:20.668676 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:08:20.671953 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:08:20.674035 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:08:20.677500 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:08:20.772516 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:08:20.775994 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:08:20.782099 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f29d5d12-429b-45b5-841a-ba4395d37bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c2b9ccb5e0>]}
[0m17:08:20.783238 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.51s]
[0m17:08:20.784570 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:08:20.786696 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:08:20.787752 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:08:20.788958 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:08:20.790746 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:08:20.792267 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:08:20.794655 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:08:20.796496 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:08:20.848454 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:08:20.850306 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:08:20.852419 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:08:20.854264 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:08:20.871598 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:08:20.964174 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:08:20.968943 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:08:20.984087 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:08:20.986674 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:08:20.988258 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:08:21.078873 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:08:21.366267 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:08:21.369111 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:08:21.372709 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:08:21.375602 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:08:21.377604 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:08:21.379336 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:08:21.631747 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:08:21.662917 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:08:21.671013 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:08:21.681322 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.83s]
[0m17:08:21.686235 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:08:21.689602 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:08:21.749019 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:08:21.756037 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:08:21.754824 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.91s]
[0m17:08:21.762310 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.97s]
[0m17:08:21.765410 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:08:21.768283 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:08:21.771790 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:08:21.773079 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:08:21.774607 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:08:21.775850 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:08:21.778025 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:08:21.779877 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:08:21.781886 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:08:21.783774 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:08:21.785436 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:08:21.787012 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:08:21.788696 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:08:21.858168 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:08:21.959242 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:08:21.972414 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:08:21.977031 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:08:21.979798 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:08:21.982270 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:08:22.053181 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:08:22.158195 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:08:22.279043 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:08:22.386119 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:08:22.458742 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:08:22.486832 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:08:22.560134 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f29d5d12_429b_45b5_841a_ba4395d37bea` 
  ...
[0m17:08:22.567277 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f29d5d12_429b_45b5_841a_ba4395d37bea` 
  ...
[0m17:08:22.569316 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:08:22.573764 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:08:22.580870 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:08:22.587296 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:08:22.684366 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:08:22.758350 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:08:22.777261 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_f29d5d12_429b_45b5_841a_ba4395d37bea`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:08:22.780356 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_f29d5d12_429b_45b5_841a_ba4395d37bea`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:08:22.784225 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:08:22.791004 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:08:22.850993 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:08:22.852699 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:08:22.865524 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:08:22.866758 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:08:22.874476 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f29d5d12-429b-45b5-841a-ba4395d37bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c2ba700790>]}
[0m17:08:22.882714 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_f29d5d12_429b_45b5_841a_ba4395d37bea'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:08:22.887828 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_f29d5d12_429b_45b5_841a_ba4395d37bea'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:08:22.889266 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.09s]
[0m17:08:22.893062 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:08:22.894757 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:08:22.896140 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:08:22.957332 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:08:22.960570 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:08:22.962344 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_f29d5d12_429b_45b5_841a_ba4395d37bea`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:08:22.963774 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_f29d5d12_429b_45b5_841a_ba4395d37bea`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:08:22.983410 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:08:22.984774 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:08:22.986770 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f29d5d12_429b_45b5_841a_ba4395d37bea`)
      
    ...
[0m17:08:22.988667 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f29d5d12_429b_45b5_841a_ba4395d37bea`)
      
    ...
[0m17:08:23.005968 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:08:23.011359 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:08:23.012746 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:08:23.019969 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:08:23.022422 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:08:23.048290 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:08:23.049892 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f29d5d12_429b_45b5_841a_ba4395d37bea` 
    ...
[0m17:08:23.052597 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f29d5d12_429b_45b5_841a_ba4395d37bea` 
    ...
[0m17:08:23.058775 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:08:23.064957 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:08:23.065718 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f29d5d12_429b_45b5_841a_ba4395d37bea` 
  ...
[0m17:08:23.071586 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f29d5d12_429b_45b5_841a_ba4395d37bea` 
  ...
[0m17:08:23.074876 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:08:23.076069 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:08:23.082112 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:08:23.087929 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:08:23.091055 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:08:23.094174 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f29d5d12-429b-45b5-841a-ba4395d37bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c2ba4a4760>]}
[0m17:08:23.095296 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.31s]
[0m17:08:23.096885 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:08:23.098186 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:08:23.150564 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f29d5d12-429b-45b5-841a-ba4395d37bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c2b9d73280>]}
[0m17:08:23.151720 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.37s]
[0m17:08:23.153007 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:08:23.154996 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:08:23.155567 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:08:23.156122 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:08:23.156638 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:08:23.157131 [debug] [MainThread]: On list__clean: Close
[0m17:08:23.157648 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m17:08:23.158131 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m17:08:23.158646 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:08:23.159131 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:08:23.159639 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:08:23.160122 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:08:23.161161 [info ] [MainThread]: 
[0m17:08:23.161857 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.15 seconds (4.15s).
[0m17:08:23.165832 [debug] [MainThread]: Command end result
[0m17:08:23.276031 [info ] [MainThread]: 
[0m17:08:23.276901 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:08:23.277749 [info ] [MainThread]: 
[0m17:08:23.278474 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:08:23.280038 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.8852267, "process_in_blocks": "0", "process_kernel_time": 0.769389, "process_mem_max_rss": "114552", "process_out_blocks": "9744", "process_user_time": 6.112539}
[0m17:08:23.281076 [debug] [MainThread]: Command `dbt build` succeeded at 17:08:23.280869 after 6.89 seconds
[0m17:08:23.281726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c2be5a1310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c2bdb32ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c2bb64da60>]}
[0m17:08:23.282343 [debug] [MainThread]: Flushing usage events
[0m17:09:18.132540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df554143e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df550da3be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df550da3a90>]}


============================== 17:09:18.142114 | 0910ea2f-dfd4-43c0-baea-952566ee80c7 ==============================
[0m17:09:18.142114 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:09:18.143166 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '.', 'invocation_command': 'dbt build --profiles-dir . --target local', 'write_json': 'True', 'debug': 'False', 'fail_fast': 'False', 'log_format': 'default', 'use_colors': 'True', 'indirect_selection': 'eager', 'no_print': 'None', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'partial_parse': 'True', 'empty': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'static_parser': 'True', 'target_path': 'None', 'log_cache_events': 'False'}
[0m17:09:18.674997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0910ea2f-dfd4-43c0-baea-952566ee80c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df5535cb910>]}
[0m17:09:18.869515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0910ea2f-dfd4-43c0-baea-952566ee80c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df550c1b130>]}
[0m17:09:18.870828 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:09:19.346881 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:09:19.848653 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:09:19.849287 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:09:20.048215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0910ea2f-dfd4-43c0-baea-952566ee80c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df550508e50>]}
[0m17:09:20.491016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0910ea2f-dfd4-43c0-baea-952566ee80c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df55051da30>]}
[0m17:09:20.492001 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:09:20.533985 [info ] [MainThread]: 
[0m17:09:20.535085 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:09:20.547830 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:09:20.549884 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:09:20.659666 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:09:20.669298 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:09:21.404978 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:09:21.409168 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:09:21.413366 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:09:21.431189 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:09:21.531283 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:09:21.538358 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:09:21.562752 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:09:21.565624 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:09:21.578064 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:09:21.580683 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:09:21.649686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0910ea2f-dfd4-43c0-baea-952566ee80c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df5504664c0>]}
[0m17:09:21.651589 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:09:21.652943 [info ] [MainThread]: 
[0m17:09:21.680519 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:09:21.731122 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:09:21.732745 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:09:21.733810 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:09:21.758435 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:09:21.760387 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:09:21.959443 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:09:22.033243 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:09:22.034885 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:09:22.049024 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:09:22.172625 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:09:22.176092 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:09:22.178059 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:09:22.181016 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:09:22.235805 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:09:22.238988 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:09:22.240804 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:09:22.243643 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:09:22.337699 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:09:22.341271 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:09:22.347282 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0910ea2f-dfd4-43c0-baea-952566ee80c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df5500c9bb0>]}
[0m17:09:22.348855 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m17:09:22.350169 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:09:22.352349 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:09:22.353509 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:09:22.355120 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:09:22.356897 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:09:22.358718 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:09:22.360467 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:09:22.362683 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:09:22.364519 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:09:22.365914 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:09:22.367214 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:09:22.368732 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:09:22.369745 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:09:22.561235 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:09:22.575074 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:09:22.576677 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:09:22.579253 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:09:22.631149 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:09:22.637785 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:09:22.932212 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:09:22.876369 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:09:22.950449 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:09:22.952716 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:09:22.954410 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:09:22.956514 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:09:24.126794 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:09:24.132445 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:09:24.136567 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:09:24.141359 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:09:24.148064 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.78s]
[0m17:09:24.149708 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:09:24.152169 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:09:24.154018 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:09:24.159643 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 1.79s]
[0m17:09:24.165347 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.80s]
[0m17:09:24.168757 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:09:24.171505 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:09:24.174672 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:09:24.175723 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:09:24.177249 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:09:24.178418 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:09:24.180516 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:09:24.231428 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:09:24.233773 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:09:24.235627 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:09:24.237315 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:09:24.239099 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:09:24.241086 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:09:24.263970 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:09:24.347899 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:09:24.358225 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:09:24.376272 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:09:24.378485 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:09:24.380469 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:09:24.432594 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:09:24.636282 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:09:24.772721 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:09:24.958242 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m17:09:25.072810 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:09:25.165037 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:09:25.244246 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:09:25.270178 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_0910ea2f_dfd4_43c0_baea_952566ee80c7` 
  ...
[0m17:09:25.343340 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:09:25.358182 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_0910ea2f_dfd4_43c0_baea_952566ee80c7` 
  ...
[0m17:09:25.371250 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:09:25.373966 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:09:25.432337 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:09:25.466947 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:09:25.547358 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:09:25.636513 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:09:25.650335 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_0910ea2f_dfd4_43c0_baea_952566ee80c7`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:09:25.651381 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_0910ea2f_dfd4_43c0_baea_952566ee80c7`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:09:25.653230 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:09:25.658600 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:09:25.662991 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0910ea2f-dfd4-43c0-baea-952566ee80c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df54f13ee80>]}
[0m17:09:25.664807 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.42s]
[0m17:09:25.666937 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:09:25.673851 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:09:25.675115 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:09:25.739507 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_0910ea2f_dfd4_43c0_baea_952566ee80c7'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:09:25.746011 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_0910ea2f_dfd4_43c0_baea_952566ee80c7'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:09:25.752179 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:09:25.753705 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:09:25.769311 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:09:25.772502 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:09:25.773966 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_0910ea2f_dfd4_43c0_baea_952566ee80c7`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:09:25.774990 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_0910ea2f_dfd4_43c0_baea_952566ee80c7`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:09:25.791591 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:09:25.832726 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_0910ea2f_dfd4_43c0_baea_952566ee80c7`)
      
    ...
[0m17:09:25.793252 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:09:25.836380 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_0910ea2f_dfd4_43c0_baea_952566ee80c7`)
      
    ...
[0m17:09:25.852523 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:09:25.862906 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:09:25.876096 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:09:25.879387 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_0910ea2f_dfd4_43c0_baea_952566ee80c7` 
    ...
[0m17:09:25.880743 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:09:25.887172 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:09:25.889528 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:09:25.895632 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_0910ea2f_dfd4_43c0_baea_952566ee80c7` 
  ...
[0m17:09:25.898359 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:09:25.899670 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:09:25.931547 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_0910ea2f_dfd4_43c0_baea_952566ee80c7` 
    ...
[0m17:09:25.937736 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:09:25.941398 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:09:25.944703 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0910ea2f-dfd4-43c0-baea-952566ee80c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df54f10f5e0>]}
[0m17:09:25.945895 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.71s]
[0m17:09:25.947208 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:09:25.948907 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:09:25.959036 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_0910ea2f_dfd4_43c0_baea_952566ee80c7` 
  ...
[0m17:09:25.963330 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:09:25.973173 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:09:25.976167 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:09:25.979297 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0910ea2f-dfd4-43c0-baea-952566ee80c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df550cd8520>]}
[0m17:09:25.980425 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.75s]
[0m17:09:26.032018 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:09:26.034072 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:09:26.034649 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:09:26.035217 [debug] [MainThread]: On list__mart: Close
[0m17:09:26.035925 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:09:26.036628 [debug] [MainThread]: On list__clean: Close
[0m17:09:26.037308 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:09:26.038020 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:09:26.038706 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m17:09:26.039407 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m17:09:26.040105 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:09:26.040823 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:09:26.041503 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:09:26.042092 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:09:26.043328 [info ] [MainThread]: 
[0m17:09:26.044031 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.51 seconds (5.51s).
[0m17:09:26.047796 [debug] [MainThread]: Command end result
[0m17:09:26.154205 [info ] [MainThread]: 
[0m17:09:26.155128 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:09:26.155705 [info ] [MainThread]: 
[0m17:09:26.156310 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:09:26.157604 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 8.2193575, "process_in_blocks": "0", "process_kernel_time": 0.740295, "process_mem_max_rss": "115132", "process_out_blocks": "9744", "process_user_time": 6.443424}
[0m17:09:26.158335 [debug] [MainThread]: Command `dbt build` succeeded at 17:09:26.158145 after 8.22 seconds
[0m17:09:26.158954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df554143e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df5503b7b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df5520d3d60>]}
[0m17:09:26.159529 [debug] [MainThread]: Flushing usage events
[0m17:10:15.574391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6f90812310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6f8d47dbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6f8d47da60>]}


============================== 17:10:15.583789 | b081da54-be4c-4169-b983-ad70a011ab1f ==============================
[0m17:10:15.583789 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:10:15.584827 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '.', 'partial_parse': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'debug': 'False', 'version_check': 'True', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'write_json': 'True', 'indirect_selection': 'eager', 'fail_fast': 'False', 'introspect': 'True', 'log_format': 'default', 'log_cache_events': 'False', 'warn_error': 'None', 'quiet': 'False', 'printer_width': '80', 'use_experimental_parser': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'empty': 'False'}
[0m17:10:16.180374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b081da54-be4c-4169-b983-ad70a011ab1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6f8d5361f0>]}
[0m17:10:16.377828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b081da54-be4c-4169-b983-ad70a011ab1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6f8d53e8b0>]}
[0m17:10:16.379115 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:10:16.788184 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:10:17.291288 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:10:17.291929 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:10:17.494093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b081da54-be4c-4169-b983-ad70a011ab1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6f8cbe7eb0>]}
[0m17:10:17.986768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b081da54-be4c-4169-b983-ad70a011ab1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6f8cadc4c0>]}
[0m17:10:17.987626 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:10:17.990845 [info ] [MainThread]: 
[0m17:10:17.991865 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:10:18.003797 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:10:18.049476 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:10:18.083049 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:10:18.095592 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:10:18.806989 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:10:18.816128 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:10:18.818402 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:10:18.828392 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:10:18.890498 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:10:18.892292 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:10:18.973381 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:10:18.974362 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:10:18.982825 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:10:18.992273 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:10:19.053507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b081da54-be4c-4169-b983-ad70a011ab1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6f8caa7d30>]}
[0m17:10:19.055591 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:10:19.056969 [info ] [MainThread]: 
[0m17:10:19.083683 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:10:19.084989 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:10:19.086038 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:10:19.086785 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:10:19.153035 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:10:19.154257 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:10:19.281116 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:10:19.372022 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:10:19.373371 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:10:19.385085 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:10:19.487206 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:10:19.490857 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:10:19.492971 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:10:19.495940 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:10:19.550351 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:10:19.553584 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:10:19.555529 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:10:19.558639 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:10:19.656418 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:10:19.659977 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:10:19.666432 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b081da54-be4c-4169-b983-ad70a011ab1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6f8fd23a60>]}
[0m17:10:19.667879 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.58s]
[0m17:10:19.669183 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:10:19.671442 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:10:19.673081 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:10:19.674596 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:10:19.676147 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:10:19.677368 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:10:19.679127 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:10:19.680361 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:10:19.682553 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:10:19.684187 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:10:19.686149 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:10:19.687830 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:10:19.759878 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:10:19.788088 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:10:19.858260 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:10:19.867665 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:10:19.870239 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:10:19.877486 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:10:19.894811 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:10:20.260409 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:10:20.258709 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:10:20.266030 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:10:20.270305 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:10:20.271994 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:10:20.275518 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:10:20.596880 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:10:20.607661 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:10:20.615234 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:10:20.655670 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:10:20.623522 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:10:20.658000 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.98s]
[0m17:10:20.664261 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.98s]
[0m17:10:20.669412 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:10:20.672640 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:10:20.679113 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:10:20.684887 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 1.00s]
[0m17:10:20.687743 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:10:20.690736 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:10:20.691898 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:10:20.693445 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:10:20.695293 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:10:20.698201 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:10:20.700342 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:10:20.702461 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:10:20.750843 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:10:20.752792 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:10:20.755240 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:10:20.757063 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:10:20.769249 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:10:20.865449 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:10:20.880613 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:10:20.883227 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:10:20.885379 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:10:20.892413 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:10:20.954595 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:10:20.970980 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:10:21.091556 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:10:21.250510 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:10:21.288448 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:10:21.367862 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:10:21.389394 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:10:21.460813 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:10:21.549992 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:10:21.654619 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b081da54_be4c_4169_b983_ad70a011ab1f` 
  ...
[0m17:10:21.662659 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b081da54_be4c_4169_b983_ad70a011ab1f` 
  ...
[0m17:10:21.664827 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:10:21.667035 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:10:21.669019 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:10:21.670386 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:10:21.771237 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:10:21.798476 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_b081da54_be4c_4169_b983_ad70a011ab1f`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:10:21.850145 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_b081da54_be4c_4169_b983_ad70a011ab1f`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:10:21.856068 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:10:21.862365 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:10:21.865420 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b081da54-be4c-4169-b983-ad70a011ab1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6f8d3802e0>]}
[0m17:10:21.866574 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.11s]
[0m17:10:21.867972 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:10:21.881484 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:10:21.898925 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:10:21.900101 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_b081da54_be4c_4169_b983_ad70a011ab1f'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:10:21.908727 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_b081da54_be4c_4169_b983_ad70a011ab1f'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:10:21.953371 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:10:21.955154 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:10:21.961917 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:10:21.966154 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:10:21.967941 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_b081da54_be4c_4169_b983_ad70a011ab1f`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:10:21.970076 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_b081da54_be4c_4169_b983_ad70a011ab1f`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:10:21.984435 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:10:21.986043 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:10:21.988654 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b081da54_be4c_4169_b983_ad70a011ab1f`)
      
    ...
[0m17:10:21.991752 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b081da54_be4c_4169_b983_ad70a011ab1f`)
      
    ...
[0m17:10:22.011922 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:10:22.020657 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:10:22.049681 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:10:22.057865 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:10:22.059709 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:10:22.065680 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b081da54_be4c_4169_b983_ad70a011ab1f` 
    ...
[0m17:10:22.067467 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:10:22.071701 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b081da54_be4c_4169_b983_ad70a011ab1f` 
    ...
[0m17:10:22.073626 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:10:22.086293 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:10:22.084952 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b081da54_be4c_4169_b983_ad70a011ab1f` 
  ...
[0m17:10:22.092697 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b081da54_be4c_4169_b983_ad70a011ab1f` 
  ...
[0m17:10:22.096976 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:10:22.151171 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:10:22.154078 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:10:22.164104 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:10:22.165881 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:10:22.171691 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b081da54-be4c-4169-b983-ad70a011ab1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6f8bf75bb0>]}
[0m17:10:22.173257 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:10:22.174779 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.42s]
[0m17:10:22.178255 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b081da54-be4c-4169-b983-ad70a011ab1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6f8beff9d0>]}
[0m17:10:22.180008 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:10:22.181662 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.48s]
[0m17:10:22.183324 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:10:22.185253 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:10:22.185808 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:10:22.186333 [debug] [MainThread]: On list__mart: Close
[0m17:10:22.186833 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:10:22.187310 [debug] [MainThread]: On list__clean: Close
[0m17:10:22.187788 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:10:22.188265 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:10:22.188756 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:10:22.189216 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:10:22.189697 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:10:22.190158 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:10:22.190648 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m17:10:22.191131 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m17:10:22.192296 [info ] [MainThread]: 
[0m17:10:22.193012 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.20 seconds (4.20s).
[0m17:10:22.196714 [debug] [MainThread]: Command end result
[0m17:10:22.355506 [info ] [MainThread]: 
[0m17:10:22.356409 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:10:22.357045 [info ] [MainThread]: 
[0m17:10:22.357689 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:10:22.359029 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.977273, "process_in_blocks": "0", "process_kernel_time": 0.68096, "process_mem_max_rss": "114696", "process_out_blocks": "9744", "process_user_time": 6.152575}
[0m17:10:22.359767 [debug] [MainThread]: Command `dbt build` succeeded at 17:10:22.359564 after 6.98 seconds
[0m17:10:22.360458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6f90812310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6f8ca95400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e6f8d5361f0>]}
[0m17:10:22.361100 [debug] [MainThread]: Flushing usage events
[0m17:11:16.367390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7beadcad4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bead9745b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bead9745a00>]}


============================== 17:11:16.376684 | f7f86dac-5f94-439b-815d-d4a01b5d8409 ==============================
[0m17:11:16.376684 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:11:16.377770 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '.', 'no_print': 'None', 'write_json': 'True', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'warn_error': 'None', 'indirect_selection': 'eager', 'target_path': 'None', 'use_colors': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'static_parser': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'partial_parse': 'True', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'introspect': 'True', 'debug': 'False', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m17:11:16.961334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f7f86dac-5f94-439b-815d-d4a01b5d8409', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bead9714580>]}
[0m17:11:17.155380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f7f86dac-5f94-439b-815d-d4a01b5d8409', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bead9b9ab20>]}
[0m17:11:17.156608 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:11:17.565915 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:11:18.076780 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:11:18.077454 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:11:18.288427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f7f86dac-5f94-439b-815d-d4a01b5d8409', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bead8e9deb0>]}
[0m17:11:18.769067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f7f86dac-5f94-439b-815d-d4a01b5d8409', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bead8d8bdc0>]}
[0m17:11:18.769905 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:11:18.772976 [info ] [MainThread]: 
[0m17:11:18.773945 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:11:18.788909 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:11:18.790519 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:11:18.880373 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:11:18.898200 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:11:19.619883 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:11:19.625143 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:11:19.627323 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:11:19.652301 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:11:19.689992 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:11:19.691345 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:11:19.757711 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:11:19.766774 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:11:19.774600 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:11:19.775857 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:11:19.786601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f7f86dac-5f94-439b-815d-d4a01b5d8409', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bead96e5fd0>]}
[0m17:11:19.787491 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:11:19.788154 [info ] [MainThread]: 
[0m17:11:19.852071 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:11:19.853213 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:11:19.854060 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_03_meteo.stg_btc__market_price)
[0m17:11:19.854776 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:11:19.870931 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:11:19.872016 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:11:20.051240 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:11:20.053179 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:11:20.066803 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:11:20.080123 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:11:20.083162 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:11:20.086046 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:11:20.089066 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:11:20.199163 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:11:20.252797 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:11:20.254839 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:11:20.257690 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:11:20.352631 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:11:20.356031 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:11:20.361897 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7f86dac-5f94-439b-815d-d4a01b5d8409', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bead824ad00>]}
[0m17:11:20.363014 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.51s]
[0m17:11:20.364693 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:11:20.367178 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:11:20.368938 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:11:20.370504 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:11:20.372713 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:11:20.374917 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:11:20.377289 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:11:20.379141 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:11:20.380775 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:11:20.382096 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:11:20.384062 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:11:20.385489 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:11:20.455566 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:11:20.561064 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:11:20.566392 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:11:20.573348 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:11:20.575789 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:11:20.577889 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:11:20.579414 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:11:20.864153 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:11:20.880083 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:11:20.891826 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:11:20.894919 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:11:20.897446 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:11:20.900273 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:11:21.164278 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:11:21.173757 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:11:21.178374 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:11:21.190067 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:11:21.198234 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:11:21.200769 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:11:21.260182 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.88s]
[0m17:11:21.259274 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.88s]
[0m17:11:21.266314 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.88s]
[0m17:11:21.269200 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:11:21.272076 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:11:21.274897 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:11:21.278814 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:11:21.280039 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:11:21.281564 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:11:21.282791 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:11:21.284922 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:11:21.286852 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:11:21.288890 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:11:21.290739 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:11:21.292375 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:11:21.293976 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:11:21.295610 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:11:21.365771 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:11:21.389477 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:11:21.468696 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:11:21.471260 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:11:21.474029 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:11:21.481026 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:11:21.482956 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:11:21.572059 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:11:21.650674 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:11:21.680896 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:11:21.775758 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:11:21.884164 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:11:21.968323 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:11:22.089428 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:11:22.194189 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:11:22.273582 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:11:22.293824 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:11:22.363627 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f7f86dac_5f94_439b_815d_d4a01b5d8409` 
  ...
[0m17:11:22.396441 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:11:22.458291 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f7f86dac_5f94_439b_815d_d4a01b5d8409` 
  ...
[0m17:11:22.460905 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:11:22.474663 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:11:22.484312 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:11:22.574719 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:11:22.653792 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7f86dac-5f94-439b-815d-d4a01b5d8409', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bead8277610>]}
[0m17:11:22.677352 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.36s]
[0m17:11:22.695927 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:11:22.877080 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_f7f86dac_5f94_439b_815d_d4a01b5d8409`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:11:22.875051 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_f7f86dac_5f94_439b_815d_d4a01b5d8409`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:11:22.912387 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:11:22.954990 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:11:22.988675 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_f7f86dac_5f94_439b_815d_d4a01b5d8409'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:11:22.990741 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_f7f86dac_5f94_439b_815d_d4a01b5d8409'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:11:23.050817 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:11:23.053709 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:11:23.066903 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:11:23.072273 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:11:23.075306 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_f7f86dac_5f94_439b_815d_d4a01b5d8409`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:11:23.077495 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_f7f86dac_5f94_439b_815d_d4a01b5d8409`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:11:23.105008 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:11:23.109374 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f7f86dac_5f94_439b_815d_d4a01b5d8409`)
      
    ...
[0m17:11:23.111979 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:11:23.151208 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f7f86dac_5f94_439b_815d_d4a01b5d8409`)
      
    ...
[0m17:11:23.172823 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:11:23.182376 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:11:23.185404 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:11:23.201660 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:11:23.205146 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:11:23.250425 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f7f86dac_5f94_439b_815d_d4a01b5d8409` 
    ...
[0m17:11:23.253514 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:11:23.261350 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f7f86dac_5f94_439b_815d_d4a01b5d8409` 
    ...
[0m17:11:23.264086 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:11:23.281944 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f7f86dac_5f94_439b_815d_d4a01b5d8409` 
  ...
[0m17:11:23.284596 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:11:23.351089 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:11:23.352391 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f7f86dac_5f94_439b_815d_d4a01b5d8409` 
  ...
[0m17:11:23.364499 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:11:23.371657 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:11:23.379404 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:11:23.386444 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:11:23.393390 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7f86dac-5f94-439b-815d-d4a01b5d8409', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bead883c430>]}
[0m17:11:23.451659 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:11:23.453688 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.11s]
[0m17:11:23.460440 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7f86dac-5f94-439b-815d-d4a01b5d8409', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bead77a4be0>]}
[0m17:11:23.463185 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:11:23.466028 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.17s]
[0m17:11:23.470092 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:11:23.473984 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:11:23.475195 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:11:23.476503 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:11:23.477651 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:11:23.478804 [debug] [MainThread]: On list__clean: Close
[0m17:11:23.480026 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:11:23.481194 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:11:23.482321 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:11:23.483507 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:11:23.484644 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m17:11:23.485816 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m17:11:23.488028 [info ] [MainThread]: 
[0m17:11:23.489447 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.71 seconds (4.71s).
[0m17:11:23.497652 [debug] [MainThread]: Command end result
[0m17:11:23.770316 [info ] [MainThread]: 
[0m17:11:23.772161 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:11:23.773487 [info ] [MainThread]: 
[0m17:11:23.774944 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:11:23.778004 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.604364, "process_in_blocks": "0", "process_kernel_time": 0.702578, "process_mem_max_rss": "114400", "process_out_blocks": "9744", "process_user_time": 6.520004}
[0m17:11:23.779854 [debug] [MainThread]: Command `dbt build` succeeded at 17:11:23.779362 after 7.61 seconds
[0m17:11:23.781393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7beadcad4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7beada9f70a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bead963a550>]}
[0m17:11:23.782911 [debug] [MainThread]: Flushing usage events
[0m17:12:16.765365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e44cc1a7310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e44c8e09b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e44c8e099d0>]}


============================== 17:12:16.776645 | 7c1e163b-7a94-4d45-abd6-36d71263d63f ==============================
[0m17:12:16.776645 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:12:16.777944 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'warn_error': 'None', 'target_path': 'None', 'write_json': 'True', 'quiet': 'False', 'no_print': 'None', 'use_colors': 'True', 'empty': 'False', 'version_check': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'introspect': 'True', 'log_format': 'default', 'printer_width': '80', 'profiles_dir': '.', 'debug': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'fail_fast': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m17:12:17.362234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7c1e163b-7a94-4d45-abd6-36d71263d63f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e44cc5c3af0>]}
[0m17:12:17.558057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7c1e163b-7a94-4d45-abd6-36d71263d63f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e44c8df9250>]}
[0m17:12:17.559327 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:12:17.971912 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:12:18.479888 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:12:18.480550 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:12:18.680272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7c1e163b-7a94-4d45-abd6-36d71263d63f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e44c8576e80>]}
[0m17:12:19.163734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7c1e163b-7a94-4d45-abd6-36d71263d63f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e44c858b670>]}
[0m17:12:19.164612 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:12:19.167867 [info ] [MainThread]: 
[0m17:12:19.168860 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:12:19.180517 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:12:19.192467 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:12:19.260030 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:12:19.267304 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:12:19.817738 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:12:19.853870 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:12:19.860714 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:12:19.870235 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:12:19.963788 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:12:19.965018 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:12:19.979110 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:12:19.985484 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:12:19.994149 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:12:20.046273 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:12:20.063791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7c1e163b-7a94-4d45-abd6-36d71263d63f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e44c84d42b0>]}
[0m17:12:20.065650 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:12:20.066961 [info ] [MainThread]: 
[0m17:12:20.146217 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:12:20.147939 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:12:20.149576 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:12:20.150708 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:12:20.175467 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:12:20.177201 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:12:20.371685 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:12:20.434874 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:12:20.436321 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:12:20.456524 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:12:20.471763 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:12:20.474689 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:12:20.476661 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:12:20.479262 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:12:20.594290 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:12:20.647381 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:12:20.649608 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:12:20.652297 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:12:20.751492 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:12:20.754594 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:12:20.760829 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c1e163b-7a94-4d45-abd6-36d71263d63f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e44c8149e20>]}
[0m17:12:20.762037 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m17:12:20.763452 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:12:20.765042 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:12:20.765869 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:12:20.766819 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:12:20.767964 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:12:20.768882 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:12:20.769967 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:12:20.771339 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:12:20.772377 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:12:20.773547 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:12:20.774623 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:12:20.775410 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:12:20.776323 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:12:20.861213 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:12:20.863034 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:12:20.874885 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:12:20.876664 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:12:20.877357 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:12:20.888609 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:12:20.981913 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:12:20.989500 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:12:20.991106 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:12:20.992445 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:12:21.045690 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:12:21.047154 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:12:21.153646 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:12:21.156143 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:12:21.162865 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:12:21.164155 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:12:21.165420 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:12:21.171324 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.40s]
[0m17:12:21.174197 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.40s]
[0m17:12:21.176835 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:12:21.178375 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:12:21.182770 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:12:21.186080 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.41s]
[0m17:12:21.187705 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:12:21.189282 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:12:21.190010 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:12:21.190793 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:12:21.191883 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:12:21.193007 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:12:21.195653 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:12:21.194883 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:12:21.194008 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:12:21.196374 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:12:21.245457 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:12:21.246365 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:12:21.270501 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:12:21.273373 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:12:21.274253 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:12:21.281049 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:12:21.281815 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:12:21.282801 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:12:21.470593 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:12:21.546374 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:12:21.660946 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:12:21.782755 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:12:21.781109 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_7c1e163b_7a94_4d45_abd6_36d71263d63f` 
  ...
[0m17:12:21.876035 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:12:21.875658 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_7c1e163b_7a94_4d45_abd6_36d71263d63f` 
  ...
[0m17:12:21.883450 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:12:21.887705 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:12:21.951443 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:12:21.984657 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:12:22.163316 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:12:22.187757 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:12:22.288771 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_7c1e163b_7a94_4d45_abd6_36d71263d63f`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:12:22.346257 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_7c1e163b_7a94_4d45_abd6_36d71263d63f`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:12:22.348258 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:12:22.357798 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:12:22.365705 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:12:22.380836 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:12:22.383560 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:12:22.392990 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:12:22.457139 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:12:22.553460 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_7c1e163b_7a94_4d45_abd6_36d71263d63f'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:12:22.555722 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_7c1e163b_7a94_4d45_abd6_36d71263d63f'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:12:22.549297 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c1e163b-7a94-4d45-abd6-36d71263d63f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e44c8484f70>]}
[0m17:12:22.563359 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.30s]
[0m17:12:22.566699 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:12:22.569385 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:12:22.577823 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:12:22.586226 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:12:22.592717 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:12:22.645953 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_7c1e163b_7a94_4d45_abd6_36d71263d63f`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:12:22.648094 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_7c1e163b_7a94_4d45_abd6_36d71263d63f`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:12:22.677842 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:12:22.680391 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:12:22.684851 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_7c1e163b_7a94_4d45_abd6_36d71263d63f`)
      
    ...
[0m17:12:22.689011 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_7c1e163b_7a94_4d45_abd6_36d71263d63f`)
      
    ...
[0m17:12:22.719385 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:12:22.733974 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:12:22.731578 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:12:22.753961 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:12:22.763418 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:12:22.769269 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_7c1e163b_7a94_4d45_abd6_36d71263d63f` 
    ...
[0m17:12:22.772054 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:12:22.779301 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_7c1e163b_7a94_4d45_abd6_36d71263d63f` 
    ...
[0m17:12:22.787692 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:12:22.790569 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:12:22.851925 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_7c1e163b_7a94_4d45_abd6_36d71263d63f` 
  ...
[0m17:12:22.863889 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_7c1e163b_7a94_4d45_abd6_36d71263d63f` 
  ...
[0m17:12:22.870751 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:12:22.878899 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:12:22.891148 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:12:22.956518 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:12:22.961405 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:12:22.963984 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:12:22.970529 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c1e163b-7a94-4d45-abd6-36d71263d63f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e44c706df10>]}
[0m17:12:22.977021 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c1e163b-7a94-4d45-abd6-36d71263d63f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e44c8cd64f0>]}
[0m17:12:22.979491 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.77s]
[0m17:12:22.982058 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.78s]
[0m17:12:22.984999 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:12:22.987898 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:12:22.992344 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:12:22.993498 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:12:22.994765 [debug] [MainThread]: On list__mart: Close
[0m17:12:22.995835 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:12:23.045147 [debug] [MainThread]: On list__clean: Close
[0m17:12:23.046340 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:12:23.047431 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:12:23.048496 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:12:23.049598 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:12:23.050638 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:12:23.051711 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:12:23.052746 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:12:23.053814 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:12:23.056125 [info ] [MainThread]: 
[0m17:12:23.057433 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.89 seconds (3.89s).
[0m17:12:23.065728 [debug] [MainThread]: Command end result
[0m17:12:23.282144 [info ] [MainThread]: 
[0m17:12:23.283479 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:12:23.284497 [info ] [MainThread]: 
[0m17:12:23.285592 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:12:23.287654 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.7218885, "process_in_blocks": "0", "process_kernel_time": 0.672805, "process_mem_max_rss": "114328", "process_out_blocks": "9744", "process_user_time": 6.125289}
[0m17:12:23.288812 [debug] [MainThread]: Command `dbt build` succeeded at 17:12:23.288491 after 6.72 seconds
[0m17:12:23.289788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e44cc1a7310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e44c84dd5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e44c8570f40>]}
[0m17:12:23.290748 [debug] [MainThread]: Flushing usage events
[0m17:13:16.058853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5fd7e41310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5fd4a9bb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5fd4a9ba00>]}


============================== 17:13:16.069265 | b8423776-2d21-4e46-8d86-34880db0c407 ==============================
[0m17:13:16.069265 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:13:16.070415 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'invocation_command': 'dbt build --profiles-dir . --target local', 'empty': 'False', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'debug': 'False', 'quiet': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'no_print': 'None', 'fail_fast': 'False', 'printer_width': '80', 'write_json': 'True', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager', 'use_colors': 'True', 'version_check': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'target_path': 'None', 'partial_parse': 'True', 'introspect': 'True'}
[0m17:13:16.655135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b8423776-2d21-4e46-8d86-34880db0c407', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5fd49f0fa0>]}
[0m17:13:16.853253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b8423776-2d21-4e46-8d86-34880db0c407', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5fd4a5e3d0>]}
[0m17:13:16.855193 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:13:17.389029 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:13:17.966923 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:13:17.967599 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:13:18.171666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b8423776-2d21-4e46-8d86-34880db0c407', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5fd41eee80>]}
[0m17:13:18.654105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b8423776-2d21-4e46-8d86-34880db0c407', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5fd4203670>]}
[0m17:13:18.655017 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:13:18.658164 [info ] [MainThread]: 
[0m17:13:18.659330 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:13:18.671438 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:13:18.673119 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:13:18.759910 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:13:18.777826 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:13:19.476935 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:13:19.484908 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:13:19.488923 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:13:19.496242 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:13:19.565051 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:13:19.566612 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:13:19.581359 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:13:19.586897 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:13:19.641080 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:13:19.649329 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:13:19.660862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8423776-2d21-4e46-8d86-34880db0c407', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5fd4763b50>]}
[0m17:13:19.662712 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:13:19.663983 [info ] [MainThread]: 
[0m17:13:19.688600 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:13:19.740393 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:13:19.741768 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__clean, now model.ex_03_meteo.stg_btc__market_price)
[0m17:13:19.742815 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:13:19.767107 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:13:19.768712 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:13:19.962885 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:13:19.964732 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:13:19.978749 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:13:19.992141 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:13:19.995096 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:13:19.997873 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:13:20.001248 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:13:20.158459 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:13:20.161702 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:13:20.163727 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:13:20.166504 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:13:20.261649 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:13:20.265360 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:13:20.271423 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8423776-2d21-4e46-8d86-34880db0c407', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5fd3571520>]}
[0m17:13:20.272511 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m17:13:20.273880 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:13:20.275893 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:13:20.277291 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:13:20.278845 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:13:20.280466 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:13:20.281939 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:13:20.283672 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:13:20.285487 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:13:20.287699 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:13:20.289394 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:13:20.291465 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:13:20.342106 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:13:20.354438 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:13:20.483918 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:13:20.485997 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:13:20.544047 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:13:20.546193 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:13:20.553868 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:13:20.560610 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:13:20.842485 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:13:20.845448 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:13:20.860844 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:13:20.863277 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:13:20.865122 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:13:20.868618 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:13:21.118502 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:13:21.126697 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:13:21.140864 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:13:21.129112 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:13:21.149557 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.87s]
[0m17:13:21.151172 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:13:21.153568 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:13:21.157331 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.87s]
[0m17:13:21.158979 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:13:21.160485 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:13:21.163977 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.87s]
[0m17:13:21.165830 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:13:21.167761 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:13:21.168657 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:13:21.169774 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:13:21.170637 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:13:21.171838 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:13:21.173104 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:13:21.174963 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:13:21.176590 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:13:21.178131 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:13:21.179741 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:13:21.181322 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:13:21.240780 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:13:21.279110 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:13:21.341861 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:13:21.355750 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:13:21.357905 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:13:21.359859 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:13:21.366898 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:13:21.480081 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:13:21.646163 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:13:21.681433 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:13:21.782072 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:13:21.962320 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m17:13:21.971692 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:13:22.085177 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:13:22.172620 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:13:22.258504 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:13:22.259819 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b8423776_2d21_4e46_8d86_34880db0c407` 
  ...
[0m17:13:22.269480 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:13:22.346962 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b8423776_2d21_4e46_8d86_34880db0c407` 
  ...
[0m17:13:22.350194 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:13:22.355894 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:13:22.363203 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:13:22.467412 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:13:22.586497 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:13:22.674916 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8423776-2d21-4e46-8d86-34880db0c407', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5fd3488130>]}
[0m17:13:22.688567 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.50s]
[0m17:13:22.757894 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:13:22.776163 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_b8423776_2d21_4e46_8d86_34880db0c407`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:13:22.778424 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_b8423776_2d21_4e46_8d86_34880db0c407`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:13:22.811467 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:13:22.841598 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:13:22.953608 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_b8423776_2d21_4e46_8d86_34880db0c407'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:13:22.949809 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_b8423776_2d21_4e46_8d86_34880db0c407'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:13:22.963757 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:13:22.971871 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:13:22.985529 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:13:23.043771 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:13:23.046480 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_b8423776_2d21_4e46_8d86_34880db0c407`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:13:23.050620 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_b8423776_2d21_4e46_8d86_34880db0c407`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:13:23.079954 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:13:23.082632 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:13:23.086705 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b8423776_2d21_4e46_8d86_34880db0c407`)
      
    ...
[0m17:13:23.091059 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b8423776_2d21_4e46_8d86_34880db0c407`)
      
    ...
[0m17:13:23.120415 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:13:23.133658 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:13:23.142766 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:13:23.152816 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:13:23.155636 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:13:23.163386 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b8423776_2d21_4e46_8d86_34880db0c407` 
    ...
[0m17:13:23.166691 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:13:23.175752 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b8423776_2d21_4e46_8d86_34880db0c407` 
    ...
[0m17:13:23.180433 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:13:23.241720 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:13:23.254970 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b8423776_2d21_4e46_8d86_34880db0c407` 
  ...
[0m17:13:23.263479 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b8423776_2d21_4e46_8d86_34880db0c407` 
  ...
[0m17:13:23.268040 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:13:23.281488 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:13:23.284059 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:13:23.341791 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:13:23.358560 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8423776-2d21-4e46-8d86-34880db0c407', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5fd4a73550>]}
[0m17:13:23.357755 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:13:23.361694 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.18s]
[0m17:13:23.366466 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:13:23.369582 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:13:23.376618 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8423776-2d21-4e46-8d86-34880db0c407', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5fd358ea00>]}
[0m17:13:23.378872 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.20s]
[0m17:13:23.381634 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:13:23.385504 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:13:23.386647 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:13:23.387772 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:13:23.440411 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:13:23.441622 [debug] [MainThread]: On list__mart: Close
[0m17:13:23.442667 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:13:23.443743 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:13:23.444777 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:13:23.445843 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:13:23.446800 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m17:13:23.447554 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m17:13:23.449236 [info ] [MainThread]: 
[0m17:13:23.450478 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.79 seconds (4.79s).
[0m17:13:23.456555 [debug] [MainThread]: Command end result
[0m17:13:23.661561 [info ] [MainThread]: 
[0m17:13:23.663169 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:13:23.664436 [info ] [MainThread]: 
[0m17:13:23.665992 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:13:23.669095 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.8026323, "process_in_blocks": "0", "process_kernel_time": 0.706821, "process_mem_max_rss": "114556", "process_out_blocks": "9744", "process_user_time": 6.643724}
[0m17:13:23.671201 [debug] [MainThread]: Command `dbt build` succeeded at 17:13:23.670572 after 7.80 seconds
[0m17:13:23.673311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5fd7e41310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5fd48e36d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5fd2d4ca30>]}
[0m17:13:23.674552 [debug] [MainThread]: Flushing usage events
[0m17:14:16.163038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eec94218310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eec90e88b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eec90e88a00>]}


============================== 17:14:16.172663 | 978b8a3a-b84c-4975-9ca8-6af11c264cf0 ==============================
[0m17:14:16.172663 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:14:16.173746 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'no_print': 'None', 'static_parser': 'True', 'partial_parse': 'True', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_format': 'default', 'fail_fast': 'False', 'warn_error': 'None', 'version_check': 'True', 'quiet': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'introspect': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'printer_width': '80', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'use_colors': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'write_json': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local'}
[0m17:14:16.754606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '978b8a3a-b84c-4975-9ca8-6af11c264cf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eec90d7b940>]}
[0m17:14:16.952598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '978b8a3a-b84c-4975-9ca8-6af11c264cf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eec90e44310>]}
[0m17:14:16.953900 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:14:17.374781 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:14:17.963452 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:14:17.964118 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:14:18.178087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '978b8a3a-b84c-4975-9ca8-6af11c264cf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eec905ddeb0>]}
[0m17:14:18.692514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '978b8a3a-b84c-4975-9ca8-6af11c264cf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eec904d24c0>]}
[0m17:14:18.693513 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:14:18.697466 [info ] [MainThread]: 
[0m17:14:18.698650 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:14:18.711335 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:14:18.758473 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:14:18.771144 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:14:18.777084 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:14:19.315254 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:14:19.322156 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:14:19.324349 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:14:19.358052 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:14:19.388866 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:14:19.390721 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:14:19.465019 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:14:19.468115 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:14:19.479225 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:14:19.489363 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:14:19.500614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '978b8a3a-b84c-4975-9ca8-6af11c264cf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eec90d61f70>]}
[0m17:14:19.503062 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:14:19.504126 [info ] [MainThread]: 
[0m17:14:19.578972 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:14:19.580119 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:14:19.581169 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:14:19.581935 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:14:19.597961 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:14:19.599049 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:14:19.792116 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:14:19.906006 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:14:19.908056 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:14:19.920022 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:14:20.076080 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:14:20.079245 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:14:20.081408 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:14:20.084422 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:14:20.090358 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:14:20.092994 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:14:20.094903 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:14:20.097464 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:14:20.193240 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:14:20.196326 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:14:20.252830 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '978b8a3a-b84c-4975-9ca8-6af11c264cf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eec901bd910>]}
[0m17:14:20.254205 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.62s]
[0m17:14:20.255638 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:14:20.257308 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:14:20.258171 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:14:20.259002 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:14:20.259840 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:14:20.260806 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:14:20.262250 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:14:20.263168 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:14:20.264173 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:14:20.264947 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:14:20.265945 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:14:20.266752 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:14:20.288359 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:14:20.289437 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:14:20.296866 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:14:20.355226 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:14:20.356757 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:14:20.362896 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:14:20.368915 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:14:20.480164 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:14:20.482315 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:14:20.489205 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:14:20.491024 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:14:20.491860 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:14:20.494125 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:14:20.691397 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:14:20.698074 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:14:20.700815 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:14:20.708962 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.44s]
[0m17:14:20.710477 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:14:20.712242 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:14:20.715283 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.45s]
[0m17:14:20.718492 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:14:20.720063 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:14:20.727264 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:14:20.730239 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.46s]
[0m17:14:20.751893 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:14:20.753783 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:14:20.754809 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:14:20.756149 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:14:20.757139 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:14:20.758912 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:14:20.760515 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:14:20.761835 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:14:20.763100 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:14:20.764505 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:14:20.765680 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:14:20.766832 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:14:20.784407 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:14:20.788899 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:14:20.858209 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:14:20.869033 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:14:20.871529 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:14:20.873209 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:14:20.890608 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:14:21.063890 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:14:21.163362 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:14:21.258531 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:14:21.399487 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:14:21.580510 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:14:21.665204 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:14:21.777594 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_978b8a3a_b84c_4975_9ca8_6af11c264cf0` 
  ...
[0m17:14:21.780314 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:14:21.781873 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_978b8a3a_b84c_4975_9ca8_6af11c264cf0` 
  ...
[0m17:14:21.797460 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:14:21.802823 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:14:21.800072 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:14:21.854140 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:14:21.868240 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:14:21.958421 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:14:22.062571 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:14:22.090566 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_978b8a3a_b84c_4975_9ca8_6af11c264cf0`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:14:22.098618 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_978b8a3a_b84c_4975_9ca8_6af11c264cf0`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:14:22.152795 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:14:22.157780 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '978b8a3a-b84c-4975-9ca8-6af11c264cf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eec9035f250>]}
[0m17:14:22.158985 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.39s]
[0m17:14:22.160447 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:14:22.181150 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:14:22.195854 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:14:22.259945 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_978b8a3a_b84c_4975_9ca8_6af11c264cf0'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:14:22.269046 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_978b8a3a_b84c_4975_9ca8_6af11c264cf0'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:14:22.276877 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:14:22.284560 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:14:22.292901 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:14:22.297477 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:14:22.300193 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_978b8a3a_b84c_4975_9ca8_6af11c264cf0`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:14:22.353689 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_978b8a3a_b84c_4975_9ca8_6af11c264cf0`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:14:22.384207 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:14:22.386854 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:14:22.390902 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_978b8a3a_b84c_4975_9ca8_6af11c264cf0`)
      
    ...
[0m17:14:22.395090 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_978b8a3a_b84c_4975_9ca8_6af11c264cf0`)
      
    ...
[0m17:14:22.423233 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:14:22.438252 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:14:22.436134 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:14:22.455399 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:14:22.466900 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:14:22.468353 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:14:22.473822 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_978b8a3a_b84c_4975_9ca8_6af11c264cf0` 
    ...
[0m17:14:22.477835 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_978b8a3a_b84c_4975_9ca8_6af11c264cf0` 
    ...
[0m17:14:22.487425 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:14:22.489756 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:14:22.506848 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_978b8a3a_b84c_4975_9ca8_6af11c264cf0` 
  ...
[0m17:14:22.555334 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_978b8a3a_b84c_4975_9ca8_6af11c264cf0` 
  ...
[0m17:14:22.563719 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:14:22.571461 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:14:22.583588 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:14:22.592317 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:14:22.596758 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:14:22.653290 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:14:22.658168 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '978b8a3a-b84c-4975-9ca8-6af11c264cf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eec8f994be0>]}
[0m17:14:22.664324 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '978b8a3a-b84c-4975-9ca8-6af11c264cf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eec8f994400>]}
[0m17:14:22.667918 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.90s]
[0m17:14:22.671475 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.90s]
[0m17:14:22.675641 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:14:22.679548 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:14:22.684307 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:14:22.685602 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:14:22.686859 [debug] [MainThread]: On list__mart: Close
[0m17:14:22.687995 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:14:22.689188 [debug] [MainThread]: On list__clean: Close
[0m17:14:22.690291 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:14:22.691435 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:14:22.692516 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:14:22.693683 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:14:22.695034 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:14:22.696270 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:14:22.697451 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m17:14:22.699308 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m17:14:22.752038 [info ] [MainThread]: 
[0m17:14:22.753706 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.00 seconds (4.00s).
[0m17:14:22.761970 [debug] [MainThread]: Command end result
[0m17:14:22.971599 [info ] [MainThread]: 
[0m17:14:22.973293 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:14:22.974638 [info ] [MainThread]: 
[0m17:14:22.976035 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:14:22.978716 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.010525, "process_in_blocks": "0", "process_kernel_time": 0.695445, "process_mem_max_rss": "114928", "process_out_blocks": "9744", "process_user_time": 6.16149}
[0m17:14:22.980363 [debug] [MainThread]: Command `dbt build` succeeded at 17:14:22.979934 after 7.01 seconds
[0m17:14:22.982015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eec94218310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eec90d7b940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eec90e44310>]}
[0m17:14:22.983345 [debug] [MainThread]: Flushing usage events
[0m17:15:16.526214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7381d29af310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7381cf61cb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7381cf61c9d0>]}


============================== 17:15:16.585529 | 9ae84b42-960a-406b-b7bc-205a063805db ==============================
[0m17:15:16.585529 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:15:16.586653 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'indirect_selection': 'eager', 'printer_width': '80', 'warn_error': 'None', 'use_colors': 'True', 'empty': 'False', 'log_cache_events': 'False', 'fail_fast': 'False', 'profiles_dir': '.', 'static_parser': 'True', 'version_check': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'cache_selected_only': 'False', 'introspect': 'True', 'log_format': 'default', 'debug': 'False', 'partial_parse': 'True', 'write_json': 'True', 'quiet': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'no_print': 'None'}
[0m17:15:17.176239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9ae84b42-960a-406b-b7bc-205a063805db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7381cf5e24f0>]}
[0m17:15:17.319112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9ae84b42-960a-406b-b7bc-205a063805db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7381cf5d2040>]}
[0m17:15:17.320412 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:15:17.790950 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:15:18.299053 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:15:18.299701 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:15:18.503886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9ae84b42-960a-406b-b7bc-205a063805db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7381ced85eb0>]}
[0m17:15:19.026406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9ae84b42-960a-406b-b7bc-205a063805db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7381cedc3100>]}
[0m17:15:19.027907 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:15:19.033439 [info ] [MainThread]: 
[0m17:15:19.035257 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:15:19.086583 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:15:19.087570 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:15:19.180207 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:15:19.186626 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:15:19.890566 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:15:19.894806 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:15:19.899258 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:15:19.901778 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:15:19.999660 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:15:20.001139 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:15:20.016993 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:15:20.022313 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:15:20.084295 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:15:20.091380 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:15:20.108647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9ae84b42-960a-406b-b7bc-205a063805db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7381ce495dc0>]}
[0m17:15:20.110567 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:15:20.111598 [info ] [MainThread]: 
[0m17:15:20.185157 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:15:20.186262 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:15:20.187318 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:15:20.188029 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:15:20.205040 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:15:20.206215 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:15:20.392110 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:15:20.456166 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:15:20.457518 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:15:20.469528 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:15:20.598880 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:15:20.602742 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:15:20.604646 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:15:20.607782 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:15:20.613385 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:15:20.616194 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:15:20.617943 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:15:20.620673 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:15:20.714302 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:15:20.717940 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:15:20.723988 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ae84b42-960a-406b-b7bc-205a063805db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7381ce0ef760>]}
[0m17:15:20.725573 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.54s]
[0m17:15:20.777070 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:15:20.779414 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:15:20.781113 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:15:20.782967 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:15:20.784662 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:15:20.786481 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:15:20.788108 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:15:20.789410 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:15:20.791631 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:15:20.793124 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:15:20.794683 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:15:20.796378 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:15:20.813643 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:15:20.819661 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:15:20.891007 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:15:20.900448 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:15:20.903053 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:15:20.904733 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:15:20.906569 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:15:21.213745 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:15:21.210988 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:15:21.279064 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:15:21.281890 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:15:21.283647 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:15:21.286907 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:15:21.518300 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:15:21.532136 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:15:21.577849 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.79s]
[0m17:15:21.582725 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:15:21.585337 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:15:21.591822 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:15:21.602929 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:15:21.608940 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.82s]
[0m17:15:21.611883 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:15:21.614741 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:15:21.620904 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.83s]
[0m17:15:21.623643 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:15:21.676832 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:15:21.678008 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:15:21.679914 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:15:21.681894 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:15:21.683910 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:15:21.686326 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:15:21.687483 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:15:21.688360 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:15:21.689364 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:15:21.690498 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:15:21.691391 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:15:21.692329 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:15:21.815491 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:15:21.885333 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:15:21.887349 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:15:21.889713 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:15:21.891839 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:15:21.893442 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:15:21.907409 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:15:22.024359 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:15:22.183142 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:15:22.288205 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:15:22.377960 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:15:22.387501 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:15:22.486714 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:15:22.523037 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:15:22.687885 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:15:22.710812 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:15:22.788690 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9ae84b42_960a_406b_b7bc_205a063805db` 
  ...
[0m17:15:22.806980 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:15:22.815373 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9ae84b42_960a_406b_b7bc_205a063805db` 
  ...
[0m17:15:22.824018 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:15:22.879661 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:15:22.892254 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:15:22.925168 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:15:23.006764 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_9ae84b42_960a_406b_b7bc_205a063805db`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:15:23.011216 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_9ae84b42_960a_406b_b7bc_205a063805db`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:15:23.013935 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ae84b42-960a-406b-b7bc-205a063805db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7381ce193e80>]}
[0m17:15:23.017017 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.32s]
[0m17:15:23.018545 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:15:23.040442 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:15:23.077211 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:15:23.094512 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_9ae84b42_960a_406b_b7bc_205a063805db'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:15:23.099921 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_9ae84b42_960a_406b_b7bc_205a063805db'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:15:23.104902 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:15:23.106211 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:15:23.112504 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:15:23.115279 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:15:23.116813 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_9ae84b42_960a_406b_b7bc_205a063805db`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:15:23.118709 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_9ae84b42_960a_406b_b7bc_205a063805db`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:15:23.133954 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:15:23.135687 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:15:23.138362 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9ae84b42_960a_406b_b7bc_205a063805db`)
      
    ...
[0m17:15:23.178631 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9ae84b42_960a_406b_b7bc_205a063805db`)
      
    ...
[0m17:15:23.198380 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:15:23.206742 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:15:23.208183 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:15:23.213901 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:15:23.217224 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:15:23.220143 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9ae84b42_960a_406b_b7bc_205a063805db` 
    ...
[0m17:15:23.222088 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:15:23.225204 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9ae84b42_960a_406b_b7bc_205a063805db` 
    ...
[0m17:15:23.227517 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:15:23.233663 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9ae84b42_960a_406b_b7bc_205a063805db` 
  ...
[0m17:15:23.235819 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:15:23.242941 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:15:23.276487 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9ae84b42_960a_406b_b7bc_205a063805db` 
  ...
[0m17:15:23.282838 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:15:23.286560 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:15:23.288032 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:15:23.291387 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ae84b42-960a-406b-b7bc-205a063805db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7381ce193880>]}
[0m17:15:23.297259 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:15:23.298686 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.60s]
[0m17:15:23.301043 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:15:23.304117 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:15:23.307593 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ae84b42-960a-406b-b7bc-205a063805db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7381ceafd880>]}
[0m17:15:23.308729 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.62s]
[0m17:15:23.310066 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:15:23.312088 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:15:23.312648 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:15:23.313158 [debug] [MainThread]: On list__mart: Close
[0m17:15:23.313657 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:15:23.314147 [debug] [MainThread]: On list__clean: Close
[0m17:15:23.314649 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:15:23.315120 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:15:23.315616 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:15:23.316091 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:15:23.316572 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:15:23.317052 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:15:23.317509 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m17:15:23.318014 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m17:15:23.319167 [info ] [MainThread]: 
[0m17:15:23.319820 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.28 seconds (4.28s).
[0m17:15:23.323478 [debug] [MainThread]: Command end result
[0m17:15:23.479954 [info ] [MainThread]: 
[0m17:15:23.480811 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:15:23.481369 [info ] [MainThread]: 
[0m17:15:23.481983 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:15:23.483400 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.1579084, "process_in_blocks": "0", "process_kernel_time": 0.709127, "process_mem_max_rss": "114828", "process_out_blocks": "9744", "process_user_time": 6.220174}
[0m17:15:23.484208 [debug] [MainThread]: Command `dbt build` succeeded at 17:15:23.484021 after 7.16 seconds
[0m17:15:23.484841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7381d29af310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7381cf5e24f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7381cd9a6940>]}
[0m17:15:23.485491 [debug] [MainThread]: Flushing usage events
[0m17:16:16.200740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7614454f6d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x761442161c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x761442161b20>]}


============================== 17:16:16.210379 | 0ea7781d-d064-48a1-82c8-51cc784a53de ==============================
[0m17:16:16.210379 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:16:16.211463 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'quiet': 'False', 'fail_fast': 'False', 'log_format': 'default', 'static_parser': 'True', 'debug': 'False', 'cache_selected_only': 'False', 'partial_parse': 'True', 'empty': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'profiles_dir': '.', 'printer_width': '80', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'warn_error': 'None', 'log_cache_events': 'False', 'target_path': 'None'}
[0m17:16:16.793979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0ea7781d-d064-48a1-82c8-51cc784a53de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x761442125970>]}
[0m17:16:16.989959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0ea7781d-d064-48a1-82c8-51cc784a53de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7614421382e0>]}
[0m17:16:16.991237 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:16:17.410553 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:16:17.915311 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:16:17.915950 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:16:18.174579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0ea7781d-d064-48a1-82c8-51cc784a53de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7614418b2dc0>]}
[0m17:16:18.620374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0ea7781d-d064-48a1-82c8-51cc784a53de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7614418f7430>]}
[0m17:16:18.621310 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:16:18.625121 [info ] [MainThread]: 
[0m17:16:18.626310 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:16:18.678279 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:16:18.689910 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:16:18.776123 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:16:18.777296 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:16:19.279504 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:16:19.281265 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:16:19.285238 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:16:19.286753 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:16:19.312795 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:16:19.313958 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:16:19.388965 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:16:19.392836 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:16:19.398919 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:16:19.400109 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:16:19.414526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ea7781d-d064-48a1-82c8-51cc784a53de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x761442100d60>]}
[0m17:16:19.415636 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:16:19.416324 [info ] [MainThread]: 
[0m17:16:19.478351 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:16:19.479632 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:16:19.480713 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:16:19.481523 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:16:19.498710 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:16:19.499880 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:16:19.671271 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:16:19.731871 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:16:19.733293 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:16:19.748193 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:16:19.893140 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:16:19.897290 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:16:19.899337 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:16:19.902369 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:16:19.908019 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:16:19.910938 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:16:19.912867 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:16:19.915825 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:16:20.077050 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:16:20.080916 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:16:20.088717 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ea7781d-d064-48a1-82c8-51cc784a53de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7614449efb80>]}
[0m17:16:20.090288 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m17:16:20.091806 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:16:20.094356 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:16:20.096444 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:16:20.097865 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:16:20.099190 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:16:20.100220 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:16:20.101520 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:16:20.103257 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:16:20.104957 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:16:20.106169 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:16:20.107216 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:16:20.108093 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:16:20.109352 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:16:20.219093 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:16:20.286970 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:16:20.286246 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:16:20.289810 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:16:20.307283 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:16:20.314007 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:16:20.601239 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:16:20.604029 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:16:20.618187 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:16:20.620355 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:16:20.672171 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:16:20.675682 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:16:20.948855 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:16:20.962651 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:16:20.972267 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:16:20.974826 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:16:20.984270 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.88s]
[0m17:16:20.985841 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:16:20.988239 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:16:20.991964 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.89s]
[0m17:16:20.995012 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:16:20.998152 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:16:21.004279 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.90s]
[0m17:16:21.007745 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:16:21.010719 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:16:21.012453 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:16:21.013846 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:16:21.011721 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:16:21.016406 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:16:21.070412 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:16:21.082197 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:16:21.083900 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:16:21.085450 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:16:21.087166 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:16:21.088874 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:16:21.090410 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:16:21.204921 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:16:21.215303 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:16:21.272146 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:16:21.275069 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:16:21.287510 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:16:21.309732 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:16:21.392280 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:16:21.501883 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:16:21.597376 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:16:21.686320 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:16:21.810858 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m17:16:21.882321 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:16:21.987924 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:16:22.100043 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:16:22.172500 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_0ea7781d_d064_48a1_82c8_51cc784a53de` 
  ...
[0m17:16:22.187675 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:16:22.190265 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:16:22.202669 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:16:22.213861 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_0ea7781d_d064_48a1_82c8_51cc784a53de` 
  ...
[0m17:16:22.308443 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:16:22.388098 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:16:22.415175 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:16:22.497653 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_0ea7781d_d064_48a1_82c8_51cc784a53de`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:16:22.499877 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_0ea7781d_d064_48a1_82c8_51cc784a53de`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:16:22.508752 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:16:22.516910 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ea7781d-d064-48a1-82c8-51cc784a53de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7614404b9d30>]}
[0m17:16:22.519095 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.43s]
[0m17:16:22.572445 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:16:22.574964 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:16:22.577674 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:16:22.682785 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_0ea7781d_d064_48a1_82c8_51cc784a53de'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:16:22.687204 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_0ea7781d_d064_48a1_82c8_51cc784a53de'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:16:22.697651 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:16:22.700932 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:16:22.714369 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:16:22.771248 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:16:22.774336 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_0ea7781d_d064_48a1_82c8_51cc784a53de`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:16:22.776456 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_0ea7781d_d064_48a1_82c8_51cc784a53de`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:16:22.807980 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:16:22.812585 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_0ea7781d_d064_48a1_82c8_51cc784a53de`)
      
    ...
[0m17:16:22.814693 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:16:22.819605 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_0ea7781d_d064_48a1_82c8_51cc784a53de`)
      
    ...
[0m17:16:22.841350 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:16:22.854894 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:16:22.852606 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:16:22.875739 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:16:22.886074 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:16:22.894108 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:16:22.892111 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_0ea7781d_d064_48a1_82c8_51cc784a53de` 
    ...
[0m17:16:22.900432 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_0ea7781d_d064_48a1_82c8_51cc784a53de` 
    ...
[0m17:16:22.914438 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:16:22.917102 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:16:22.972879 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_0ea7781d_d064_48a1_82c8_51cc784a53de` 
  ...
[0m17:16:22.985420 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_0ea7781d_d064_48a1_82c8_51cc784a53de` 
  ...
[0m17:16:22.991320 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:16:22.993698 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:16:23.006283 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:16:23.072890 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:16:23.077406 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:16:23.084763 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ea7781d-d064-48a1-82c8-51cc784a53de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7614404ce1f0>]}
[0m17:16:23.087075 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.00s]
[0m17:16:23.088776 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:16:23.090599 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:16:23.094470 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ea7781d-d064-48a1-82c8-51cc784a53de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x761440baad30>]}
[0m17:16:23.096304 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.01s]
[0m17:16:23.097989 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:16:23.101619 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:16:23.102284 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:16:23.103199 [debug] [MainThread]: On list__mart: Close
[0m17:16:23.104155 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:16:23.105186 [debug] [MainThread]: On list__clean: Close
[0m17:16:23.106274 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:16:23.107443 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:16:23.108490 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m17:16:23.109557 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m17:16:23.110589 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:16:23.111648 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:16:23.112653 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:16:23.113707 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:16:23.115872 [info ] [MainThread]: 
[0m17:16:23.117252 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.49 seconds (4.49s).
[0m17:16:23.173242 [debug] [MainThread]: Command end result
[0m17:16:23.380364 [info ] [MainThread]: 
[0m17:16:23.382015 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:16:23.383334 [info ] [MainThread]: 
[0m17:16:23.384804 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:16:23.387374 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.3770723, "process_in_blocks": "0", "process_kernel_time": 0.680966, "process_mem_max_rss": "114732", "process_out_blocks": "9752", "process_user_time": 6.409216}
[0m17:16:23.388918 [debug] [MainThread]: Command `dbt build` succeeded at 17:16:23.388499 after 7.38 seconds
[0m17:16:23.390203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7614454f6d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x761442c70af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7614418e59d0>]}
[0m17:16:23.391443 [debug] [MainThread]: Flushing usage events
[0m17:17:17.116356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bfbcb87e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bfb97d3b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bfb97d3a30>]}


============================== 17:17:17.125693 | ae184636-40c2-4b2e-b066-5e527dfca5b6 ==============================
[0m17:17:17.125693 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:17:17.126778 [debug] [MainThread]: running dbt with arguments {'log_path': '/workdir/transforms/04_btc/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'use_colors': 'True', 'version_check': 'True', 'no_print': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'cache_selected_only': 'False', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'printer_width': '80', 'partial_parse': 'True', 'static_parser': 'True', 'profiles_dir': '.', 'write_json': 'True', 'target_path': 'None', 'indirect_selection': 'eager', 'empty': 'False', 'log_cache_events': 'False', 'quiet': 'False', 'fail_fast': 'False', 'introspect': 'True', 'log_format': 'default'}
[0m17:17:17.704672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ae184636-40c2-4b2e-b066-5e527dfca5b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bfb982ab80>]}
[0m17:17:17.897168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ae184636-40c2-4b2e-b066-5e527dfca5b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bfb96cd6d0>]}
[0m17:17:17.898447 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:17:18.318044 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:17:18.832326 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:17:18.832954 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:17:19.035683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ae184636-40c2-4b2e-b066-5e527dfca5b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bfb8f37e50>]}
[0m17:17:19.528581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ae184636-40c2-4b2e-b066-5e527dfca5b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bfb8ef6e80>]}
[0m17:17:19.529464 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:17:19.532692 [info ] [MainThread]: 
[0m17:17:19.533709 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:17:19.545270 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:17:19.546816 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:17:19.702715 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:17:19.708151 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:17:20.398289 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:17:20.402269 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:17:20.404557 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:17:20.411208 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:17:20.502650 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:17:20.504172 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:17:20.519441 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:17:20.525509 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:17:20.535556 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:17:20.544557 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:17:20.606441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ae184636-40c2-4b2e-b066-5e527dfca5b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bfb94a9c40>]}
[0m17:17:20.608757 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:17:20.610372 [info ] [MainThread]: 
[0m17:17:20.635306 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:17:20.637320 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:17:20.639074 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:17:20.639885 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:17:20.711662 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:17:20.713003 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:17:20.842406 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:17:20.958693 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:17:20.960833 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:17:20.973904 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:17:21.111832 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:17:21.115335 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:17:21.117273 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:17:21.120147 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:17:21.125772 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:17:21.128691 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:17:21.130572 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:17:21.133419 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:17:21.227724 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:17:21.231281 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:17:21.237369 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ae184636-40c2-4b2e-b066-5e527dfca5b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bfb8b09cd0>]}
[0m17:17:21.238502 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m17:17:21.239851 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:17:21.242111 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:17:21.243465 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:17:21.293915 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:17:21.245263 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:17:21.296918 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:17:21.299263 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:17:21.301230 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:17:21.303545 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:17:21.305321 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:17:21.307364 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:17:21.309182 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:17:21.331660 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:17:21.416710 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:17:21.431792 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:17:21.493822 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:17:21.496551 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:17:21.498212 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:17:21.510586 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:17:21.800630 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:17:21.803400 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:17:21.819868 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:17:21.822477 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:17:21.824136 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:17:21.828899 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:17:22.064549 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:17:22.072769 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:17:22.076750 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:17:22.089041 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:17:22.087177 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.79s]
[0m17:17:22.093572 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.79s]
[0m17:17:22.095086 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:17:22.096403 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:17:22.097720 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:17:22.104792 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:17:22.107762 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.80s]
[0m17:17:22.109218 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:17:22.110825 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:17:22.111754 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:17:22.112528 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:17:22.113526 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:17:22.114589 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:17:22.115659 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:17:22.116585 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:17:22.117265 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:17:22.117959 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:17:22.118715 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:17:22.119422 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:17:22.120167 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:17:22.138675 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:17:22.194259 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:17:22.202050 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:17:22.203972 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:17:22.204768 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:17:22.216109 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:17:22.293780 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:17:22.393397 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:17:22.521586 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:17:22.598285 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_ae184636_40c2_4b2e_b066_5e527dfca5b6` 
  ...
[0m17:17:22.603307 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:17:22.608552 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_ae184636_40c2_4b2e_b066_5e527dfca5b6` 
  ...
[0m17:17:22.612684 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:17:22.615001 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:17:22.627357 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:17:22.634750 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:17:22.736511 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_ae184636_40c2_4b2e_b066_5e527dfca5b6`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:17:22.739729 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_ae184636_40c2_4b2e_b066_5e527dfca5b6`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:17:22.743212 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:17:22.800513 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:17:22.801831 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:17:22.810473 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:17:22.822145 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:17:22.821167 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_ae184636_40c2_4b2e_b066_5e527dfca5b6'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:17:22.824882 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:17:22.829946 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_ae184636_40c2_4b2e_b066_5e527dfca5b6'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:17:22.835189 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:17:22.836595 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:17:22.904834 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:17:22.902173 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:17:22.919016 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:17:22.924553 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:17:22.929558 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_ae184636_40c2_4b2e_b066_5e527dfca5b6`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:17:22.933915 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:17:22.935913 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_ae184636_40c2_4b2e_b066_5e527dfca5b6`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:17:22.993167 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ae184636-40c2-4b2e-b066-5e527dfca5b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bfb7b3b0a0>]}
[0m17:17:22.996069 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:17:23.000339 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.82s]
[0m17:17:23.005600 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_ae184636_40c2_4b2e_b066_5e527dfca5b6`)
      
    ...
[0m17:17:23.008867 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:17:23.030067 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:17:23.034932 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_ae184636_40c2_4b2e_b066_5e527dfca5b6`)
      
    ...
[0m17:17:23.039344 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:17:23.050410 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:17:23.094433 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:17:23.059525 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:17:23.105281 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:17:23.111412 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_ae184636_40c2_4b2e_b066_5e527dfca5b6` 
    ...
[0m17:17:23.121723 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:17:23.127725 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_ae184636_40c2_4b2e_b066_5e527dfca5b6` 
    ...
[0m17:17:23.130332 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:17:23.194577 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:17:23.200741 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_ae184636_40c2_4b2e_b066_5e527dfca5b6` 
  ...
[0m17:17:23.213574 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_ae184636_40c2_4b2e_b066_5e527dfca5b6` 
  ...
[0m17:17:23.219910 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:17:23.227491 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:17:23.239866 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:17:23.300838 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:17:23.306170 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:17:23.314143 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:17:23.316256 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ae184636-40c2-4b2e-b066-5e527dfca5b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bfbb299880>]}
[0m17:17:23.323008 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ae184636-40c2-4b2e-b066-5e527dfca5b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bfb8ef6e80>]}
[0m17:17:23.325472 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.20s]
[0m17:17:23.328021 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.21s]
[0m17:17:23.331031 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:17:23.333945 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:17:23.338591 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:17:23.339829 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:17:23.340979 [debug] [MainThread]: On list__clean: Close
[0m17:17:23.342062 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:17:23.343170 [debug] [MainThread]: On list__mart: Close
[0m17:17:23.393758 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:17:23.394911 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:17:23.395970 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:17:23.397084 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:17:23.398129 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:17:23.399239 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:17:23.400319 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m17:17:23.401414 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m17:17:23.403702 [info ] [MainThread]: 
[0m17:17:23.405115 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.87 seconds (3.87s).
[0m17:17:23.413215 [debug] [MainThread]: Command end result
[0m17:17:23.625556 [info ] [MainThread]: 
[0m17:17:23.627118 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:17:23.628278 [info ] [MainThread]: 
[0m17:17:23.629511 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:17:23.631951 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.7079034, "process_in_blocks": "0", "process_kernel_time": 0.683611, "process_mem_max_rss": "114600", "process_out_blocks": "9744", "process_user_time": 6.034741}
[0m17:17:23.633318 [debug] [MainThread]: Command `dbt build` succeeded at 17:17:23.632978 after 6.71 seconds
[0m17:17:23.634407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bfbcb87e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bfba1fe340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bfb96cd6d0>]}
[0m17:17:23.635476 [debug] [MainThread]: Flushing usage events
[0m17:18:16.284146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783ad871a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783ad5370ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783ad5370970>]}


============================== 17:18:16.344056 | 08ca68aa-f9c5-4991-a5e0-b6e56bc45ad1 ==============================
[0m17:18:16.344056 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:18:16.345119 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'target_path': 'None', 'quiet': 'False', 'indirect_selection': 'eager', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'version_check': 'True', 'use_experimental_parser': 'False', 'debug': 'False', 'log_cache_events': 'False', 'fail_fast': 'False', 'empty': 'False', 'write_json': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_colors': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_path': '/workdir/transforms/04_btc/logs', 'profiles_dir': '.', 'printer_width': '80'}
[0m17:18:16.869283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '08ca68aa-f9c5-4991-a5e0-b6e56bc45ad1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783ad7cacfd0>]}
[0m17:18:17.061144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '08ca68aa-f9c5-4991-a5e0-b6e56bc45ad1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783ad6623400>]}
[0m17:18:17.062450 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:18:17.473356 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:18:17.975994 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:18:17.976655 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:18:18.180844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '08ca68aa-f9c5-4991-a5e0-b6e56bc45ad1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783ad4ad5f10>]}
[0m17:18:18.691132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '08ca68aa-f9c5-4991-a5e0-b6e56bc45ad1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783ad4abf310>]}
[0m17:18:18.692250 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:18:18.695635 [info ] [MainThread]: 
[0m17:18:18.696970 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:18:18.744681 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:18:18.745842 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:18:18.768110 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:18:18.772027 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:18:19.291594 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:18:19.298328 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:18:19.300307 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:18:19.307212 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:18:19.357503 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:18:19.358964 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:18:19.379670 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:18:19.437758 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:18:19.443582 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:18:19.445112 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:18:19.459326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '08ca68aa-f9c5-4991-a5e0-b6e56bc45ad1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783ad7b28940>]}
[0m17:18:19.460361 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:18:19.461157 [info ] [MainThread]: 
[0m17:18:19.477111 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:18:19.478248 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:18:19.479330 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:18:19.480076 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:18:19.549932 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:18:19.551514 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:18:19.741514 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:18:19.805624 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:18:19.806968 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:18:19.818907 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:18:19.947781 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:18:19.951111 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:18:19.953049 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:18:19.955605 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:18:19.961335 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:18:19.964048 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:18:19.965862 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:18:19.968291 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:18:20.061491 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:18:20.064893 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:18:20.070827 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08ca68aa-f9c5-4991-a5e0-b6e56bc45ad1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783ad3d82550>]}
[0m17:18:20.071972 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m17:18:20.073269 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:18:20.075699 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:18:20.076710 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:18:20.077913 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:18:20.079431 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:18:20.080904 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:18:20.081768 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:18:20.083465 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:18:20.085671 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:18:20.138342 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:18:20.140247 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:18:20.142038 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:18:20.143874 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:18:20.366374 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:18:20.368739 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:18:20.370997 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:18:20.372572 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:18:20.373539 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:18:20.385142 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:18:20.672511 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:18:20.675182 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:18:20.684594 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:18:20.737870 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:18:20.739438 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:18:20.740263 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:18:20.911791 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:18:20.924502 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:18:20.930084 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:18:20.943404 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:18:20.951917 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:18:20.964969 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:18:20.962951 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.88s]
[0m17:18:20.973333 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.84s]
[0m17:18:20.971622 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.89s]
[0m17:18:20.976985 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:18:20.980028 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:18:20.982777 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:18:21.037631 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:18:21.038968 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:18:21.040784 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:18:21.041976 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:18:21.043820 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:18:21.045468 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:18:21.047478 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:18:21.049239 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:18:21.050947 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:18:21.052610 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:18:21.054194 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:18:21.066445 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:18:21.171589 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:18:21.174919 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:18:21.176245 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:18:21.179046 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:18:21.180779 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:18:21.237720 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:18:21.374653 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:18:21.469394 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:18:21.573923 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:18:21.763044 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:18:21.838674 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:18:21.868947 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:18:21.959954 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:18:21.985667 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:18:22.069853 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_08ca68aa_f9c5_4991_a5e0_b6e56bc45ad1` 
  ...
[0m17:18:22.073061 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_08ca68aa_f9c5_4991_a5e0_b6e56bc45ad1` 
  ...
[0m17:18:22.076297 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:18:22.078680 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:18:22.083188 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:18:22.085426 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:18:22.173214 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:18:22.358277 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:18:22.448921 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:18:22.464894 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08ca68aa-f9c5-4991-a5e0-b6e56bc45ad1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783ad659b5b0>]}
[0m17:18:22.540029 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.41s]
[0m17:18:22.480873 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_08ca68aa_f9c5_4991_a5e0_b6e56bc45ad1`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:18:22.544189 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_08ca68aa_f9c5_4991_a5e0_b6e56bc45ad1`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:18:22.547241 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:18:22.577251 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:18:22.592752 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:18:22.669412 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_08ca68aa_f9c5_4991_a5e0_b6e56bc45ad1'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:18:22.673614 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_08ca68aa_f9c5_4991_a5e0_b6e56bc45ad1'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:18:22.681051 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:18:22.683964 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:18:22.748068 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:18:22.753734 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:18:22.756635 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_08ca68aa_f9c5_4991_a5e0_b6e56bc45ad1`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:18:22.760660 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_08ca68aa_f9c5_4991_a5e0_b6e56bc45ad1`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:18:22.790353 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:18:22.794658 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_08ca68aa_f9c5_4991_a5e0_b6e56bc45ad1`)
      
    ...
[0m17:18:22.797442 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:18:22.804139 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_08ca68aa_f9c5_4991_a5e0_b6e56bc45ad1`)
      
    ...
[0m17:18:22.838346 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:18:22.824758 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:18:22.849058 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:18:22.858620 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:18:22.867547 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:18:22.870298 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:18:22.875947 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_08ca68aa_f9c5_4991_a5e0_b6e56bc45ad1` 
    ...
[0m17:18:22.881692 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_08ca68aa_f9c5_4991_a5e0_b6e56bc45ad1` 
    ...
[0m17:18:22.937618 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:18:22.950639 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_08ca68aa_f9c5_4991_a5e0_b6e56bc45ad1` 
  ...
[0m17:18:22.953409 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:18:22.969304 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:18:22.967238 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_08ca68aa_f9c5_4991_a5e0_b6e56bc45ad1` 
  ...
[0m17:18:22.983477 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:18:23.041235 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:18:23.044016 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:18:23.056789 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:18:23.064306 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08ca68aa-f9c5-4991-a5e0-b6e56bc45ad1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783ad49c28e0>]}
[0m17:18:23.068527 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.02s]
[0m17:18:23.071427 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:18:23.074255 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:18:23.080992 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08ca68aa-f9c5-4991-a5e0-b6e56bc45ad1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783ad3709580>]}
[0m17:18:23.083857 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.03s]
[0m17:18:23.137184 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:18:23.141268 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:18:23.142902 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:18:23.144085 [debug] [MainThread]: On list__mart: Close
[0m17:18:23.145286 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:18:23.146382 [debug] [MainThread]: On list__clean: Close
[0m17:18:23.147433 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:18:23.148527 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:18:23.149601 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:18:23.150698 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:18:23.151763 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:18:23.152846 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:18:23.153910 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:18:23.154989 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:18:23.157259 [info ] [MainThread]: 
[0m17:18:23.158707 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.46 seconds (4.46s).
[0m17:18:23.166736 [debug] [MainThread]: Command end result
[0m17:18:23.369983 [info ] [MainThread]: 
[0m17:18:23.371527 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:18:23.372739 [info ] [MainThread]: 
[0m17:18:23.373925 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:18:23.376250 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.2363873, "process_in_blocks": "0", "process_kernel_time": 0.685947, "process_mem_max_rss": "115180", "process_out_blocks": "9744", "process_user_time": 6.286028}
[0m17:18:23.377578 [debug] [MainThread]: Command `dbt build` succeeded at 17:18:23.377238 after 7.24 seconds
[0m17:18:23.378631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783ad871a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783ad3575730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783ad3575fa0>]}
[0m17:18:23.379673 [debug] [MainThread]: Flushing usage events
[0m17:19:16.215547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847e26b0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847df312be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847df312a90>]}


============================== 17:19:16.224969 | bce96b31-0fcb-470f-a94f-72428ba90d12 ==============================
[0m17:19:16.224969 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:19:16.226014 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'profiles_dir': '.', 'partial_parse': 'True', 'empty': 'False', 'static_parser': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'cache_selected_only': 'False', 'debug': 'False', 'printer_width': '80', 'version_check': 'True', 'introspect': 'True', 'warn_error': 'None', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_path': '/workdir/transforms/04_btc/logs', 'use_experimental_parser': 'False', 'use_colors': 'True', 'no_print': 'None', 'log_format': 'default', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'fail_fast': 'False'}
[0m17:19:16.756297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bce96b31-0fcb-470f-a94f-72428ba90d12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847df1df100>]}
[0m17:19:16.949252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bce96b31-0fcb-470f-a94f-72428ba90d12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847df1f0a90>]}
[0m17:19:16.950526 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:19:17.416043 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:19:17.926045 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:19:17.926732 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:19:18.128114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bce96b31-0fcb-470f-a94f-72428ba90d12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847dea77e80>]}
[0m17:19:18.606548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bce96b31-0fcb-470f-a94f-72428ba90d12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847de9e64f0>]}
[0m17:19:18.607463 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:19:18.610698 [info ] [MainThread]: 
[0m17:19:18.611703 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:19:18.623200 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:19:18.624844 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:19:18.729146 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:19:18.742899 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:19:19.315039 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:19:19.316485 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:19:19.320297 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:19:19.321653 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:19:19.350172 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:19:19.351423 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:19:19.413232 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:19:19.419525 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:19:19.429475 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:19:19.439005 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:19:19.450455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bce96b31-0fcb-470f-a94f-72428ba90d12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847de9d5880>]}
[0m17:19:19.452475 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:19:19.453916 [info ] [MainThread]: 
[0m17:19:19.526189 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:19:19.527479 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:19:19.528648 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:19:19.529503 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:19:19.546473 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:19:19.547747 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:19:19.722751 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:19:19.787798 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:19:19.789187 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:19:19.801369 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:19:19.929898 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:19:19.933572 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:19:19.935661 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:19:19.938810 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:19:19.944314 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:19:19.947090 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:19:19.948946 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:19:19.951885 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:19:20.043372 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:19:20.046767 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:19:20.052964 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bce96b31-0fcb-470f-a94f-72428ba90d12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847de645fa0>]}
[0m17:19:20.054109 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.52s]
[0m17:19:20.055424 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:19:20.106864 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:19:20.107889 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:19:20.108831 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:19:20.109684 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:19:20.110683 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:19:20.111617 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:19:20.112800 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:19:20.113776 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:19:20.114914 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:19:20.116104 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:19:20.116946 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:19:20.117713 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:19:20.146074 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:19:20.151159 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:19:20.212250 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:19:20.215004 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:19:20.216732 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:19:20.239581 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:19:20.518949 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:19:20.541766 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:19:20.544611 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:19:20.546608 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:19:20.548192 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:19:20.550327 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:19:20.829642 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:19:20.834616 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:19:20.837501 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:19:20.846856 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:19:20.908196 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:19:20.911017 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:19:20.925453 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.81s]
[0m17:19:20.927071 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.81s]
[0m17:19:20.934363 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.82s]
[0m17:19:20.938363 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:19:20.942205 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:19:20.945218 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:19:20.949474 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:19:20.950717 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:19:20.952733 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:19:20.954108 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:19:21.008489 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:19:21.010764 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:19:21.013225 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:19:21.015035 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:19:21.016768 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:19:21.018472 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:19:21.020186 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:19:21.032631 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:19:21.111635 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:19:21.115196 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:19:21.121938 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:19:21.123515 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:19:21.124327 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:19:21.140707 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:19:21.237512 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:19:21.406945 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:19:21.455476 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_bce96b31_0fcb_470f_a94f_72428ba90d12` 
  ...
[0m17:19:21.521224 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_bce96b31_0fcb_470f_a94f_72428ba90d12` 
  ...
[0m17:19:21.523106 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:19:21.524587 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:19:21.535562 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:19:21.542518 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:19:21.629961 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:19:21.710154 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_bce96b31_0fcb_470f_a94f_72428ba90d12`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:19:21.714730 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_bce96b31_0fcb_470f_a94f_72428ba90d12`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:19:21.717744 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:19:21.723410 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:19:21.733687 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:19:21.736669 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:19:21.738722 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:19:21.741644 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:19:21.748644 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:19:21.750035 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:19:21.752707 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:19:21.817649 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:19:21.822176 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_bce96b31_0fcb_470f_a94f_72428ba90d12'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:19:21.827126 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_bce96b31_0fcb_470f_a94f_72428ba90d12'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:19:21.829738 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bce96b31-0fcb-470f-a94f-72428ba90d12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847de656130>]}
[0m17:19:21.833244 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.81s]
[0m17:19:21.834840 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:19:21.836204 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:19:21.838028 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:19:21.846361 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:19:21.849598 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:19:21.851332 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_bce96b31_0fcb_470f_a94f_72428ba90d12`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:19:21.852386 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_bce96b31_0fcb_470f_a94f_72428ba90d12`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:19:21.868168 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:19:21.907663 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:19:21.909685 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_bce96b31_0fcb_470f_a94f_72428ba90d12`)
      
    ...
[0m17:19:21.911673 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_bce96b31_0fcb_470f_a94f_72428ba90d12`)
      
    ...
[0m17:19:21.930926 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:19:21.937522 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:19:21.938934 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:19:21.946146 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:19:21.947625 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:19:21.951652 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_bce96b31_0fcb_470f_a94f_72428ba90d12` 
    ...
[0m17:19:21.953890 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:19:21.956747 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_bce96b31_0fcb_470f_a94f_72428ba90d12` 
    ...
[0m17:19:21.959645 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:19:21.965877 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_bce96b31_0fcb_470f_a94f_72428ba90d12` 
  ...
[0m17:19:21.968021 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:19:22.007408 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:19:22.016032 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_bce96b31_0fcb_470f_a94f_72428ba90d12` 
  ...
[0m17:19:22.016931 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:19:22.020447 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:19:22.023768 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bce96b31-0fcb-470f-a94f-72428ba90d12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847de2d8fd0>]}
[0m17:19:22.024960 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:19:22.026103 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.01s]
[0m17:19:22.032202 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:19:22.033770 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:19:22.038590 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:19:22.043953 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bce96b31-0fcb-470f-a94f-72428ba90d12', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847de645c40>]}
[0m17:19:22.045881 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.03s]
[0m17:19:22.048225 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:19:22.051641 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:19:22.052877 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:19:22.054133 [debug] [MainThread]: On list__mart: Close
[0m17:19:22.055254 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:19:22.056415 [debug] [MainThread]: On list__clean: Close
[0m17:19:22.108370 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:19:22.110289 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:19:22.112147 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:19:22.114105 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:19:22.115491 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:19:22.116635 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:19:22.117689 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:19:22.119002 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:19:22.122625 [info ] [MainThread]: 
[0m17:19:22.124818 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.51 seconds (3.51s).
[0m17:19:22.134273 [debug] [MainThread]: Command end result
[0m17:19:22.351704 [info ] [MainThread]: 
[0m17:19:22.352942 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:19:22.353869 [info ] [MainThread]: 
[0m17:19:22.354899 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:19:22.407064 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.385359, "process_in_blocks": "0", "process_kernel_time": 0.678991, "process_mem_max_rss": "114548", "process_out_blocks": "9744", "process_user_time": 5.967612}
[0m17:19:22.408965 [debug] [MainThread]: Command `dbt build` succeeded at 17:19:22.408521 after 6.39 seconds
[0m17:19:22.410401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847e26b0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847dea71670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847e05cf2e0>]}
[0m17:19:22.411712 [debug] [MainThread]: Flushing usage events
[0m17:20:16.446909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c08e4993310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c08e15f5b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c08e15f5a00>]}


============================== 17:20:16.456308 | 04347974-6ba2-45d9-860d-88fe2b3c68ae ==============================
[0m17:20:16.456308 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:20:16.457399 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'no_print': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'log_path': '/workdir/transforms/04_btc/logs', 'version_check': 'True', 'cache_selected_only': 'False', 'debug': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'quiet': 'False', 'static_parser': 'True', 'fail_fast': 'False', 'log_format': 'default', 'use_experimental_parser': 'False', 'write_json': 'True', 'printer_width': '80', 'target_path': 'None', 'profiles_dir': '.'}
[0m17:20:17.049981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '04347974-6ba2-45d9-860d-88fe2b3c68ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c08e358e2b0>]}
[0m17:20:17.252559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '04347974-6ba2-45d9-860d-88fe2b3c68ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c08e15d1400>]}
[0m17:20:17.253961 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:20:17.738870 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:20:18.272430 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:20:18.273232 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:20:18.475895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04347974-6ba2-45d9-860d-88fe2b3c68ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c08e0d5de80>]}
[0m17:20:18.973415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04347974-6ba2-45d9-860d-88fe2b3c68ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c08e0d47550>]}
[0m17:20:18.974371 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:20:18.977674 [info ] [MainThread]: 
[0m17:20:18.978697 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:20:19.030822 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:20:19.037368 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:20:19.129370 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:20:19.130647 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:20:19.687638 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:20:19.693049 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:20:19.695091 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:20:19.705396 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:20:19.739397 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:20:19.741119 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:20:19.752940 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:20:19.757376 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:20:19.766769 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:20:19.776019 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:20:19.835896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '04347974-6ba2-45d9-860d-88fe2b3c68ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c08e48f3790>]}
[0m17:20:19.837866 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:20:19.839105 [info ] [MainThread]: 
[0m17:20:19.866364 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:20:19.867977 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:20:19.869513 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:20:19.870608 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:20:19.942908 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:20:19.944916 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:20:20.136571 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:20:20.205299 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:20:20.206730 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:20:20.218677 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:20:20.350971 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:20:20.354734 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:20:20.356748 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:20:20.359890 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:20:20.365608 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:20:20.368687 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:20:20.370906 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:20:20.373947 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:20:20.466249 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:20:20.469832 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:20:20.475817 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04347974-6ba2-45d9-860d-88fe2b3c68ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c08e0065f40>]}
[0m17:20:20.476947 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m17:20:20.478277 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:20:20.529916 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:20:20.531384 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:20:20.532977 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:20:20.534705 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:20:20.536505 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:20:20.538356 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:20:20.540749 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:20:20.542760 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:20:20.544837 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:20:20.546768 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:20:20.548313 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:20:20.549407 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:20:20.749976 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:20:20.743431 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:20:20.749090 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:20:20.752168 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:20:20.758154 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:20:20.833636 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:20:20.941850 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:20:20.943290 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:20:20.956310 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:20:20.958170 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:20:20.959876 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:20:20.961014 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:20:21.170083 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:20:21.182450 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:20:21.196751 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.65s]
[0m17:20:21.203434 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:20:21.230054 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:20:21.231992 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:20:21.246157 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:20:21.249016 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:20:21.254801 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.71s]
[0m17:20:21.260517 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.72s]
[0m17:20:21.264563 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:20:21.267861 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:20:21.271298 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:20:21.272645 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:20:21.274747 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:20:21.276054 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:20:21.277706 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:20:21.279119 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:20:21.281001 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:20:21.282202 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:20:21.283646 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:20:21.328750 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:20:21.329844 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:20:21.346713 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:20:21.370385 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:20:21.436818 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:20:21.450703 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:20:21.453510 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:20:21.460747 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:20:21.473178 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:20:21.635042 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:20:21.745758 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:20:21.849788 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m17:20:21.930955 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:20:22.050171 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m17:20:22.135754 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:20:22.141588 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_04347974_6ba2_45d9_860d_88fe2b3c68ae` 
  ...
[0m17:20:22.154816 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_04347974_6ba2_45d9_860d_88fe2b3c68ae` 
  ...
[0m17:20:22.158390 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:20:22.168049 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:20:22.240026 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:20:22.242665 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:20:22.373134 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:20:22.431079 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:20:22.538748 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:20:22.635711 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:20:22.667096 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:20:22.669902 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_04347974_6ba2_45d9_860d_88fe2b3c68ae`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:20:22.729002 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_04347974_6ba2_45d9_860d_88fe2b3c68ae`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:20:22.733486 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04347974-6ba2-45d9-860d-88fe2b3c68ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c08e0075a30>]}
[0m17:20:22.739789 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.40s]
[0m17:20:22.742797 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:20:22.771241 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:20:22.786975 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:20:22.863893 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_04347974_6ba2_45d9_860d_88fe2b3c68ae'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:20:22.866396 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_04347974_6ba2_45d9_860d_88fe2b3c68ae'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:20:22.929635 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:20:22.931070 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:20:22.944355 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:20:22.950109 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:20:22.953122 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_04347974_6ba2_45d9_860d_88fe2b3c68ae`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:20:22.955397 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_04347974_6ba2_45d9_860d_88fe2b3c68ae`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:20:22.987577 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:20:22.991156 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:20:22.996132 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_04347974_6ba2_45d9_860d_88fe2b3c68ae`)
      
    ...
[0m17:20:23.000657 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_04347974_6ba2_45d9_860d_88fe2b3c68ae`)
      
    ...
[0m17:20:23.055558 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:20:23.063905 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:20:23.066785 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:20:23.079277 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:20:23.084519 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:20:23.090806 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_04347974_6ba2_45d9_860d_88fe2b3c68ae` 
    ...
[0m17:20:23.093743 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:20:23.129474 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:20:23.134610 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_04347974_6ba2_45d9_860d_88fe2b3c68ae` 
    ...
[0m17:20:23.147194 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_04347974_6ba2_45d9_860d_88fe2b3c68ae` 
  ...
[0m17:20:23.158448 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:20:23.161256 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:20:23.175423 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:20:23.240603 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_04347974_6ba2_45d9_860d_88fe2b3c68ae` 
  ...
[0m17:20:23.245036 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:20:23.248008 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:20:23.254602 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04347974-6ba2-45d9-860d-88fe2b3c68ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c08df96fe20>]}
[0m17:20:23.267651 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.97s]
[0m17:20:23.269998 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:20:23.272843 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:20:23.329473 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:20:23.336655 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04347974-6ba2-45d9-860d-88fe2b3c68ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c08e00d8730>]}
[0m17:20:23.338959 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.06s]
[0m17:20:23.341712 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:20:23.345580 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:20:23.346721 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:20:23.347854 [debug] [MainThread]: On list__clean: Close
[0m17:20:23.348942 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:20:23.350088 [debug] [MainThread]: On list__mart: Close
[0m17:20:23.351218 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:20:23.352305 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:20:23.353371 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m17:20:23.354450 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m17:20:23.355491 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:20:23.356583 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:20:23.357622 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:20:23.358717 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:20:23.360958 [info ] [MainThread]: 
[0m17:20:23.362373 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.38 seconds (4.38s).
[0m17:20:23.370518 [debug] [MainThread]: Command end result
[0m17:20:23.558723 [info ] [MainThread]: 
[0m17:20:23.559520 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:20:23.560125 [info ] [MainThread]: 
[0m17:20:23.560809 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:20:23.562384 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.3096232, "process_in_blocks": "0", "process_kernel_time": 0.72429, "process_mem_max_rss": "114896", "process_out_blocks": "9744", "process_user_time": 6.326801}
[0m17:20:23.563294 [debug] [MainThread]: Command `dbt build` succeeded at 17:20:23.563020 after 7.31 seconds
[0m17:20:23.563930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c08e4993310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c08e3c620a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c08df9788b0>]}
[0m17:20:23.564510 [debug] [MainThread]: Flushing usage events
[0m17:21:16.328229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73aad655a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73aad31b6b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73aad31b6a00>]}


============================== 17:21:16.388137 | 677bd513-4beb-42bb-b435-e8de9d3eae3b ==============================
[0m17:21:16.388137 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:21:16.389267 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'write_json': 'True', 'debug': 'False', 'fail_fast': 'False', 'log_format': 'default', 'profiles_dir': '.', 'no_print': 'None', 'quiet': 'False', 'use_colors': 'True', 'cache_selected_only': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'use_experimental_parser': 'False', 'target_path': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error': 'None', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'printer_width': '80', 'introspect': 'True', 'log_cache_events': 'False', 'version_check': 'True', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True'}
[0m17:21:16.920249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '677bd513-4beb-42bb-b435-e8de9d3eae3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73aad30cf940>]}
[0m17:21:17.114045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '677bd513-4beb-42bb-b435-e8de9d3eae3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73aad3181310>]}
[0m17:21:17.115353 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:21:17.583087 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:21:18.089494 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:21:18.090158 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:21:18.291810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '677bd513-4beb-42bb-b435-e8de9d3eae3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73aad291deb0>]}
[0m17:21:18.729118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '677bd513-4beb-42bb-b435-e8de9d3eae3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73aad28124c0>]}
[0m17:21:18.729955 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:21:18.733115 [info ] [MainThread]: 
[0m17:21:18.734125 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:21:18.784321 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:21:18.796539 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:21:18.818321 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:21:18.886288 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:21:19.640476 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:21:19.648073 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:21:19.650176 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:21:19.656338 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:21:19.708335 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:21:19.709880 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:21:19.726127 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:21:19.783395 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:21:19.794559 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:21:19.796841 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:21:19.820525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '677bd513-4beb-42bb-b435-e8de9d3eae3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73aad31a72b0>]}
[0m17:21:19.822390 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:21:19.823802 [info ] [MainThread]: 
[0m17:21:19.897593 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:21:19.899177 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:21:19.900739 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:21:19.901719 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:21:19.922440 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:21:19.923673 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:21:20.117901 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:21:20.222293 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:21:20.223791 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:21:20.233503 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:21:20.326299 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:21:20.380493 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:21:20.382782 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:21:20.385690 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:21:20.391729 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:21:20.394642 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:21:20.396951 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:21:20.399682 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:21:20.495903 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:21:20.498933 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:21:20.505135 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '677bd513-4beb-42bb-b435-e8de9d3eae3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73aad1bb9d30>]}
[0m17:21:20.506359 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m17:21:20.507845 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:21:20.509468 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:21:20.510366 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:21:20.511152 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:21:20.512052 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:21:20.512913 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:21:20.513998 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:21:20.514900 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:21:20.515927 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:21:20.516702 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:21:20.517726 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:21:20.518678 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:21:20.584512 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:21:20.590777 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:21:20.597807 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:21:20.604792 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:21:20.606156 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:21:20.607050 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:21:20.612924 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:21:20.724650 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:21:20.726058 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:21:20.789564 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:21:20.790786 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:21:20.791522 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:21:20.792578 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:21:20.929278 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:21:20.937684 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:21:20.944942 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.43s]
[0m17:21:20.949236 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:21:20.955443 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:21:20.958234 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:21:20.963935 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:21:20.979726 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:21:20.982731 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.47s]
[0m17:21:20.985620 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.47s]
[0m17:21:20.987135 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:21:20.988457 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:21:20.990343 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:21:20.991373 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:21:20.993350 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:21:20.992620 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:21:20.994829 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:21:20.996511 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:21:20.997729 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:21:20.998481 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:21:20.999347 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:21:21.000597 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:21:21.001824 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:21:21.002970 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:21:21.023013 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:21:21.083210 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:21:21.094634 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:21:21.096507 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:21:21.112733 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:21:21.113738 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:21:21.285593 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:21:21.395063 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:21:21.485408 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:21:21.510177 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_677bd513_4beb_42bb_b435_e8de9d3eae3b` 
  ...
[0m17:21:21.525349 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:21:21.611137 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:21:21.621784 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_677bd513_4beb_42bb_b435_e8de9d3eae3b` 
  ...
[0m17:21:21.679679 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:21:21.720271 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:21:21.779249 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:21:21.802255 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:21:21.919977 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:21:22.009913 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_677bd513_4beb_42bb_b435_e8de9d3eae3b`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:21:22.007479 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_677bd513_4beb_42bb_b435_e8de9d3eae3b`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:21:22.013851 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:21:22.021480 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:21:22.028877 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:21:22.080862 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:21:22.083652 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:21:22.099001 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:21:22.209047 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:21:22.218057 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_677bd513_4beb_42bb_b435_e8de9d3eae3b'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:21:22.219930 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_677bd513_4beb_42bb_b435_e8de9d3eae3b'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:21:22.225122 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '677bd513-4beb-42bb-b435-e8de9d3eae3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73aad1cef070>]}
[0m17:21:22.283393 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.23s]
[0m17:21:22.286485 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:21:22.289184 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:21:22.291828 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:21:22.305369 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:21:22.310999 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:21:22.314302 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_677bd513_4beb_42bb_b435_e8de9d3eae3b`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:21:22.318030 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_677bd513_4beb_42bb_b435_e8de9d3eae3b`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:21:22.346814 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:21:22.380385 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_677bd513_4beb_42bb_b435_e8de9d3eae3b`)
      
    ...
[0m17:21:22.381188 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:21:22.385049 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_677bd513_4beb_42bb_b435_e8de9d3eae3b`)
      
    ...
[0m17:21:22.400778 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:21:22.406023 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:21:22.407403 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:21:22.413656 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:21:22.415067 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:21:22.419461 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_677bd513_4beb_42bb_b435_e8de9d3eae3b` 
    ...
[0m17:21:22.421406 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:21:22.425127 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_677bd513_4beb_42bb_b435_e8de9d3eae3b` 
    ...
[0m17:21:22.427610 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:21:22.433970 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_677bd513_4beb_42bb_b435_e8de9d3eae3b` 
  ...
[0m17:21:22.435300 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:21:22.485135 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:21:22.488296 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_677bd513_4beb_42bb_b435_e8de9d3eae3b` 
  ...
[0m17:21:22.501222 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:21:22.507805 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:21:22.520965 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:21:22.523585 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:21:22.581407 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '677bd513-4beb-42bb-b435-e8de9d3eae3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73aad1d718b0>]}
[0m17:21:22.586243 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.58s]
[0m17:21:22.590810 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:21:22.594473 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:21:22.602313 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '677bd513-4beb-42bb-b435-e8de9d3eae3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73aad2440850>]}
[0m17:21:22.605155 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.60s]
[0m17:21:22.607950 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:21:22.611983 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:21:22.613185 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:21:22.614339 [debug] [MainThread]: On list__mart: Close
[0m17:21:22.615398 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:21:22.616526 [debug] [MainThread]: On list__clean: Close
[0m17:21:22.617613 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:21:22.618689 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:21:22.619728 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:21:22.620835 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:21:22.621874 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:21:22.622997 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:21:22.624139 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:21:22.625271 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:21:22.678502 [info ] [MainThread]: 
[0m17:21:22.680095 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.89 seconds (3.89s).
[0m17:21:22.688389 [debug] [MainThread]: Command end result
[0m17:21:22.895234 [info ] [MainThread]: 
[0m17:21:22.896059 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:21:22.896638 [info ] [MainThread]: 
[0m17:21:22.897234 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:21:22.898500 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.7136774, "process_in_blocks": "0", "process_kernel_time": 0.678001, "process_mem_max_rss": "114952", "process_out_blocks": "9744", "process_user_time": 6.11581}
[0m17:21:22.899212 [debug] [MainThread]: Command `dbt build` succeeded at 17:21:22.899027 after 6.71 seconds
[0m17:21:22.899821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73aad655a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73aad3181310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73aad14544c0>]}
[0m17:21:22.900402 [debug] [MainThread]: Flushing usage events
[0m17:22:17.547242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eb6af67e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eb67bc2b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eb67bc2a30>]}


============================== 17:22:17.556825 | 5a99dece-4d97-4256-9579-c9e0b5d3e9ba ==============================
[0m17:22:17.556825 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:22:17.557845 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'no_print': 'None', 'use_experimental_parser': 'False', 'introspect': 'True', 'debug': 'False', 'quiet': 'False', 'profiles_dir': '.', 'log_path': '/workdir/transforms/04_btc/logs', 'fail_fast': 'False', 'partial_parse': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'version_check': 'True', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'indirect_selection': 'eager', 'use_colors': 'True', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'empty': 'False', 'log_format': 'default'}
[0m17:22:18.132923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5a99dece-4d97-4256-9579-c9e0b5d3e9ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eb67a8edc0>]}
[0m17:22:18.327025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5a99dece-4d97-4256-9579-c9e0b5d3e9ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eb6800b4f0>]}
[0m17:22:18.328255 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:22:18.736648 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:22:19.241389 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:22:19.242074 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:22:19.441193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5a99dece-4d97-4256-9579-c9e0b5d3e9ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eb67326e20>]}
[0m17:22:19.917194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5a99dece-4d97-4256-9579-c9e0b5d3e9ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eb67364b50>]}
[0m17:22:19.918146 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:22:19.921722 [info ] [MainThread]: 
[0m17:22:19.922760 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:22:19.934590 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:22:19.935550 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:22:19.963792 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:22:20.029303 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:22:20.829155 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:22:20.832072 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:22:20.835638 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:22:20.837548 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:22:20.921465 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:22:20.922931 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:22:20.937979 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:22:20.943506 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:22:20.951892 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:22:20.961199 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:22:21.024110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5a99dece-4d97-4256-9579-c9e0b5d3e9ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eb67898cd0>]}
[0m17:22:21.026083 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:22:21.027356 [info ] [MainThread]: 
[0m17:22:21.054260 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:22:21.055436 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:22:21.056513 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:22:21.057250 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:22:21.125785 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:22:21.127148 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:22:21.326741 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:22:21.390114 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:22:21.391477 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:22:21.403856 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:22:21.540884 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:22:21.544950 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:22:21.546856 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:22:21.549672 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:22:21.555138 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:22:21.557948 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:22:21.560047 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:22:21.563100 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:22:21.655142 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:22:21.658660 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:22:21.664452 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5a99dece-4d97-4256-9579-c9e0b5d3e9ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eb66637ee0>]}
[0m17:22:21.665635 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m17:22:21.667021 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:22:21.718682 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:22:21.720358 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:22:21.722131 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:22:21.723789 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:22:21.725262 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:22:21.726925 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:22:21.729387 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:22:21.731450 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:22:21.733529 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:22:21.735422 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:22:21.737136 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:22:21.738853 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:22:21.936584 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:22:21.937805 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:22:21.946003 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:22:21.948842 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:22:21.956166 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:22:21.963112 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:22:22.221014 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:22:22.232067 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:22:22.252548 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:22:22.254449 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:22:22.257199 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:22:22.259955 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:22:22.536694 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:22:22.543459 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:22:22.555152 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:22:22.617157 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:22:22.620429 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:22:22.624465 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.90s]
[0m17:22:22.630507 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.90s]
[0m17:22:22.634776 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:22:22.638814 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:22:22.642832 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:22:22.648727 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.92s]
[0m17:22:22.651523 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:22:22.654376 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:22:22.655688 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:22:22.657290 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:22:22.658693 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:22:22.660892 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:22:22.662481 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:22:22.664235 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:22:22.665969 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:22:22.718196 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:22:22.720016 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:22:22.721655 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:22:22.738859 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:22:22.763551 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:22:22.844864 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:22:22.846387 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:22:22.849248 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:22:22.923456 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:22:22.929878 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:22:22.947694 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:22:23.059584 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:22:23.232875 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m17:22:23.332760 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:22:23.438241 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:22:23.454590 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5a99dece_4d97_4256_9579_c9e0b5d3e9ba` 
  ...
[0m17:22:23.456596 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:22:23.519165 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5a99dece_4d97_4256_9579_c9e0b5d3e9ba` 
  ...
[0m17:22:23.522937 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:22:23.525370 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:22:23.552612 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:22:23.558848 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:22:23.717952 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:22:23.719174 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_5a99dece_4d97_4256_9579_c9e0b5d3e9ba`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:22:23.722470 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_5a99dece_4d97_4256_9579_c9e0b5d3e9ba`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:22:23.724637 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:22:23.730590 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:22:23.738550 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:22:23.741621 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:22:23.744162 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5a99dece-4d97-4256-9579-c9e0b5d3e9ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eb65f624f0>]}
[0m17:22:23.745298 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.02s]
[0m17:22:23.746761 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:22:23.750519 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:22:23.765245 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:22:23.767890 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_5a99dece_4d97_4256_9579_c9e0b5d3e9ba'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:22:23.820528 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_5a99dece_4d97_4256_9579_c9e0b5d3e9ba'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:22:23.825688 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:22:23.827051 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:22:23.833242 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:22:23.835915 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:22:23.837304 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_5a99dece_4d97_4256_9579_c9e0b5d3e9ba`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:22:23.838384 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_5a99dece_4d97_4256_9579_c9e0b5d3e9ba`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:22:23.852576 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:22:23.853899 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:22:23.856572 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5a99dece_4d97_4256_9579_c9e0b5d3e9ba`)
      
    ...
[0m17:22:23.858682 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5a99dece_4d97_4256_9579_c9e0b5d3e9ba`)
      
    ...
[0m17:22:23.877524 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:22:23.884305 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:22:23.886722 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:22:23.891819 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:22:23.893304 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:22:23.920855 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5a99dece_4d97_4256_9579_c9e0b5d3e9ba` 
    ...
[0m17:22:23.922740 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:22:23.926912 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5a99dece_4d97_4256_9579_c9e0b5d3e9ba` 
    ...
[0m17:22:23.929164 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:22:23.939390 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5a99dece_4d97_4256_9579_c9e0b5d3e9ba` 
  ...
[0m17:22:23.941106 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:22:23.949083 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5a99dece_4d97_4256_9579_c9e0b5d3e9ba` 
  ...
[0m17:22:23.950784 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:22:23.961369 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:22:23.964302 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:22:24.023112 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:22:24.024398 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:22:24.030180 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5a99dece-4d97-4256-9579-c9e0b5d3e9ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eb65f62820>]}
[0m17:22:24.031812 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:22:24.033295 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.36s]
[0m17:22:24.036828 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5a99dece-4d97-4256-9579-c9e0b5d3e9ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eb666b6ca0>]}
[0m17:22:24.038502 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:22:24.040039 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.37s]
[0m17:22:24.041813 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:22:24.043892 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:22:24.044439 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:22:24.044962 [debug] [MainThread]: On list__clean: Close
[0m17:22:24.045431 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:22:24.045946 [debug] [MainThread]: On list__mart: Close
[0m17:22:24.046391 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:22:24.046915 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:22:24.047361 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:22:24.047876 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:22:24.048355 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:22:24.048843 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:22:24.049313 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:22:24.049820 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:22:24.051046 [info ] [MainThread]: 
[0m17:22:24.051849 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.13 seconds (4.13s).
[0m17:22:24.055612 [debug] [MainThread]: Command end result
[0m17:22:24.163668 [info ] [MainThread]: 
[0m17:22:24.164600 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:22:24.165280 [info ] [MainThread]: 
[0m17:22:24.166013 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:22:24.217829 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.86141, "process_in_blocks": "0", "process_kernel_time": 0.666069, "process_mem_max_rss": "115296", "process_out_blocks": "9744", "process_user_time": 6.060335}
[0m17:22:24.218775 [debug] [MainThread]: Command `dbt build` succeeded at 17:22:24.218563 after 6.86 seconds
[0m17:22:24.219398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eb6af67e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eb68deef70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eb6800b4f0>]}
[0m17:22:24.220022 [debug] [MainThread]: Flushing usage events
[0m17:23:16.359353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1d48834310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1d45498a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1d45498940>]}


============================== 17:23:16.368665 | 1cc2c990-80f5-469a-a004-19e82843a3a6 ==============================
[0m17:23:16.368665 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:23:16.369774 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'use_experimental_parser': 'False', 'write_json': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'static_parser': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'version_check': 'True', 'log_cache_events': 'False', 'log_format': 'default', 'no_print': 'None', 'introspect': 'True', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'printer_width': '80', 'cache_selected_only': 'False', 'profiles_dir': '.', 'empty': 'False', 'use_colors': 'True', 'quiet': 'False', 'indirect_selection': 'eager'}
[0m17:23:16.949592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1cc2c990-80f5-469a-a004-19e82843a3a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1d47dd7fd0>]}
[0m17:23:17.144914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1cc2c990-80f5-469a-a004-19e82843a3a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1d45f7a430>]}
[0m17:23:17.146187 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:23:17.556952 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:23:18.061572 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:23:18.062234 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:23:18.263979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1cc2c990-80f5-469a-a004-19e82843a3a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1d44c00f10>]}
[0m17:23:18.740802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1cc2c990-80f5-469a-a004-19e82843a3a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1d47a71c70>]}
[0m17:23:18.741673 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:23:18.744872 [info ] [MainThread]: 
[0m17:23:18.745878 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:23:18.757783 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:23:18.764335 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:23:18.871156 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:23:18.878796 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:23:19.503186 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:23:19.506800 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:23:19.509852 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:23:19.513758 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:23:19.549229 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:23:19.550272 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:23:19.561717 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:23:19.566192 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:23:19.573468 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:23:19.574772 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:23:19.633157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1cc2c990-80f5-469a-a004-19e82843a3a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1d44749f10>]}
[0m17:23:19.634243 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:23:19.634957 [info ] [MainThread]: 
[0m17:23:19.647831 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:23:19.649034 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:23:19.650234 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:23:19.651049 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:23:19.668933 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:23:19.670184 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:23:19.840419 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:23:19.900584 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:23:19.902027 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:23:19.912330 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:23:20.049859 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:23:20.052801 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:23:20.054814 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:23:20.057515 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:23:20.063423 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:23:20.066151 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:23:20.068101 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:23:20.070770 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:23:20.166392 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:23:20.169566 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:23:20.175670 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1cc2c990-80f5-469a-a004-19e82843a3a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1d43fbf790>]}
[0m17:23:20.176870 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.52s]
[0m17:23:20.178209 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:23:20.179842 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:23:20.180603 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:23:20.181498 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:23:20.231294 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:23:20.232470 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:23:20.233905 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:23:20.234953 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:23:20.236204 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:23:20.237073 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:23:20.238012 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:23:20.238796 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:23:20.260094 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:23:20.265389 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:23:20.272527 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:23:20.331982 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:23:20.334681 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:23:20.336606 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:23:20.338058 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:23:20.655479 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:23:20.657421 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:23:20.667210 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:23:20.669625 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:23:20.673116 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:23:20.675831 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:23:20.945514 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:23:20.959329 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:23:20.977634 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.74s]
[0m17:23:20.983622 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:23:21.031162 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:23:21.037194 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:23:21.042680 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:23:21.047257 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.81s]
[0m17:23:21.049610 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:23:21.051469 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:23:21.056705 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.82s]
[0m17:23:21.059693 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:23:21.061899 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:23:21.062719 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:23:21.063665 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:23:21.064938 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:23:21.066229 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:23:21.067474 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:23:21.068454 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:23:21.069366 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:23:21.070274 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:23:21.071189 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:23:21.072098 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:23:21.073069 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:23:21.241584 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:23:21.245317 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:23:21.253895 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:23:21.256267 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:23:21.257982 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:23:21.270478 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:23:21.355132 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:23:21.457136 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:23:21.562511 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m17:23:21.646922 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:23:21.736987 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:23:21.756962 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:23:21.843768 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:23:21.931287 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:23:22.047158 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:23:22.061915 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:23:22.145335 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:23:22.169305 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_1cc2c990_80f5_469a_a004_19e82843a3a6` 
  ...
[0m17:23:22.233657 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:23:22.238646 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_1cc2c990_80f5_469a_a004_19e82843a3a6` 
  ...
[0m17:23:22.241786 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:23:22.249636 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:23:22.252475 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:23:22.267953 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1cc2c990-80f5-469a-a004-19e82843a3a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1d4381abe0>]}
[0m17:23:22.367644 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.20s]
[0m17:23:22.447563 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:23:22.648251 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_1cc2c990_80f5_469a_a004_19e82843a3a6`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:23:22.651365 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_1cc2c990_80f5_469a_a004_19e82843a3a6`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:23:22.683894 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:23:22.700922 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:23:22.759434 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_1cc2c990_80f5_469a_a004_19e82843a3a6'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:23:22.761125 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_1cc2c990_80f5_469a_a004_19e82843a3a6'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:23:22.770243 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:23:22.772852 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:23:22.833380 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:23:22.837631 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:23:22.839166 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_1cc2c990_80f5_469a_a004_19e82843a3a6`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:23:22.841158 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_1cc2c990_80f5_469a_a004_19e82843a3a6`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:23:22.854711 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:23:22.855911 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:23:22.857958 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_1cc2c990_80f5_469a_a004_19e82843a3a6`)
      
    ...
[0m17:23:22.859860 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_1cc2c990_80f5_469a_a004_19e82843a3a6`)
      
    ...
[0m17:23:22.884669 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:23:22.895293 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:23:22.896776 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:23:22.903164 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:23:22.906080 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:23:22.932058 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:23:22.910046 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_1cc2c990_80f5_469a_a004_19e82843a3a6` 
    ...
[0m17:23:22.939230 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_1cc2c990_80f5_469a_a004_19e82843a3a6` 
    ...
[0m17:23:22.950057 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:23:22.958739 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:23:22.967622 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_1cc2c990_80f5_469a_a004_19e82843a3a6` 
  ...
[0m17:23:22.979276 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_1cc2c990_80f5_469a_a004_19e82843a3a6` 
  ...
[0m17:23:23.031956 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:23:23.034577 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:23:23.047341 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:23:23.061848 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:23:23.066674 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:23:23.074587 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:23:23.076179 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1cc2c990-80f5-469a-a004-19e82843a3a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1d43faa670>]}
[0m17:23:23.134371 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1cc2c990-80f5-469a-a004-19e82843a3a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1d437cf070>]}
[0m17:23:23.136989 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.01s]
[0m17:23:23.139473 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.06s]
[0m17:23:23.142601 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:23:23.145482 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:23:23.150364 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:23:23.151516 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:23:23.152680 [debug] [MainThread]: On list__mart: Close
[0m17:23:23.153842 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:23:23.155030 [debug] [MainThread]: On list__clean: Close
[0m17:23:23.156172 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:23:23.157260 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:23:23.158304 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m17:23:23.159388 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m17:23:23.160428 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:23:23.161498 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:23:23.162561 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:23:23.163746 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:23:23.165991 [info ] [MainThread]: 
[0m17:23:23.167303 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.42 seconds (4.42s).
[0m17:23:23.175323 [debug] [MainThread]: Command end result
[0m17:23:23.434241 [info ] [MainThread]: 
[0m17:23:23.435958 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:23:23.437181 [info ] [MainThread]: 
[0m17:23:23.438516 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:23:23.441140 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.279124, "process_in_blocks": "0", "process_kernel_time": 0.680659, "process_mem_max_rss": "114560", "process_out_blocks": "9744", "process_user_time": 6.514885}
[0m17:23:23.442709 [debug] [MainThread]: Command `dbt build` succeeded at 17:23:23.442278 after 7.28 seconds
[0m17:23:23.444030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1d48834310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1d47dd7fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e1d43726f70>]}
[0m17:23:23.445283 [debug] [MainThread]: Flushing usage events
[0m17:24:16.205123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75362a036310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753626c95b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753626c95a00>]}


============================== 17:24:16.214734 | 5b040361-0356-4c54-a3fd-f8a86654be39 ==============================
[0m17:24:16.214734 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:24:16.215809 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'warn_error': 'None', 'printer_width': '80', 'use_colors': 'True', 'version_check': 'True', 'fail_fast': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'target_path': 'None', 'log_format': 'default', 'use_experimental_parser': 'False', 'introspect': 'True', 'write_json': 'True', 'debug': 'False', 'quiet': 'False'}
[0m17:24:16.804409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5b040361-0356-4c54-a3fd-f8a86654be39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753626bf8fa0>]}
[0m17:24:17.001208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5b040361-0356-4c54-a3fd-f8a86654be39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753626c683d0>]}
[0m17:24:17.002855 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:24:17.421038 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:24:17.924212 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:24:17.924860 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:24:18.126146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5b040361-0356-4c54-a3fd-f8a86654be39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7536263fae80>]}
[0m17:24:18.627503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5b040361-0356-4c54-a3fd-f8a86654be39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75362640f670>]}
[0m17:24:18.628341 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:24:18.631582 [info ] [MainThread]: 
[0m17:24:18.632608 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:24:18.644397 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:24:18.687062 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:24:18.734363 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:24:18.795731 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:24:19.545315 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:24:19.551001 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:24:19.553412 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:24:19.596559 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:24:19.686087 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:24:19.687705 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:24:19.703194 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:24:19.709065 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:24:19.718840 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:24:19.728333 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:24:19.788882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5b040361-0356-4c54-a3fd-f8a86654be39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753625f3c370>]}
[0m17:24:19.791010 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:24:19.792490 [info ] [MainThread]: 
[0m17:24:19.819434 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:24:19.820538 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:24:19.821590 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:24:19.822297 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:24:19.888309 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:24:19.889849 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:24:20.019747 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:24:20.126507 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:24:20.127882 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:24:20.140528 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:24:20.223217 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:24:20.226562 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:24:20.228728 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:24:20.231739 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:24:20.237327 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:24:20.288040 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:24:20.290014 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:24:20.293129 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:24:20.387998 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:24:20.391451 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:24:20.398076 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5b040361-0356-4c54-a3fd-f8a86654be39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7536257793a0>]}
[0m17:24:20.399268 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.58s]
[0m17:24:20.400686 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:24:20.402940 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:24:20.403956 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:24:20.405135 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:24:20.406860 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:24:20.408277 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:24:20.410769 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:24:20.412360 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:24:20.414256 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:24:20.415951 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:24:20.418042 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:24:20.419845 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:24:20.490764 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:24:20.522987 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:24:20.533433 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:24:20.592933 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:24:20.594664 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:24:20.595404 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:24:20.628289 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:24:20.629609 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:24:20.632380 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:24:20.692354 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:24:20.694788 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:24:20.697442 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:24:20.700934 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:24:20.960667 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:24:20.970833 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:24:20.986560 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:24:21.003905 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.59s]
[0m17:24:21.007770 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:24:21.011387 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:24:21.016217 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:24:21.023070 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.61s]
[0m17:24:21.026094 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:24:21.029702 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:24:21.087364 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.67s]
[0m17:24:21.090417 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:24:21.093246 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:24:21.094368 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:24:21.096005 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:24:21.097299 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:24:21.099430 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:24:21.101057 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:24:21.103028 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:24:21.104817 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:24:21.106380 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:24:21.108115 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:24:21.109791 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:24:21.127001 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:24:21.220385 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:24:21.225103 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:24:21.289499 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:24:21.292379 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:24:21.294084 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:24:21.306408 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:24:21.492181 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:24:21.623543 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:24:21.732323 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:24:21.890913 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:24:21.921274 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:24:21.998650 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:24:21.999947 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5b040361_0356_4c54_a3fd_f8a86654be39` 
  ...
[0m17:24:22.008023 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5b040361_0356_4c54_a3fd_f8a86654be39` 
  ...
[0m17:24:22.012773 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:24:22.017195 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:24:22.030166 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:24:22.032699 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:24:22.192290 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:24:22.212170 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:24:22.312182 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:24:22.394349 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:24:22.406935 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_5b040361_0356_4c54_a3fd_f8a86654be39`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:24:22.408085 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_5b040361_0356_4c54_a3fd_f8a86654be39`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:24:22.412265 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:24:22.417945 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5b040361-0356-4c54-a3fd-f8a86654be39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753625f6f850>]}
[0m17:24:22.420221 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.31s]
[0m17:24:22.422403 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:24:22.439520 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:24:22.485752 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:24:22.494278 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_5b040361_0356_4c54_a3fd_f8a86654be39'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:24:22.499194 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_5b040361_0356_4c54_a3fd_f8a86654be39'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:24:22.504472 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:24:22.505992 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:24:22.512233 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:24:22.514956 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:24:22.516380 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_5b040361_0356_4c54_a3fd_f8a86654be39`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:24:22.517405 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_5b040361_0356_4c54_a3fd_f8a86654be39`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:24:22.533895 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:24:22.535223 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:24:22.537279 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5b040361_0356_4c54_a3fd_f8a86654be39`)
      
    ...
[0m17:24:22.539195 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5b040361_0356_4c54_a3fd_f8a86654be39`)
      
    ...
[0m17:24:22.555322 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:24:22.586759 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:24:22.588174 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:24:22.594273 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:24:22.596882 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:24:22.599870 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5b040361_0356_4c54_a3fd_f8a86654be39` 
    ...
[0m17:24:22.601982 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:24:22.604876 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5b040361_0356_4c54_a3fd_f8a86654be39` 
    ...
[0m17:24:22.607149 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:24:22.613093 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5b040361_0356_4c54_a3fd_f8a86654be39` 
  ...
[0m17:24:22.616787 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:24:22.617993 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:24:22.623901 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:24:22.629543 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5b040361_0356_4c54_a3fd_f8a86654be39` 
  ...
[0m17:24:22.633134 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:24:22.685690 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:24:22.688094 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5b040361-0356-4c54-a3fd-f8a86654be39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753625f6f5e0>]}
[0m17:24:22.694056 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:24:22.695951 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.58s]
[0m17:24:22.698700 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:24:22.700163 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:24:22.703607 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5b040361-0356-4c54-a3fd-f8a86654be39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753625779370>]}
[0m17:24:22.704700 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.60s]
[0m17:24:22.706045 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:24:22.708028 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:24:22.708586 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:24:22.709091 [debug] [MainThread]: On list__mart: Close
[0m17:24:22.709571 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:24:22.710051 [debug] [MainThread]: On list__clean: Close
[0m17:24:22.710523 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:24:22.711015 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:24:22.711460 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:24:22.711960 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:24:22.712402 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:24:22.712892 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:24:22.713336 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m17:24:22.713858 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m17:24:22.714938 [info ] [MainThread]: 
[0m17:24:22.715602 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.08 seconds (4.08s).
[0m17:24:22.719245 [debug] [MainThread]: Command end result
[0m17:24:22.824286 [info ] [MainThread]: 
[0m17:24:22.825243 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:24:22.825891 [info ] [MainThread]: 
[0m17:24:22.826594 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:24:22.827907 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.8153014, "process_in_blocks": "0", "process_kernel_time": 0.679219, "process_mem_max_rss": "114488", "process_out_blocks": "9744", "process_user_time": 6.096995}
[0m17:24:22.828665 [debug] [MainThread]: Command `dbt build` succeeded at 17:24:22.828443 after 6.82 seconds
[0m17:24:22.829274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75362a036310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753627f52910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x753627f55160>]}
[0m17:24:22.829879 [debug] [MainThread]: Flushing usage events
[0m17:25:16.166065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2006f29310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2003b8fb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2003b8f9d0>]}


============================== 17:25:16.175710 | a4ba991c-b285-4416-8b5d-20916afc575c ==============================
[0m17:25:16.175710 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:25:16.176797 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'log_format': 'default', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt build --profiles-dir . --target local', 'printer_width': '80', 'use_colors': 'True', 'target_path': 'None', 'no_print': 'None', 'empty': 'False', 'version_check': 'True', 'log_cache_events': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'introspect': 'True', 'quiet': 'False', 'cache_selected_only': 'False'}
[0m17:25:16.758307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a4ba991c-b285-4416-8b5d-20916afc575c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d20039dbcd0>]}
[0m17:25:16.951155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a4ba991c-b285-4416-8b5d-20916afc575c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2004d9ce20>]}
[0m17:25:16.952428 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:25:17.368454 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:25:17.872341 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:25:17.873004 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:25:18.070099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a4ba991c-b285-4416-8b5d-20916afc575c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d20032e5eb0>]}
[0m17:25:18.549698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a4ba991c-b285-4416-8b5d-20916afc575c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d20031d04c0>]}
[0m17:25:18.550612 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:25:18.553957 [info ] [MainThread]: 
[0m17:25:18.555078 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:25:18.566896 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:25:18.567934 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:25:18.644015 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:25:18.646296 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:25:19.096761 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:25:19.102138 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:25:19.104387 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:25:19.116456 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:25:19.152396 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:25:19.153395 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:25:19.168301 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:25:19.172426 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:25:19.180490 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:25:19.188487 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:25:19.243243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a4ba991c-b285-4416-8b5d-20916afc575c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2006e807c0>]}
[0m17:25:19.244208 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:25:19.244877 [info ] [MainThread]: 
[0m17:25:19.257701 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:25:19.258874 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:25:19.259949 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:25:19.260729 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:25:19.277352 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:25:19.278665 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:25:19.453211 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:25:19.517890 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:25:19.519227 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:25:19.531039 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:25:19.662053 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:25:19.666156 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:25:19.668425 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:25:19.671551 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:25:19.677061 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:25:19.679825 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:25:19.681611 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:25:19.684503 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:25:19.777679 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:25:19.781298 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:25:19.787191 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4ba991c-b285-4416-8b5d-20916afc575c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d20031a5d30>]}
[0m17:25:19.837140 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m17:25:19.838578 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:25:19.840581 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:25:19.841707 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:25:19.843134 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:25:19.844405 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:25:19.846233 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:25:19.848107 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:25:19.849279 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:25:19.851284 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:25:19.852611 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:25:19.854140 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:25:19.855768 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:25:19.868420 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:25:19.878940 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:25:19.953103 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:25:19.957398 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:25:19.959988 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:25:19.961583 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:25:19.979128 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:25:20.269960 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:25:20.283587 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:25:20.285106 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:25:20.338386 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:25:20.340623 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:25:20.342660 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:25:20.597347 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:25:20.613056 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:25:20.650059 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.80s]
[0m17:25:20.655327 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:25:20.658105 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:25:20.663310 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:25:20.675778 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:25:20.681703 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.83s]
[0m17:25:20.684578 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:25:20.687398 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:25:20.740229 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.89s]
[0m17:25:20.743077 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:25:20.745853 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:25:20.747098 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:25:20.748794 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:25:20.750601 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:25:20.752214 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:25:20.754484 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:25:20.756298 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:25:20.757937 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:25:20.759499 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:25:20.761130 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:25:20.762867 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:25:20.764609 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:25:20.873238 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:25:20.874292 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:25:20.877945 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:25:20.879251 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:25:20.880057 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:25:20.941965 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:25:20.981844 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:25:21.157492 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:25:21.247964 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:25:21.366142 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:25:21.537699 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:25:21.547213 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:25:21.653264 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:25:21.756506 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:25:21.849630 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_a4ba991c_b285_4416_8b5d_20916afc575c` 
  ...
[0m17:25:21.851098 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_a4ba991c_b285_4416_8b5d_20916afc575c` 
  ...
[0m17:25:21.853884 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:25:21.859497 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:25:21.863955 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:25:21.866944 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:25:21.959238 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:25:22.144126 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:25:22.243190 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:25:22.277728 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_a4ba991c_b285_4416_8b5d_20916afc575c`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:25:22.282002 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_a4ba991c_b285_4416_8b5d_20916afc575c`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:25:22.274921 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4ba991c-b285-4416-8b5d-20916afc575c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2002e1f940>]}
[0m17:25:22.341446 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.52s]
[0m17:25:22.346568 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:25:22.369799 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:25:22.384852 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:25:22.457903 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_a4ba991c_b285_4416_8b5d_20916afc575c'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:25:22.459835 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_a4ba991c_b285_4416_8b5d_20916afc575c'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:25:22.470779 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:25:22.475246 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:25:22.539639 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:25:22.545267 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:25:22.548162 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_a4ba991c_b285_4416_8b5d_20916afc575c`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:25:22.550449 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_a4ba991c_b285_4416_8b5d_20916afc575c`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:25:22.580709 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:25:22.583900 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:25:22.589235 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_a4ba991c_b285_4416_8b5d_20916afc575c`)
      
    ...
[0m17:25:22.594004 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_a4ba991c_b285_4416_8b5d_20916afc575c`)
      
    ...
[0m17:25:22.616985 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:25:22.637662 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:25:22.643835 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:25:22.646064 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:25:22.653255 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:25:22.654694 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:25:22.657559 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_a4ba991c_b285_4416_8b5d_20916afc575c` 
    ...
[0m17:25:22.660267 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_a4ba991c_b285_4416_8b5d_20916afc575c` 
    ...
[0m17:25:22.667335 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:25:22.668671 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:25:22.675551 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_a4ba991c_b285_4416_8b5d_20916afc575c` 
  ...
[0m17:25:22.681711 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_a4ba991c_b285_4416_8b5d_20916afc575c` 
  ...
[0m17:25:22.686278 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:25:22.688094 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:25:22.742021 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:25:22.752949 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:25:22.757998 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:25:22.760230 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:25:22.765052 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4ba991c-b285-4416-8b5d-20916afc575c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2002e1ff10>]}
[0m17:25:22.771908 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4ba991c-b285-4416-8b5d-20916afc575c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2001ee68b0>]}
[0m17:25:22.773804 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.01s]
[0m17:25:22.775912 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.02s]
[0m17:25:22.778698 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:25:22.781900 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:25:22.836841 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:25:22.838217 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:25:22.839395 [debug] [MainThread]: On list__mart: Close
[0m17:25:22.840519 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:25:22.841624 [debug] [MainThread]: On list__clean: Close
[0m17:25:22.842667 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:25:22.843766 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:25:22.844809 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:25:22.845997 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:25:22.847066 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:25:22.848238 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:25:22.849413 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:25:22.850490 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:25:22.852872 [info ] [MainThread]: 
[0m17:25:22.854273 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.30 seconds (4.30s).
[0m17:25:22.862212 [debug] [MainThread]: Command end result
[0m17:25:23.061740 [info ] [MainThread]: 
[0m17:25:23.063194 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:25:23.064282 [info ] [MainThread]: 
[0m17:25:23.065399 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:25:23.067570 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.0943813, "process_in_blocks": "0", "process_kernel_time": 0.671784, "process_mem_max_rss": "114348", "process_out_blocks": "9744", "process_user_time": 6.26833}
[0m17:25:23.068792 [debug] [MainThread]: Command `dbt build` succeeded at 17:25:23.068457 after 7.10 seconds
[0m17:25:23.069856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2006f29310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2003b48670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2004d9ce20>]}
[0m17:25:23.070832 [debug] [MainThread]: Flushing usage events
[0m17:26:15.757989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785696f5c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785693bc8b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785693bc8a00>]}


============================== 17:26:15.767280 | 532edf0e-b5b0-4445-8d1a-f6f683ffe2d3 ==============================
[0m17:26:15.767280 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:26:15.768384 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'printer_width': '80', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'log_cache_events': 'False', 'introspect': 'True', 'use_experimental_parser': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'fail_fast': 'False', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'log_format': 'default', 'static_parser': 'True', 'write_json': 'True', 'use_colors': 'True', 'warn_error': 'None', 'debug': 'False', 'empty': 'False', 'version_check': 'True', 'target_path': 'None', 'profiles_dir': '.', 'invocation_command': 'dbt build --profiles-dir . --target local', 'partial_parse': 'True'}
[0m17:26:16.354845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '532edf0e-b5b0-4445-8d1a-f6f683ffe2d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7856956a85b0>]}
[0m17:26:16.548240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '532edf0e-b5b0-4445-8d1a-f6f683ffe2d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785694022ca0>]}
[0m17:26:16.549582 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:26:16.962703 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:26:17.466083 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:26:17.466812 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:26:17.666764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '532edf0e-b5b0-4445-8d1a-f6f683ffe2d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78569331ceb0>]}
[0m17:26:18.167734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '532edf0e-b5b0-4445-8d1a-f6f683ffe2d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7856932114c0>]}
[0m17:26:18.168610 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:26:18.171814 [info ] [MainThread]: 
[0m17:26:18.172796 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:26:18.184383 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:26:18.230003 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:26:18.258589 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:26:18.333292 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:26:19.132732 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:26:19.136030 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:26:19.154098 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:26:19.160809 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:26:19.239793 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:26:19.246725 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:26:19.257107 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:26:19.262717 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:26:19.271608 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:26:19.276350 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:26:19.344814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '532edf0e-b5b0-4445-8d1a-f6f683ffe2d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785692e1da90>]}
[0m17:26:19.346626 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:26:19.347887 [info ] [MainThread]: 
[0m17:26:19.374453 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:26:19.375611 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:26:19.376684 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:26:19.377403 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:26:19.450479 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:26:19.452088 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:26:19.645851 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:26:19.713073 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:26:19.714476 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:26:19.729471 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:26:19.866597 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:26:19.869968 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:26:19.872048 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:26:19.875265 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:26:19.929643 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:26:19.933558 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:26:19.935993 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:26:19.939230 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:26:20.034794 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:26:20.038283 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:26:20.044311 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '532edf0e-b5b0-4445-8d1a-f6f683ffe2d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785692591970>]}
[0m17:26:20.045412 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.67s]
[0m17:26:20.046807 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:26:20.049092 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:26:20.050130 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:26:20.051321 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:26:20.052907 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:26:20.054413 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:26:20.055705 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:26:20.057286 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:26:20.058920 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:26:20.060918 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:26:20.062218 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:26:20.063307 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:26:20.064915 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:26:20.144297 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:26:20.150630 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:26:20.165733 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:26:20.168078 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:26:20.235243 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:26:20.236836 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:26:20.432807 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:26:20.435710 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:26:20.459827 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:26:20.462292 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:26:20.465385 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:26:20.467412 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:26:20.752977 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:26:20.755911 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:26:20.758388 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:26:20.771848 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:26:20.774767 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:26:20.837202 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:26:20.840162 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.78s]
[0m17:26:20.845936 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.79s]
[0m17:26:20.851601 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.79s]
[0m17:26:20.854717 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:26:20.857528 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:26:20.860520 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:26:20.864438 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:26:20.865658 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:26:20.867347 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:26:20.869160 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:26:20.870962 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:26:20.873111 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:26:20.874930 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:26:20.876372 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:26:20.877885 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:26:20.930338 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:26:20.932023 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:26:20.933691 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:26:21.037025 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:26:21.065126 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:26:21.132066 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:26:21.137562 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:26:21.149809 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:26:21.152095 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:26:21.169342 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:26:21.170344 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:26:21.330879 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:26:21.456418 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:26:21.541662 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:26:21.641123 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:26:21.742392 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_532edf0e_b5b0_4445_8d1a_f6f683ffe2d3` 
  ...
[0m17:26:21.746189 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_532edf0e_b5b0_4445_8d1a_f6f683ffe2d3` 
  ...
[0m17:26:21.748907 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:26:21.750988 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:26:21.757343 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:26:21.758170 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:26:21.930027 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:26:21.939145 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_532edf0e_b5b0_4445_8d1a_f6f683ffe2d3`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:26:21.941222 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:26:21.941986 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_532edf0e_b5b0_4445_8d1a_f6f683ffe2d3`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:26:21.946909 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:26:21.956000 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:26:21.958907 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:26:21.961729 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '532edf0e-b5b0-4445-8d1a-f6f683ffe2d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785693ba9310>]}
[0m17:26:21.962901 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.08s]
[0m17:26:21.964278 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:26:21.966723 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:26:22.030485 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:26:22.041618 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_532edf0e_b5b0_4445_8d1a_f6f683ffe2d3'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:26:22.041028 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_532edf0e_b5b0_4445_8d1a_f6f683ffe2d3'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:26:22.046832 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:26:22.049702 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:26:22.056448 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:26:22.059493 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:26:22.061012 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_532edf0e_b5b0_4445_8d1a_f6f683ffe2d3`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:26:22.061959 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_532edf0e_b5b0_4445_8d1a_f6f683ffe2d3`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:26:22.079503 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:26:22.080915 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:26:22.082925 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_532edf0e_b5b0_4445_8d1a_f6f683ffe2d3`)
      
    ...
[0m17:26:22.084880 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_532edf0e_b5b0_4445_8d1a_f6f683ffe2d3`)
      
    ...
[0m17:26:22.103230 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:26:22.130045 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:26:22.131455 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:26:22.136411 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:26:22.142228 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:26:22.143662 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:26:22.146396 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_532edf0e_b5b0_4445_8d1a_f6f683ffe2d3` 
    ...
[0m17:26:22.149160 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_532edf0e_b5b0_4445_8d1a_f6f683ffe2d3` 
    ...
[0m17:26:22.154721 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:26:22.155975 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:26:22.161870 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_532edf0e_b5b0_4445_8d1a_f6f683ffe2d3` 
  ...
[0m17:26:22.167812 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_532edf0e_b5b0_4445_8d1a_f6f683ffe2d3` 
  ...
[0m17:26:22.171425 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:26:22.172742 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:26:22.178687 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:26:22.231449 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:26:22.234616 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:26:22.237778 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '532edf0e-b5b0-4445-8d1a-f6f683ffe2d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785692b42280>]}
[0m17:26:22.239014 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.36s]
[0m17:26:22.240400 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:26:22.241606 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:26:22.244926 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '532edf0e-b5b0-4445-8d1a-f6f683ffe2d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785693cb4c70>]}
[0m17:26:22.246763 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.37s]
[0m17:26:22.248117 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:26:22.250064 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:26:22.250609 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:26:22.251168 [debug] [MainThread]: On list__clean: Close
[0m17:26:22.251665 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:26:22.252157 [debug] [MainThread]: On list__mart: Close
[0m17:26:22.252646 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:26:22.253123 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:26:22.253603 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:26:22.254081 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:26:22.254550 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:26:22.255072 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:26:22.255541 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:26:22.256045 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:26:22.257236 [info ] [MainThread]: 
[0m17:26:22.257968 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.08 seconds (4.08s).
[0m17:26:22.261693 [debug] [MainThread]: Command end result
[0m17:26:22.370193 [info ] [MainThread]: 
[0m17:26:22.371046 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:26:22.371712 [info ] [MainThread]: 
[0m17:26:22.372438 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:26:22.373743 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.8100114, "process_in_blocks": "0", "process_kernel_time": 0.674546, "process_mem_max_rss": "114784", "process_out_blocks": "9744", "process_user_time": 6.086787}
[0m17:26:22.374486 [debug] [MainThread]: Command `dbt build` succeeded at 17:26:22.374298 after 6.81 seconds
[0m17:26:22.375092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785696f5c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7856956a85b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785694022ca0>]}
[0m17:26:22.375668 [debug] [MainThread]: Flushing usage events
[0m17:27:16.963270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ca581d4e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ca54e2ec10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ca54e2eac0>]}


============================== 17:27:16.972662 | ac722ba1-5603-46ba-bc3c-7823d7af4957 ==============================
[0m17:27:16.972662 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:27:16.973769 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'cache_selected_only': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error': 'None', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'indirect_selection': 'eager', 'no_print': 'None', 'quiet': 'False', 'target_path': 'None', 'fail_fast': 'False', 'profiles_dir': '.', 'partial_parse': 'True', 'version_check': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'log_format': 'default', 'empty': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'introspect': 'True', 'static_parser': 'True'}
[0m17:27:17.552223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ac722ba1-5603-46ba-bc3c-7823d7af4957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ca57664910>]}
[0m17:27:17.748733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ac722ba1-5603-46ba-bc3c-7823d7af4957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ca560ebcd0>]}
[0m17:27:17.750080 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:27:18.170458 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:27:18.682994 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:27:18.683705 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:27:18.885696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ac722ba1-5603-46ba-bc3c-7823d7af4957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ca54593e50>]}
[0m17:27:19.383552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ac722ba1-5603-46ba-bc3c-7823d7af4957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ca545aaa90>]}
[0m17:27:19.384390 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:27:19.387555 [info ] [MainThread]: 
[0m17:27:19.388610 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:27:19.400404 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:27:19.441684 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:27:19.480751 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:27:19.488474 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:27:20.210773 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:27:20.217364 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:27:20.219311 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:27:20.224474 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:27:20.286798 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:27:20.288697 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:27:20.355167 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:27:20.360050 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:27:20.369818 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:27:20.371955 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:27:20.443990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac722ba1-5603-46ba-bc3c-7823d7af4957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ca54d91970>]}
[0m17:27:20.446022 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:27:20.447375 [info ] [MainThread]: 
[0m17:27:20.474894 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:27:20.476017 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:27:20.477054 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:27:20.477801 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:27:20.546805 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:27:20.548356 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:27:20.685440 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:27:20.799716 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:27:20.801309 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:27:20.814915 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:27:20.942273 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:27:20.946200 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:27:20.948127 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:27:20.951384 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:27:20.957454 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:27:20.960502 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:27:20.962405 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:27:20.965193 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:27:21.057998 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:27:21.061711 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:27:21.067836 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac722ba1-5603-46ba-bc3c-7823d7af4957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ca576dcc10>]}
[0m17:27:21.068989 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m17:27:21.070303 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:27:21.072193 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:27:21.073153 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:27:21.074185 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:27:21.075304 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:27:21.077225 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:27:21.079672 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:27:21.081648 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:27:21.083928 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:27:21.085707 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:27:21.087801 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:27:21.089426 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:27:21.151933 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:27:21.260331 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:27:21.262671 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:27:21.266760 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:27:21.269003 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:27:21.271362 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:27:21.273025 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:27:21.574830 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:27:21.577608 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:27:21.584875 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:27:21.587902 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:27:21.589488 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:27:21.641741 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:27:21.859569 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:27:21.861271 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:27:21.863451 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:27:21.871770 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:27:21.873663 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:27:21.880527 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:27:21.885579 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.80s]
[0m17:27:21.945766 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.86s]
[0m17:27:21.949793 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.87s]
[0m17:27:21.952747 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:27:21.955687 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:27:21.958555 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:27:21.962349 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:27:21.963465 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:27:21.965010 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:27:21.966206 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:27:21.968324 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:27:21.969996 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:27:21.971799 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:27:21.973594 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:27:21.975189 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:27:21.976756 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:27:21.978784 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:27:22.046810 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:27:22.072915 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:27:22.142228 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:27:22.156489 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:27:22.159255 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:27:22.160892 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:27:22.167819 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:27:22.347795 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:27:22.462511 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:27:22.573753 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:27:22.657255 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:27:22.763048 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:27:22.867837 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:27:22.964869 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:27:23.044207 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_ac722ba1_5603_46ba_bc3c_7823d7af4957` 
  ...
[0m17:27:23.063888 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:27:23.075524 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_ac722ba1_5603_46ba_bc3c_7823d7af4957` 
  ...
[0m17:27:23.081307 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:27:23.083387 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:27:23.087501 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:27:23.143997 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:27:23.174234 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:27:23.364516 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:27:23.452849 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:27:23.477965 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_ac722ba1_5603_46ba_bc3c_7823d7af4957`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:27:23.480906 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_ac722ba1_5603_46ba_bc3c_7823d7af4957`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:27:23.486190 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac722ba1-5603-46ba-bc3c-7823d7af4957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ca54e71550>]}
[0m17:27:23.491296 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.51s]
[0m17:27:23.543741 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:27:23.546841 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:27:23.565290 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:27:23.655964 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_ac722ba1_5603_46ba_bc3c_7823d7af4957'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:27:23.658486 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_ac722ba1_5603_46ba_bc3c_7823d7af4957'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:27:23.667363 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:27:23.680485 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:27:23.683356 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:27:23.689914 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:27:23.743776 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_ac722ba1_5603_46ba_bc3c_7823d7af4957`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:27:23.746077 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_ac722ba1_5603_46ba_bc3c_7823d7af4957`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:27:23.778102 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:27:23.782753 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_ac722ba1_5603_46ba_bc3c_7823d7af4957`)
      
    ...
[0m17:27:23.785332 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:27:23.791065 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_ac722ba1_5603_46ba_bc3c_7823d7af4957`)
      
    ...
[0m17:27:23.814173 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:27:23.829192 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:27:23.827327 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:27:23.848434 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:27:23.858035 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:27:23.864035 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_ac722ba1_5603_46ba_bc3c_7823d7af4957` 
    ...
[0m17:27:23.866927 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:27:23.874838 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_ac722ba1_5603_46ba_bc3c_7823d7af4957` 
    ...
[0m17:27:23.879309 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:27:23.942434 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:27:23.944451 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_ac722ba1_5603_46ba_bc3c_7823d7af4957` 
  ...
[0m17:27:23.956742 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_ac722ba1_5603_46ba_bc3c_7823d7af4957` 
  ...
[0m17:27:23.962846 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:27:23.975864 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:27:23.978011 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:27:24.042954 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:27:24.048465 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:27:24.050991 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:27:24.057526 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac722ba1-5603-46ba-bc3c-7823d7af4957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ca5431fd90>]}
[0m17:27:24.063805 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac722ba1-5603-46ba-bc3c-7823d7af4957', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ca54c9af10>]}
[0m17:27:24.066432 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.08s]
[0m17:27:24.069660 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:27:24.072115 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.09s]
[0m17:27:24.075658 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:27:24.079624 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:27:24.080806 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:27:24.082003 [debug] [MainThread]: On list__mart: Close
[0m17:27:24.083082 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:27:24.084247 [debug] [MainThread]: On list__clean: Close
[0m17:27:24.085314 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:27:24.086444 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:27:24.087528 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m17:27:24.088750 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m17:27:24.141296 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:27:24.142892 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:27:24.144026 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:27:24.145214 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:27:24.147362 [info ] [MainThread]: 
[0m17:27:24.148636 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.76 seconds (4.76s).
[0m17:27:24.156005 [debug] [MainThread]: Command end result
[0m17:27:24.363987 [info ] [MainThread]: 
[0m17:27:24.364855 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:27:24.365523 [info ] [MainThread]: 
[0m17:27:24.366254 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:27:24.367692 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.5946164, "process_in_blocks": "0", "process_kernel_time": 0.712818, "process_mem_max_rss": "114620", "process_out_blocks": "9744", "process_user_time": 6.482068}
[0m17:27:24.368803 [debug] [MainThread]: Command `dbt build` succeeded at 17:27:24.368459 after 7.60 seconds
[0m17:27:24.369658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ca581d4e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ca544eb040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ca56058550>]}
[0m17:27:24.370260 [debug] [MainThread]: Flushing usage events
[0m17:28:16.958520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b47aa2c2310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b47a6f2cb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b47a6f2ca00>]}


============================== 17:28:16.967510 | 693dc6ca-e20b-40a2-8249-24bd3faffa3a ==============================
[0m17:28:16.967510 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:28:16.968618 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'empty': 'False', 'version_check': 'True', 'debug': 'False', 'no_print': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'partial_parse': 'True', 'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'quiet': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error': 'None', 'write_json': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'use_colors': 'True'}
[0m17:28:17.550120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '693dc6ca-e20b-40a2-8249-24bd3faffa3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b47a984db80>]}
[0m17:28:17.691331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '693dc6ca-e20b-40a2-8249-24bd3faffa3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b47a6fef820>]}
[0m17:28:17.743239 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:28:18.155496 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:28:18.657516 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:28:18.658232 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:28:18.861415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '693dc6ca-e20b-40a2-8249-24bd3faffa3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b47a667ee80>]}
[0m17:28:19.362263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '693dc6ca-e20b-40a2-8249-24bd3faffa3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b47a66938e0>]}
[0m17:28:19.363128 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:28:19.366310 [info ] [MainThread]: 
[0m17:28:19.367337 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:28:19.379284 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:28:19.380995 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:28:19.465267 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:28:19.482500 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:28:20.146719 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:28:20.153486 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:28:20.155030 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:28:20.166248 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:28:20.185879 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:28:20.186826 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:28:20.250522 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:28:20.254483 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:28:20.260745 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:28:20.261944 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:28:20.273525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '693dc6ca-e20b-40a2-8249-24bd3faffa3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b47a65db2b0>]}
[0m17:28:20.274503 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:28:20.275191 [info ] [MainThread]: 
[0m17:28:20.288408 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:28:20.289566 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:28:20.290680 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:28:20.291458 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:28:20.358830 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:28:20.360045 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:28:20.483750 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:28:21.386359 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:28:21.388686 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:28:21.400108 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:28:21.550907 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:28:21.554032 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:28:21.556278 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:28:21.559598 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:28:21.565818 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:28:21.569566 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:28:21.571843 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:28:21.574931 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:28:21.672579 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:28:21.675909 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:28:21.682484 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '693dc6ca-e20b-40a2-8249-24bd3faffa3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b47a590ee20>]}
[0m17:28:21.683806 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 1.39s]
[0m17:28:21.685223 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:28:21.687003 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:28:21.687844 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:28:21.688966 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:28:21.690184 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:28:21.691168 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:28:21.694986 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:28:21.693950 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:28:21.692390 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:28:21.742270 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:28:21.743293 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:28:21.744346 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:28:21.782321 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:28:21.783730 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:28:21.785116 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:28:21.786697 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:28:21.846983 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:28:21.848341 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:28:21.942120 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:28:21.943046 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:28:21.950437 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:28:21.955208 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:28:21.956461 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:28:21.957699 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:28:21.958465 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:28:22.110897 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:28:22.120312 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:28:22.122145 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:28:22.147193 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:28:22.150168 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:28:22.145782 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.40s]
[0m17:28:22.153505 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.46s]
[0m17:28:22.156950 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:28:22.159120 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:28:22.161932 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:28:22.165704 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.47s]
[0m17:28:22.167226 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:28:22.169265 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:28:22.170516 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:28:22.171376 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:28:22.172861 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:28:22.174319 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:28:22.175412 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:28:22.176394 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:28:22.177120 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:28:22.177799 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:28:22.178608 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:28:22.179377 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:28:22.180096 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:28:22.260516 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:28:22.262810 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:28:22.275333 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:28:22.277231 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:28:22.288410 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:28:22.342604 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:28:22.475052 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:28:22.563635 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:28:22.758982 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:28:22.842782 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:28:22.879901 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_693dc6ca_e20b_40a2_8249_24bd3faffa3a` 
  ...
[0m17:28:22.882816 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:28:22.963346 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_693dc6ca_e20b_40a2_8249_24bd3faffa3a` 
  ...
[0m17:28:22.966237 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:28:22.967889 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:28:22.971581 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:28:22.983663 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:28:23.167183 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:28:23.264616 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:28:23.352788 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:28:23.375552 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_693dc6ca_e20b_40a2_8249_24bd3faffa3a`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:28:23.379068 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_693dc6ca_e20b_40a2_8249_24bd3faffa3a`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:28:23.383313 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:28:23.449618 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:28:23.453155 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:28:23.458220 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:28:23.561821 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_693dc6ca_e20b_40a2_8249_24bd3faffa3a'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:28:23.554722 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_693dc6ca_e20b_40a2_8249_24bd3faffa3a'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:28:23.568041 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:28:23.573506 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:28:23.579305 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '693dc6ca-e20b-40a2-8249-24bd3faffa3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b47a61ec0d0>]}
[0m17:28:23.582041 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:28:23.647020 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:28:23.649857 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.40s]
[0m17:28:23.655659 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:28:23.658935 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:28:23.661894 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_693dc6ca_e20b_40a2_8249_24bd3faffa3a`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:28:23.664996 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_693dc6ca_e20b_40a2_8249_24bd3faffa3a`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:28:23.689603 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:28:23.691559 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:28:23.694554 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_693dc6ca_e20b_40a2_8249_24bd3faffa3a`)
      
    ...
[0m17:28:23.697754 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_693dc6ca_e20b_40a2_8249_24bd3faffa3a`)
      
    ...
[0m17:28:23.719473 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:28:23.742831 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:28:23.744754 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:28:23.751101 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:28:23.758897 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:28:23.760805 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:28:23.766062 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_693dc6ca_e20b_40a2_8249_24bd3faffa3a` 
    ...
[0m17:28:23.769348 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_693dc6ca_e20b_40a2_8249_24bd3faffa3a` 
    ...
[0m17:28:23.779029 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:28:23.792024 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:28:23.793804 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_693dc6ca_e20b_40a2_8249_24bd3faffa3a` 
  ...
[0m17:28:23.849042 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_693dc6ca_e20b_40a2_8249_24bd3faffa3a` 
  ...
[0m17:28:23.855333 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:28:23.857969 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:28:23.870219 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:28:23.884677 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:28:23.943583 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:28:23.945040 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:28:23.951579 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '693dc6ca-e20b-40a2-8249-24bd3faffa3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b47a8150a00>]}
[0m17:28:23.957603 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '693dc6ca-e20b-40a2-8249-24bd3faffa3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b47a6d73df0>]}
[0m17:28:23.960212 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.77s]
[0m17:28:23.962800 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.78s]
[0m17:28:23.965782 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:28:23.969853 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:28:23.975455 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:28:23.976777 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:28:23.978012 [debug] [MainThread]: On list__mart: Close
[0m17:28:23.979269 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:28:23.980569 [debug] [MainThread]: On list__clean: Close
[0m17:28:23.981710 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:28:23.982921 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:28:23.984081 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:28:23.985332 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:28:23.986478 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:28:23.987698 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:28:23.988924 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:28:23.990153 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:28:24.043047 [info ] [MainThread]: 
[0m17:28:24.044652 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.68 seconds (4.68s).
[0m17:28:24.052862 [debug] [MainThread]: Command end result
[0m17:28:24.272704 [info ] [MainThread]: 
[0m17:28:24.273895 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:28:24.274812 [info ] [MainThread]: 
[0m17:28:24.275863 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:28:24.277673 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.510025, "process_in_blocks": "0", "process_kernel_time": 0.626196, "process_mem_max_rss": "114848", "process_out_blocks": "9744", "process_user_time": 6.119606}
[0m17:28:24.278383 [debug] [MainThread]: Command `dbt build` succeeded at 17:28:24.278193 after 7.51 seconds
[0m17:28:24.279118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b47aa2c2310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b47a52bf940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b47a6678fd0>]}
[0m17:28:24.279769 [debug] [MainThread]: Flushing usage events
[0m17:29:16.385828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f95687d310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f9534e1b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f9534e1a00>]}


============================== 17:29:16.445570 | 5894c08b-2085-4818-9757-28df5b5a442d ==============================
[0m17:29:16.445570 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:29:16.446641 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'debug': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'target_path': 'None', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'write_json': 'True', 'quiet': 'False', 'log_format': 'default', 'log_path': '/workdir/transforms/04_btc/logs', 'log_cache_events': 'False', 'no_print': 'None', 'printer_width': '80', 'profiles_dir': '.', 'cache_selected_only': 'False', 'introspect': 'True', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'version_check': 'True', 'indirect_selection': 'eager'}
[0m17:29:16.980248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5894c08b-2085-4818-9757-28df5b5a442d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f954fc75b0>]}
[0m17:29:17.175694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5894c08b-2085-4818-9757-28df5b5a442d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f95394cca0>]}
[0m17:29:17.177049 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:29:17.644648 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:29:18.152296 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:29:18.152946 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:29:18.353871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5894c08b-2085-4818-9757-28df5b5a442d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f952c47eb0>]}
[0m17:29:18.802879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5894c08b-2085-4818-9757-28df5b5a442d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f952b3c4c0>]}
[0m17:29:18.803744 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:29:18.806921 [info ] [MainThread]: 
[0m17:29:18.807932 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:29:18.848894 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:29:18.855669 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:29:18.966691 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:29:18.968039 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:29:19.599439 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:29:19.605947 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:29:19.609117 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:29:19.611309 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:29:19.675558 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:29:19.687226 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:29:19.740838 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:29:19.746638 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:29:19.755206 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:29:19.761652 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:29:19.781984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5894c08b-2085-4818-9757-28df5b5a442d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f9567d47c0>]}
[0m17:29:19.783973 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:29:19.785398 [info ] [MainThread]: 
[0m17:29:19.860785 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:29:19.861873 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:29:19.862942 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:29:19.863677 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:29:19.881298 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:29:19.882433 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:29:20.073153 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:29:20.186174 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:29:20.187786 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:29:20.199959 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:29:20.281480 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:29:20.284776 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:29:20.286763 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:29:20.338042 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:29:20.343824 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:29:20.347110 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:29:20.348964 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:29:20.351723 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:29:20.447070 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:29:20.450445 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:29:20.456409 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5894c08b-2085-4818-9757-28df5b5a442d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f9520097c0>]}
[0m17:29:20.457508 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m17:29:20.458835 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:29:20.461037 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:29:20.462053 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:29:20.463214 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:29:20.464773 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:29:20.465584 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:29:20.466661 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:29:20.467977 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:29:20.469701 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:29:20.470910 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:29:20.472923 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:29:20.474298 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:29:20.486076 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:29:20.578124 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:29:20.583100 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:29:20.651977 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:29:20.654406 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:29:20.661489 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:29:20.673596 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:29:20.975643 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:29:20.978544 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:29:20.985561 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:29:21.038402 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:29:21.040201 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:29:21.043498 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:29:21.251890 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:29:21.266133 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:29:21.278796 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.81s]
[0m17:29:21.284164 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:29:21.293167 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:29:21.342339 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:29:21.348857 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:29:21.355053 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.89s]
[0m17:29:21.358155 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:29:21.360996 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:29:21.366797 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m17:29:21.370134 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:29:21.373186 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:29:21.374421 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:29:21.376241 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:29:21.377948 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:29:21.379896 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:29:21.382278 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:29:21.384113 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:29:21.385745 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:29:21.387432 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:29:21.389117 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:29:21.439286 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:29:21.441052 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:29:21.577248 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:29:21.580747 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:29:21.583438 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:29:21.585748 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:29:21.639441 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:29:21.652639 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:29:21.659815 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:29:21.759962 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:29:21.876617 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:29:22.044602 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:29:22.152934 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:29:22.248472 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:29:22.273756 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:29:22.383316 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:29:22.453427 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5894c08b_2085_4818_9757_28df5b5a442d` 
  ...
[0m17:29:22.463138 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5894c08b_2085_4818_9757_28df5b5a442d` 
  ...
[0m17:29:22.467782 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:29:22.472122 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:29:22.476489 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:29:22.484257 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:29:22.557523 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:29:22.679917 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:29:22.839515 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:29:22.855097 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5894c08b-2085-4818-9757-28df5b5a442d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f95188f580>]}
[0m17:29:22.939442 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.47s]
[0m17:29:22.949159 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_5894c08b_2085_4818_9757_28df5b5a442d`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:29:22.950784 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_5894c08b_2085_4818_9757_28df5b5a442d`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:29:22.954184 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:29:23.315699 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.36 seconds
[0m17:29:23.332576 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.37 seconds
[0m17:29:23.353416 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_5894c08b_2085_4818_9757_28df5b5a442d'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:29:23.359418 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_5894c08b_2085_4818_9757_28df5b5a442d'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:29:23.366792 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:29:23.371645 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:29:23.379759 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:29:23.383041 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:29:23.384787 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_5894c08b_2085_4818_9757_28df5b5a442d`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:29:23.386053 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_5894c08b_2085_4818_9757_28df5b5a442d`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:29:23.408506 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:29:23.441005 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5894c08b_2085_4818_9757_28df5b5a442d`)
      
    ...
[0m17:29:23.443530 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:29:23.449189 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5894c08b_2085_4818_9757_28df5b5a442d`)
      
    ...
[0m17:29:23.469067 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:29:23.476442 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:29:23.478402 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:29:23.487250 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:29:23.489133 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:29:23.494020 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5894c08b_2085_4818_9757_28df5b5a442d` 
    ...
[0m17:29:23.498577 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:29:23.501952 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5894c08b_2085_4818_9757_28df5b5a442d` 
    ...
[0m17:29:23.503261 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:29:23.538751 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:29:23.544846 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5894c08b_2085_4818_9757_28df5b5a442d` 
  ...
[0m17:29:23.550591 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5894c08b_2085_4818_9757_28df5b5a442d` 
  ...
[0m17:29:23.553796 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:29:23.554947 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:29:23.560759 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:29:23.566371 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:29:23.569262 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:29:23.570477 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:29:23.573720 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5894c08b-2085-4818-9757-28df5b5a442d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f951834ca0>]}
[0m17:29:23.576818 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5894c08b-2085-4818-9757-28df5b5a442d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f95188ff40>]}
[0m17:29:23.578046 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.19s]
[0m17:29:23.579260 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.19s]
[0m17:29:23.580715 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:29:23.582080 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:29:23.585052 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:29:23.585896 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:29:23.638324 [debug] [MainThread]: On list__mart: Close
[0m17:29:23.639227 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:29:23.640045 [debug] [MainThread]: On list__clean: Close
[0m17:29:23.640802 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:29:23.641571 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:29:23.642349 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:29:23.643109 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:29:23.643843 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:29:23.644642 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:29:23.645383 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m17:29:23.646133 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m17:29:23.647790 [info ] [MainThread]: 
[0m17:29:23.648767 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.84 seconds (4.84s).
[0m17:29:23.654756 [debug] [MainThread]: Command end result
[0m17:29:23.851324 [info ] [MainThread]: 
[0m17:29:23.853227 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:29:23.855071 [info ] [MainThread]: 
[0m17:29:23.856553 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:29:23.859228 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.617841, "process_in_blocks": "0", "process_kernel_time": 0.715979, "process_mem_max_rss": "114932", "process_out_blocks": "9744", "process_user_time": 6.369024}
[0m17:29:23.860845 [debug] [MainThread]: Command `dbt build` succeeded at 17:29:23.860410 after 7.62 seconds
[0m17:29:23.862125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f95687d310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f954fc75b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f95394cca0>]}
[0m17:29:23.863307 [debug] [MainThread]: Flushing usage events
[0m17:30:17.209002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c95e001310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c95ac5dbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c95ac5da60>]}


============================== 17:30:17.219853 | 383b5311-e339-48c8-9ab9-92332726fa16 ==============================
[0m17:30:17.219853 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:30:17.220896 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'partial_parse': 'True', 'version_check': 'True', 'use_experimental_parser': 'False', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'quiet': 'False', 'introspect': 'True', 'profiles_dir': '.', 'cache_selected_only': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'fail_fast': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'no_print': 'None', 'static_parser': 'True', 'printer_width': '80', 'debug': 'False', 'log_format': 'default', 'log_cache_events': 'False'}
[0m17:30:17.809604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '383b5311-e339-48c8-9ab9-92332726fa16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c95ad54160>]}
[0m17:30:18.001945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '383b5311-e339-48c8-9ab9-92332726fa16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c95ac393a0>]}
[0m17:30:18.003240 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:30:18.412699 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:30:18.914351 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:30:18.915033 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:30:19.115309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '383b5311-e339-48c8-9ab9-92332726fa16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c95a3c0e80>]}
[0m17:30:19.596520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '383b5311-e339-48c8-9ab9-92332726fa16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c95a3d5550>]}
[0m17:30:19.597454 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:30:19.600801 [info ] [MainThread]: 
[0m17:30:19.601798 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:30:19.613435 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:30:19.615374 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:30:19.706980 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:30:19.720588 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:30:20.405614 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:30:20.415749 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:30:20.418722 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:30:20.432185 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:30:20.508792 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:30:20.520044 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:30:20.523170 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:30:20.527384 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:30:20.534199 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:30:20.537894 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:30:20.595012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '383b5311-e339-48c8-9ab9-92332726fa16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c95a31e2b0>]}
[0m17:30:20.596142 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:30:20.596790 [info ] [MainThread]: 
[0m17:30:20.609610 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:30:20.610797 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:30:20.611873 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:30:20.612643 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:30:20.629539 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:30:20.630730 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:30:20.801863 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:30:20.859336 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:30:20.860767 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:30:20.871756 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:30:21.009914 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:30:21.012822 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:30:21.015129 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:30:21.017834 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:30:21.023666 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:30:21.026309 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:30:21.028238 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:30:21.031089 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:30:21.127353 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:30:21.130783 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:30:21.136812 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '383b5311-e339-48c8-9ab9-92332726fa16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c95d510c40>]}
[0m17:30:21.137993 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.52s]
[0m17:30:21.139291 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:30:21.140925 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:30:21.141695 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:30:21.142599 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:30:21.143387 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:30:21.194610 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:30:21.195584 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:30:21.197034 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:30:21.198364 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:30:21.199377 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:30:21.200333 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:30:21.201442 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:30:21.202309 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:30:21.296319 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:30:21.297292 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:30:21.304279 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:30:21.305680 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:30:21.311749 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:30:21.333316 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:30:21.434277 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:30:21.441403 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:30:21.506686 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:30:21.509098 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:30:21.511175 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:30:21.513591 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:30:21.782709 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:30:21.801313 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:30:21.806688 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:30:21.811319 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:30:21.824696 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:30:21.826955 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.63s]
[0m17:30:21.833757 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.64s]
[0m17:30:21.836855 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:30:21.839695 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:30:21.894313 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:30:21.900781 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.70s]
[0m17:30:21.903718 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:30:21.905377 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:30:21.906187 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:30:21.907013 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:30:21.907999 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:30:21.909058 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:30:21.910104 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:30:21.910992 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:30:21.911769 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:30:21.912573 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:30:21.913307 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:30:21.914198 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:30:21.915093 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:30:22.004954 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:30:22.011716 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:30:22.020979 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:30:22.023727 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:30:22.025303 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:30:22.130490 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:30:22.311558 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:30:22.334705 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:30:22.514004 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m17:30:22.536168 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:30:22.709825 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:30:22.712452 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:30:22.739345 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:30:22.823703 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_383b5311_e339_48c8_9ab9_92332726fa16` 
  ...
[0m17:30:22.835148 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_383b5311_e339_48c8_9ab9_92332726fa16` 
  ...
[0m17:30:22.895810 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:30:22.900557 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:30:22.905111 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:30:22.918134 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:30:23.007515 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:30:23.095040 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:30:23.139709 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:30:23.212135 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:30:23.229928 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '383b5311-e339-48c8-9ab9-92332726fa16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c959ef0e80>]}
[0m17:30:23.300112 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.32s]
[0m17:30:23.318669 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:30:23.393883 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_383b5311_e339_48c8_9ab9_92332726fa16`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:30:23.342078 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_383b5311_e339_48c8_9ab9_92332726fa16`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:30:23.429921 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:30:23.445524 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:30:23.501363 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_383b5311_e339_48c8_9ab9_92332726fa16'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:30:23.512564 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_383b5311_e339_48c8_9ab9_92332726fa16'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:30:23.517799 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:30:23.531368 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:30:23.533999 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:30:23.539913 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:30:23.542310 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_383b5311_e339_48c8_9ab9_92332726fa16`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:30:23.597759 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_383b5311_e339_48c8_9ab9_92332726fa16`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:30:23.626164 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:30:23.630694 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_383b5311_e339_48c8_9ab9_92332726fa16`)
      
    ...
[0m17:30:23.634890 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:30:23.639379 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_383b5311_e339_48c8_9ab9_92332726fa16`)
      
    ...
[0m17:30:23.660314 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:30:23.669817 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:30:23.675363 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:30:23.697832 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:30:23.706396 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:30:23.709546 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:30:23.715437 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_383b5311_e339_48c8_9ab9_92332726fa16` 
    ...
[0m17:30:23.721575 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_383b5311_e339_48c8_9ab9_92332726fa16` 
    ...
[0m17:30:23.736062 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:30:23.738607 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:30:23.746252 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_383b5311_e339_48c8_9ab9_92332726fa16` 
  ...
[0m17:30:23.803178 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_383b5311_e339_48c8_9ab9_92332726fa16` 
  ...
[0m17:30:23.809148 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:30:23.822253 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:30:23.829705 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:30:23.838021 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:30:23.894417 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:30:23.902519 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:30:23.904077 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '383b5311-e339-48c8-9ab9-92332726fa16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c958e03910>]}
[0m17:30:23.910039 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '383b5311-e339-48c8-9ab9-92332726fa16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c95a1545b0>]}
[0m17:30:23.912676 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.99s]
[0m17:30:23.915346 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.00s]
[0m17:30:23.918330 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:30:23.921265 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:30:23.926223 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:30:23.927390 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:30:23.928520 [debug] [MainThread]: On list__mart: Close
[0m17:30:23.929608 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:30:23.931178 [debug] [MainThread]: On list__clean: Close
[0m17:30:23.932274 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:30:23.933466 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:30:23.934526 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:30:23.935704 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:30:23.936827 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:30:23.937958 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:30:23.939072 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m17:30:23.940150 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m17:30:23.942636 [info ] [MainThread]: 
[0m17:30:23.944151 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.34 seconds (4.34s).
[0m17:30:24.001317 [debug] [MainThread]: Command end result
[0m17:30:24.211504 [info ] [MainThread]: 
[0m17:30:24.212844 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:30:24.213945 [info ] [MainThread]: 
[0m17:30:24.215096 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:30:24.217148 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.2006516, "process_in_blocks": "0", "process_kernel_time": 0.668761, "process_mem_max_rss": "114724", "process_out_blocks": "9752", "process_user_time": 6.298568}
[0m17:30:24.218366 [debug] [MainThread]: Command `dbt build` succeeded at 17:30:24.218027 after 7.20 seconds
[0m17:30:24.219362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c95e001310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c95a327700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77c95bf16f70>]}
[0m17:30:24.220274 [debug] [MainThread]: Flushing usage events
[0m17:31:16.305094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de6851d2310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de681e29b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de681e29a00>]}


============================== 17:31:16.314689 | c17aeda2-1165-4d3e-8793-3fb2057f19e5 ==============================
[0m17:31:16.314689 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:31:16.315806 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_path': '/workdir/transforms/04_btc/logs', 'static_parser': 'True', 'printer_width': '80', 'introspect': 'True', 'warn_error': 'None', 'use_experimental_parser': 'False', 'quiet': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'write_json': 'True', 'version_check': 'True', 'indirect_selection': 'eager', 'profiles_dir': '.', 'use_colors': 'True', 'target_path': 'None', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'empty': 'False', 'log_format': 'default', 'debug': 'False', 'partial_parse': 'True'}
[0m17:31:16.909883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c17aeda2-1165-4d3e-8793-3fb2057f19e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de681d8bfa0>]}
[0m17:31:17.108084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c17aeda2-1165-4d3e-8793-3fb2057f19e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de681df73d0>]}
[0m17:31:17.109377 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:31:17.524102 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:31:18.034784 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:31:18.035415 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:31:18.286664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c17aeda2-1165-4d3e-8793-3fb2057f19e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de68158de80>]}
[0m17:31:18.735509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c17aeda2-1165-4d3e-8793-3fb2057f19e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de6815a2670>]}
[0m17:31:18.736368 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:31:18.739570 [info ] [MainThread]: 
[0m17:31:18.740593 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:31:18.752234 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:31:18.753887 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:31:18.906103 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:31:18.912546 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:31:19.623819 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:31:19.629585 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:31:19.631900 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:31:19.634987 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:31:19.708730 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:31:19.715451 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:31:19.731624 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:31:19.793214 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:31:19.803587 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:31:19.813633 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:31:19.821438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c17aeda2-1165-4d3e-8793-3fb2057f19e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de6814eb880>]}
[0m17:31:19.823265 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:31:19.824509 [info ] [MainThread]: 
[0m17:31:19.898090 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:31:19.899628 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:31:19.901000 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:31:19.901869 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:31:19.922907 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:31:19.924129 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:31:20.095935 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:31:20.170497 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:31:20.171876 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:31:20.183985 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:31:20.313511 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:31:20.317152 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:31:20.319075 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:31:20.322330 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:31:20.328112 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:31:20.330979 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:31:20.332811 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:31:20.335967 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:31:20.429992 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:31:20.433310 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:31:20.488747 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c17aeda2-1165-4d3e-8793-3fb2057f19e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de6846cdc40>]}
[0m17:31:20.490159 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m17:31:20.491515 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:31:20.493736 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:31:20.495170 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:31:20.496647 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:31:20.498551 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:31:20.500377 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:31:20.502771 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:31:20.504611 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:31:20.506877 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:31:20.508656 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:31:20.510625 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:31:20.512336 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:31:20.534840 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:31:20.616957 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:31:20.626085 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:31:20.692300 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:31:20.695332 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:31:20.697023 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:31:20.704036 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:31:21.025193 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:31:21.026997 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:31:21.030266 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:31:21.031862 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:31:21.032986 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:31:21.035892 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:31:21.334876 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:31:21.346683 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:31:21.349644 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:31:21.351411 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:31:21.387742 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:31:21.395948 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:31:21.403624 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.90s]
[0m17:31:21.408881 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.90s]
[0m17:31:21.412697 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.91s]
[0m17:31:21.415143 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:31:21.418099 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:31:21.420358 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:31:21.423357 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:31:21.424172 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:31:21.425317 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:31:21.426922 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:31:21.428589 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:31:21.430751 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:31:21.432564 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:31:21.434174 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:31:21.487148 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:31:21.488984 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:31:21.490739 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:31:21.492314 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:31:21.621051 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:31:21.625017 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:31:21.631895 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:31:21.686501 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:31:21.688841 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:31:21.701028 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:31:21.790051 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:31:21.907473 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:31:22.025212 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:31:22.118040 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:31:22.217471 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:31:22.315572 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:31:22.434051 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:31:22.529737 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c17aeda2_1165_4d3e_8793_3fb2057f19e5` 
  ...
[0m17:31:22.594509 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:31:22.597304 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:31:22.628293 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c17aeda2_1165_4d3e_8793_3fb2057f19e5` 
  ...
[0m17:31:22.697987 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:31:22.792825 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:31:22.802301 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:31:22.909898 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:31:23.005844 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:31:23.032439 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_c17aeda2_1165_4d3e_8793_3fb2057f19e5`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:31:23.087714 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:31:23.089063 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_c17aeda2_1165_4d3e_8793_3fb2057f19e5`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:31:23.100042 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c17aeda2-1165-4d3e-8793-3fb2057f19e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de68131cd30>]}
[0m17:31:23.104819 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.61s]
[0m17:31:23.108149 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:31:23.513474 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.42 seconds
[0m17:31:23.528489 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.43 seconds
[0m17:31:23.537336 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_c17aeda2_1165_4d3e_8793_3fb2057f19e5'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:31:23.543794 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_c17aeda2_1165_4d3e_8793_3fb2057f19e5'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:31:23.548988 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:31:23.555568 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:31:23.556998 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:31:23.559586 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:31:23.561019 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_c17aeda2_1165_4d3e_8793_3fb2057f19e5`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:31:23.562822 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_c17aeda2_1165_4d3e_8793_3fb2057f19e5`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:31:23.600372 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:31:23.603741 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c17aeda2_1165_4d3e_8793_3fb2057f19e5`)
      
    ...
[0m17:31:23.606914 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:31:23.608971 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c17aeda2_1165_4d3e_8793_3fb2057f19e5`)
      
    ...
[0m17:31:23.622705 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:31:23.627989 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:31:23.629299 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:31:23.635566 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:31:23.638571 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:31:23.642037 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c17aeda2_1165_4d3e_8793_3fb2057f19e5` 
    ...
[0m17:31:23.643429 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:31:23.647315 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c17aeda2_1165_4d3e_8793_3fb2057f19e5` 
    ...
[0m17:31:23.651764 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:31:23.658217 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:31:23.659051 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c17aeda2_1165_4d3e_8793_3fb2057f19e5` 
  ...
[0m17:31:23.689323 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c17aeda2_1165_4d3e_8793_3fb2057f19e5` 
  ...
[0m17:31:23.693118 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:31:23.699698 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:31:23.701571 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:31:23.709284 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:31:23.710752 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:31:23.715005 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c17aeda2-1165-4d3e-8793-3fb2057f19e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de681df7fd0>]}
[0m17:31:23.717347 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:31:23.720444 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c17aeda2-1165-4d3e-8793-3fb2057f19e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de681c9d9a0>]}
[0m17:31:23.716200 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.28s]
[0m17:31:23.721547 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.29s]
[0m17:31:23.723102 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:31:23.726156 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:31:23.728292 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:31:23.728857 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:31:23.729375 [debug] [MainThread]: On list__mart: Close
[0m17:31:23.729879 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:31:23.730368 [debug] [MainThread]: On list__clean: Close
[0m17:31:23.730858 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:31:23.731347 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:31:23.731895 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m17:31:23.732436 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m17:31:23.732973 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:31:23.733472 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:31:23.733956 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:31:23.734459 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:31:23.787213 [info ] [MainThread]: 
[0m17:31:23.787992 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.05 seconds (5.05s).
[0m17:31:23.791672 [debug] [MainThread]: Command end result
[0m17:31:23.900191 [info ] [MainThread]: 
[0m17:31:23.901196 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:31:23.901808 [info ] [MainThread]: 
[0m17:31:23.902413 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:31:23.903767 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.7920985, "process_in_blocks": "0", "process_kernel_time": 0.690468, "process_mem_max_rss": "114872", "process_out_blocks": "9744", "process_user_time": 6.382603}
[0m17:31:23.904513 [debug] [MainThread]: Command `dbt build` succeeded at 17:31:23.904313 after 7.79 seconds
[0m17:31:23.905146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de6851d2310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de6830e8160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de67ff46940>]}
[0m17:31:23.905761 [debug] [MainThread]: Flushing usage events
[0m17:32:17.127004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d082312310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d07ef66b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d07ef669d0>]}


============================== 17:32:17.136384 | 878bb0b8-11f4-464c-a69b-25b70a8edc5a ==============================
[0m17:32:17.136384 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:32:17.137451 [debug] [MainThread]: running dbt with arguments {'log_path': '/workdir/transforms/04_btc/logs', 'debug': 'False', 'no_print': 'None', 'write_json': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'version_check': 'True', 'profiles_dir': '.', 'printer_width': '80', 'target_path': 'None', 'log_format': 'default', 'fail_fast': 'False', 'log_cache_events': 'False', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'quiet': 'False', 'introspect': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m17:32:17.663555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '878bb0b8-11f4-464c-a69b-25b70a8edc5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d07ef309a0>]}
[0m17:32:17.858736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '878bb0b8-11f4-464c-a69b-25b70a8edc5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d07ee34b50>]}
[0m17:32:17.860068 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:32:18.323984 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:32:18.836619 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:32:18.837318 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:32:19.039752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '878bb0b8-11f4-464c-a69b-25b70a8edc5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d07e6d0ee0>]}
[0m17:32:19.522866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '878bb0b8-11f4-464c-a69b-25b70a8edc5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d07e720850>]}
[0m17:32:19.524025 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:32:19.527690 [info ] [MainThread]: 
[0m17:32:19.528798 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:32:19.540944 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:32:19.547907 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:32:19.632807 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:32:19.637530 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:32:20.087255 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:32:20.093071 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:32:20.096953 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:32:20.102261 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:32:20.138448 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:32:20.139461 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:32:20.156377 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:32:20.160043 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:32:20.165794 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:32:20.221377 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:32:20.230916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '878bb0b8-11f4-464c-a69b-25b70a8edc5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d081729940>]}
[0m17:32:20.231956 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:32:20.232610 [info ] [MainThread]: 
[0m17:32:20.245513 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:32:20.246774 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:32:20.247913 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:32:20.248715 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:32:20.267044 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:32:20.268276 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:32:20.437982 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:32:20.494930 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:32:20.496287 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:32:20.506265 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:32:20.644987 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:32:20.648295 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:32:20.650232 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:32:20.652729 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:32:20.658232 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:32:20.660749 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:32:20.662562 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:32:20.665041 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:32:20.759867 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:32:20.762992 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:32:20.819326 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '878bb0b8-11f4-464c-a69b-25b70a8edc5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d08189b820>]}
[0m17:32:20.820680 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.52s]
[0m17:32:20.822051 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:32:20.824526 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:32:20.826177 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:32:20.827865 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:32:20.829758 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:32:20.831154 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:32:20.833009 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:32:20.834575 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:32:20.836332 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:32:20.837513 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:32:20.839656 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:32:20.840965 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:32:20.852576 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:32:21.021138 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:32:21.032490 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:32:21.038759 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:32:21.041092 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:32:21.048682 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:32:21.055515 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:32:21.267080 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:32:21.351153 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:32:21.364202 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:32:21.366351 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:32:21.421239 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:32:21.422912 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:32:21.664720 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:32:21.673943 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:32:21.682293 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:32:21.730358 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:32:21.728659 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.90s]
[0m17:32:21.736918 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:32:21.740435 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:32:21.747485 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m17:32:21.750594 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:32:21.753339 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:32:21.759374 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.92s]
[0m17:32:21.762693 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:32:21.765397 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:32:21.768016 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:32:21.766522 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:32:21.769177 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:32:21.819872 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:32:21.821886 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:32:21.824367 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:32:21.826135 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:32:21.827743 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:32:21.829298 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:32:21.846520 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:32:21.919103 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:32:21.928772 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:32:21.964577 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:32:22.019093 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:32:22.021094 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:32:22.022708 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:32:22.029520 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:32:22.138710 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:32:22.244880 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:32:22.350878 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:32:22.446119 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:32:22.466020 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:32:22.521446 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:32:22.564300 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:32:22.740577 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:32:22.830418 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:32:22.859204 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:32:22.936993 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:32:22.942369 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_878bb0b8_11f4_464c_a69b_25b70a8edc5a` 
  ...
[0m17:32:22.958442 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_878bb0b8_11f4_464c_a69b_25b70a8edc5a` 
  ...
[0m17:32:23.020360 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:32:23.027335 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:32:23.032889 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:32:23.051423 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:32:23.143065 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '878bb0b8-11f4-464c-a69b-25b70a8edc5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d07d307430>]}
[0m17:32:23.145462 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.31s]
[0m17:32:23.163789 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:32:23.420772 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_878bb0b8_11f4_464c_a69b_25b70a8edc5a`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:32:23.367400 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_878bb0b8_11f4_464c_a69b_25b70a8edc5a`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:32:23.456831 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:32:23.472035 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:32:23.528133 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_878bb0b8_11f4_464c_a69b_25b70a8edc5a'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:32:23.533318 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_878bb0b8_11f4_464c_a69b_25b70a8edc5a'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:32:23.544099 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:32:23.557413 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:32:23.560278 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:32:23.565870 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:32:23.619470 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_878bb0b8_11f4_464c_a69b_25b70a8edc5a`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:32:23.621289 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_878bb0b8_11f4_464c_a69b_25b70a8edc5a`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:32:23.650906 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:32:23.655123 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_878bb0b8_11f4_464c_a69b_25b70a8edc5a`)
      
    ...
[0m17:32:23.657687 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:32:23.663361 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_878bb0b8_11f4_464c_a69b_25b70a8edc5a`)
      
    ...
[0m17:32:23.688430 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:32:23.699163 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:32:23.701876 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:32:23.725154 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:32:23.733571 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:32:23.731309 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_878bb0b8_11f4_464c_a69b_25b70a8edc5a` 
    ...
[0m17:32:23.742416 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:32:23.744782 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:32:23.751071 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_878bb0b8_11f4_464c_a69b_25b70a8edc5a` 
    ...
[0m17:32:23.763727 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_878bb0b8_11f4_464c_a69b_25b70a8edc5a` 
  ...
[0m17:32:23.818600 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:32:23.821284 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:32:23.831289 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_878bb0b8_11f4_464c_a69b_25b70a8edc5a` 
  ...
[0m17:32:23.843519 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:32:23.849999 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:32:23.863075 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:32:23.865146 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:32:23.923484 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '878bb0b8-11f4-464c-a69b-25b70a8edc5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d07d307f40>]}
[0m17:32:23.926440 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.10s]
[0m17:32:23.928402 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:32:23.930090 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:32:23.934485 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '878bb0b8-11f4-464c-a69b-25b70a8edc5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d07ee5f730>]}
[0m17:32:23.937033 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.11s]
[0m17:32:23.939904 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:32:23.943731 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:32:23.944915 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:32:23.946057 [debug] [MainThread]: On list__clean: Close
[0m17:32:23.947116 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:32:23.948202 [debug] [MainThread]: On list__mart: Close
[0m17:32:23.949261 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:32:23.950271 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:32:23.951314 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:32:23.952400 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:32:23.953469 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:32:23.954578 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:32:23.955626 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:32:23.956730 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:32:23.958256 [info ] [MainThread]: 
[0m17:32:23.959253 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.43 seconds (4.43s).
[0m17:32:23.965636 [debug] [MainThread]: Command end result
[0m17:32:24.146708 [info ] [MainThread]: 
[0m17:32:24.147587 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:32:24.148218 [info ] [MainThread]: 
[0m17:32:24.148867 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:32:24.150198 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.2164154, "process_in_blocks": "0", "process_kernel_time": 0.70552, "process_mem_max_rss": "114768", "process_out_blocks": "9744", "process_user_time": 6.41202}
[0m17:32:24.151009 [debug] [MainThread]: Command `dbt build` succeeded at 17:32:24.150807 after 7.22 seconds
[0m17:32:24.151649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d082312310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d07ee34b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78d07edcb640>]}
[0m17:32:24.152250 [debug] [MainThread]: Flushing usage events
[0m17:33:16.959300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b983a58310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b9806bab50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b9806baa00>]}


============================== 17:33:16.968393 | 211d37fe-4160-4884-b92d-605e4d3a8a86 ==============================
[0m17:33:16.968393 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:33:16.969426 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'use_experimental_parser': 'False', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'quiet': 'False', 'debug': 'False', 'use_colors': 'True', 'fail_fast': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'log_path': '/workdir/transforms/04_btc/logs', 'log_cache_events': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'version_check': 'True', 'profiles_dir': '.', 'printer_width': '80', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error': 'None', 'write_json': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'introspect': 'True'}
[0m17:33:17.549081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '211d37fe-4160-4884-b92d-605e4d3a8a86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b98061dfa0>]}
[0m17:33:17.744689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '211d37fe-4160-4884-b92d-605e4d3a8a86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b9806913d0>]}
[0m17:33:17.746010 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:33:18.162406 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:33:18.665313 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:33:18.665953 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:33:18.864543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '211d37fe-4160-4884-b92d-605e4d3a8a86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b97fe1fe80>]}
[0m17:33:19.352626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '211d37fe-4160-4884-b92d-605e4d3a8a86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b97fe34670>]}
[0m17:33:19.353452 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:33:19.356683 [info ] [MainThread]: 
[0m17:33:19.357690 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:33:19.369358 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:33:19.381209 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:33:19.471786 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:33:19.534683 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:33:20.198654 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:33:20.206078 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:33:20.208106 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:33:20.234623 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:33:20.259947 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:33:20.261222 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:33:20.276438 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:33:20.282222 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:33:20.343181 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:33:20.352923 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:33:20.366905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '211d37fe-4160-4884-b92d-605e4d3a8a86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b98061dcd0>]}
[0m17:33:20.368777 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:33:20.370164 [info ] [MainThread]: 
[0m17:33:20.444129 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:33:20.445358 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:33:20.446478 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:33:20.447256 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:33:20.464923 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:33:20.466111 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:33:20.654153 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:33:20.722659 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:33:20.724184 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:33:20.736290 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:33:20.866578 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:33:20.870275 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:33:20.872234 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:33:20.875355 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:33:20.881068 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:33:20.883851 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:33:20.885661 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:33:20.936632 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:33:20.981420 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:33:20.984926 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:33:21.038985 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '211d37fe-4160-4884-b92d-605e4d3a8a86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b97f0af820>]}
[0m17:33:21.040222 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m17:33:21.041497 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:33:21.043602 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:33:21.045017 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:33:21.046772 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:33:21.048358 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:33:21.050416 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:33:21.052318 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:33:21.054582 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:33:21.056729 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:33:21.058726 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:33:21.060436 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:33:21.062227 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:33:21.063905 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:33:21.337431 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:33:21.342445 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:33:21.346498 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:33:21.349139 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:33:21.350812 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:33:21.352643 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:33:21.679752 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:33:21.734852 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:33:21.736914 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:33:21.739245 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:33:21.740993 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:33:21.742772 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:33:21.983166 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:33:21.990883 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:33:22.000406 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:33:22.041248 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:33:22.054324 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.00s]
[0m17:33:22.056039 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.99s]
[0m17:33:22.061419 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:33:22.066459 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:33:22.069412 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:33:22.083881 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:33:22.089772 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 1.03s]
[0m17:33:22.134416 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:33:22.137777 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:33:22.139399 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:33:22.140959 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:33:22.142510 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:33:22.144244 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:33:22.146590 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:33:22.148409 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:33:22.150037 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:33:22.151629 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:33:22.153252 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:33:22.155182 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:33:22.156996 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:33:22.270546 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:33:22.338070 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:33:22.345331 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:33:22.357786 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:33:22.359165 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:33:22.364064 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:33:22.439872 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:33:22.463148 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:33:22.578567 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:33:22.652733 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:33:22.779109 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:33:22.856351 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:33:22.947419 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_211d37fe_4160_4884_b92d_605e4d3a8a86` 
  ...
[0m17:33:22.955658 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_211d37fe_4160_4884_b92d_605e4d3a8a86` 
  ...
[0m17:33:22.957485 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:33:22.960986 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:33:22.962635 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:33:22.969283 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:33:23.140776 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:33:23.174564 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:33:23.175841 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_211d37fe_4160_4884_b92d_605e4d3a8a86`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:33:23.178882 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_211d37fe_4160_4884_b92d_605e4d3a8a86`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:33:23.184139 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:33:23.235948 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:33:23.265254 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_211d37fe_4160_4884_b92d_605e4d3a8a86'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:33:23.266697 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:33:23.268712 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:33:23.274933 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_211d37fe_4160_4884_b92d_605e4d3a8a86'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:33:23.276671 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:33:23.335237 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:33:23.339764 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:33:23.342415 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '211d37fe-4160-4884-b92d-605e4d3a8a86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b9807a1df0>]}
[0m17:33:23.343699 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:33:23.345117 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.19s]
[0m17:33:23.348202 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:33:23.349229 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_211d37fe_4160_4884_b92d_605e4d3a8a86`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:33:23.351134 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:33:23.354023 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_211d37fe_4160_4884_b92d_605e4d3a8a86`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:33:23.368282 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:33:23.369524 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:33:23.371571 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_211d37fe_4160_4884_b92d_605e4d3a8a86`)
      
    ...
[0m17:33:23.373347 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_211d37fe_4160_4884_b92d_605e4d3a8a86`)
      
    ...
[0m17:33:23.390996 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:33:23.396730 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:33:23.398091 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:33:23.404166 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:33:23.406721 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:33:23.435359 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:33:23.437218 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_211d37fe_4160_4884_b92d_605e4d3a8a86` 
    ...
[0m17:33:23.439918 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_211d37fe_4160_4884_b92d_605e4d3a8a86` 
    ...
[0m17:33:23.445413 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:33:23.446652 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:33:23.452698 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_211d37fe_4160_4884_b92d_605e4d3a8a86` 
  ...
[0m17:33:23.458476 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_211d37fe_4160_4884_b92d_605e4d3a8a86` 
  ...
[0m17:33:23.461982 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:33:23.463162 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:33:23.468963 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:33:23.474719 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:33:23.477751 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:33:23.479016 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:33:23.482081 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '211d37fe-4160-4884-b92d-605e4d3a8a86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b97f09e220>]}
[0m17:33:23.534653 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '211d37fe-4160-4884-b92d-605e4d3a8a86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b9810d72e0>]}
[0m17:33:23.536054 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.33s]
[0m17:33:23.537217 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.34s]
[0m17:33:23.538601 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:33:23.539881 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:33:23.542648 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:33:23.543467 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:33:23.544284 [debug] [MainThread]: On list__mart: Close
[0m17:33:23.545096 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:33:23.545889 [debug] [MainThread]: On list__clean: Close
[0m17:33:23.546656 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:33:23.547420 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:33:23.548216 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:33:23.549062 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:33:23.549826 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:33:23.550598 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:33:23.551366 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m17:33:23.552211 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m17:33:23.553950 [info ] [MainThread]: 
[0m17:33:23.555004 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.20 seconds (4.20s).
[0m17:33:23.561043 [debug] [MainThread]: Command end result
[0m17:33:23.671343 [info ] [MainThread]: 
[0m17:33:23.672239 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:33:23.672874 [info ] [MainThread]: 
[0m17:33:23.673516 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:33:23.675327 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.90631, "process_in_blocks": "0", "process_kernel_time": 0.675848, "process_mem_max_rss": "115288", "process_out_blocks": "9744", "process_user_time": 6.165754}
[0m17:33:23.676643 [debug] [MainThread]: Command `dbt build` succeeded at 17:33:23.676335 after 6.91 seconds
[0m17:33:23.677517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b983a58310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b981977910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73b98197a160>]}
[0m17:33:23.678222 [debug] [MainThread]: Flushing usage events
[0m17:34:17.274904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8009f72310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8006bdfaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8006bdf9a0>]}


============================== 17:34:17.284187 | 5e93e554-03ba-4b57-b9bd-79ff4aba3044 ==============================
[0m17:34:17.284187 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:34:17.285216 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'log_format': 'default', 'invocation_command': 'dbt build --profiles-dir . --target local', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '.', 'introspect': 'True', 'target_path': 'None', 'use_colors': 'True', 'empty': 'False', 'version_check': 'True', 'log_cache_events': 'False', 'quiet': 'False', 'fail_fast': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'partial_parse': 'True', 'no_print': 'None', 'static_parser': 'True'}
[0m17:34:17.815876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5e93e554-03ba-4b57-b9bd-79ff4aba3044', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d80095073a0>]}
[0m17:34:18.008795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5e93e554-03ba-4b57-b9bd-79ff4aba3044', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8006c403a0>]}
[0m17:34:18.010015 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:34:18.481756 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:34:18.997960 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:34:18.998667 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:34:19.203648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5e93e554-03ba-4b57-b9bd-79ff4aba3044', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8006335ee0>]}
[0m17:34:19.698393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5e93e554-03ba-4b57-b9bd-79ff4aba3044', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d800631fc70>]}
[0m17:34:19.699315 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:34:19.702958 [info ] [MainThread]: 
[0m17:34:19.704139 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:34:19.716312 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:34:19.768898 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:34:19.796779 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:34:19.814500 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:34:20.529615 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:34:20.538728 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:34:20.541130 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:34:20.549509 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:34:20.611212 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:34:20.617960 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:34:20.694789 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:34:20.699930 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:34:20.710634 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:34:20.714315 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:34:20.779090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e93e554-03ba-4b57-b9bd-79ff4aba3044', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8005ba0790>]}
[0m17:34:20.780131 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:34:20.780824 [info ] [MainThread]: 
[0m17:34:20.794328 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:34:20.795547 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:34:20.796704 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:34:20.797522 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:34:20.869402 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:34:20.871127 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:34:21.012311 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:34:21.129451 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:34:21.131004 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:34:21.143743 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:34:21.270834 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:34:21.275245 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:34:21.277382 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:34:21.280745 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:34:21.286453 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:34:21.289455 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:34:21.291347 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:34:21.294199 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:34:21.386420 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:34:21.389905 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:34:21.395823 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e93e554-03ba-4b57-b9bd-79ff4aba3044', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d80095037f0>]}
[0m17:34:21.396948 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m17:34:21.398265 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:34:21.400343 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:34:21.401455 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:34:21.403222 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:34:21.404685 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:34:21.406685 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:34:21.408717 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:34:21.410988 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:34:21.413050 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:34:21.415139 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:34:21.416880 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:34:21.418474 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:34:21.420162 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:34:21.608338 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:34:21.610849 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:34:21.670389 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:34:21.672589 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:34:21.680350 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:34:21.687350 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:34:22.012290 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:34:22.015019 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:34:21.999923 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:34:22.068757 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:34:22.072067 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:34:22.074124 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:34:23.148392 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:34:23.161164 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:34:23.164129 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:34:23.168880 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:34:23.186704 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 1.77s]
[0m17:34:23.189914 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:34:23.192711 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:34:23.195447 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:34:23.201260 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.79s]
[0m17:34:23.207463 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.79s]
[0m17:34:23.211022 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:34:23.213995 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:34:23.269016 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:34:23.270213 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:34:23.271371 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:34:23.273673 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:34:23.276092 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:34:23.278427 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:34:23.280348 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:34:23.282063 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:34:23.283732 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:34:23.285416 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:34:23.287266 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:34:23.289056 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:34:23.472502 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:34:23.474458 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:34:23.480983 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:34:23.483652 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:34:23.485318 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:34:23.492049 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:34:23.596049 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:34:23.695388 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:34:23.807394 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:34:23.886127 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:34:23.916043 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:34:24.088226 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:34:24.169750 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:34:24.274242 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:34:24.391648 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:34:24.394514 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e93e554_03ba_4b57_b9bd_79ff4aba3044` 
  ...
[0m17:34:24.398610 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:34:24.389779 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e93e554_03ba_4b57_b9bd_79ff4aba3044` 
  ...
[0m17:34:24.406320 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:34:24.410468 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:34:24.480288 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:34:24.515203 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:34:24.698315 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:34:24.793037 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e93e554-03ba-4b57-b9bd-79ff4aba3044', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8006997f40>]}
[0m17:34:24.806114 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.51s]
[0m17:34:24.892706 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e93e554_03ba_4b57_b9bd_79ff4aba3044`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:34:24.895940 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e93e554_03ba_4b57_b9bd_79ff4aba3044`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:34:24.898892 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:34:25.741637 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.84 seconds
[0m17:34:25.758631 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.86 seconds
[0m17:34:25.759293 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_5e93e554_03ba_4b57_b9bd_79ff4aba3044'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:34:25.765443 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_5e93e554_03ba_4b57_b9bd_79ff4aba3044'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:34:25.770741 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:34:25.771986 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:34:25.778078 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:34:25.780675 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:34:25.782028 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e93e554_03ba_4b57_b9bd_79ff4aba3044`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:34:25.783001 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e93e554_03ba_4b57_b9bd_79ff4aba3044`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:34:25.796525 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:34:25.799832 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e93e554_03ba_4b57_b9bd_79ff4aba3044`)
      
    ...
[0m17:34:25.801829 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:34:25.805187 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e93e554_03ba_4b57_b9bd_79ff4aba3044`)
      
    ...
[0m17:34:25.824452 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:34:25.830875 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:34:25.832416 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:34:25.840395 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:34:25.842044 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:34:25.869853 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e93e554_03ba_4b57_b9bd_79ff4aba3044` 
    ...
[0m17:34:25.871325 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:34:25.874943 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e93e554_03ba_4b57_b9bd_79ff4aba3044` 
    ...
[0m17:34:25.880119 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:34:25.881374 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:34:25.887282 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_5e93e554_03ba_4b57_b9bd_79ff4aba3044` 
  ...
[0m17:34:25.893114 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_5e93e554_03ba_4b57_b9bd_79ff4aba3044` 
  ...
[0m17:34:25.896851 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:34:25.898055 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:34:25.903968 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:34:25.909845 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:34:25.913372 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:34:25.916546 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e93e554-03ba-4b57-b9bd-79ff4aba3044', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d80056b2eb0>]}
[0m17:34:25.917762 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:34:25.918932 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.64s]
[0m17:34:25.969903 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e93e554-03ba-4b57-b9bd-79ff4aba3044', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8006b975e0>]}
[0m17:34:25.971286 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:34:25.972557 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.69s]
[0m17:34:25.974183 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:34:25.976174 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:34:25.976746 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:34:25.977259 [debug] [MainThread]: On list__clean: Close
[0m17:34:25.977750 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:34:25.978223 [debug] [MainThread]: On list__mart: Close
[0m17:34:25.978715 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:34:25.979190 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:34:25.979718 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:34:25.980179 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:34:25.980669 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:34:25.981133 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:34:25.981631 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:34:25.982089 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:34:25.983213 [info ] [MainThread]: 
[0m17:34:25.983979 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 6.28 seconds (6.28s).
[0m17:34:25.987694 [debug] [MainThread]: Command end result
[0m17:34:26.097710 [info ] [MainThread]: 
[0m17:34:26.098540 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:34:26.099110 [info ] [MainThread]: 
[0m17:34:26.099712 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:34:26.100983 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 9.019138, "process_in_blocks": "0", "process_kernel_time": 0.723024, "process_mem_max_rss": "115136", "process_out_blocks": "9744", "process_user_time": 6.431839}
[0m17:34:26.101716 [debug] [MainThread]: Command `dbt build` succeeded at 17:34:26.101519 after 9.02 seconds
[0m17:34:26.102319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8009f72310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8007efe850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d8007efbd00>]}
[0m17:34:26.102915 [debug] [MainThread]: Flushing usage events
[0m17:35:16.423710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d51913a7dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d518dffcbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d518dffca60>]}


============================== 17:35:16.485281 | 71281c82-aeff-4295-8ac6-4bb21dec33e2 ==============================
[0m17:35:16.485281 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:35:16.486511 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'quiet': 'False', 'profiles_dir': '.', 'no_print': 'None', 'use_experimental_parser': 'False', 'target_path': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'indirect_selection': 'eager', 'printer_width': '80', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_colors': 'True', 'cache_selected_only': 'False', 'version_check': 'True', 'debug': 'False', 'fail_fast': 'False', 'empty': 'False', 'warn_error': 'None'}
[0m17:35:17.019683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '71281c82-aeff-4295-8ac6-4bb21dec33e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d5190832940>]}
[0m17:35:17.215784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '71281c82-aeff-4295-8ac6-4bb21dec33e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d518dfc18e0>]}
[0m17:35:17.217026 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:35:17.678712 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:35:18.186409 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:35:18.187059 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:35:18.388561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '71281c82-aeff-4295-8ac6-4bb21dec33e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d518d766e20>]}
[0m17:35:18.832054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '71281c82-aeff-4295-8ac6-4bb21dec33e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d518d7a4250>]}
[0m17:35:18.832898 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:35:18.836043 [info ] [MainThread]: 
[0m17:35:18.837070 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:35:18.885060 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:35:18.887005 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:35:18.981081 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:35:18.927344 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:35:19.833522 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:35:19.841452 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:35:19.845595 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:35:19.849645 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:35:19.902064 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:35:19.908964 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:35:19.987982 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:35:19.989805 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:35:20.002599 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:35:20.017650 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:35:20.027081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '71281c82-aeff-4295-8ac6-4bb21dec33e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d518dcdbbe0>]}
[0m17:35:20.028993 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:35:20.030466 [info ] [MainThread]: 
[0m17:35:20.102709 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:35:20.104285 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:35:20.105926 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:35:20.106991 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:35:20.127830 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:35:20.129054 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:35:20.315004 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:35:20.427544 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:35:20.428956 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:35:20.439433 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:35:20.519825 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:35:20.523118 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:35:20.525021 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:35:20.527856 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:35:20.581844 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:35:20.585105 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:35:20.587109 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:35:20.590300 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:35:20.685056 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:35:20.688494 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:35:20.695609 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71281c82-aeff-4295-8ac6-4bb21dec33e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d518cab9bb0>]}
[0m17:35:20.697314 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m17:35:20.698723 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:35:20.700648 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:35:20.702102 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:35:20.703598 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:35:20.704984 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:35:20.706805 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:35:20.708818 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:35:20.710301 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:35:20.712493 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:35:20.714209 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:35:20.716183 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:35:20.717940 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:35:20.778304 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:35:20.899223 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:35:20.900652 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:35:20.910734 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:35:20.914002 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:35:20.915735 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:35:20.983449 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:35:21.296102 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:35:21.294653 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:35:21.299521 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:35:21.302084 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:35:21.304086 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:35:21.307844 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:35:21.565766 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:35:21.583665 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:35:21.586706 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:35:21.591435 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:35:21.607249 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.90s]
[0m17:35:21.610209 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:35:21.613066 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:35:21.616055 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:35:21.622578 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m17:35:21.678490 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.92s]
[0m17:35:21.681613 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:35:21.684549 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:35:21.688064 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:35:21.689150 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:35:21.690391 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:35:21.692086 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:35:21.693585 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:35:21.695634 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:35:21.697418 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:35:21.699574 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:35:21.701255 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:35:21.723805 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:35:21.788319 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:35:21.791818 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:35:21.792840 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:35:21.801802 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:35:21.808863 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:35:21.810013 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:35:21.816000 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:35:21.882949 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:35:21.915666 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:35:22.113109 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:35:22.191076 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_71281c82_aeff_4295_8ac6_4bb21dec33e2` 
  ...
[0m17:35:22.208802 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_71281c82_aeff_4295_8ac6_4bb21dec33e2` 
  ...
[0m17:35:22.211096 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:35:22.212440 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:35:22.213715 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:35:22.288151 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:35:22.392284 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_71281c82_aeff_4295_8ac6_4bb21dec33e2`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:35:22.395617 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_71281c82_aeff_4295_8ac6_4bb21dec33e2`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:35:22.397932 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:35:22.401092 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:35:22.404354 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:35:22.410339 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:35:22.413013 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:35:22.415026 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:35:22.418329 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:35:22.425129 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:35:22.426406 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:35:22.427504 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:35:22.493811 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:35:22.492606 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_71281c82_aeff_4295_8ac6_4bb21dec33e2'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:35:22.500272 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_71281c82_aeff_4295_8ac6_4bb21dec33e2'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:35:22.503284 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71281c82-aeff-4295-8ac6-4bb21dec33e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d518d42ec10>]}
[0m17:35:22.507353 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.78s]
[0m17:35:22.509300 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:35:22.510559 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:35:22.511887 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:35:22.518784 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:35:22.521609 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:35:22.523298 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_71281c82_aeff_4295_8ac6_4bb21dec33e2`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:35:22.525334 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_71281c82_aeff_4295_8ac6_4bb21dec33e2`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:35:22.592003 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:35:22.593282 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:35:22.595355 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_71281c82_aeff_4295_8ac6_4bb21dec33e2`)
      
    ...
[0m17:35:22.597296 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_71281c82_aeff_4295_8ac6_4bb21dec33e2`)
      
    ...
[0m17:35:22.614973 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:35:22.620468 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:35:22.621962 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:35:22.629278 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:35:22.631737 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:35:22.634766 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_71281c82_aeff_4295_8ac6_4bb21dec33e2` 
    ...
[0m17:35:22.638413 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:35:22.641452 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_71281c82_aeff_4295_8ac6_4bb21dec33e2` 
    ...
[0m17:35:22.642935 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:35:22.650360 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_71281c82_aeff_4295_8ac6_4bb21dec33e2` 
  ...
[0m17:35:22.679002 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:35:22.687425 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_71281c82_aeff_4295_8ac6_4bb21dec33e2` 
  ...
[0m17:35:22.689822 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:35:22.697651 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:35:22.699024 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:35:22.705902 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:35:22.708194 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:35:22.711268 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71281c82-aeff-4295-8ac6-4bb21dec33e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d518d4d3160>]}
[0m17:35:22.712530 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.02s]
[0m17:35:22.713937 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:35:22.715169 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:35:22.719826 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71281c82-aeff-4295-8ac6-4bb21dec33e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d518c255a60>]}
[0m17:35:22.721108 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.02s]
[0m17:35:22.722528 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:35:22.724581 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:35:22.725121 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:35:22.725664 [debug] [MainThread]: On list__clean: Close
[0m17:35:22.726140 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:35:22.777868 [debug] [MainThread]: On list__mart: Close
[0m17:35:22.778625 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:35:22.779117 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:35:22.779633 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:35:22.780111 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:35:22.780610 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:35:22.781094 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:35:22.781624 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:35:22.782096 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:35:22.783246 [info ] [MainThread]: 
[0m17:35:22.783992 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.95 seconds (3.95s).
[0m17:35:22.787780 [debug] [MainThread]: Command end result
[0m17:35:22.908257 [info ] [MainThread]: 
[0m17:35:22.909106 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:35:22.909692 [info ] [MainThread]: 
[0m17:35:22.910333 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:35:22.911623 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.632128, "process_in_blocks": "0", "process_kernel_time": 0.744327, "process_mem_max_rss": "114936", "process_out_blocks": "9744", "process_user_time": 5.966515}
[0m17:35:22.912332 [debug] [MainThread]: Command `dbt build` succeeded at 17:35:22.912143 after 6.63 seconds
[0m17:35:22.912948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d51913a7dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d518d72bac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d518d6b0fd0>]}
[0m17:35:22.913514 [debug] [MainThread]: Flushing usage events
[0m17:36:16.457815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743dbfb92310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743dbc7fd4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743dbc7fd640>]}


============================== 17:36:16.467163 | e1d1c1fc-0f06-485a-9556-7c4fe5854115 ==============================
[0m17:36:16.467163 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:36:16.468188 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'version_check': 'True', 'log_cache_events': 'False', 'quiet': 'False', 'warn_error': 'None', 'use_colors': 'True', 'printer_width': '80', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'profiles_dir': '.', 'target_path': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'invocation_command': 'dbt build --profiles-dir . --target local', 'partial_parse': 'True', 'empty': 'False', 'fail_fast': 'False', 'log_format': 'default', 'debug': 'False', 'static_parser': 'True', 'write_json': 'True'}
[0m17:36:17.043791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e1d1c1fc-0f06-485a-9556-7c4fe5854115', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743dbc6cf7f0>]}
[0m17:36:17.240669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e1d1c1fc-0f06-485a-9556-7c4fe5854115', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743dbcc544c0>]}
[0m17:36:17.241974 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:36:17.656233 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:36:18.167454 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:36:18.168118 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:36:18.370388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e1d1c1fc-0f06-485a-9556-7c4fe5854115', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743dbbf55eb0>]}
[0m17:36:18.877664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e1d1c1fc-0f06-485a-9556-7c4fe5854115', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743dbbe4a4c0>]}
[0m17:36:18.878523 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:36:18.881685 [info ] [MainThread]: 
[0m17:36:18.882768 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:36:18.895768 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:36:18.933178 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:36:19.048369 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:36:19.060125 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:36:19.890905 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:36:19.897864 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:36:19.901384 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:36:19.905196 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:36:19.968218 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:36:19.970042 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:36:20.048029 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:36:20.049441 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:36:20.057888 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:36:20.067983 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:36:20.082301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1d1c1fc-0f06-485a-9556-7c4fe5854115', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743dbefa8970>]}
[0m17:36:20.133060 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:36:20.134635 [info ] [MainThread]: 
[0m17:36:20.160782 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:36:20.161869 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:36:20.163027 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:36:20.163776 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:36:20.180187 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:36:20.181336 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:36:20.373481 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:36:20.484354 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:36:20.485821 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:36:20.497485 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:36:20.577065 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:36:20.580246 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:36:20.582066 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:36:20.635380 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:36:20.641172 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:36:20.644044 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:36:20.645854 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:36:20.648539 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:36:20.742451 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:36:20.745913 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:36:20.752133 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1d1c1fc-0f06-485a-9556-7c4fe5854115', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743dbb2e0850>]}
[0m17:36:20.753268 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m17:36:20.754598 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:36:20.756843 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:36:20.758187 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:36:20.759814 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:36:20.761161 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:36:20.763102 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:36:20.765051 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:36:20.767260 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:36:20.769441 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:36:20.771497 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:36:20.773232 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:36:20.775024 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:36:20.776727 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:36:20.871166 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:36:20.872040 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:36:20.875464 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:36:20.876922 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:36:20.877652 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:36:20.943573 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:36:20.968668 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:36:20.972254 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:36:21.033275 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:36:21.036065 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:36:21.038071 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:36:21.042457 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:36:21.270523 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:36:21.283108 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:36:21.295597 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.53s]
[0m17:36:21.332921 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:36:21.346969 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:36:21.351657 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:36:21.362212 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:36:21.364430 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:36:21.367819 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.60s]
[0m17:36:21.372805 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.60s]
[0m17:36:21.375829 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:36:21.378584 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:36:21.381809 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:36:21.382842 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:36:21.384499 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:36:21.434354 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:36:21.436579 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:36:21.438832 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:36:21.440755 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:36:21.442485 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:36:21.444164 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:36:21.445879 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:36:21.447621 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:36:21.449318 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:36:21.557309 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:36:21.571320 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:36:21.573773 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:36:21.575946 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:36:21.577843 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:36:21.632801 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:36:21.673963 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:36:21.854015 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:36:21.954336 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:36:22.049315 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:36:22.176948 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:36:22.235687 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:36:22.334051 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:36:22.369287 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:36:22.444882 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1d1c1fc_0f06_485a_9556_7c4fe5854115` 
  ...
[0m17:36:22.463434 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:36:22.533828 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:36:22.538028 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:36:22.547041 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1d1c1fc_0f06_485a_9556_7c4fe5854115` 
  ...
[0m17:36:22.639275 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:36:22.672257 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:36:22.748694 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:36:22.849462 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:36:22.876149 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1d1c1fc-0f06-485a-9556-7c4fe5854115', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743dbaa69c40>]}
[0m17:36:22.934295 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1d1c1fc_0f06_485a_9556_7c4fe5854115`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:36:22.880520 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1d1c1fc_0f06_485a_9556_7c4fe5854115`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:36:22.937484 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.43s]
[0m17:36:22.945610 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:36:23.009426 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:36:23.024248 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:36:23.068222 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_e1d1c1fc_0f06_485a_9556_7c4fe5854115'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:36:23.070759 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_e1d1c1fc_0f06_485a_9556_7c4fe5854115'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:36:23.081078 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:36:23.084350 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:36:23.140377 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:36:23.146021 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:36:23.149115 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1d1c1fc_0f06_485a_9556_7c4fe5854115`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:36:23.151336 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1d1c1fc_0f06_485a_9556_7c4fe5854115`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:36:23.181409 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:36:23.183904 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:36:23.188388 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1d1c1fc_0f06_485a_9556_7c4fe5854115`)
      
    ...
[0m17:36:23.193079 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1d1c1fc_0f06_485a_9556_7c4fe5854115`)
      
    ...
[0m17:36:23.230508 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:36:23.247724 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:36:23.250667 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:36:23.262739 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:36:23.268009 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:36:23.273920 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1d1c1fc_0f06_485a_9556_7c4fe5854115` 
    ...
[0m17:36:23.276897 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:36:23.334003 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:36:23.337103 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1d1c1fc_0f06_485a_9556_7c4fe5854115` 
    ...
[0m17:36:23.345180 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1d1c1fc_0f06_485a_9556_7c4fe5854115` 
  ...
[0m17:36:23.351003 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:36:23.352895 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:36:23.360976 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:36:23.373003 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1d1c1fc_0f06_485a_9556_7c4fe5854115` 
  ...
[0m17:36:23.379128 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:36:23.435620 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1d1c1fc-0f06-485a-9556-7c4fe5854115', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743dbbcee400>]}
[0m17:36:23.438088 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.00s]
[0m17:36:23.440953 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:36:23.443819 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:36:23.457472 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:36:23.463349 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:36:23.469602 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1d1c1fc-0f06-485a-9556-7c4fe5854115', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743dbaa69760>]}
[0m17:36:23.471954 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.03s]
[0m17:36:23.474741 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:36:23.478571 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:36:23.479814 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:36:23.481009 [debug] [MainThread]: On list__clean: Close
[0m17:36:23.482144 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:36:23.533161 [debug] [MainThread]: On list__mart: Close
[0m17:36:23.534396 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:36:23.535578 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:36:23.536684 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:36:23.537831 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:36:23.538942 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:36:23.540133 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:36:23.541236 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m17:36:23.542390 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m17:36:23.544696 [info ] [MainThread]: 
[0m17:36:23.546185 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.66 seconds (4.66s).
[0m17:36:23.554354 [debug] [MainThread]: Command end result
[0m17:36:23.779048 [info ] [MainThread]: 
[0m17:36:23.780400 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:36:23.781458 [info ] [MainThread]: 
[0m17:36:23.832241 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:36:23.835400 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.5688553, "process_in_blocks": "0", "process_kernel_time": 0.733019, "process_mem_max_rss": "114984", "process_out_blocks": "9744", "process_user_time": 6.512101}
[0m17:36:23.837059 [debug] [MainThread]: Command `dbt build` succeeded at 17:36:23.836645 after 7.57 seconds
[0m17:36:23.838449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743dbfb92310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743dbeedc0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743dbe3341c0>]}
[0m17:36:23.839808 [debug] [MainThread]: Flushing usage events
[0m17:37:16.717349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11a67ac310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11a3410ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11a3410970>]}


============================== 17:37:16.726306 | 7ed7bff1-d9f5-4846-9a8e-49c9f3948e74 ==============================
[0m17:37:16.726306 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:37:16.727432 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt build --profiles-dir . --target local', 'cache_selected_only': 'False', 'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'introspect': 'True', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'static_parser': 'True', 'indirect_selection': 'eager', 'empty': 'False', 'log_cache_events': 'False', 'no_print': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'profiles_dir': '.', 'target_path': 'None', 'use_colors': 'True', 'printer_width': '80', 'write_json': 'True', 'fail_fast': 'False'}
[0m17:37:17.307888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7ed7bff1-d9f5-4846-9a8e-49c9f3948e74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11a33095e0>]}
[0m17:37:17.501266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7ed7bff1-d9f5-4846-9a8e-49c9f3948e74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11a69c9f10>]}
[0m17:37:17.502529 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:37:17.918904 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:37:18.423921 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:37:18.424567 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:37:18.625614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7ed7bff1-d9f5-4846-9a8e-49c9f3948e74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11a2b76f10>]}
[0m17:37:19.189990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7ed7bff1-d9f5-4846-9a8e-49c9f3948e74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11a2bb41f0>]}
[0m17:37:19.190915 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:37:19.194368 [info ] [MainThread]: 
[0m17:37:19.195591 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:37:19.207960 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:37:19.214274 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:37:19.300882 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:37:19.298167 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:37:19.746637 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:37:19.750602 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:37:19.756332 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:37:19.760766 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:37:19.799982 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:37:19.806720 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:37:19.812892 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:37:19.816539 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:37:19.822660 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:37:19.828366 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:37:19.837055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7ed7bff1-d9f5-4846-9a8e-49c9f3948e74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11a30edbb0>]}
[0m17:37:19.838040 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:37:19.888304 [info ] [MainThread]: 
[0m17:37:19.902411 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:37:19.903599 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:37:19.904665 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:37:19.905415 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:37:19.923647 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:37:19.925497 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:37:20.107664 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:37:20.171149 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:37:20.189856 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:37:20.201555 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:37:20.388958 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:37:20.392225 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:37:20.394345 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:37:20.397130 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:37:20.403030 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:37:20.405766 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:37:20.407708 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:37:20.410398 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:37:20.505833 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:37:20.508845 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:37:20.515121 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ed7bff1-d9f5-4846-9a8e-49c9f3948e74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11a273ef10>]}
[0m17:37:20.516340 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m17:37:20.517708 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:37:20.519282 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:37:20.520107 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:37:20.520870 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:37:20.521732 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:37:20.522611 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:37:20.523946 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:37:20.524831 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:37:20.525811 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:37:20.526599 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:37:20.527466 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:37:20.528228 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:37:20.600839 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:37:20.601724 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:37:20.608728 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:37:20.617375 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:37:20.618198 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:37:20.619479 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:37:20.625395 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:37:20.729717 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:37:20.732853 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:37:20.734353 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:37:20.735792 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:37:20.736759 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:37:20.789968 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:37:20.948905 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:37:20.959257 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:37:20.968694 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:37:20.970798 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.45s]
[0m17:37:20.988103 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:37:20.990556 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:37:20.995890 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.47s]
[0m17:37:20.997948 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:37:20.999874 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:37:21.008290 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:37:21.011270 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.49s]
[0m17:37:21.012686 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:37:21.014945 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:37:21.016316 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:37:21.017549 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:37:21.019157 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:37:21.020865 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:37:21.022400 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:37:21.023430 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:37:21.024277 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:37:21.025012 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:37:21.025875 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:37:21.026683 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:37:21.027422 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:37:21.099468 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:37:21.103997 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:37:21.111340 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:37:21.112952 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:37:21.113780 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:37:21.119796 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:37:21.301466 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:37:21.411176 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:37:21.591211 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_7ed7bff1_d9f5_4846_9a8e_49c9f3948e74` 
  ...
[0m17:37:21.537216 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_7ed7bff1_d9f5_4846_9a8e_49c9f3948e74` 
  ...
[0m17:37:21.593348 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m17:37:21.596923 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:37:21.603476 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:37:21.605873 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:37:21.730898 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:37:21.800425 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_7ed7bff1_d9f5_4846_9a8e_49c9f3948e74`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:37:21.801623 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_7ed7bff1_d9f5_4846_9a8e_49c9f3948e74`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:37:21.804006 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:37:21.808784 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:37:21.815100 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:37:21.818172 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:37:21.820327 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:37:21.823164 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:37:21.830389 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:37:21.832040 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:37:21.834184 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:37:21.894775 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:37:21.919162 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_7ed7bff1_d9f5_4846_9a8e_49c9f3948e74'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:37:21.925853 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_7ed7bff1_d9f5_4846_9a8e_49c9f3948e74'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:37:21.928591 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ed7bff1-d9f5-4846-9a8e-49c9f3948e74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11a1e4e040>]}
[0m17:37:21.932944 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.90s]
[0m17:37:21.936836 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:37:21.940027 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:37:21.935064 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:37:22.001140 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:37:22.006052 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:37:22.008628 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_7ed7bff1_d9f5_4846_9a8e_49c9f3948e74`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:37:22.012044 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_7ed7bff1_d9f5_4846_9a8e_49c9f3948e74`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:37:22.038269 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:37:22.040723 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_7ed7bff1_d9f5_4846_9a8e_49c9f3948e74`)
      
    ...
[0m17:37:22.043651 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:37:22.047426 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_7ed7bff1_d9f5_4846_9a8e_49c9f3948e74`)
      
    ...
[0m17:37:22.068479 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:37:22.089106 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:37:22.090766 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:37:22.100757 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:37:22.110496 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:37:22.118364 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:37:22.116522 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_7ed7bff1_d9f5_4846_9a8e_49c9f3948e74` 
    ...
[0m17:37:22.125087 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_7ed7bff1_d9f5_4846_9a8e_49c9f3948e74` 
    ...
[0m17:37:22.134937 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:37:22.142523 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:37:22.196036 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_7ed7bff1_d9f5_4846_9a8e_49c9f3948e74` 
  ...
[0m17:37:22.212776 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_7ed7bff1_d9f5_4846_9a8e_49c9f3948e74` 
  ...
[0m17:37:22.221467 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:37:22.229152 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:37:22.237154 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:37:22.302560 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:37:22.307313 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:37:22.314919 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:37:22.316309 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ed7bff1-d9f5-4846-9a8e-49c9f3948e74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11a16a2370>]}
[0m17:37:22.322478 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ed7bff1-d9f5-4846-9a8e-49c9f3948e74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11a173c310>]}
[0m17:37:22.324984 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.29s]
[0m17:37:22.327640 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.30s]
[0m17:37:22.330553 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:37:22.333408 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:37:22.338235 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:37:22.389167 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:37:22.390389 [debug] [MainThread]: On list__mart: Close
[0m17:37:22.391469 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:37:22.392525 [debug] [MainThread]: On list__clean: Close
[0m17:37:22.393628 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:37:22.394757 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:37:22.395773 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:37:22.396818 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:37:22.397899 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:37:22.398960 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:37:22.399979 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:37:22.401104 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:37:22.403325 [info ] [MainThread]: 
[0m17:37:22.404758 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.21 seconds (3.21s).
[0m17:37:22.412820 [debug] [MainThread]: Command end result
[0m17:37:22.625577 [info ] [MainThread]: 
[0m17:37:22.627021 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:37:22.628124 [info ] [MainThread]: 
[0m17:37:22.629250 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:37:22.631492 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.105497, "process_in_blocks": "0", "process_kernel_time": 0.611415, "process_mem_max_rss": "114516", "process_out_blocks": "9744", "process_user_time": 5.809442}
[0m17:37:22.632731 [debug] [MainThread]: Command `dbt build` succeeded at 17:37:22.632401 after 6.11 seconds
[0m17:37:22.633766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11a67ac310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11a2b602b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d11a33095e0>]}
[0m17:37:22.634700 [debug] [MainThread]: Flushing usage events
[0m17:38:16.452224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7327a11c8e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73279de27b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73279de27a30>]}


============================== 17:38:16.461623 | 62697bee-4860-4506-bff3-038a3f37451a ==============================
[0m17:38:16.461623 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:38:16.462698 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'partial_parse': 'True', 'no_print': 'None', 'target_path': 'None', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'use_experimental_parser': 'False', 'log_format': 'default', 'debug': 'False', 'introspect': 'True', 'profiles_dir': '.', 'invocation_command': 'dbt build --profiles-dir . --target local', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'fail_fast': 'False', 'write_json': 'True', 'warn_error': 'None', 'version_check': 'True'}
[0m17:38:17.047239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '62697bee-4860-4506-bff3-038a3f37451a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73279de80b80>]}
[0m17:38:17.246375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '62697bee-4860-4506-bff3-038a3f37451a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73279dd236d0>]}
[0m17:38:17.247750 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:38:17.721148 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:38:18.228647 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:38:18.229316 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:38:18.430874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '62697bee-4860-4506-bff3-038a3f37451a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73279d58ae50>]}
[0m17:38:18.876228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '62697bee-4860-4506-bff3-038a3f37451a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73279d549e80>]}
[0m17:38:18.877139 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:38:18.916296 [info ] [MainThread]: 
[0m17:38:18.917500 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:38:18.929024 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:38:18.941288 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:38:19.030365 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:38:19.039563 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:38:19.719516 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:38:19.727036 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:38:19.731148 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:38:19.733060 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:38:19.830711 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:38:19.832293 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:38:19.847238 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:38:19.852808 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:38:19.862332 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:38:19.915359 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:38:19.934444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '62697bee-4860-4506-bff3-038a3f37451a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73279dafdc40>]}
[0m17:38:19.936297 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:38:19.937612 [info ] [MainThread]: 
[0m17:38:19.964246 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:38:20.015284 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:38:20.016734 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:38:20.017717 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:38:20.039999 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:38:20.041331 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:38:20.231114 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:38:20.300322 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:38:20.301705 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:38:20.313624 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:38:20.446591 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:38:20.450202 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:38:20.452156 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:38:20.455251 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:38:20.460880 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:38:20.464100 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:38:20.465911 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:38:20.516431 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:38:20.561404 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:38:20.564684 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:38:20.619682 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '62697bee-4860-4506-bff3-038a3f37451a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7327a06e4c10>]}
[0m17:38:20.620912 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m17:38:20.622207 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:38:20.624416 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:38:20.625657 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:38:20.627280 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:38:20.629124 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:38:20.630763 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:38:20.632226 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:38:20.633937 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:38:20.635502 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:38:20.637565 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:38:20.638908 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:38:20.640087 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:38:20.641762 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:38:20.849369 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:38:20.851343 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:38:20.852986 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:38:20.855647 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:38:20.857715 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:38:20.945710 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:38:21.144978 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:38:21.147908 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:38:21.226093 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:38:21.228024 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:38:21.230503 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:38:21.232628 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:38:21.499165 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:38:21.514818 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:38:21.525369 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:38:21.529227 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:38:21.534566 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:38:21.547968 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:38:21.550513 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.92s]
[0m17:38:21.556278 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.92s]
[0m17:38:21.561866 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.92s]
[0m17:38:21.615128 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:38:21.618094 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:38:21.620932 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:38:21.624471 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:38:21.625366 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:38:21.626630 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:38:21.628297 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:38:21.629961 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:38:21.632180 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:38:21.634159 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:38:21.635676 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:38:21.637183 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:38:21.638851 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:38:21.640453 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:38:21.642083 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:38:21.761058 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:38:21.837012 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:38:21.838523 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:38:21.841101 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:38:21.853232 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:38:21.860251 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:38:21.941667 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:38:22.050725 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:38:22.153379 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:38:22.235708 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:38:22.348272 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:38:22.439631 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:38:22.520827 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:38:22.632996 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:38:22.650906 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_62697bee_4860_4506_bff3_038a3f37451a` 
  ...
[0m17:38:22.715914 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:38:22.726468 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_62697bee_4860_4506_bff3_038a3f37451a` 
  ...
[0m17:38:22.731073 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:38:22.733708 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:38:22.739746 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:38:22.826083 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:38:22.933362 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:38:23.027527 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:38:23.043130 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '62697bee-4860-4506-bff3-038a3f37451a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73279c1b1df0>]}
[0m17:38:23.055808 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.41s]
[0m17:38:23.141511 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:38:23.154903 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_62697bee_4860_4506_bff3_038a3f37451a`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:38:23.214393 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_62697bee_4860_4506_bff3_038a3f37451a`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:38:23.240771 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:38:23.257473 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:38:23.329772 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_62697bee_4860_4506_bff3_038a3f37451a'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:38:23.331385 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_62697bee_4860_4506_bff3_038a3f37451a'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:38:23.342203 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:38:23.349854 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:38:23.362970 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:38:23.418926 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:38:23.422781 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_62697bee_4860_4506_bff3_038a3f37451a`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:38:23.426211 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_62697bee_4860_4506_bff3_038a3f37451a`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:38:23.457633 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:38:23.460236 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:38:23.464497 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_62697bee_4860_4506_bff3_038a3f37451a`)
      
    ...
[0m17:38:23.468822 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_62697bee_4860_4506_bff3_038a3f37451a`)
      
    ...
[0m17:38:23.496673 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:38:23.515516 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:38:23.517298 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:38:23.527110 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:38:23.535953 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:38:23.543864 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:38:23.541710 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_62697bee_4860_4506_bff3_038a3f37451a` 
    ...
[0m17:38:23.549355 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_62697bee_4860_4506_bff3_038a3f37451a` 
    ...
[0m17:38:23.562000 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:38:23.619916 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:38:23.621124 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_62697bee_4860_4506_bff3_038a3f37451a` 
  ...
[0m17:38:23.627763 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_62697bee_4860_4506_bff3_038a3f37451a` 
  ...
[0m17:38:23.632436 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:38:23.633834 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:38:23.643290 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:38:23.651876 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:38:23.655753 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:38:23.657688 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:38:23.661345 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '62697bee-4860-4506-bff3-038a3f37451a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73279dcf5c70>]}
[0m17:38:23.717736 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '62697bee-4860-4506-bff3-038a3f37451a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73279c886f10>]}
[0m17:38:23.720358 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.03s]
[0m17:38:23.723560 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.08s]
[0m17:38:23.728302 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:38:23.732132 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:38:23.736709 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:38:23.737869 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:38:23.739003 [debug] [MainThread]: On list__clean: Close
[0m17:38:23.740073 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:38:23.741147 [debug] [MainThread]: On list__mart: Close
[0m17:38:23.742232 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:38:23.743310 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:38:23.744349 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:38:23.745428 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:38:23.746573 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:38:23.747647 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:38:23.748691 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m17:38:23.749754 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m17:38:23.751948 [info ] [MainThread]: 
[0m17:38:23.753252 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.83 seconds (4.83s).
[0m17:38:23.761161 [debug] [MainThread]: Command end result
[0m17:38:24.018221 [info ] [MainThread]: 
[0m17:38:24.019153 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:38:24.019768 [info ] [MainThread]: 
[0m17:38:24.020440 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:38:24.021852 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.760194, "process_in_blocks": "56", "process_kernel_time": 0.65852, "process_mem_max_rss": "115076", "process_out_blocks": "9744", "process_user_time": 6.582223}
[0m17:38:24.022621 [debug] [MainThread]: Command `dbt build` succeeded at 17:38:24.022407 after 7.76 seconds
[0m17:38:24.023273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7327a11c8e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73279f055f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73279d47eb50>]}
[0m17:38:24.023934 [debug] [MainThread]: Flushing usage events
[0m17:39:15.861984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f0a8e1b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f0a5a8ebe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f0a5a8ea90>]}


============================== 17:39:15.871000 | c8b565d6-2f0c-4aa4-a108-a0a7af9747f2 ==============================
[0m17:39:15.871000 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:39:15.872119 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'write_json': 'True', 'target_path': 'None', 'version_check': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'printer_width': '80', 'partial_parse': 'True', 'fail_fast': 'False', 'static_parser': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'profiles_dir': '.', 'introspect': 'True', 'log_format': 'default', 'debug': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'empty': 'False'}
[0m17:39:16.457922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c8b565d6-2f0c-4aa4-a108-a0a7af9747f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f0a83a7b80>]}
[0m17:39:16.653983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c8b565d6-2f0c-4aa4-a108-a0a7af9747f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f0a596b610>]}
[0m17:39:16.655380 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:39:17.072822 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:39:17.581599 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:39:17.582243 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:39:17.783909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c8b565d6-2f0c-4aa4-a108-a0a7af9747f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f0a51e1e80>]}
[0m17:39:18.280747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c8b565d6-2f0c-4aa4-a108-a0a7af9747f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f0a51f78b0>]}
[0m17:39:18.281637 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:39:18.285186 [info ] [MainThread]: 
[0m17:39:18.286388 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:39:18.298561 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:39:18.300119 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:39:18.386795 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:39:18.452935 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:39:19.250726 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:39:19.255626 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:39:19.264505 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:39:19.269493 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:39:19.290158 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:39:19.291656 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:39:19.360417 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:39:19.362891 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:39:19.372640 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:39:19.374747 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:39:19.445857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8b565d6-2f0c-4aa4-a108-a0a7af9747f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f0a59e3670>]}
[0m17:39:19.447875 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:39:19.449167 [info ] [MainThread]: 
[0m17:39:19.474138 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:39:19.475299 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:39:19.476403 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:39:19.477144 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:39:19.542817 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:39:19.544369 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:39:19.686544 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:39:19.801944 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:39:19.803282 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:39:19.815142 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:39:19.890218 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:39:19.941916 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:39:19.943972 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:39:19.947031 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:39:19.952876 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:39:19.955863 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:39:19.957679 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:39:19.960566 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:39:20.054419 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:39:20.057917 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:39:20.063851 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8b565d6-2f0c-4aa4-a108-a0a7af9747f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f0a4ab8af0>]}
[0m17:39:20.064974 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m17:39:20.066297 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:39:20.068326 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:39:20.069449 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:39:20.071111 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:39:20.072309 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:39:20.073741 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:39:20.075643 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:39:20.077989 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:39:20.080121 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:39:20.082190 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:39:20.083860 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:39:20.085527 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:39:20.087181 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:39:20.354708 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:39:20.359026 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:39:20.360639 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:39:20.362916 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:39:20.364503 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:39:20.377204 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:39:20.674141 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:39:20.682980 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:39:20.685750 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:39:20.741810 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:39:20.688674 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:39:20.744465 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:39:20.988889 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:39:21.000134 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:39:21.005141 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:39:21.043160 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:39:21.058231 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.98s]
[0m17:39:21.061763 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:39:21.065108 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.98s]
[0m17:39:21.068001 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:39:21.073102 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:39:21.082161 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:39:21.087974 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.01s]
[0m17:39:21.090812 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:39:21.093508 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:39:21.142230 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:39:21.094733 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:39:21.144493 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:39:21.146275 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:39:21.148439 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:39:21.150710 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:39:21.152705 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:39:21.154352 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:39:21.155975 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:39:21.173662 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:39:21.248220 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:39:21.253189 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:39:21.277082 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:39:21.286245 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:39:21.288903 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:39:21.341871 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:39:21.290970 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:39:21.473593 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:39:21.583697 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:39:21.753152 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m17:39:21.847661 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:39:21.974807 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:39:22.070323 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:39:22.167794 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:39:22.241240 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c8b565d6_2f0c_4aa4_a108_a0a7af9747f2` 
  ...
[0m17:39:22.257926 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c8b565d6_2f0c_4aa4_a108_a0a7af9747f2` 
  ...
[0m17:39:22.260235 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:39:22.269104 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:39:22.277386 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:39:22.284992 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:39:22.357031 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:39:22.453257 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:39:22.551025 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:39:22.668507 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:39:22.673389 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_c8b565d6_2f0c_4aa4_a108_a0a7af9747f2`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:39:22.666019 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_c8b565d6_2f0c_4aa4_a108_a0a7af9747f2`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:39:22.677452 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8b565d6-2f0c-4aa4-a108-a0a7af9747f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f0a3deae50>]}
[0m17:39:22.682695 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.52s]
[0m17:39:22.685226 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:39:22.742895 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:39:22.704489 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:39:22.844342 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_c8b565d6_2f0c_4aa4_a108_a0a7af9747f2'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:39:22.851933 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_c8b565d6_2f0c_4aa4_a108_a0a7af9747f2'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:39:22.863464 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:39:22.867369 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:39:22.880754 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:39:22.887251 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:39:22.890164 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_c8b565d6_2f0c_4aa4_a108_a0a7af9747f2`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:39:22.892366 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_c8b565d6_2f0c_4aa4_a108_a0a7af9747f2`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:39:22.968278 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:39:22.970815 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:39:22.974975 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c8b565d6_2f0c_4aa4_a108_a0a7af9747f2`)
      
    ...
[0m17:39:22.979018 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c8b565d6_2f0c_4aa4_a108_a0a7af9747f2`)
      
    ...
[0m17:39:23.006800 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:39:23.015359 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:39:23.017417 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:39:23.042782 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:39:23.030893 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:39:23.049000 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c8b565d6_2f0c_4aa4_a108_a0a7af9747f2` 
    ...
[0m17:39:23.058838 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:39:23.064677 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c8b565d6_2f0c_4aa4_a108_a0a7af9747f2` 
    ...
[0m17:39:23.067206 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:39:23.081430 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c8b565d6_2f0c_4aa4_a108_a0a7af9747f2` 
  ...
[0m17:39:23.084001 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:39:23.142684 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:39:23.147954 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c8b565d6_2f0c_4aa4_a108_a0a7af9747f2` 
  ...
[0m17:39:23.161655 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:39:23.166208 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:39:23.168782 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:39:23.183395 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:39:23.241608 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8b565d6-2f0c-4aa4-a108-a0a7af9747f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f0a4610c40>]}
[0m17:39:23.245981 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.04s]
[0m17:39:23.248941 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:39:23.251785 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:39:23.256064 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8b565d6-2f0c-4aa4-a108-a0a7af9747f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f0a5b7a730>]}
[0m17:39:23.257994 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.10s]
[0m17:39:23.259801 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:39:23.262259 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:39:23.262925 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:39:23.263522 [debug] [MainThread]: On list__mart: Close
[0m17:39:23.264078 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:39:23.264681 [debug] [MainThread]: On list__clean: Close
[0m17:39:23.265319 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:39:23.266241 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:39:23.267299 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m17:39:23.268020 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m17:39:23.268730 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:39:23.269398 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:39:23.270186 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:39:23.271318 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:39:23.273617 [info ] [MainThread]: 
[0m17:39:23.274924 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.99 seconds (4.99s).
[0m17:39:23.283047 [debug] [MainThread]: Command end result
[0m17:39:23.490229 [info ] [MainThread]: 
[0m17:39:23.491374 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:39:23.542513 [info ] [MainThread]: 
[0m17:39:23.543942 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:39:23.546701 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.8793964, "process_in_blocks": "0", "process_kernel_time": 0.649743, "process_mem_max_rss": "115132", "process_out_blocks": "9744", "process_user_time": 6.597622}
[0m17:39:23.548280 [debug] [MainThread]: Command `dbt build` succeeded at 17:39:23.547851 after 7.88 seconds
[0m17:39:23.549631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f0a8e1b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f0a815f8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f0a5149700>]}
[0m17:39:23.550929 [debug] [MainThread]: Flushing usage events
[0m17:40:16.483985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790b6b307310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790b67f6eaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790b67f6e9a0>]}


============================== 17:40:16.493286 | 20238556-9055-46ca-b9ac-420cd7bcc2f5 ==============================
[0m17:40:16.493286 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:40:16.494414 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'log_format': 'default', 'quiet': 'False', 'empty': 'False', 'target_path': 'None', 'warn_error': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_cache_events': 'False', 'write_json': 'True', 'profiles_dir': '.', 'static_parser': 'True', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'no_print': 'None', 'use_experimental_parser': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'printer_width': '80'}
[0m17:40:17.073176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '20238556-9055-46ca-b9ac-420cd7bcc2f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790b6a8b03a0>]}
[0m17:40:17.217311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '20238556-9055-46ca-b9ac-420cd7bcc2f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790b67fd23a0>]}
[0m17:40:17.218682 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:40:17.687034 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:40:18.192747 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:40:18.193379 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:40:18.394324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '20238556-9055-46ca-b9ac-420cd7bcc2f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790b676d7ee0>]}
[0m17:40:18.831875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '20238556-9055-46ca-b9ac-420cd7bcc2f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790b676c1c70>]}
[0m17:40:18.832766 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:40:18.873046 [info ] [MainThread]: 
[0m17:40:18.874310 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:40:18.886695 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:40:18.898432 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:40:18.988675 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:40:18.989937 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:40:19.786766 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:40:19.789013 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:40:19.795207 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:40:19.797597 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:40:19.901003 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:40:19.912875 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:40:19.917265 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:40:19.973206 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:40:19.979652 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:40:19.980872 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:40:19.995284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '20238556-9055-46ca-b9ac-420cd7bcc2f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790b670df490>]}
[0m17:40:19.996670 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:40:19.997429 [info ] [MainThread]: 
[0m17:40:20.012123 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:40:20.013324 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:40:20.014396 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:40:20.015129 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:40:20.084992 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:40:20.086565 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:40:20.278932 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:40:20.346121 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:40:20.347423 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:40:20.359262 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:40:20.484937 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:40:20.488918 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:40:20.491084 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:40:20.493964 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:40:20.499578 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:40:20.502493 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:40:20.504330 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:40:20.507047 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:40:20.598569 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:40:20.602106 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:40:20.608072 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20238556-9055-46ca-b9ac-420cd7bcc2f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790b669bcbb0>]}
[0m17:40:20.609198 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m17:40:20.610600 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:40:20.612630 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:40:20.613872 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:40:20.615821 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:40:20.616707 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:40:20.617951 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:40:20.620342 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:40:20.622207 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:40:20.674732 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:40:20.676531 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:40:20.678600 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:40:20.680285 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:40:20.692411 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:40:20.801386 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:40:20.809222 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:40:20.819190 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:40:20.820870 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:40:20.884347 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:40:20.901817 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:40:21.209081 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:40:21.210311 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:40:21.212230 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:40:21.214777 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:40:21.217414 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:40:21.273047 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:40:21.515948 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:40:21.530612 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:40:21.533831 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:40:21.574243 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:40:21.587791 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.91s]
[0m17:40:21.591306 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:40:21.594168 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:40:21.596929 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:40:21.602552 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.98s]
[0m17:40:21.608807 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.93s]
[0m17:40:21.611758 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:40:21.614661 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:40:21.617848 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:40:21.618939 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:40:21.620486 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:40:21.621759 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:40:21.673879 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:40:21.675473 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:40:21.677423 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:40:21.679189 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:40:21.680925 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:40:21.682498 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:40:21.684153 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:40:21.706496 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:40:21.785087 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:40:21.807794 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:40:21.811571 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:40:21.814219 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:40:21.816324 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:40:21.888717 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:40:21.917907 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:40:22.009776 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:40:22.104989 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m17:40:22.204198 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:40:22.289984 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:40:22.315205 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:40:22.479240 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:40:22.587405 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:40:22.680085 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:40:22.694874 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:40:22.708159 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_20238556_9055_46ca_b9ac_420cd7bcc2f5` 
  ...
[0m17:40:22.790039 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:40:22.798152 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:40:22.796200 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_20238556_9055_46ca_b9ac_420cd7bcc2f5` 
  ...
[0m17:40:22.813152 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:40:22.910924 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:40:22.913511 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:40:22.976526 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20238556-9055-46ca-b9ac-420cd7bcc2f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790b662c86d0>]}
[0m17:40:22.999759 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.29s]
[0m17:40:23.002838 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:40:23.179481 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_20238556_9055_46ca_b9ac_420cd7bcc2f5`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:40:23.177164 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_20238556_9055_46ca_b9ac_420cd7bcc2f5`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:40:23.213029 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:40:23.228258 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:40:23.289661 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_20238556_9055_46ca_b9ac_420cd7bcc2f5'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:40:23.293745 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_20238556_9055_46ca_b9ac_420cd7bcc2f5'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:40:23.303613 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:40:23.316564 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:40:23.374179 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:40:23.322377 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:40:23.378074 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_20238556_9055_46ca_b9ac_420cd7bcc2f5`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:40:23.380228 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_20238556_9055_46ca_b9ac_420cd7bcc2f5`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:40:23.408791 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:40:23.411927 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_20238556_9055_46ca_b9ac_420cd7bcc2f5`)
      
    ...
[0m17:40:23.413663 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:40:23.417638 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_20238556_9055_46ca_b9ac_420cd7bcc2f5`)
      
    ...
[0m17:40:23.436843 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:40:23.447697 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:40:23.450589 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:40:23.479526 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:40:23.481750 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:40:23.487469 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_20238556_9055_46ca_b9ac_420cd7bcc2f5` 
    ...
[0m17:40:23.497259 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:40:23.503494 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_20238556_9055_46ca_b9ac_420cd7bcc2f5` 
    ...
[0m17:40:23.506140 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:40:23.574134 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:40:23.521516 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_20238556_9055_46ca_b9ac_420cd7bcc2f5` 
  ...
[0m17:40:23.586589 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_20238556_9055_46ca_b9ac_420cd7bcc2f5` 
  ...
[0m17:40:23.593699 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:40:23.606473 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:40:23.608460 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:40:23.675943 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:40:23.680195 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:40:23.688035 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:40:23.694337 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20238556-9055-46ca-b9ac-420cd7bcc2f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790b67dbfee0>]}
[0m17:40:23.694037 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20238556-9055-46ca-b9ac-420cd7bcc2f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790b662c6be0>]}
[0m17:40:23.698105 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.01s]
[0m17:40:23.700689 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.02s]
[0m17:40:23.703544 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:40:23.706456 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:40:23.710955 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:40:23.712102 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:40:23.713266 [debug] [MainThread]: On list__clean: Close
[0m17:40:23.714342 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:40:23.715515 [debug] [MainThread]: On list__mart: Close
[0m17:40:23.716629 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:40:23.717754 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:40:23.718793 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:40:23.719923 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:40:23.720961 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:40:23.772980 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:40:23.773637 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:40:23.774693 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:40:23.776948 [info ] [MainThread]: 
[0m17:40:23.778474 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.90 seconds (4.90s).
[0m17:40:23.786568 [debug] [MainThread]: Command end result
[0m17:40:23.999646 [info ] [MainThread]: 
[0m17:40:24.001359 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:40:24.002801 [info ] [MainThread]: 
[0m17:40:24.004228 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:40:24.006909 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.7143807, "process_in_blocks": "0", "process_kernel_time": 0.714945, "process_mem_max_rss": "115112", "process_out_blocks": "9744", "process_user_time": 6.478826}
[0m17:40:24.008365 [debug] [MainThread]: Command `dbt build` succeeded at 17:40:24.007970 after 7.72 seconds
[0m17:40:24.009668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790b6b307310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790b676c1c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790b675c5ee0>]}
[0m17:40:24.010894 [debug] [MainThread]: Flushing usage events
[0m17:41:15.771247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4bf74b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4bc3a0af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4bc3a09a0>]}


============================== 17:41:15.780787 | b8705c86-aa0c-43aa-b7a6-fdc68943d73c ==============================
[0m17:41:15.780787 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:41:15.781824 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt build --profiles-dir . --target local', 'version_check': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'log_cache_events': 'False', 'quiet': 'False', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'log_format': 'default', 'printer_width': '80', 'debug': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'empty': 'False', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'profiles_dir': '.', 'no_print': 'None', 'introspect': 'True', 'use_colors': 'True', 'write_json': 'True'}
[0m17:41:16.367998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b8705c86-aa0c-43aa-b7a6-fdc68943d73c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4becdefd0>]}
[0m17:41:16.560306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b8705c86-aa0c-43aa-b7a6-fdc68943d73c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4bfb56040>]}
[0m17:41:16.561577 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:41:16.977779 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:41:17.486472 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:41:17.487160 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:41:17.686261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b8705c86-aa0c-43aa-b7a6-fdc68943d73c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4bbb06f10>]}
[0m17:41:18.164265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b8705c86-aa0c-43aa-b7a6-fdc68943d73c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4bea14430>]}
[0m17:41:18.165123 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:41:18.168275 [info ] [MainThread]: 
[0m17:41:18.169315 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:41:18.180714 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:41:18.182143 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:41:18.292881 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:41:18.294237 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:41:19.120980 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:41:19.128101 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:41:19.134653 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:41:19.137362 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:41:19.189751 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:41:19.190643 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:41:19.253492 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:41:19.262089 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:41:19.271464 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:41:19.284384 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:41:19.291858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8705c86-aa0c-43aa-b7a6-fdc68943d73c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4bc078d00>]}
[0m17:41:19.293922 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:41:19.295302 [info ] [MainThread]: 
[0m17:41:19.370016 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:41:19.371135 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:41:19.372247 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:41:19.373001 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:41:19.388865 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:41:19.389956 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:41:19.578799 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:41:19.646375 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:41:19.648238 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:41:19.664991 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:41:19.794883 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:41:19.798642 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:41:19.800832 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:41:19.804116 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:41:19.858636 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:41:19.861733 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:41:19.863888 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:41:19.867016 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:41:19.960006 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:41:19.963449 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:41:19.969271 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8705c86-aa0c-43aa-b7a6-fdc68943d73c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4becd6820>]}
[0m17:41:19.970408 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m17:41:19.971859 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:41:19.973800 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:41:19.974989 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:41:19.976073 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:41:19.977383 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:41:19.979364 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:41:19.981404 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:41:19.983720 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:41:19.985805 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:41:19.988008 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:41:19.990021 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:41:19.991020 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:41:19.991997 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:41:20.192208 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:41:20.183425 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:41:20.194819 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:41:20.197771 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:41:20.264174 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:41:20.281356 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:41:20.474985 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:41:20.490043 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:41:20.497748 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:41:20.499758 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:41:20.501728 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:41:20.503013 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:41:20.662509 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:41:20.670318 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:41:20.676954 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.69s]
[0m17:41:20.680732 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:41:20.689822 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:41:20.691980 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:41:20.698141 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:41:20.702620 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:41:20.701058 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.72s]
[0m17:41:20.705921 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.72s]
[0m17:41:20.707409 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:41:20.709447 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:41:20.755709 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:41:20.756801 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:41:20.758169 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:41:20.760230 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:41:20.762194 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:41:20.764243 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:41:20.765840 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:41:20.767062 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:41:20.768912 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:41:20.770695 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:41:20.772383 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:41:20.774154 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:41:20.897322 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:41:20.962345 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:41:20.967467 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:41:20.969774 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:41:20.977343 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:41:21.053876 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:41:21.073206 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:41:21.159380 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:41:21.265027 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:41:21.374852 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:41:21.497630 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:41:21.556385 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:41:21.677064 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:41:21.786173 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:41:21.875898 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:41:21.886841 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b8705c86_aa0c_43aa_b7a6_fdc68943d73c` 
  ...
[0m17:41:21.891748 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b8705c86_aa0c_43aa_b7a6_fdc68943d73c` 
  ...
[0m17:41:21.897022 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:41:21.953725 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:41:21.958005 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:41:21.971181 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:41:22.156284 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:41:22.260465 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m17:41:22.281818 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8705c86-aa0c-43aa-b7a6-fdc68943d73c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4ba720160>]}
[0m17:41:22.355739 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.51s]
[0m17:41:22.380719 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:41:22.394162 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_b8705c86_aa0c_43aa_b7a6_fdc68943d73c`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:41:22.454160 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_b8705c86_aa0c_43aa_b7a6_fdc68943d73c`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:41:22.488305 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:41:22.504780 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:41:22.575876 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_b8705c86_aa0c_43aa_b7a6_fdc68943d73c'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:41:22.573739 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_b8705c86_aa0c_43aa_b7a6_fdc68943d73c'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:41:22.586158 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:41:22.594106 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:41:22.603116 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:41:22.658150 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:41:22.661910 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_b8705c86_aa0c_43aa_b7a6_fdc68943d73c`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:41:22.664143 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_b8705c86_aa0c_43aa_b7a6_fdc68943d73c`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:41:22.692892 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:41:22.694585 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:41:22.697171 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b8705c86_aa0c_43aa_b7a6_fdc68943d73c`)
      
    ...
[0m17:41:22.699318 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b8705c86_aa0c_43aa_b7a6_fdc68943d73c`)
      
    ...
[0m17:41:22.727041 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:41:22.737259 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:41:22.739734 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:41:22.760311 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:41:22.757675 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:41:22.767159 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b8705c86_aa0c_43aa_b7a6_fdc68943d73c` 
    ...
[0m17:41:22.776040 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:41:22.783864 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:41:22.781949 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b8705c86_aa0c_43aa_b7a6_fdc68943d73c` 
    ...
[0m17:41:22.798751 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b8705c86_aa0c_43aa_b7a6_fdc68943d73c` 
  ...
[0m17:41:22.804233 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:41:22.855083 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:41:22.870576 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b8705c86_aa0c_43aa_b7a6_fdc68943d73c` 
  ...
[0m17:41:22.883717 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:41:22.893681 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:41:22.896441 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:41:22.964328 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:41:22.965819 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8705c86-aa0c-43aa-b7a6-fdc68943d73c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4ba645700>]}
[0m17:41:22.969994 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.20s]
[0m17:41:22.972947 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:41:22.975875 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:41:22.983045 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8705c86-aa0c-43aa-b7a6-fdc68943d73c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4ba3472e0>]}
[0m17:41:22.985233 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.22s]
[0m17:41:22.988218 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:41:22.992327 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:41:22.993484 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:41:22.994709 [debug] [MainThread]: On list__mart: Close
[0m17:41:22.995772 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:41:22.996893 [debug] [MainThread]: On list__clean: Close
[0m17:41:22.997954 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:41:22.999096 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:41:23.000173 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:41:23.001339 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:41:23.002438 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:41:23.054567 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:41:23.055656 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m17:41:23.056856 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m17:41:23.059174 [info ] [MainThread]: 
[0m17:41:23.060590 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.89 seconds (4.89s).
[0m17:41:23.068745 [debug] [MainThread]: Command end result
[0m17:41:23.280168 [info ] [MainThread]: 
[0m17:41:23.281828 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:41:23.283012 [info ] [MainThread]: 
[0m17:41:23.284236 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:41:23.286569 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.7095203, "process_in_blocks": "0", "process_kernel_time": 0.715674, "process_mem_max_rss": "115116", "process_out_blocks": "9744", "process_user_time": 6.514321}
[0m17:41:23.287917 [debug] [MainThread]: Command `dbt build` succeeded at 17:41:23.287574 after 7.71 seconds
[0m17:41:23.289001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4bf74b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4bd027be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af4ba720eb0>]}
[0m17:41:23.290073 [debug] [MainThread]: Flushing usage events
[0m17:42:16.621946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bea7452e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bea40a6b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bea40a6a30>]}


============================== 17:42:16.630933 | 036b3fd9-3983-4070-a3fe-7b781f11f123 ==============================
[0m17:42:16.630933 [info ] [MainThread]: Running with dbt=1.8.9
[0m17:42:16.631960 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False', 'write_json': 'True', 'partial_parse': 'True', 'use_colors': 'True', 'log_format': 'default', 'log_cache_events': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'target_path': 'None', 'indirect_selection': 'eager', 'warn_error': 'None', 'profiles_dir': '.', 'quiet': 'False', 'cache_selected_only': 'False', 'no_print': 'None', 'introspect': 'True', 'debug': 'False', 'printer_width': '80', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'static_parser': 'True', 'empty': 'False'}
[0m17:42:17.211131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '036b3fd9-3983-4070-a3fe-7b781f11f123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bea5f21790>]}
[0m17:42:17.407115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '036b3fd9-3983-4070-a3fe-7b781f11f123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bea3e79d30>]}
[0m17:42:17.408348 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m17:42:17.829044 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m17:42:18.333234 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:42:18.333908 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:42:18.534078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '036b3fd9-3983-4070-a3fe-7b781f11f123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bea380be50>]}
[0m17:42:19.012390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '036b3fd9-3983-4070-a3fe-7b781f11f123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bea379aaf0>]}
[0m17:42:19.013254 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m17:42:19.016446 [info ] [MainThread]: 
[0m17:42:19.017481 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m17:42:19.028959 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:42:19.030494 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m17:42:19.139276 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:42:19.140380 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:42:20.008010 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:42:20.012287 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m17:42:20.016582 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:42:20.019066 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:42:20.117339 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m17:42:20.118307 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m17:42:20.131983 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m17:42:20.137526 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m17:42:20.145503 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:42:20.196054 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:42:20.215719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '036b3fd9-3983-4070-a3fe-7b781f11f123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bea4008640>]}
[0m17:42:20.217517 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m17:42:20.218884 [info ] [MainThread]: 
[0m17:42:20.245346 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m17:42:20.296081 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m17:42:20.297653 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m17:42:20.298761 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m17:42:20.323700 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:42:20.325126 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m17:42:20.524651 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m17:42:20.600357 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m17:42:20.601975 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:42:20.615626 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:42:20.738845 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:42:20.742510 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:42:20.744529 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m17:42:20.796738 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:42:20.802952 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m17:42:20.805955 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:42:20.807903 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m17:42:20.810682 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:42:20.905949 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m17:42:20.909334 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:42:20.915296 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '036b3fd9-3983-4070-a3fe-7b781f11f123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bea2baad90>]}
[0m17:42:20.916424 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.62s]
[0m17:42:20.917712 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m17:42:20.920185 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:42:20.921828 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:42:20.923374 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:42:20.924571 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m17:42:20.926561 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m17:42:20.928347 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m17:42:20.930554 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m17:42:20.932640 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m17:42:20.934638 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m17:42:20.936396 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:42:20.938110 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:42:20.939714 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:42:21.211363 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:42:21.212811 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:42:21.214746 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:42:21.217293 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:42:21.229431 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:42:21.300280 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:42:21.399483 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m17:42:21.496489 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m17:42:21.498460 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:42:21.510609 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m17:42:21.514205 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:42:21.519293 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:42:21.759728 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m17:42:21.794732 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m17:42:21.804258 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:42:21.814684 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:42:21.822664 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.89s]
[0m17:42:21.825782 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m17:42:21.831497 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.90s]
[0m17:42:21.834579 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m17:42:21.896572 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:42:21.899381 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m17:42:21.906803 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.97s]
[0m17:42:21.910693 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m17:42:21.913718 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:42:21.914819 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:42:21.916686 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:42:21.918723 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m17:42:21.920766 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m17:42:21.923215 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m17:42:21.925155 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m17:42:21.926852 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m17:42:21.928492 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m17:42:21.930162 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:42:21.931871 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:42:21.933677 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m17:42:22.102877 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:42:22.114643 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:42:22.116636 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:42:22.119135 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m17:42:22.120921 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:42:22.135090 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m17:42:22.195344 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:42:22.223516 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m17:42:22.331745 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m17:42:22.420162 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:42:22.517121 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:42:22.531787 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m17:42:22.618393 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:42:22.727280 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:42:22.901323 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m17:42:22.936546 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m17:42:23.038062 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:42:23.105598 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_036b3fd9_3983_4070_a3fe_7b781f11f123` 
  ...
[0m17:42:23.118670 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_036b3fd9_3983_4070_a3fe_7b781f11f123` 
  ...
[0m17:42:23.122410 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m17:42:23.129365 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:42:23.137413 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:42:23.206978 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m17:42:23.222607 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '036b3fd9-3983-4070-a3fe-7b781f11f123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bea2447370>]}
[0m17:42:23.230142 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.29s]
[0m17:42:23.302036 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m17:42:23.616646 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_036b3fd9_3983_4070_a3fe_7b781f11f123`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m17:42:23.618216 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_036b3fd9_3983_4070_a3fe_7b781f11f123`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m17:42:23.651004 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m17:42:23.666583 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m17:42:23.729590 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_036b3fd9_3983_4070_a3fe_7b781f11f123'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:42:23.736096 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_036b3fd9_3983_4070_a3fe_7b781f11f123'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:42:23.743484 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:42:23.796627 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:42:23.816530 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m17:42:23.817422 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m17:42:23.819254 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_036b3fd9_3983_4070_a3fe_7b781f11f123`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m17:42:23.820722 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_036b3fd9_3983_4070_a3fe_7b781f11f123`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m17:42:23.839587 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:42:23.841343 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:42:23.844844 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_036b3fd9_3983_4070_a3fe_7b781f11f123`)
      
    ...
[0m17:42:23.847220 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_036b3fd9_3983_4070_a3fe_7b781f11f123`)
      
    ...
[0m17:42:23.870496 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m17:42:23.896249 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m17:42:23.902317 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:42:23.912811 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m17:42:23.922396 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:42:23.925134 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:42:23.930823 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_036b3fd9_3983_4070_a3fe_7b781f11f123` 
    ...
[0m17:42:23.936474 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_036b3fd9_3983_4070_a3fe_7b781f11f123` 
    ...
[0m17:42:23.948435 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:42:23.995933 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m17:42:24.008469 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_036b3fd9_3983_4070_a3fe_7b781f11f123` 
  ...
[0m17:42:24.021294 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_036b3fd9_3983_4070_a3fe_7b781f11f123` 
  ...
[0m17:42:24.028584 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m17:42:24.036269 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:42:24.095549 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m17:42:24.109277 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m17:42:24.114791 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:42:24.117351 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m17:42:24.123887 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '036b3fd9-3983-4070-a3fe-7b781f11f123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bea2b204c0>]}
[0m17:42:24.129928 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '036b3fd9-3983-4070-a3fe-7b781f11f123', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bea4008640>]}
[0m17:42:24.132518 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.20s]
[0m17:42:24.135678 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.21s]
[0m17:42:24.138700 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m17:42:24.195947 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m17:42:24.198508 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:42:24.199251 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m17:42:24.199910 [debug] [MainThread]: On list__mart: Close
[0m17:42:24.200520 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m17:42:24.201135 [debug] [MainThread]: On list__clean: Close
[0m17:42:24.201745 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m17:42:24.202365 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m17:42:24.202984 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m17:42:24.203601 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m17:42:24.204183 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m17:42:24.204826 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m17:42:24.205374 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m17:42:24.205966 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m17:42:24.207258 [info ] [MainThread]: 
[0m17:42:24.208019 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 5.19 seconds (5.19s).
[0m17:42:24.212172 [debug] [MainThread]: Command end result
[0m17:42:24.335667 [info ] [MainThread]: 
[0m17:42:24.336811 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:42:24.338054 [info ] [MainThread]: 
[0m17:42:24.338909 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:42:24.341121 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.9099827, "process_in_blocks": "0", "process_kernel_time": 0.70079, "process_mem_max_rss": "114912", "process_out_blocks": "9744", "process_user_time": 6.586647}
[0m17:42:24.342602 [debug] [MainThread]: Command `dbt build` succeeded at 17:42:24.342131 after 7.91 seconds
[0m17:42:24.343618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bea7452e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bea208d9a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bea5f21790>]}
[0m17:42:24.394455 [debug] [MainThread]: Flushing usage events
